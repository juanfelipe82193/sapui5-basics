sap.ui.define(["sap/m/HeaderContainer","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterDialogController","sap/ui/comp/odata/ODataModelUtil","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/VisualFilterProvider","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/comp/smartvariants/SmartVariantManagement","sap/ui/model/Filter","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/ui/comp/odata/MetadataAnalyser","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms","sap/m/VBox","sap/m/Button","sap/m/Title","sap/suite/ui/generic/template/AnalyticalListPage/controller/DropDownController","sap/suite/ui/generic/template/AnalyticalListPage/controller/DatePickerController","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroBar","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroLine","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroDonut","sap/ui/model/json/JSONModel","sap/ui/core/CustomData","sap/m/Text","sap/m/OverflowToolbarLayoutData","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/model/SimpleType","sap/ui/core/library","sap/m/library","sap/m/DatePicker","sap/base/Log","sap/ui/core/InvisibleText","sap/suite/ui/generic/template/js/StableIdHelper","sap/base/util/deepExtend"],function(H,V,O,a,P,S,F,b,T,M,c,d,f,B,g,D,h,k,l,m,J,C,n,o,p,q,r,s,t,u,L,I,v,w){"use strict";var x="Donut";var y="Line";var z="Bar";var A=r.extend("sap.ui.model.DimensionFilterType",{formatValue:function(e){return e;},parseValue:function(e){return e;},validateValue:function(e){}});var E=H.extend("sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.SmartVisualFilterBar",{metadata:{designTime:true,properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},config:{type:"object",group:"Misc",defaultValue:null},persistencyKey:{type:"string",group:"Misc",defaultValue:null},lazyLoadVisualFilter:{type:"boolean",group:"Misc",defaultValue:false},displayCurrency:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},events:{filterChange:{},Initialized:{},onFilterItemAdded:{}}},renderer:{}});E.prototype.init=function(){if(H.prototype.init){H.prototype.init.apply(this,arguments);}var i=document.body.classList.contains("sapUiSizeCozy");this._cellItemHeightNorth=i?"3rem":"2rem";this._cellItemHeightSouth=i?"9.9rem":"7.5rem";q.system.phone?this._cellItemHeightSouth="9rem":"";this._cellHeight=i?"12rem":"11rem";this._cellWidth="20rem";this.labelHeight=2.0;this.compHeight=i?9.9:7.9;this.cellHeightPadding=1;this.cellHeight=(this.labelHeight+this.compHeight+this.cellHeightPadding)+"rem";this.cellWidth=320;this._dialogFilters={};this._compactFilters={};this._oVariantConfig={};this._smartFilterContext;this._oMetadataAnalyser;this.setModel(new J(),'_visualFilterConfigModel');if(i){if(q.system.phone){this.setOrientation("Vertical");this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBarCozyPhone");}else{this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBarCozy");}}else{this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBar");}};E.prototype.propagateProperties=function(){H.prototype.propagateProperties.apply(this,arguments);this._initMetadata();};E.prototype._initMetadata=function(){if(!this.bIsInitialised){O.handleModelInit(this,this._onMetadataInit);}};E.prototype._onMetadataInit=function(){if(this._smartFilterContext.isInitialised()){this._initiateVisualFilterLoad();}else{this._smartFilterContext.attachInitialized(this._initiateVisualFilterLoad,this);}};E.prototype._initiateVisualFilterLoad=function(){if(this.bIsInitialised){return;}this._annoProvider=this._createVisualFilterProvider();if(!this._annoProvider){return;}this._oMetadataAnalyser=this._annoProvider.getMetadataAnalyser();this.bIsInitialised=true;this._updateFilterBar();};E.prototype._createVisualFilterProvider=function(){var e=this.getModel();var i=this.getEntitySet();if(!e||!i){return null;}return new a(this);};E.prototype._getBasicGroupTitle=function(){return this.getModel("i18n").getResourceBundle().getText("VIS_FILTER_GRP_BASIC_TITLE");};E.prototype._getFieldGroupForProperty=function(e,i){return this._annoProvider?this._annoProvider._getFieldGroupForProperty(e,i):undefined;};E.prototype._getGroupList=function(){return this._annoProvider?this._annoProvider.getGroupList():[];};E.prototype._getGroupMap=function(){return this._annoProvider?this._annoProvider.getGroupMap():{};};E.prototype._getMeasureMap=function(){return this._annoProvider?this._annoProvider.getMeasureMap():{};};E.prototype._getDimensionMap=function(){return this._annoProvider?this._annoProvider.getDimensionMap():{};};E.prototype.setSmartFilterContext=function(e){this._smartFilterContext=e;};E.prototype._updateFilterBar=function(){var e=this._getAnnotationSettings();if(e&&e.filterList){var i=this._convertSettingsToConfig(e);}else{i={filterCompList:[]};this.getModel('_visualFilterConfigModel').setData(i);return;}var j=this._getVariantConfig();if(j&&j.config){i.filterCompList.forEach(function(G){if(j.config[G.component.properties.parentProperty]){w(G,j.config[G.component.properties.parentProperty]);}});this._oVariantConfig=i;}this.unbindAggregation('content',true);this.getModel('_visualFilterConfigModel').setData(i);this.bindAggregation('content',{path:"_visualFilterConfigModel>/filterCompList",factory:function(G,K){var N=K.getProperty('component'),Q=N?N.properties:undefined,R=this._resolveChartType(N?N.type:undefined);return this._createHeaderItems(K.sPath,R,Q);}.bind(this),filters:new F("shownInFilterBar",p.EQ,true)});this.attachBrowserEvent("keyup",c.onKeyUpVisualFilter.bind(c));this.attachBrowserEvent("keydown",c.onKeyDownVisualFilter.bind(c,this._smartFilterContext));this.fireInitialized();};E.prototype._createHeaderItems=function(j,G,K){var N=this._createFilterItemOfType(G,K,true);N.data("isDialogFilterItem","false");var Q=K.selectFilters&&K.selectFilters.SelectOptions,R=N.getInParameters(),U=[],W=this;if(R&&R.length>0){R.forEach(function(e){U.push({path:'_filter>/'+e.localDataProperty});});}N.addCustomData(new C({key:'sPath',value:j}));if(K.stringdate){N.addCustomData(new C({key:'stringdate',value:K.stringdate}));}if(W.getEntitySet()===N.getEntitySet()){var X=W._smartFilterContext.determineMandatoryFilterItems();if(X&&X.length>0){X.forEach(function(e){if(!e.data("isCustomField")){U.push({path:'_filter>/'+e.getName()});}});}}N.bindProperty('dimensionFilter',{path:'_filter>/'+N.getParentProperty(),type:new A()});N.bindProperty('measureField',{path:'_visualFilterConfigModel>'+j+'/component/properties/measureField'});N.bindProperty('sortOrder',{path:'_visualFilterConfigModel>'+j+'/component/properties/sortOrder'});N.bindProperty('unitField',{path:'_visualFilterConfigModel>'+j+'/component/properties/measureField',formatter:function(){var e=W._getMeasureMap();var f1=e[this.getEntitySet()][this.getMeasureField()];return f1?f1.fieldInfo.unit:"";}});if(U&&U.length>0){N.bindProperty('dimensionFilterExternal',{parts:U,formatter:function(){var R=this.getInParameters()||[];var f1=this.getParentProperty();var g1,h1;if(W.getEntitySet()===this.getEntitySet()){var X=W._smartFilterContext.determineMandatoryFilterItems();X.forEach(function(w1){var x1=w1.getName();var y1=R&&R.some(function(e){return e.localDataProperty===x1;});if(x1.indexOf("$Parameter")===-1&&!y1){R.push({localDataProperty:x1,valueListProperty:x1});}});}if(!(W.getEntitySet()===this.getEntitySet()&&W._smartFilterContext.getAnalyticBindingPath()!=="")&&(W._smartFilterContext.getAnalyticBindingPath()===""||W._smartFilterContext.getAnalyticBindingPath().indexOf("P_DisplayCurrency")!=-1)){var i1=this.getMeasureField();var j1=W.getModel();var k1=j1.getMetaModel();var l1=k1.getODataEntityType(W._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.getEntitySet()));var m1=k1.getODataEntitySet(this.getEntitySet());var n1=k1.getODataProperty(l1,i1);var o1=W.getProperty("displayCurrency");var p1=n1&&n1[d.ISOCurrency];if(o1&&p1){var q1=p1.Path;for(var r1=(R.length-1);r1>-1;r1--){var s1=R[r1].valueListProperty;var t1=R[r1].localDataProperty;if(s1===q1){var u1=W._smartFilterContext.getFilterData();if(!u1[t1]){h1=k1.getODataProperty(l1,q1);var v1=h1&&c.isPropertyNonFilterable(m1,h1.name);if(!v1){g1=new F({aFilters:[new F({path:q1,operator:"EQ",value1:o1,value2:undefined})],and:false});}}break;}}}}if(this._chart instanceof sap.suite.ui.microchart.InteractiveDonutChart){this._inParameterFilterList=new F({aFilters:[],bAnd:true});}return W._getFiltersForFilterItem(R,f1,g1,q1,Q,this._inParameterFilterList);}});}else if(Q&&Q.length>0){var Y=new F({aFilters:[],bAnd:true});for(var i in Q){var Z=Q[i];Y=this.fnAddSelectOptionsToFilters(Z,Y);}N.setProperty('dimensionFilterExternal',Y);}if(N.attachFilterChange){N.attachFilterChange(this._onFilterChange,this);}if(N.attachTitleChange){N.attachTitleChange(this._onTitleChange,this);}var $=this._createTitleToolbar(K,N),_=new f({height:this._cellItemHeightNorth,items:[$]});var a1=new f({width:"100%",height:this._cellItemHeightSouth,items:[new n({width:this.cellWidth+"px",textAlign:s.TextAlign.Center,text:{path:'_visualFilterConfigModel>'+j+'/overlayMessage',formatter:function(e){return e&&this.getModel("i18n").getResourceBundle().getText(e);}}})],visible:{path:'_visualFilterConfigModel>'+j+'/showChartOverlay',formatter:function(e){return e;}}});a1.addStyleClass("sapUiOverlay");a1.addStyleClass("sapSmartTemplatesAnalyticalListPageVFOverflow");a1.addStyleClass("sapSmartTemplatesAnalyticalListPageVFOverflowCozy");var b1=new f({height:this._cellItemHeightSouth,items:[N],visible:{path:"_visualFilterConfigModel>"+j+"/showChartOverlay",formatter:function(e){return!e;}}});var c1="visualFilterBarInvisibleText"+N.getParentProperty();var d1=new I({id:c1});if(this.getAriaLabelledBy().indexOf(c1)===-1){this.addAriaLabelledBy(c1);}var e1=new f({id:v.getStableId({type:"VisualFilterBar",subType:"FilterItemContainer",sProperty:N.getParentProperty()}),fieldGroupIds:["headerBar"],height:this._cellHeight,width:(this.cellWidth+16)+"px",items:[_,a1,b1,d1]});_.addStyleClass("sapSmartTemplatesAnalyticalListPageVFTitle");a1.addStyleClass("sapSmartTemplatesAnalyticalListPageVFChart");b1.addStyleClass("sapSmartTemplatesAnalyticalListPageVFChart");this.fireOnFilterItemAdded(N);return e1;};E.prototype.fnAddSelectOptionsToFilters=function(e,i){var j=new F({aFilters:[],bAnd:false});var G=this,K=e.PropertyName&&e.PropertyName.PropertyPath;e.Ranges.forEach(function(R){var N=R.Low&&R.Low.String,Q=R.Sign&&R.Sign.EnumMember&&R.Sign.EnumMember.split("/")[1],U=R.Option&&R.Option.EnumMember&&R.Option.EnumMember.split("/")[1],W=R.High&&R.High.String;var X=G._getSelectOptionFilters(K,N,W,U,Q);j.aFilters.push(X);});i.aFilters.push(j);return i;};E.prototype._getAnnotationSettings=function(){return this._annoProvider?this._annoProvider.getVisualFilterConfig():null;};E.prototype._convertSettingsToConfig=function(e,G){var K={filterCompList:[]};var N=this._getGroupList();var Q={};for(var i=0;i<N.length;i++){var R=N[i];for(var j=0;j<R.fieldList.length;j++){var U=R.fieldList[j];Q[U.name]={name:R.name,label:R.label};}}var W=this._getGroupMap();var X=W["_BASIC"];var Y=[];if(X&&X.fieldList){for(var i=0;i<X.fieldList.length;i++){Y.push(X.fieldList[i].name);}}var Z=this._getMeasureMap(),$=e.filterList,_={};for(var i=0;i<$.length;i++){var a1=$[i];var b1=a1.dimension.field;var c1=Z[a1.collectionPath][a1.measure.field];var d1=false;if(c1.fieldInfo[d.ISOCurrency]){d1=true;}var e1={shownInFilterBar:a1.selected,component:{type:a1.type,properties:{sortOrder:a1.sortOrder,measureField:a1.measure.field,parentProperty:a1.parentProperty?a1.parentProperty:undefined,stringdate:a1.stringdate}}};if(!G){var f1={shownInFilterDialog:a1.selected||Y.indexOf(b1)!=-1,group:Q[a1.parentProperty],component:{properties:{selectFilters:a1.selectionVariant?a1.selectionVariant:undefined,scaleFactor:a1.scaleFactor,numberOfFractionalDigits:a1.numberOfFractionalDigits,filterRestriction:a1.filterRestriction,lazyLoadVisualFilter:this.getLazyLoadVisualFilter(),width:this.cellWidth+"px",height:this.compHeight+"rem",entitySet:a1.collectionPath?a1.collectionPath:this.getEntitySet(),dimensionField:b1,dimensionFieldDisplay:a1.dimension.fieldDisplay,dimensionFilter:a1.dimensionFilter,unitField:c1?c1.fieldInfo.unit:"",isCurrency:d1,isDropDown:a1.isDropDown,isMandatory:a1.isMandatory,outParameter:a1.outParameter?a1.outParameter:undefined,inParameters:a1.inParameters?a1.inParameters:undefined,textArrangement:a1.displayBehaviour,chartQualifier:a1.chartQualifier?a1.chartQualifier:undefined,dimensionFieldIsDateTime:a1.dimensionFieldIsDateTime,dimensionFieldIsDateTimeOffset:a1.dimensionFieldIsDateTimeOffset}}};w(e1,f1);K.filterCompList.push(e1);}else{_[a1.parentProperty]=e1;}}return G?_:K;};E.prototype._setVariantModified=function(){if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true);}};E.prototype._checkMandatoryFilters=function(){var e=this._smartFilterContext.getFilterData();var j=this._smartFilterContext.determineMandatoryFilterItems();var G=false;for(var i=0;i<j.length;i++){if(e[j[i].getName()]===undefined){if(e._CUSTOM["sap.suite.ui.generic.template.customData"][j[i].getName()]===undefined){G=true;break;}}}if(G){this._smartFilterContext.showFilterDialog();}};E.prototype._onFilterChange=function(e){this._setVariantModified();this.fireFilterChange();this._checkMandatoryFilters();};E.prototype._getFiltersForFilterItem=function(e,j,G,K,N,Q){var R={},U=[],W=[],X=new F({aFilters:[],bAnd:true});if(e&&e.length>0){var Y=function(e1){e1.sPath=_;};for(var Z=(e.length-1);Z>-1;Z--){var $=e[Z].localDataProperty,_=e[Z].valueListProperty;if(N){for(var i=0;i<N.length;i++){var a1=N[i];var b1=a1.PropertyName&&a1.PropertyName.PropertyPath;if(W.indexOf(b1)===-1){if(b1===j){X=this.fnAddSelectOptionsToFilters(a1,X);W.push(b1);}else{var c1=this._smartFilterContext.determineFilterItemByName(b1);if(c1&&(c1.getVisibleInFilterBar()||c1.getPartOfCurrentVariant())){var d1=this._smartFilterContext.getFilters([b1]);if((d1&&d1.length)||(U.indexOf(b1)!==-1)){continue;}else{X=this.fnAddSelectOptionsToFilters(a1,X);W.push(b1);}}else{X=this.fnAddSelectOptionsToFilters(a1,X);W.push(b1);}}}}}if($!==j&&U.indexOf($)===-1){var c1=this._smartFilterContext.determineFilterItemByName($);if(c1&&(c1.getVisibleInFilterBar()||c1.getPartOfCurrentVariant())){R=this._smartFilterContext.getFilters([$]);if(R&&R.length>0){if(R[0].aFilters){R[0].aFilters.forEach(Y.bind(this));}else{Y(R[0]);}U.push($);X.aFilters.push(R[0]);if(Q){Q.aFilters.push(R[0]);}}}}}if(G){X.aFilters.push(G);}}else{if(N&&N.length){for(var i=0;i<N.length;i++){var a1=N[i];X=this.fnAddSelectOptionsToFilters(a1,X);}}}return X;};E.prototype._getSelectOptionFilters=function(e,i,j,G,K){if(K==="E"){if(G!==p.EQ){L.error("Exclude sign is supported only with EQ operator");return;}else{G=p.NE;K="I";}}if(G==="CP"){G=p.Contains;if(i.indexOf("*")!==-1){var N=i.indexOf('*');var Q=i.lastIndexOf('*');if(N>-1){if((N===0)&&(Q!==(i.length-1))){G=p.EndsWith;i=i.substring(1,i.length);}else if((N!==0)&&(Q===(i.length-1))){G=p.StartsWith;i=i.substring(0,i.length-1);}else{i=i.substring(1,i.length-1);}}}}var R=new F({path:e,sign:K,operator:G,value1:i,value2:j});return R;};E.prototype._createTitleToolbar=function(e,i){var j=this.getModel("@i18n");var G=i.getTitle(j);var K=new g({text:G.titleMD,titleStyle:s.TitleLevel.H6});if(i.getProperty("isMandatory")){K.addStyleClass("sapMLabelRequired");}var N=new g({text:G.titleUnitCurr.length>1?"| "+G.titleUnitCurr:"",titleStyle:s.TitleLevel.H6,width:"4.15rem"});K.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterTitleText");N.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterTitleText");var Q=this._smartFilterContext.getControlByKey(e.parentProperty);this._smartFilterContext.ensureLoadedValueHelp(e.parentProperty);if(Q){var R=c.getPropertyNameDisplay(this.getModel(),i.getEntitySet(),i.getDimensionField(),j),U=this.getModel("i18n").getResourceBundle(),W=Q.getShowValueHelp&&Q.getShowValueHelp()&&!e.dimensionFieldIsDateTimeOffset,X=Q.getMetadata().getName()==="sap.m.DateTimePicker",Y=Q instanceof u,Z=(Y&&!X)?"sap-icon://appointment-2":"",$=(e.isDropDown)?"sap-icon://slim-arrow-down":"",_=W?"sap-icon://value-help":Z||$,a1,b1=new B({id:v.getStableId({type:"VisualFilterBar",subType:"ValueHelpButton",sProperty:i.getParentProperty()}),text:{path:"_filter>/"+i.getParentProperty(),formatter:function(d1){var e1=i.getFilterRestriction();a1=0;if(d1){if(e1==='single'){a1=1;}else{if(typeof d1==="object"){if(d1.value){a1++;}if(d1.items&&d1.items.length){a1+=d1.items.length;}if(d1.ranges&&d1.ranges.length){a1+=d1.ranges.length;}}else{a1++;}}}return a1?"("+a1+")":"";}},icon:(W||e.isDropDown||Y)?_:"",customData:[new C({key:'isF4Enabled',value:(W||e.isDropDown||Y)?true:false})],visible:{path:"_filter>/"+i.getParentProperty(),formatter:function(d1){if(W||e.isDropDown||(Y&&!X)){return true;}else{if(!d1){return false;}if(typeof d1==="object"){if(d1 instanceof Date){return true;}return(d1.value||(d1.items&&d1.items.length)||(d1.ranges&&d1.ranges.length))?true:false;}return true;}}},enabled:{path:'_visualFilterConfigModel>'+i.data("sPath")+'/showChartOverlay',formatter:function(d1){return!d1;}},press:function(d1){if(W){if(Q.getParent().getParent()===null){this._smartFilterContext.addAggregation('dependents',Q.getParent());}Q.fireValueHelpRequest.call(Q);}else if(e.isDropDown){var e1=this._isDimensionFieldFilterable(this.getModel(),e.entitySet,e.dimensionField),f1=this.getModel("visualFilter")||this.getModel();D.createDropdown(d1.getSource(),i,f1,R,e,e1);}else if(Y&&!X){h._createDatePicker(d1.getSource(),i);}else{V.launchAllFiltersPopup(b1,i,d1.getSource().getModel('i18n'));}}.bind(this),layoutData:new o({priority:t.OverflowToolbarPriority.NeverOverflow}),tooltip:{path:"_filter>/"+i.getParentProperty(),formatter:function(){return c.getTooltipForValueHelp(W,R,U,a1,Y);}}});}var c1=new b({design:t.ToolbarDesign.Transparent,width:this.cellWidth+"px",content:[K,N,new T(),b1]});c1.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterTitleToolbar");return c1;};E.prototype._isDimensionFieldFilterable=function(e,i,j){var G=e.getMetaModel(),K=G.getODataEntitySet(i),N=G.getODataEntityType(K.entityType),Q=G.getODataProperty(N,j);return(Q["sap:filterable"]===undefined)?true:Q["sap:filterable"];};E.prototype.getTitleByFilterItemConfig=function(e,i,j){var G=e.component.properties;var K=G.entitySet;var N=this.getModel();var Q=this.getModel("@i18n");if(!N){return"";}var R=c.getPropertyNameDisplay(N,K,G.measureField,Q);var U=c.getPropertyNameDisplay(N,K,G.dimensionField,Q);if(!i){i="";}if(!j){j="";}var W=this.getModel("i18n").getResourceBundle();var X=W.getText("VIS_FILTER_TITLE_MD",[R,U]);var Y=j+" "+i;Y=Y.trim();var Z={titleMD:X,titleUnitCurr:Y};return Z;};E.prototype._updateVisualFilterAria=function(e,i,j){var G=e.getItems();var R=this.getModel("i18n").getResourceBundle();var K=R.getText("VIS_FILTER_ITEM_ARIA");var N=i.getParentProperty();if(i.getProperty("isMandatory")){K+=" "+R.getText("VIS_FILTER_MANDATORY_PROPERTY_ARIA",N);}var Q=G[0].getItems()[0].getContent()[0];var U=G[0].getItems()[0].getContent()[1];K+=" "+(U.getText().length>0?Q.getText()+U.getText():Q.getText());if(j==="true"){K+=" "+G[1].getItems()[0].getText();K+=" "+R.getText("VIS_FILTER_BAR_NAVIGATE_ARIA");}else{K+=" "+R.getText("VIS_FILTER_BAR_NAVIGATE_ARIA")+" "+R.getText("VIS_FILTER_ACCESS_FIELDS_ARIA");}G[G.length-1].setText(K);};E.prototype._onTitleChange=function(e){var i=e.getSource().getParent().getParent();var j=i.getItems()[i.getItems().length-2].getItems()[0];if(j.data("sOverlay")!=="true"){var G=i.getItems()[0].getItems()[0].getContent()[0];var K=i.getItems()[0].getItems()[0].getContent()[1];var N=this.getModel("i18n");var Q=this.getModel("@i18n");if(!N){return"";}var R=N.getResourceBundle();if(e.getSource().getProperty("isMandatory")){G.addStyleClass("sapMLabelRequired");}var U=e.getSource().getTitle(Q);G.setText(U.titleMD);var W=U.titleUnitCurr==""?U.titleMD:R.getText("VIS_FILTER_TITLE_MD_WITH_UNIT_CURR",[U.titleMD,U.titleUnitCurr]);G.setTooltip(W);K.setText(U.titleUnitCurr.length>0?"| "+U.titleUnitCurr:"");K.setTooltip("");var X=U.titleUnitCurr.split(" ");if(U.titleUnitCurr==""){K.setVisible(false);}else{K.setVisible(true);var Y=X.length>1?"4.15rem":"2.4rem";K.setWidth(Y);}}this._updateVisualFilterAria(i,j,j.data("sOverlay"));};E.prototype._getSupportedFilterItemList=function(){if(!this._supportedFilterItemList){this._supportedFilterItemList=[{type:"Bar",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroBar",iconLink:"sap-icon://horizontal-bar-chart",textKey:"VISUAL_FILTER_CHART_TYPE_BAR"},{type:"Donut",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroDonut",iconLink:"sap-icon://donut-chart",textKey:"VISUAL_FILTER_CHART_TYPE_Donut"},{type:"Line",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroLine",iconLink:"sap-icon://line-charts",textKey:"VISUAL_FILTER_CHART_TYPE_Line"}];}return this._supportedFilterItemList;};E.prototype._getSupportedFilterItemMap=function(){if(!this._supportedFilterItemMap){this._supportedFilterItemMap={};var e=this._getSupportedFilterItemList();for(var i=0;i<e.length;i++){var j=e[i];this._supportedFilterItemMap[j.type]=j;}}return this._supportedFilterItemMap;};E.prototype._resolveChartType=function(e){var i=this._getSupportedFilterItemMap();var j=i[e];if(!j){var G;for(G in i){j=i[G];break;}L.error("Could not resolve the filter component type: \""+e+"\", falling back to "+G);e=G;}return e;};E.prototype._createFilterItemOfType=function(e,i,j){var G;var K=v.getStableId({type:(j?"VisualFilterBar":"VisualFilterDialog"),subType:"FilterItemMicroChart",sProperty:i.parentProperty});if(e===z){G=new k(K,i);}else if(e===y){G=new l(K,i);}else if(e===x){G=new m(K,i);}G.setSmartFilterId(this.getSmartFilterId());G.setModel(this.getModel('i18n'),'i18n');G.setModel(this.getModel("_templPriv"),"_templPriv");if(!this._smartFilterContext.isDialogOpen()){G.setModel(this.getModel('_filter'),'_filter');G.setModel(this.getModel('_visualFilterConfigModel'),"_visualFilterConfigModel");}G.setModel(this.getModel());var N=this.getModel("visualFilter");if(N){G.setModel(N,"visualFilter");}return G;};E.prototype.getConfig=function(e){var j=this.getModel('_visualFilterConfigModel').getData(),G={};if(!j){return{filterCompList:[]};}var K=0;var N=sap.ui.getCore().byFieldGroupId("headerBar");for(var i=0;i<j.filterCompList.length;i++){var Q=j.filterCompList[i];if(e){G[Q.component.properties.parentProperty]={shownInFilterBar:Q.shownInFilterBar,shownInFilterDialog:Q.shownInFilterDialog,component:{type:Q.component.type,properties:{measureField:Q.component.properties.measureField,sortOrder:Q.component.properties.sortOrder,parentProperty:Q.component.properties.parentProperty}}};}else{if(!Q.shownInFilterBar){continue;}var R=N[K];if(!R){L.error("The configured selected filter bar items do not correspond to the actual filter bar items.  Could be an error during initialization, e.g. a chart class not found");return{filterCompList:[]};}K++;if(R._chart){var U=R;Q.component.properties=U.getP13NConfig();}}}return e?G:j;};E.prototype.setSmartVariant=function(e){this.setAssociation("smartVariant",e);if(e){var i=new P({type:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.SmartVisualFilterBar",keyName:"persistencyKey"});i.setControl(this);}this._oVariantManagement=this._getVariantManagementControl(e);if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(i);this._oVariantManagement.initialise(this._variantInitialised,this);this._oVariantManagement.attachSave(this._onVariantSave,this);}else if(e){if(typeof e==="string"){L.error("Variant with id="+e+" cannot be found");}else if(e instanceof sap.ui.core.Control){L.error("Variant with id="+e.getId()+" cannot be found");}}else{L.error("Missing SmartVariant");}};E.prototype._getVariantManagementControl=function(e){var i=null;if(e){i=typeof e=="string"?sap.ui.getCore().byId(e):e;if(i&&!(i instanceof S)){L.error("Control with the id="+e.getId?e.getId():e+" not of expected type");return null;}}return i;};E.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD";}};E.prototype._onVariantSave=function(){if(this._oCurrentVariant=="STANDARD"){this._oCurrentVariant={config:this.getConfig(true)};}};E.prototype.applyVariant=function(e,i){this._oCurrentVariant=e;if(this._oCurrentVariant=="STANDARD"){this._oCurrentVariant=null;}if(this._oCurrentVariant&&this._oCurrentVariant.config&&this._oCurrentVariant.config.filterCompList){this._oCurrentVariant.config=null;}if(this._oCurrentVariant&&this._oCurrentVariant.config==null){var j=this._getAnnotationSettings();if(j&&j.filterList){this._oCurrentVariant.config=this._convertSettingsToConfig(j,true);}}this._updateFilterBar();if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(false);}};E.prototype._getVariantConfig=function(){return this._oCurrentVariant;};E.prototype.fetchVariant=function(){if(!this._oCurrentVariant||this._oCurrentVariant=="STANDARD"){var e=this._getAnnotationSettings();if(e&&e.filterList){this._oCurrentVariant={config:this._convertSettingsToConfig(e,true)};return this._oCurrentVariant;}else{return{config:null};}}return{config:this.getConfig(true)};};E.prototype._getStandardVariantConfig=function(){var e=this._getAnnotationSettings();var i=this._convertSettingsToConfig(e);return i;};E.prototype.updateVisualFilterBindings=function(e,U){if(U){for(var i in this.filterChartList){var j=this.filterChartList[i];if(j._chart){j._updateBinding();j._bAllowBindingUpdateOnPropertyChange=e===true;}}}else{var G=sap.ui.getCore().byFieldGroupId("headerBar");for(var i=0;i<G.length;i++){if(G[i]._chart){G[i]._updateBinding();G[i]._bAllowBindingUpdateOnPropertyChange=e===true;}}}};E.prototype.addVisualFiltersToBasicArea=function(e){var j=w({},this.getModel('_visualFilterConfigModel').getData()),G=(e&&e.constructor===Array&&e.length)?e.length:0,K=0;if(!j){L.error("Could not add filter to basic area. No config found!");return false;}else if(!G){L.error("Improper parameter passed. Pass an array of properties.");return false;}else{for(var i=0;i<j.filterCompList.length;i++){var N=j.filterCompList[i];if(e.indexOf(c.readProperty(N.component.properties.parentProperty))!==-1&&!N.shownInFilterBar){N.shownInFilterBar=true;N.shownInFilterDialog=true;K++;}}if(K){this.getModel('_visualFilterConfigModel').setData(j);return true;}else{L.info("Filters already present in visual filter basic area");return false;}}};return E;},true);
