sap.ui.define(["sap/ui/base/Object","sap/ui/Device","sap/ui/model/Filter","sap/suite/ui/generic/template/lib/testableHelper","sap/base/util/extend"],function(B,D,F,t,e){"use strict";function h(f,H){if(Array.isArray(f)){var o=true;var a;for(var i=0;i<f.length;i++){var b=h(f[i],H);if(o){if(b===f[i]){continue;}o=false;a=f.slice(0,i);}if(b){a.push(b);}}return o?f:a;}if(f.aFilters){var n=h(f.aFilters,H);if(n===f.aFilters){return f;}if(n.length===0){return null;}if(n.length===1){return n[0];}return new F({filters:n,and:f.bAnd});}return H(f);}function g(c,T,C){var s;var o=T.oComponentUtils.getTemplatePrivateModel();var p=C.pathInTemplatePrivateModel+'/implementingHelper';var I=p+"/ignoredFilters";o.setProperty(p,{ignoredFilters:[]});function G(i,j){return i;}function f(){var i;for(var j in s){var V=s[j];var J=V.smartControl.getEntitySet();if(i&&i!==J){return true;}i=J;}return false;}function a(i,V,j,J){if(j&&J){r(i,j);}var K=C.smartFilterBar;if(!K){return i;}var L=K.getFilters();if(L.length<1){if(!J){o.setProperty(I,[]);V.implementingHelperAttributes.ignoredLabels=[];}return i;}var M=!J&&Object.create(null);L=d(V,L,M);return L.concat(i);}function b(P){var i,j;if(P.indexOf("/")!==-1){i=P.split("/");j=i.pop();}else{j=P;}return j;}function d(V,i,j){var J=V.smartControl;var M=J.getModel().getMetaModel();var K=T.oCommonUtils.getMetaModelEntityType(J);var N=K.navigationProperty;var L=function(W){var X=W.sPath;var Y=false;var Z=b(X);var $=k(X,J,M,K,N,V);$.some(function(_){var a1;if(_.name===Z){a1=_["com.sap.vocabularies.UI.v1.Hidden"];Y=a1?a1.Bool!=="true":true;return Y;}return false;});if(Y){return W;}if(j){j[X]=true;}return null;};var P=h(i,L);if(j){var Q=Object.keys(j);var U=Q.map(function(W){var X=q(W,V.smartControl);return X["sap:label"]?X["sap:label"]:X.name;});o.setProperty(I,U);V.implementingHelperAttributes.ignoredLabels=U;}return P;}function k(P,J,M,K,N,V){var L,Q,U,W,X;if(P.indexOf("/")!==-1){L=P.split("/");for(var i=0;i<L.length-1;i++){Q=L[i];for(var j in N){if(N[j].name===Q){U=true;break;}}if(!U){return[];}W=M.getODataAssociationEnd(K,Q);K=W&&M.getODataEntityType(W.type);N=K&&K.navigationProperty;}X=K&&K.property;}else{X=V.implementingHelperAttributes.entityTypeProperty;}return X;}function r(J,K){for(var i in K){var L=K[i];for(var j=J.length;j--;j>=0){if(JSON.stringify(J[j])===JSON.stringify(L)){J.splice(j,1);break;}}}}function l(V){var i=T.oCommonUtils.getMetaModelEntityType(V.smartControl);return{entityTypeProperty:i.property,dirtyState:0,activeObjectEnabled:false};}function m(i,R,j){s=i;for(var K in s){var V=s[K];V.implementingHelperAttributes=l(V);if(C.smartFilterBar){C.smartFilterBar.attachSearch(function(L){R(3);});}}if(C.pathToActiveObjectEnabled){var J=o.bindProperty(C.pathToActiveObjectEnabled);J.attachChange(function(L){var M=j();M.implementingHelperAttributes.activeObjectEnabled=o.getProperty(C.pathToActiveObjectEnabled);});}}function n(i,j){if(!j){return"";}var J="";var K=s[j].text;if(i&&i.length>0){if((D.system.tablet||D.system.phone)&&!D.system.desktop){if(i.length>1){J=T.oCommonUtils.getText("MESSAGE_MULTIPLE_VALUES_S_FORM",[i.join(", "),K]);}else{J=T.oCommonUtils.getText("MESSAGE_SINGLE_VALUE_S_FORM",[i[0],K]);}}else if(i.length>1){J=T.oCommonUtils.getText("MESSAGE_MULTIPLE_VALUES_L_FORM",[i.join(", "),K]);}else{J=T.oCommonUtils.getText("MESSAGE_SINGLE_VALUE_L_FORM",[i[0],K]);}}return J;}function q(P,i){var U;var j=v(i);for(var K in j){U=u(j[K],P);if(U){break;}}return U;}function u(i,P){return i.filter(function(j){return j.name===P;})[0];}function v(i){var P=[];for(var K in s){var V=s[K];if(V.smartControl!==i){P.push(V.implementingHelperAttributes.entityTypeProperty);}}return P;}function O(N){var V=s[N];var i=V.implementingHelperAttributes.ignoredLabels||[];o.setProperty(I,i);if(C.pathToActiveObjectEnabled){o.setProperty(C.pathToActiveObjectEnabled,V.implementingHelperAttributes.activeObjectEnabled);}}function w(i){var j,V;if(i){if(i.tableVariantIds){for(var K in s){j=s[K].smartControl;V=i.tableVariantIds[j.getId()];if(V){j.setCurrentVariantId(V);}}}if(C.pathToActiveObjectEnabled&&i.mEditButtonState){for(var J in s){s[J].implementingHelperAttributes.activeObjectEnabled=!!i.mEditButtonState[J];}}O(i.selectedTab);return i.selectedTab;}return null;}function x(i){var K,j,V={};for(K in s){j=s[K].smartControl;V[j.getId()]=j.getCurrentVariantId()||"";}var J={selectedTab:i,tableVariantIds:V};if(C.pathToActiveObjectEnabled){var L=Object.create(null);for(var M in s){L[M]=s[M].implementingHelperAttributes.activeObjectEnabled;}J.mEditButtonState=L;}return J;}function R(i,j,J,K,L,M,N){var P=function(Q){if(Q===K&&M){N(i);return;}var V=s[Q];if(V.implementingHelperAttributes.dirtyState>0&&V.implementingHelperAttributes.dirtyState!==i){V.implementingHelperAttributes.dirtyState=3;}else{V.implementingHelperAttributes.dirtyState=i;}};if(j){if(L){j.forEach(P);return;}P(j);return;}for(var Q in s){if(!J||J[s[Q].smartControl.getEntitySet()]){P(Q);}}}function y(){return"multi";}function z(N){var V=s[N];var M=V.implementingHelperAttributes.dirtyState;V.implementingHelperAttributes.dirtyState=0;return M;}function S(V){var i=V.smartControl;var o=T.oComponentUtils.getTemplatePrivateModel();var j=A(i);var J=JSON.parse(j.getValue());if(j){i.removeCustomData(j);}i.addCustomData(new sap.ui.core.CustomData({"key":"activeButtonTableState","value":!J}));o.setProperty("/listReport/activeObjectEnabled",!J);}function A(i){var j;var J=i.getCustomData();for(var K=0;K<J.length;K++){if(J[K].getKey()&&J[K].getKey()==="activeButtonTableState"){j=J[K];break;}}return j;}function E(V){var i=V.smartControl;var o=T.oComponentUtils.getTemplatePrivateModel();var j=o.getProperty("/listReport/activeObjectEnabled");var J=A(i);if(J){i.removeCustomData(J);}i.addCustomData(new sap.ui.core.CustomData({"key":"activeButtonTableState","value":j}));}function H(i,j,P){for(var K in s){var J=s[K].smartControl;if((j||P)&&J.getTable){J.setCurrentVariantId(j||P);}else if((i||P)&&J.getChart){J.setCurrentVariantId(i||P);}}}var d=t.testable(d,"fnCleanupIrrelevantFilters");return{init:m,getCustomDataHost:G,getDefaultShowCounts:f,getFiltersAdaptedFromItem:a,formatMessageStrip:n,onSelectedKeyChanged:O,getContentForIappState:x,getSelectedKeyAndRestoreFromIappState:w,refreshOperation:R,getMode:y,getRefreshMode:z,setActiveButtonState:S,restoreActiveButtonState:E,getActiveButtonStateCustomData:A,setControlVariant:H};}return B.extend("sap.suite.ui.generic.template.lib.multipleViews.MultipleTablesModeHelper",{constructor:function(c,T,C){e(this,g(c,T,C));}});});
