sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","sap/ui/core/mvc/View","sap/ui/model/base/ManagedObjectModel","sap/suite/ui/generic/template/lib/TemplateViewController","sap/suite/ui/generic/template/lib/TemplateComponent","sap/suite/ui/generic/template/lib/CRUDManager","sap/suite/ui/generic/template/lib/CommonUtils","sap/suite/ui/generic/template/lib/ComponentUtils","sap/suite/ui/generic/template/lib/CommonEventHandlers","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/support/lib/CommonMethods","sap/base/Log","sap/base/util/deepExtend"],function(C,O,V,M,T,a,b,c,d,e,t,f,L,g){"use strict";var m=Object.create(null);var A=Object.create(null);var r=function(o){var s=o.appComponent.getId();A[s]=o;return function(){delete A[s];};};function h(o){var s=o.getId();var R=A[s];return R;}function i(o){return h(o.getAppComponent()).oTemplateContract.componentRegistry[o.getId()];}function F(o){while(o&&!(o instanceof V)){o=o.getParent();}return o;}function G(o){while(o){var v=F(o);var l=v&&v.getController();var n=l&&l.getOwnerComponent();if(n instanceof a){var p=i(n);return p;}else{o=n&&n.oContainer;}}}function j(s,o,l){var R=m[s];if(R){return R;}o=g({},o);l=g({},l);l.metadata=l.metadata||{};l.metadata.methods=l.metadata.methods||{};for(var n in l){if(typeof l[n]==="function"){var p=l.metadata.methods[n];if(!p){p={};l.metadata.methods[n]=p;}p.public=p.public!==false;p.final=p.final||false;p.overrideExecution=p.overrideExecution||O.After;}}l.metadata.methods.getExtensionAPI={"public":true,"final":true};l.getExtensionAPI=function(){var q=this.getView().getController();return q.extensionAPI;};o.templateBaseExtension=C.extend(s+"BaseExtension",l);R=T.extend(s,o);m[s]=R;return R;}function k(o){var l=o.methods.oControllerSpecification;return l?function(){var n=o.oComponent.getAppComponent();var p=h(n);var q=n.getTransactionController();var N=n.getNavigationController();var s={oComponentUtils:o.utils,oServices:{oTemplateCapabilities:{},oApplicationController:n.getApplicationController(),oTransactionController:q,oNavigationController:N,oDraftController:q.getDraftController(),oApplication:p.application,oViewDependencyHelper:p.oViewDependencyHelper}};o.viewRegistered.catch(function(E){L.debug(E.message);N.navigateToMessagePage({viewLevel:o.viewLevel,title:o.oTemplateContract.getText("ST_ERROR"),text:o.oTemplateContract.getText("ST_GENERIC_UNKNOWN_NAVIGATION_TARGET"),description:E.message});});o.oControllerUtils=s;var u=o.oComponent.getTemplateName();var v=j(u,l.oControllerDefinition,l.oControllerExtensionDefinition);var R=new v();o.oController=R;var w=l.getMethods(s,R);R._templateEventHandlers=Object.freeze(w.handlers||{});R._templateFormatters=Object.freeze(w.formatters||{});R.extensionAPI=Object.freeze(w.extensionAPI||{});var x;R.onInit=function(){var y=R.getView();x=y.getId();L.info("Init view "+x+" of template "+u);s.oServices.oApplicationController.registerView(y);s.oCommonUtils=new c(R,s.oServices,s.oComponentUtils);s.oServices.oCRUDManager=new b(R,s.oComponentUtils,s.oServices,s.oCommonUtils,p.oTemplateContract.oBusyHelper);s.oCommonEventHandlers=new e(R,s.oComponentUtils,s.oServices,s.oCommonUtils);var z=new M(y);o.oComponent.setModel(z,"_templPrivView");(w.onInit||Function.prototype)();};R.onExit=function(){p.oTemplateContract.oApplicationProxy.destroyView(x);(w.onExit||Function.prototype)();L.info("View "+x+" of template "+u+" exited");};return R;}:Function.prototype;}r=t.testableStatic(r,"TemplateComponent_RegisterAppComponent");return{getTemplateComponent:function(l,s,o){var n=s+".Component";o=o||{};o.init=function(){var p=this.getComponentData();var q=p.registryEntry;q.viewRegistered=new Promise(function(R,w){q.fnViewRegisteredResolve=function(E){if(E){q.fnViewRegisteredResolve=Function.prototype;w(E);}else{delete q.fnViewRegisteredResolve;R();}};});q.oViewRenderedPromise=new Promise(function(R){q.fnViewRenderdResolve=R;});q.oViewRenderedPromise.then(function(){f.setApplicationStatus(f.mApplicationStatus.RENDERED);f.publishEvent("elements","ViewRendered",{});});q.reuseComponentProxies=Object.create(null);q.componentName=n;q.oComponent=this;q.aKeys=[];var u=h(q.oAppComponent);q.oTemplateContract=u.oTemplateContract;(a.prototype.init||Function.prototype).apply(this,arguments);q.utils=new d(this,q);q.methods=l(this,q.utils)||{};q.oGenericData={};q.mRefreshInfos=Object.create(null);var v=this.getId();q.oTemplateContract.componentRegistry[v]=q;q.oTemplateContract.oBusyHelper.setBusy(q.viewRegistered,true);q.oApplication=u.application;q.createViewController=k(q);q.componentCreateResolve(this);delete q.componentCreateResolve;delete p.registryEntry;(q.methods.init||Function.prototype)();};o.exit=function(){var p=this.getId();var q=i(this);var u=h(this.getAppComponent());var v=q.methods;(v.exit||Function.prototype)();delete u.oTemplateContract.componentRegistry[p];(a.prototype.exit||Function.prototype).apply(this,arguments);};o.onBeforeRendering=function(){var p=i(this);(a.prototype.onBeforeRendering||Function.prototype).bind(this,p).apply(this,arguments);var q=p.methods;(q.onBeforeRendering||Function.prototype)();};o.onAfterRendering=function(){var p=i(this);if(p.fnViewRenderdResolve&&!p.fnViewRegisteredResolve){p.fnViewRenderdResolve();delete p.fnViewRenderdResolve;}(a.prototype.onAfterRendering||Function.prototype).bind(this,p).apply(this,arguments);var q=p.methods;(q.onAftereRendering||Function.prototype)();};o.onActivate=function(B,I){var p=i(this);p.sCurrentBindingPath=B;var q=function(){p.utils.bindComponent(p.sCurrentBindingPath,I);p.utils.refreshBinding();return(p.methods.onActivate||Function.prototype)(B,I);};return p.fnViewRegisteredResolve?p.viewRegistered.then(q):(q()||Promise.resolve());};o.setIsRefreshRequired=function(I){if(I){var p=i(this);if(p.utils.isComponentActive()&&!p.oTemplateContract.oNavigationControllerProxy.isNavigating()){p.viewRegistered.then(p.utils.refreshBinding.bind(null,true,{}));I=false;}}this.setProperty("isRefreshRequired",I);};o.onDeactivate=Function.prototype;return a.extend(n,o);},getRegisterAppComponent:function(){var R=r;r=null;return R;},getExtensionAPIPromise:function(o){var l=G(o);if(!l){return Promise.reject();}return l.viewRegistered.then(function(){return l.oController.extensionAPI;});},getExtensionAPI:function(o){var l=G(o);return l&&l.oController&&l.oController.extensionAPI;}};});
