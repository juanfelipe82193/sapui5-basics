sap.ui.define(["sap/ui/core/CustomizingConfiguration","sap/ui/core/library","sap/ui/core/Component","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/Device","sap/suite/ui/generic/template/lib/reuseComponentHelper","sap/ui/core/CustomData","sap/suite/ui/generic/template/lib/StableIdDefinition","sap/suite/ui/generic/template/js/StableIdHelper","sap/base/Log","sap/suite/ui/generic/template/js/AnnotationHelper","sap/base/util/extend","sap/base/util/deepExtend"],function(C,c,a,U,J,R,D,r,b,S,d,L,A,e,f){"use strict";var V=c.mvc.ViewType;function g(O){var i=O&&typeof O==="string"?O:(O&&a.getOwnerIdFor(O));var u=i&&sap.ui.component(i);if(u instanceof T){u=u.getAppComponent();}return u;}var G=C.getViewExtension;C.getViewExtension=function(v,i,O){var u=g(O),w=u&&u.getId(),x=G.call(C,v,i,w);return x;};var h=C.getControllerExtension;C.getControllerExtension=function(i,O){var u=g(O),v=u&&u.getId(),w=h.call(C,i,v);return w;};function E(u){var I=new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"});var v=[];var M=u.getAppComponent().getModel("i18n|"+u.getMetadata().getComponentName()+"|"+u.getEntitySet());if(M){v.push(M);}var w=u.getModel("i18n");if(w){v.push(w);}var x=u.getModel("@i18n");if(x){v.push(x);}var y=true;for(var z="i18n";y;){z=z+"||Parent";y=u.getModel(z);if(y){v.push(y);}}for(var i=v.length-1;i>=0;i--){I.enhance(v[i].getResourceBundle());}u.setModel(I,"i18n");}function j(i,M){var u=i.getAppComponent().getManifestEntry("sap.ui5");var v=u.extends&&u.extends.extensions&&u.extends.extensions["sap.ui.controllerExtensions"];var w=i.getTemplateName();var x=v&&v[w]&&v[w]["sap.ui.generic.app"];var y=i.getEntitySet();var B=x&&x[y]&&x[y].Actions;var z={};var F=k(i);if(B){if(F){l(z,B,F);}else{m(z,B);}}else{var H=x&&x[y]&&x[y]["Sections"];for(var I in H){B=H[I]["Actions"];if(B){m(z,B);}}}i.getModel("_templPriv").setProperty("/generic/listCommons/breakoutActionsEnabled",z);}function k(i){var u;var v=i.getAppComponent().getConfig();var w=v&&v.pages[0]&&v.pages[0].component&&v.pages[0].component.settings;if(w&&w.quickVariantSelectionX){u=w.quickVariantSelectionX.variants;}return u;}function l(B,u,v){var w;for(var x in u){w=true;if(u[x].requiresSelection){w=false;}for(var i in v){var y=u[x].id;var z=v[i];var F=A.getSuffixFromIconTabFilterKey(z);if(F){y=y.concat(F);}B[y]={enabled:w};}}}function m(B,i){var u;for(var v in i){u=true;if(i[v].requiresSelection){u=false;}B[i[v].id]={enabled:u};}}function n(i){if(i.getAppComponent().getMetadata().getComponentName()===""||i.getTemplateName()===""||i.getEntitySet()===""){}return i.getAppComponent().getMetadata().getComponentName()+"::"+i.getTemplateName()+"::"+i.getEntitySet();}function o(i,u,M,v){var w=u.oComponent;var x=w.getAppComponent();var y=u.oTemplateContract.mRoutingTree[u.route];var z=w.getEntitySet();var B=u.utils.isDraftEnabled();var F=null;var H=w.getComponentContainer().getSettings();F=e({},H);delete F.appComponent;delete F.entitySet;delete F.navigationProperty;F.subPages=u.routeConfig.pages;F.routeConfig=u.routeConfig;return new J({entitySet:z,entityType:i,treeNode:y,routingSpec:u.routingSpec,"sap-ui-debug":window["sap-ui-debug"],isDraftEnabled:B,settings:F,manifest:x.getInternalManifest(),metaModel:M,templateSpecific:v&&v(),appComponentName:w.getAppComponent().getMetadata().getComponentName(),stableId:{definition:S,aParameter:[],getStableId:d.getStableId},variables:[]});}function p(i,u){var v=i.oComponent,w=i.createViewController,x=i.methods&&i.methods.getTemplateSpecificParameters,M=v.getModel(),y,z,B,F,H,N=i.routingSpec&&i.routingSpec.noOData;if(N){y=new J({entitySet:{},entityType:{}});F=y.createBindingContext("/entitySet");H=y.createBindingContext("/entityType");}else{y=M&&M.getMetaModel();z=M&&v.getEntitySet();var I=z&&y.getODataEntitySet(z);B=I&&I.entityType;if(!B){return{loaded:function(){return Promise.reject(new Error("Unknown entityset "+z));}};}F=y.createBindingContext(y.getODataEntitySet(z,true));H=y.createBindingContext(y.getODataEntityType(B,true));}E(v);j(v,M);var K=n(v);var O=sap.ui.getCore().byId(K);if(O){L.warning("View with ID: "+K+" already exists - old view is getting destroyed now!");try{O.destroy();}catch(Q){L.warning("Error destroying view: "+Q);}O=null;}var W=new J(D);W.setDefaultBindingMode("OneWay");i.oParameterModel=o(B,i,y,x);v.runAsOwner(function(){var X=i.preprocessorsData;var Y={async:true,preprocessors:{xml:{bindingContexts:{entitySet:F,entityType:H},models:{device:W,appSettings:i.oTemplateContract.appSettings,entitySet:y,entityType:y,parameter:i.oParameterModel},preprocessorsData:X}},id:K,type:V.XML,viewName:v.getTemplateName(),height:"100%",cache:{keys:u,additionalData:[X]}};if(v.getDesigntimePath||v.getFlexibilityPath){var Z={key:"sap-ui-custom-settings",value:{}};if(v.getDesigntimePath){Z.value["sap.ui.dt"]={"designtime":v.getDesigntimePath()};}if(v.getFlexibilityPath){Z.value["sap.ui.fl"]={"flexibility":v.getFlexibilityPath()};}Y.customData=[new b(Z)];}Y.controller=w();O=sap.ui.view(Y);});return O;}function q(i,u,v){var w=i.oController.extensionAPI;var x=e({},w);if(w.getNavigationController){var N=e({},w.getNavigationController());var y=N.navigateInternal;N.navigateInternal=function(z,B){var F=B&&B.routeName;if(F){i.utils.navigateRoute(F,z,u,B&&B.replaceInHistory);}else{y(z,B);}};x.getNavigationController=function(){return N;};}x.getCommunicationObject=function(z){return z===1?v.communicationObject:i.utils.getCommunicationObject(z);};(i.methods.enhanceExtensionAPI4Reuse||Function.prototype)(x,v);return x;}function P(i,u,v,w,x){w.extensionAPI=q(i,v,w);r.transferEmbeddedComponentProxy(i,u,v,w,x);var y=i.oController.byId(w.containerId);var z=y&&y.getSettings();var B=x.getMetadata().getAllProperties();for(var F in z){if((F==="uiMode"||F==="semanticObject"||F.startsWith("st"))&&!B[F]){delete z[F];}}x.applySettings(z);y.setComponent(x);}function s(i,u,v){return v.componentUsage?i.createComponent({usage:v.componentUsage,id:u}):i.runAsOwner(function(){return a.create({name:v.componentName,id:u});});}function t(i){i.reuseComponentsReady=new Promise(function(u,v){var w=Object.create(null);var x=u.bind(null,w);if(i.viewLevel>0){var y=i.oTemplateContract.mEntityTree[i.routeConfig.entitySet];if(y){var z=function(B,F){L.error("Failed to load reuse component for key "+B,F instanceof Error?F.message:"","sap.suite.ui.generic.template.lib.TemplateComponent");};i.viewRegistered.then(function(){var B=[];for(var F in y.embeddedComponents){var H=y.embeddedComponents[F];var I=H.sectionId&&i.oController.byId(H.sectionId);if(I&&I.getStashed()){delete y.embeddedComponents[F];}else{var K=i.oController.createId(H.containerId+"Content");var M=s(i.oAppComponent,K,H);B.push(M);M.catch(z.bind(null,F));M.then(P.bind(null,i,w,F,H));i.oTemplateContract.oBusyHelper.setBusy(M);}}Promise.all(B).then(x,function(N){var O=i.oAppComponent.getNavigationController();O.navigateToMessagePage({text:i.oTemplateContract.getText("ST_ERROR"),description:N instanceof Error?N.message:""});v();});});return;}}x();});}var T=U.extend("sap.suite.ui.generic.template.lib.TemplateComponent",{metadata:{properties:{templateName:{type:"string",defaultValue:null},entitySet:{type:"string",defaultValue:null},navigationProperty:{type:"string",defaultValue:null},appComponent:{type:"object",defaultValue:null},isRefreshRequired:{type:"boolean",defaultValue:false},isLeaf:{type:"boolean"}},library:"sap.suite.ui.generic.template"},init:function(){(U.prototype.init||Function.prototype).apply(this);var u=new J({editable:false,enabled:false});this.setModel(u,"ui");var i=this.getComponentData();var v=i.registryEntry;var w=Object.create(null);var x=(v.routeConfig&&v.routeConfig.embeddedComponents)||{};for(var K in x){var y=x[K];var z={hidden:!!y.hiddenByDefault};w[K]=z;}var B=new J({generic:{isActive:false,listCommons:{},viewLevel:v.viewLevel,controlProperties:{},supportedIntents:{},embeddedComponents:w}});B.setDefaultBindingMode("TwoWay");this.setModel(B,"_templPriv");t(v);},getManifestEntry:function(K){var v=U.prototype.getManifestEntry.apply(this,arguments);if(/^\/sap\.ui5\/componentUsages(\/.+)?$/.test(K)){v=f({},v,U.prototype.getManifestEntry.apply(this.getAppComponent(),arguments));}return v;},getComponentContainer:function(){return this.oContainer;},onBeforeRendering:function(u){if(u){var v=u.oComponent.getComponentContainer();var M=!u.createViewStarted&&v&&v.getModel();if(M){M.getMetaModel().loaded().then(function(){if(!u.createViewStarted){var w=[];var x=M.metadataLoaded().then(function(i){var z;if(i&&i.lastModified){z=new Date(i.lastModified).getTime()+"";}else{L.error("TemplateComponent: no valid cache key segment last modification date provided by the OData Model");z=new Date().getTime()+"";}return z;});w.push(x);var y=M.annotationsLoaded().then(function(z){var B=0;if(z){for(var i=0;i<z.length;i++){if(z[i].lastModified){var F=new Date(z[i].lastModified).getTime();if(F>B){B=F;}}else{L.error("TemplateComponent: no valid cache key segment last modification date provided by OData annotations");B=new Date().getTime()+"";}}}if(B===0){L.error("TemplateComponent: no valid cache key segment last modification date provided by OData annotations");B=new Date().getTime();}return B+"";});w.push(y);u.createViewStarted=true;p(u,w).loaded().then(function(i){u.oComponent.setAggregation("rootControl",i);u.fnViewRegisteredResolve();v.invalidate();},function(i){u.fnViewRegisteredResolve(i||{});});}});}}},getRouter:function(){if(this.getAppComponent()){return this.getAppComponent().getRouter();}return U.prototype.getRouter.apply(this,arguments);}});return T;});
