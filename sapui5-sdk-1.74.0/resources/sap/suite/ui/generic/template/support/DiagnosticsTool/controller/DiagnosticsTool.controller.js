sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/base/Log","sap/suite/ui/generic/template/support/lib/Documentation","sap/suite/ui/generic/template/lib/PollyFill"],function(C,M,a,L,D){"use strict";var d=window.diagnosticToolSpace;function o(){this.getView().attachAfterRendering(function(){A();});}function O(){var m=this.getView().getModel("data");if(m.getProperty("/status")==="Loading"){M.show("Application is still loading");return;}var t=new Date().toLocaleTimeString([],{hour12:false,hour:"2-digit",minute:"2-digit",second:"2-digit"});m.setData({properties:null,retrieval:t,copyEnabled:false});m.updateBindings();this.getView().getViewData().plugin.onRefresh();}function f(){var n="\r\n";var p="- ";var e=this.getView().getModel("data").getData();if(!(e&&e.properties&&e.url)){a.error("Could not copy data to your clipboard! No data collected",{title:"Error"});return;}var P=e.properties;var g="*************+Extracted by SAP Fiori Elements Diagnostics Plugin [FEDiagnostic]+*************"+n;g+=p+"Extracted on "+new Date().toUTCString()+n;g+=p+"Host: "+e.origin+n;g+=p+"Application status: "+e.status+n;if(e.statusMessage){g+=p+"Notice: "+e.statusMessage+n;}g+=p+"Documentation: "+D.getDocuURL()+n;g+=n;g+="APP DATA"+n;for(var i=0,l=P.length;i<l;i++){if(P[i].type==="string"){g+=p+P[i].name+": "+P[i].value+n;}else if(P[i].type==="link"){g+=p+P[i].name+": "+P[i].target+n;}else if(P[i].type==="group"){g+="Group: "+P[i].name+n;}}g+=n;g+="**************************"+n;g+=n;g+=n;g+="PROVIDE"+n;g+=p+"User/Password: <user>/<password>"+n;g+=p+"Steps to recreate the issue: <maybe also provide master data, pictures or video…>"+n;var t=this.getView().byId("CopyDataTextArea").getId();var T=document.getElementById(t);T.style.display="block";T.value=g;T.select();try{var S=document.execCommand("copy");if(S){M.show("Ticket relevant information copied to clip board");}else{a.error("Could not copy data to your clipboard! You can copy it manually from here: "+n+n+g,{title:"Error"});}}catch(h){a.error("Could not copy data to your clipboard! You can copy it manually from here: "+n+n+g,{title:"Error"});}finally{T.style.display="none";}}function b(){var n="<br/>",S="</span>"+n,e="<span>",p=e+"- ",g=this.getView().getModel("data").getData();if(!(g&&g.properties&&g.url)){a.error("Could not copy data to your clipboard! No data collected",{title:"Error"});return;}var P=g.properties,h=document.getElementById(this.getView().byId("CopyDataHTML").getId());var j=e+"*************+Extracted by SAP Fiori Elements Diagnostics Plugin [FEDiagnostic]+*************"+S;j+=p+"Extracted on "+new Date().toUTCString()+S;j+=p+"Host: <a href=\""+g.url+"\">"+g.origin+"</a>"+S;j+=p+"Application status: "+g.status+S;if(g.statusMessage){j+=p+"Notice: "+g.statusMessage+S;}j+=p+"Documentation: "+"<a href=\""+D.getDocuURL()+"\">"+D.getDocuURL()+"</a>"+S;j+=n;j+=e+"APP DATA"+S;for(var i=0,l=P.length;i<l;i++){if(P[i].type==="string"){j+=p+P[i].name+": "+P[i].value+S;}else if(P[i].type==="link"){j+=p+P[i].name+": <a href=\""+P[i].target+"\">"+P[i].value+"</a>"+S;}else if(P[i].type==="group"){j+=e+"Group: "+P[i].name+S;}}j+=e+"**************************"+S;j+=n;j+=e+"PROVIDE"+S;j+=e+"User/Password: &lt;user&gt;/&lt;password&gt;"+S;j+=e+"Steps to recreate the issue: &lt;maybe also provide master data, pictures or video…&gt;"+S;function k(){try{document.getSelection().removeAllRanges();}catch(q){Function.prototype();}}h.innerHTML='';h.insertAdjacentHTML("beforeend",j);try{var m=document.createRange();k();m.selectNode(h);document.getSelection().addRange(m);document.execCommand("copy");k();M.show("Ticket relevant information copied to clip board with HTML format");}catch(q){k();f();}finally{h.innerHTML='';}}function c(){D.openDocumentation();}function r(e){e.parentNode.removeChild(e);}function A(){var g=document.querySelectorAll(".diagnosticPropertiesGroupHeaderContent");if(g.length===0){L.debug("No headers found which should be customized");return;}var e,h;for(var i=0;i<g.length;i++){e=g[i];h=e.closest("td");h.classList.add("diagnosticPropertiesGroupHeader");h.setAttribute("colspan",2);r(h.nextElementSibling);}}function u(t,S){var m=this.getView().getModel("data");m.setData({timeLeft:t,status:S});}function s(){if(d.fioriElementsPluginID){var v=document.getElementById(d.fioriElementsPluginID);if(v&&v.parentElement&&!v.parentElement.classList.contains("sapUiSupportHidden")){M.show("Data refreshed");}}}return C.extend("sap.suite.ui.generic.template.support.DiagnosticsTool.controller.DiagnosticsTool",{onInit:o,onRefreshData:O,onCopyDataPlain:f,onCopyDataHTML:b,onShowDocumentation:c,updateStatus:u,showDataRefreshed:s});});
