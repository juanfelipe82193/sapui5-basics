sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ovp/cards/CommonUtils","sap/ui/Device","sap/ui/model/resource/ResourceModel","sap/ui/core/mvc/ViewType"],function(q,U,J,C,D,R,V){"use strict";return U.extend("sap.ovp.cards.generic.Component",{metadata:{properties:{"contentFragment":{"type":"string"},"controllerName":{"type":"string","defaultValue":"sap.ovp.cards.generic.Card"},"headerExtensionFragment":{"type":"string"},"contentPosition":{"type":"string","defaultValue":"Middle"},"headerFragment":{"type":"string","defaultValue":"sap.ovp.cards.generic.Header"},"footerFragment":{"type":"string"},"identificationAnnotationPath":{"type":"string","defaultValue":"com.sap.vocabularies.UI.v1.Identification"},"selectionAnnotationPath":{"type":"string"},"filters":{"type":"object"},"parameters":{"type":"object"},"addODataSelect":{"type":"boolean","defaultValue":false}},version:"1.74.0",library:"sap.ovp",includes:[],dependencies:{libs:[],components:[]},config:{}},setSelectionVariant:function(s,S){if(/^@/.test(s)){s=s.slice(1);}S.selectionAnnotationPath=s;},setPresentationVariant:function(p,s,e){if(/^@/.test(p)){p=p.slice(1);}s.presentationAnnotationPath=p;var a=p.split("/");var v=a.length===1?e[p].Visualizations:e[a[0]][a[1]][a[2]].Visualizations;var i;for(i=0;i<v.length;i++){var b=v[i].AnnotationPath;if(b){if(/^@/.test(b)){b=b.slice(1);}if(/.LineItem/.test(b)){s.annotationPath=b;break;}}}for(i=0;i<v.length;i++){var b=v[i].AnnotationPath;if(b){if(/^@/.test(b)){b=b.slice(1);}if(/.Chart/.test(b)){s.chartAnnotationPath=b;break;}}}},setDataPointAnnotationPath:function(d,s){if(/^@/.test(d)){d=d.slice(1);}s.dataPointAnnotationPath=d;},getCustomPreprocessor:function(){},getPreprocessors:function(p){var c=this.getComponentData(),s=c.settings,m=c.model,M,e,E,o;if(s.description&&!s.subTitle){s.subTitle=s.description;}if(m){M=m.getMetaModel();if(s.entitySet){var a=M.getODataEntitySet(s.entitySet);var b=M.getODataEntitySet(s.entitySet,true);e=M.getODataEntityType(a.entityType);o=M.createBindingContext(b);E=M.createBindingContext(e.$path);}}var d=this._getCardPropertyDefaults();var f=this._completeLayoutDefaults(d,s);var g,h;if(c.appComponent&&c.appComponent.getModel("ui")&&c.appComponent.getModel("ui").oData){var j=c.appComponent.getModel("ui").oData;g=j.showDateInRelativeFormat;h=j.disableTableCardFlexibility;}else{if(c.showDateInRelativeFormat){g=c.showDateInRelativeFormat;}if(c.disableTableCardFlexibility){h=c.disableTableCardFlexibility;}}var A={metaModel:M,entityType:e,webkitSupport:D.browser.webkit,layoutDetail:f&&f.cardLayout?f.cardLayout.containerLayout:'fixed',showDateInRelativeFormat:g,disableTableCardFlexibility:h,cardId:c.cardId};if(!!c&&!!c.cardId){var k=c.mainComponent;var t=null;if(!!k){t=k._getCardFromManifest(c.cardId)?k._getCardFromManifest(c.cardId).template:null;}else{t=c.template;}if(!!t){A.template=t;}}d.densityStyle=C._setCardpropertyDensityAttribute();if(c.errorReason){var l=c.errorReason;var P=l.getParameters();var n="sap-icon://message-error";if(P&&P.response){d.errorStatusCode=P.response.statusCode;d.errorStatusText=P.response.statusText;d.responseText=P.response.responseText;d.sMessageIcon=P.response.sIcon?P.response.sIcon:n;}}if(f){A.cardLayout=f.cardLayout;}if(d.state!=="Loading"&&d.state!=="Error"){if(s&&s.kpiAnnotationPath){var K=e[s.kpiAnnotationPath];var r=d.contentFragment;if(K&&(r==="sap.ovp.cards.charts.analytical.analyticalChart"||r==="sap.ovp.cards.charts.smart.analyticalChart")){var S=K.SelectionVariant&&K.SelectionVariant.Path?K.SelectionVariant.Path:s.kpiAnnotationPath+"/SelectionVariant";if(S){this.setSelectionVariant(S,s);}var u=K.Detail&&K.Detail.DefaultPresentationVariant&&K.Detail.DefaultPresentationVariant.Path?K.Detail.DefaultPresentationVariant.Path:s.kpiAnnotationPath+"/Detail/DefaultPresentationVariant";if(u){this.setPresentationVariant(u,s,e);}var v=K.DataPoint&&K.DataPoint.Path?K.DataPoint.Path:s.kpiAnnotationPath+"/DataPoint";if(v){this.setDataPointAnnotationPath(v,s);}}}else if(s&&s.selectionPresentationAnnotationPath){var w=e[s.selectionPresentationAnnotationPath];if(w){var S=w.SelectionVariant&&w.SelectionVariant.Path;if(S){this.setSelectionVariant(S,s);}var u=w.PresentationVariant&&w.PresentationVariant.Path;if(u){this.setPresentationVariant(u,s,e);}}}}if(c.ovpCardsAsApi&&s.ignoreSelectionVariant){s.selectionAnnotationPath="";var I=[];for(var x=0;!!s.filters&&x<s.filters.length;x++){I.push({id:"headerFilterText--"+(x+1),index:x});}s.idForExternalFilters=I;}if(!!A.entityType&&!!s.selectionAnnotationPath&&!!A.entityType[s.selectionAnnotationPath]){var y=A.entityType[s.selectionAnnotationPath].SelectOptions;for(var z=0;!!y&&z<y.length;z++){y[z].id="headerFilterText--"+(z+1);}A.entityType[s.selectionAnnotationPath].SelectOptions=y;}if(A.template==="sap.ovp.cards.linklist"&&!!s.staticContent){for(var i=0;i<s.staticContent.length;i++){s.staticContent[i].id="linkListItem--"+(i+1);}}if(A.template==='sap.ovp.cards.charts.analytical'){s.dataStep=s.dataStep?s.dataStep:10;}d=q.extend(true,{},A,d,s);var O=new J(d);var B=new J(D);B.setDefaultBindingMode("OneWay");var F={dontIncludeUOM:true,firstDataPointIndex:0,secondDataPointIndex:1,thirdDataPointIndex:2,fourthDataPointIndex:3,fifthDataPointIndex:4,sixthDataPointIndex:5,firstDataFieldIndex:0,secondDataFieldIndex:1,thirdDataFieldIndex:2,fourthDataFieldIndex:3,fifthDataFieldIndex:4,sixthDataFieldIndex:5};var G=new J(F);var H={xml:{bindingContexts:{entityType:E,entitySet:o},models:{device:B,entityType:M,entitySet:M,ovpMeta:M,ovpCardProperties:O,ovplibResourceBundle:p,ovpConstants:G},ovpCardProperties:O,dataModel:m,_ovpCache:{}}};return q.extend(true,{},this.getCustomPreprocessor(),H);},_completeLayoutDefaults:function(c,s){var o={},a=this.getComponentData(),b=null,d=null;if(a.appComponent){b=a.appComponent.getOvpConfig();}if(!b){return null;}if(b.containerLayout==="resizable"&&a.cardId&&c.contentFragment!=="sap.ovp.cards.quickview.Quickview"){d=a.appComponent.getDashboardLayoutUtil();var e=a.cardId;var f=d.aCards.filter(function(i){return i.id===e;});o.cardLayout=f[0].dashboardLayout;o.cardLayout.containerLayout=b.containerLayout;o.cardLayout.iRowHeightPx=d.ROW_HEIGHT_PX;o.cardLayout.iCardBorderPx=d.CARD_BORDER_PX;o.cardLayout.headerHeight=f[0].dashboardLayout.headerHeight;}return o;},_getCardPropertyDefaults:function(){var c={};var p=this.getMetadata().getAllProperties();var P;for(var a in p){P=p[a];if(P.defaultValue!==undefined){c[P.name]=P.defaultValue;}}return c;},getOvplibResourceBundle:function(){if(!this.ovplibResourceBundle){var r=sap.ui.getCore().getLibraryResourceBundle("sap.ovp");this.ovplibResourceBundle=r?new R({bundleUrl:r.oUrlInfo.url}):null;}return this.ovplibResourceBundle;},_getCacheKeys:function(){},createContent:function(){var c=this.getComponentData&&this.getComponentData();var m=c.model;var p;var P;var M=c&&c.mainComponent;var o=M&&M.oModelViewMap;var s=c&&c.modelName;var f=function(){if(m&&s){m.bIncludeInCurrentBatch=false;if(o&&s&&o[s]&&o[s][c.cardId]){delete o[s][c.cardId];if(Object.keys(o[s]).length>0){m.bIncludeInCurrentBatch=true;}}}};if(c&&c.mainComponent){p=c.mainComponent._getOvplibResourceBundle();}else{p=this.getOvplibResourceBundle();}P=this.getPreprocessors(p);var v={preprocessors:P,type:V.XML,viewName:"sap.ovp.cards.generic.Card"};var a=this._getCacheKeys();if(a&&a.length&&a.length>0){v.async=true;v.cache={keys:a};}var l=this._getCardPropertyDefaults().state;var i=c.cardId+(l?l:"Original");if(!l){i=i+(c.settings.selectedKey?"_Tab"+c.settings.selectedKey:"");}if(m&&m.bUseBatch&&!v.async){f();}var b=sap.ui.view(c.containerId==="dialogCard"?undefined:i,v);if(v.async){var O=b.onControllerConnected;b.onControllerConnected=function(){if(m&&m.bUseBatch){f();}O.apply(b,arguments);};}b.setModel(m);if(c.i18n){b.setModel(c.i18n,"@i18n");}b.setModel(P.xml.ovpCardProperties,"ovpCardProperties");b.setModel(p,"ovplibResourceBundle");return b;}});});
