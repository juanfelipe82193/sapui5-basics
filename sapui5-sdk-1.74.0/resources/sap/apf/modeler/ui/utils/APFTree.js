/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2018 SAP SE. All rights reserved
*/
sap.ui.define(['sap/apf/modeler/ui/utils/constants','sap/m/Tree','sap/m/TreeRenderer'],function(c,T,a){'use strict';var A=T.extend("sap.apf.modeler.ui.utils.APFTree",{metadata:{events:{},properties:{translationFunction:{},defaultRepresentationType:{},applicationId:{}}},previousSelectedItem:null,renderer:function(C,r){a.render(C,r);},setTranslationFunction:function(t){this.fnTranslationFunction=t;},setDefaultRepresentationType:function(d){this.defaultRepresentationType=d;},setApplicationId:function(b){this.applicationId=b;},getAPFTreeNodeContext:function(n){if(n){var N=n?n._getBindingContext():undefined;var o=N.getObject()?N.getObject().type:undefined;var O;if(N.getObject()&&N.getObject().id){O=N.getObject().id;}else if(N.getObject()&&N.getObject().AnalyticalConfiguration){O=N.getObject().AnalyticalConfiguration;}return{oNode:n,nodeContext:N.sPath,nodeObjectType:o,nodeTitle:n.getTitle(),nodeAPFId:O};}return null;},getItemNodeByContext:function(p){var n=this.getNumberOfExpandedLevel();var t=this;var s=p.split("/");switch(s.length){case 3:t.expandToLevel(0);break;case 7:t.expandToLevel(2);break;case 9:t.expandToLevel(3);break;case 11:t.expandToLevel(4);break;}for(var b=0;b<this.getItems().length;b++){var i=this.getItems()[b];var o=i._getBindingContext().getObject().type;if(i._getBindingContext().sPath===p){return i;}}return null;},getItemNodeByContextWithoutExpand:function(p){for(var n=0;n<this.getItems().length;n++){var i=this.getItems()[n];var o=i._getBindingContext().getObject().type;if(i._getBindingContext().sPath===p){return i;}}return null;},getParentNodeContext:function(s){var m=this.getModel();if(s!==null){var b=s.nodeContext.split('/')[2];var d=m.getData().aConfigDetails[b]?m.getData().aConfigDetails[b].AnalyticalConfiguration:undefined;var r;var e=s.nodeContext.split('/')[6];var f=s.nodeContext.split('/')[6];var n=s.nodeContext.split('/')[6];var g=s.nodeContext.split('/')[8];var S={};if(s!==null){switch(s.nodeObjectType){case c.configurationObjectTypes.FACETFILTER:S.facetFilterId=m.getData().aConfigDetails[b].configData[0].filters[f].id;S.configId=d;S.configurationName=m.getData().aConfigDetails[b].name;S.facetFilterName=m.getData().aConfigDetails[b].configData[0].filters[f].name;break;case c.configurationObjectTypes.SMARTFILTERBAR:S.smartFilterId=m.getData().aConfigDetails[b].configData[0].filters[f].id;S.configId=d;S.configurationName=m.getData().aConfigDetails[b].name;S.smartFilterName=m.getData().aConfigDetails[b].configData[0].filters[f].name;break;case c.configurationObjectTypes.CATEGORY:if(m.getData().aConfigDetails[b].configData!=undefined){S.categoryId=m.getData().aConfigDetails[b].configData[1].categories[e].id;S.configId=d;S.configurationName=m.getData().aConfigDetails[b].name;S.categoryName=m.getData().aConfigDetails[b].configData[1].categories[e].name;}break;case c.configurationObjectTypes.STEP:S.configId=d;S.categoryId=m.getData().aConfigDetails[b].configData[1].categories[e].id;S.stepId=m.getData().aConfigDetails[b].configData[1].categories[e].steps[g].id;S.configurationName=m.getData().aConfigDetails[b].name;S.categoryName=m.getData().aConfigDetails[b].configData[1].categories[e].name;S.stepName=m.getData().aConfigDetails[b].configData[1].categories[e].steps[g].name;break;case c.configurationObjectTypes.REPRESENTATION:r=s.oNode;S.configId=d;S.categoryId=m.getData().aConfigDetails[b].configData[1].categories[e].id;S.stepId=m.getData().aConfigDetails[b].configData[1].categories[e].steps[g].id;S.representationId=r._getBindingContext().getObject().id;S.configurationName=m.getData().aConfigDetails[b].name;S.categoryName=m.getData().aConfigDetails[b].configData[1].categories[e].name;S.stepName=m.getData().aConfigDetails[b].configData[1].categories[e].steps[g].name;S.representationName=r._getBindingContext().getObject().name;break;case c.configurationObjectTypes.CONFIGURATION:S.configId=s.oNode._getBindingContext().getObject().AnalyticalConfiguration;S.configurationName=s.oNode._getBindingContext().getObject().name;break;case c.configurationObjectTypes.NAVIGATIONTARGET:S.navTargetId=m.getData().aConfigDetails[b].configData[2].navTargets[n].id;S.configId=d;S.configurationName=m.getData().aConfigDetails[b].name;S.navTargetName=m.getData().aConfigDetails[b].configData[2].navTargets[n].name;break;default:break;}if(m.getData().aConfigDetails&&m.getData().aConfigDetails[b]){S.appId=m.getData().aConfigDetails[b].Application;}}return S;}},isConfigurationSwitched:function(p,C){var i=false,P,b;var o=this.getParentNodeContext(this.getAPFTreeNodeContext(p));var d=this.getParentNodeContext(this.getAPFTreeNodeContext(C));P=o?o.configId:undefined;if(o&&!jQuery.isEmptyObject(o)&&o.configId===undefined){b=this.getAPFTreeNodeContext(p).nodeContext.split("/")[2];P=this.getModel().getData().aConfigDetails[b].AnalyticalConfiguration;}if(P!==undefined&&P!==d.configId){i=true;}return i;},removeSelectionOnTree:function(s){var S=this.getSelectedItem();if(s){s._getBindingContext().getObject().isSelected=false;s.setSelected(false);}else if(S){S._getBindingContext().getObject().isSelected=false;S.setSelected(false);}this.getModel().updateBindings();},setSelectionOnTree:function(b){this.selectedNode=this.getItemNodeByContextWithoutExpand(b);var s=this.getSelectedItem();if(s!==this.selectedNode){if(s&&s._getBindingContext().getObject()){s.getBindingContext().getObject().isSelected=false;s.setSelected(false);}this.setSelectedItem(this.selectedNode);}},_scrollTreeToNewNode:function(n){if(n&&n.$().length!==0){jQuery(n.$())[0].scrollIntoView();}},setSelectedNode:function(n){this.setSelectedItem(n.getItemNodeContext());this.getModel().updateBindings();this._scrollTreeToNewNode(n);},addNodeInTree:function(o,p,i){var m;var s=this.getAPFTreeNodeContext(this.getSelectedItem());var b=s?s.nodeContext.split('/')[2]:undefined;var d=s?s.nodeContext.split('/')[6]:undefined;var e=s?s.nodeContext.split('/')[8]:undefined;m=["_add",o].join("");this[m](b,d,e,p,i);var O=this._getObjectNodesArray(o,b,d,e);var n=O[O.length-1];if(n!==undefined){if(o!==c.configurationObjectTypes.CONFIGURATION){this.onItemExpanderPressed(n,true);}this.setSelectedItem(n);}},_getObjectNodesArray:function(o,b,d,s){var O=[];switch(o){case c.configurationObjectTypes.CONFIGURATION:O=this.getItems();break;case c.configurationObjectTypes.FACETFILTER:this.expandToLevel(2);var e=this.getSelectedItem().getId();var r=e.split("-");var f=r.length;var g=r[f-1];var h=this.getItems()[parseInt(g)+1].getItemNodeContext().children.length;if(this.getItems()[parseInt(g)+1].getItemNodeContext().context.sPath==="/aConfigDetails/"+b+"/configData/0"){for(var i=1;i<h;i++){O.push(this.getItems()[parseInt(g)+1+i]);}}this.expandToLevel(1);break;case c.configurationObjectTypes.CATEGORY:this.expandToLevel(2);var e=this.getSelectedItem().getId();var r=e.split("-");var f=r.length;var g=r[f-1];if(this.getItems()[parseInt(g)+1].getItemNodeContext().context.sPath==="/aConfigDetails/"+b+"/configData/0"){var h=this.getItems()[parseInt(g)+1].getItemNodeContext().children.length;var j=parseInt(g)+2+h;var k=this.getItems()[parseInt(j)].getItemNodeContext().children.length;for(var i=1;i<k;i++){O.push(this.getItems()[parseInt(j)+1+i]);}}this.expandToLevel(1);break;case c.configurationObjectTypes.STEP:break;case c.configurationObjectTypes.REPRESENTATION:break;case c.configurationObjectTypes.NAVIGATIONTARGET:this.expandToLevel(2);var e=this.getSelectedItem().getId();var r=e.split("-");var f=r.length;var g=r[f-1];if(this.getItems()[parseInt(g)+1].getItemNodeContext().context.sPath==="/aConfigDetails/"+b+"/configData/0"){var h=this.getItems()[parseInt(g)+1].getItemNodeContext().children.length;var j=parseInt(g)+2+h;var k=this.getItems()[j].getItemNodeContext().children.length;var N=j+k+1;var l=this.getItems()[N].getItemNodeContext().children.length;for(var i=1;i<l;i++){O.push(this.getItems()[N+1+i]);}}this.expandToLevel(1);break;default:break;}return O;},_addconfiguration:function(){var s=this;this.configNewIndex=this.configNewIndex||1;var m=this.getModel();var i;i="I"+this.configNewIndex;this.configNewIndex++;var b=[],f=[],C=[],n=[];b.push({filters:f,name:s.fnTranslationFunction("facetFilters"),isSelected:false,expanded:false,selectable:false});b.push({categories:C,name:s.fnTranslationFunction("categories"),isSelected:false,expanded:false,selectable:false});b.push({navTargets:n,name:s.fnTranslationFunction("navigationTargets"),isSelected:false,expanded:false,selectable:false});var o={};o.configData=b;var d=this.fnTranslationFunction("newConfiguration");var e={name:"< "+d+" >",type:c.configurationObjectTypes.CONFIGURATION,AnalyticalConfiguration:"newConfig"+i,Application:this.applicationId,configData:b,bIsLoaded:true,isSelected:false,expanded:false,selectable:true};m.getData().aConfigDetails.push(e);m.updateBindings();},_addfacetFilter:function(b){var m=this.getModel();var n=this.fnTranslationFunction("newFacetFilter");var i=m.getData().aConfigDetails[b].configData[0].filters.length;var d={name:"< "+n+" >",type:c.configurationObjectTypes.FACETFILTER,id:"newFilter"+i,isSelected:false,selectable:true};m.getData().aConfigDetails[b].expanded=true;m.getData().aConfigDetails[b].configData[0].expanded=true;m.getData().aConfigDetails[b].configData[0].filters.push(d);m.updateBindings();},_addnavigationTarget:function(b){var m=this.getModel();var n=this.fnTranslationFunction("newNavigationTarget");var i=m.getData().aConfigDetails[b].configData[2].navTargets.length;var d={name:"< "+n+" >",type:c.configurationObjectTypes.NAVIGATIONTARGET,id:"newNavTarget"+i,isSelected:false,selectable:true};m.getData().aConfigDetails[b].expanded=true;m.getData().aConfigDetails[b].configData[2].expanded=true;m.getData().aConfigDetails[b].configData[2].navTargets.push(d);m.updateBindings();},_addcategory:function(b){var m=this.getModel();var n=this.fnTranslationFunction("newCategory");var i=m.getData().aConfigDetails[b].configData[1].categories.length;var d={name:"< "+n+" >",type:c.configurationObjectTypes.CATEGORY,id:"newCategory"+i,isSelected:false,expanded:false,selectable:true};m.getData().aConfigDetails[b].expanded=true;m.getData().aConfigDetails[b].configData[1].expanded=true;m.getData().aConfigDetails[b].configData[1].categories.push(d);m.updateBindings();},_addstep:function(b,d,s,p,I){var m=this.getModel();var n;var I=(I&&I===true)?true:false;if(m.getData().aConfigDetails[b].configData[1].categories[d].steps===undefined){m.getData().aConfigDetails[b].configData[1].categories[d].steps=[];}if(!p){var e=m.getData().aConfigDetails[b].configData[1].categories[d].steps.length;var f=this.fnTranslationFunction("newStep");n={name:"< "+f+" >",type:c.configurationObjectTypes.STEP,id:"newStep"+e,isSelected:false,expanded:false,selectable:true,bIsHierarchicalStep:I};m.getData().aConfigDetails[b].expanded=true;m.getData().aConfigDetails[b].configData[1].expanded=true;m.getData().aConfigDetails[b].configData[1].categories[d].expanded=true;m.getData().aConfigDetails[b].configData[1].categories[d].steps.push(n);}else{var g,i,j;for(i=0;i<p.noOfSteps;i++){g={name:p.aExistingStepsToBeAdded[i].step.name,type:c.configurationObjectTypes.STEP,id:p.aExistingStepsToBeAdded[i].step.id,isSelected:false,expanded:false,selectable:true,icon:I===true?"sap-icon://drill-down":"sap-icon://step"};m.getData().aConfigDetails[b].configData[1].categories[d].steps.push(g);if(p.aExistingStepsToBeAdded[i].noOfReps!==0){s=m.getData().aConfigDetails[b].configData[1].categories[d].steps.length-1;for(j=0;j<p.aExistingStepsToBeAdded[i].noOfReps;j++){var r={id:p.aExistingStepsToBeAdded[i].representations[j].id,name:p.aExistingStepsToBeAdded[i].representations[j].name,icon:p.aExistingStepsToBeAdded[i].representations[j].icon};this._addrepresentation(b,d,s,r);}}}}m.updateBindings();},_addrepresentation:function(b,d,s,p){var m=this.getModel();var e=this;var f;if(p===undefined){var g=this.getAPFTreeNodeContext(this.getSelectedItem());if(g.nodeObjectType===c.configurationObjectTypes.REPRESENTATION){f=this.getParentNodeContext(g,m).stepId;}else if(g.nodeObjectType===c.configurationObjectTypes.STEP){f=g.nodeAPFId;}var S=[];m.getData().aConfigDetails[b].configData[1].categories.forEach(function(h,i){if(m.getData().aConfigDetails[b].configData[1].categories[i].steps){m.getData().aConfigDetails[b].configData[1].categories[i].steps.forEach(function(j,k){var l={};if(j.id===f){l.stepIndex=k;l.categoryIndex=i;S.push(l);}});}});S.forEach(function(h){if(m.getData().aConfigDetails[b].configData[1].categories[h.categoryIndex].steps[h.stepIndex].representations===undefined){m.getData().aConfigDetails[b].configData[1].categories[h.categoryIndex].steps[h.stepIndex].representations=[];}var i=m.getData().aConfigDetails[b].configData[1].categories[h.categoryIndex].steps[h.stepIndex].representations.length;var n={name:e.fnTranslationFunction(e.defaultRepresentationType),type:c.configurationObjectTypes.REPRESENTATION,id:"newRepresentation"+i,isSelected:false,selectable:true};m.getData().aConfigDetails[b].expanded=true;m.getData().aConfigDetails[b].configData[1].expanded=true;m.getData().aConfigDetails[b].configData[1].categories[h.categoryIndex].expanded=true;m.getData().aConfigDetails[b].configData[1].categories[h.categoryIndex].steps[h.stepIndex].expanded=true;m.getData().aConfigDetails[b].configData[1].categories[h.categoryIndex].steps[h.stepIndex].representations.push(n);});}else{if(m.getData().aConfigDetails[b].configData[1].categories[d].steps[s].representations===undefined){m.getData().aConfigDetails[b].configData[1].categories[d].steps[s].representations=[];}var r={name:p.name,type:c.configurationObjectTypes.REPRESENTATION,id:p.id,isSelected:false,selectable:true,icon:p.icon};m.getData().aConfigDetails[b].configData[1].categories[d].steps[s].representations.push(r);}m.updateBindings();}});sap.apf.modeler.ui.utils.APFTree=A;return A;},true);
