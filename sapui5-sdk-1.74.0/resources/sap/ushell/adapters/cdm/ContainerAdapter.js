// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ushell/User","sap/ushell/System","sap/ui/thirdparty/URI","sap/base/Log","sap/ui/thirdparty/jquery"],function(u,U,S,a,L,q){"use strict";var l=L.getLogger("sap/ushell/adapters/cdm/ContainerAdapter",L.Level.INFO);var C=function(i,p,P){var b="/sap/public/bc/icf/logoff",s=g(P.config,b),o=e(P.config),c=f(i,P.config),d=k(P.config);function g(m,D){if(m.systemProperties&&m.systemProperties.logoutUrl){return m.systemProperties.logoutUrl;}return D;}function e(m){var n,r=m.userProfile;if(r){n=h(r.defaults,m.userProfilePersonalization,r.metadata);}return new U(n||j());}function f(O,m){var n=m.systemProperties,A=O.getAlias(),r=O.getPlatform(),B=O.getBaseUrl(),t,v;if(n){A=n.alias||A;r=n.platform||r;t=n.SID;v=n.client;}return new S({alias:A,platform:r,baseUrl:B,system:t,client:v});}function h(D,m,n){var r=q.extend(j(),D,m);r.bootTheme=r.bootTheme||{theme:r.theme,root:""};delete r.theme;if(n){if(n.editablePropterties){r.setThemePermitted=n.editablePropterties.indexOf("theme")>-1;r.setAccessibilityPermitted=n.editablePropterties.indexOf("accessibility")>-1;r.setContentDensityPermitted=n.editablePropterties.indexOf("contentDensity")>-1;}if(n.ranges){r.ranges=n.ranges;}}return r;}function j(){return{setThemePermitted:false,setAccessibilityPermitted:false,setContentDensityPermitted:false};}function k(A){var m=A&&A.systemProperties&&A.systemProperties.sessionKeepAlive;if(!m){return null;}if(!m.url){l.error("Mandatory parameter 'url' missing in 'sessionKeepAlive' configuration.");return null;}if(m.method!=="HEAD"&&m.method!=="GET"){m.method="HEAD";}return m;}this._getLogoutUrl=function(){return s;};this._setDocumentLocation=function(m){document.location=m;};this.getSystem=function(){return c;};this.getUser=function(){return o;};this.load=function(){return q.when();};this.getCurrentUrl=function(){return window.location.href;};this.logout=function(m){var F;if(!m){throw new Error("Not implemented");}if(u.hasNativeLogoutCapability()){F=(new a(this._getLogoutUrl())).absoluteTo(this.getCurrentUrl()).search("").toString();u.getPrivateEpcm().doLogOff(F);}else{this.logoutRedirect();}return q.when();};this.logoutRedirect=function(){var m=c.adjustUrl(this._getLogoutUrl());this._setDocumentLocation(m);};this.sessionKeepAlive=function(){if(!d){return;}var x=new XMLHttpRequest();x.open(d.method,d.url,true);x.onreadystatechange=function(){if(this.readyState===4){l.debug("Server session was extended");}};x.send();};this._getSessionKeepAliveConfig=function(){return d;};};return C;},true);
