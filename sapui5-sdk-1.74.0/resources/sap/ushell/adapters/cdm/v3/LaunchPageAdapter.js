// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/adapters/cdm/v3/_LaunchPage/readHome","sap/ushell/adapters/cdm/_LaunchPage/modifyHome","sap/ushell/adapters/cdm/v3/_LaunchPage/readCatalogs","sap/m/library","sap/ushell/utils","sap/ushell/adapters/cdm/v3/utilsCdm","sap/ushell/components/tiles/utilsRT","sap/ushell/adapters/cdm/v3/AdapterBase","sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ushell/navigationMode","sap/ushell/Config","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery","sap/base/util/isEmptyObject","sap/base/util/ObjectPath"],function(r,m,R,M,u,U,o,A,a,n,C,J,q,i,O){"use strict";var g=M.GenericTileMode;var S="sap.ushell.components.tiles.cdm.applauncher";var D="sap.ushell.components.tiles.cdm.applauncherdynamic";function L(b,p,c){A.call(this,b,p,c);this._getTileFromHashInContextOfSite=function(e,x,I){var y=new q.Deferred(),z=x[I];if(!z){z=e(I);x[I]=z;}z.done(function(T){var B={tileIntent:I,tileResolutionResult:T};y.resolve(B);}).fail(function(E){y.reject("Hash '"+I+"' could not be resolved to a tile. "+E);});return y.promise();};this._getTileFromHash=function(I){var e=sap.ushell.Container.getService("ClientSideTargetResolution");var x=e.resolveTileIntent.bind(e);return this._getTileFromHashInContextOfSite(x,this._mCatalogTilePromises,I);};this._getTileFromHashFromSite=function(e,I){var x=sap.ushell.Container.getService("ClientSideTargetResolution");var y=U.formatSite(e);var z=x.resolveTileIntentInContext.bind(x,y);var B={};return this._getTileFromHashInContextOfSite(z,B,I);};this._getTileForUrl=function(T){var e={componentName:T.indicatorDataSource?D:S};return{tileIntent:"#",tileResolutionResult:{tileComponentLoadInfo:e,isCustomTile:false}};};this._prepareTileHash=function(T){var e=sap.ushell.Container.getService("URLParsing"),P={},x,y;if(this._isCatalogTile(T)){return T.tileIntent;}if(this._isGroupTile(T)&&T.target){y=T.target.parameters||[];y.forEach(function(z){if(z.name&&z.value){P[z.name]=[z.value];}});x={target:{semanticObject:T.target.semanticObject,action:T.target.action},params:P,appSpecificRoute:T.target.appSpecificRoute};return"#"+e.constructShellHash(x);}return undefined;};this.getDefaultGroup=function(){var e=new q.Deferred(),x;var y=this;if(!this._oDefaultGroup){x=this._ensureLoaded();}if(x){x.done(function(){e.resolve(y._oDefaultGroup);}).fail(function(z){e.reject("Failed to access default group. "+z);});}else{e.resolve(y._oDefaultGroup);}return e.promise();};this.addGroup=function(T){var e=new q.Deferred(),x=sap.ushell.Container.getService("CommonDataModel"),G,y,z=this;if(!this._isValidTitle(T)){return e.reject("No valid group title").promise();}y="Failed to add the group with title '"+T+"' to the homepage. ";x.getSite().done(function(B){G=u.generateUniqueId(r.getGroupIdsFromSite(B));m.addGroupToSite(B,m.createEmptyGroup(G,T));x.save().done(function(){delete z._ensureLoadedDeferred;e.resolve(B.groups[G],G);}).fail(function(E){e.reject(E);});}).fail(function(E){e.reject(y+E);});return e.promise();};this.setGroupTitle=function(G,N){var e=this,x=new q.Deferred(),y=sap.ushell.Container.getService("CommonDataModel"),z,B;if(typeof G!=="object"||!r.getGroupId(G)){return x.reject("Unexpected group value").promise();}if(!e._isValidTitle(N)){return x.reject("Unexpected oGroup title value").promise();}B="Failed to set new title for group with id '"+r.getGroupId(G)+"'. ";z=r.getGroupTitle(G);y.getSite().done(function(E){if(G){m.setGroupTitle(G,N);}y.save().done(function(){x.resolve();}).fail(function(F){q.sap.log.error(F);x.reject(z);});}).fail(function(E){x.reject(z,B+E);});return x.promise();};this.hideGroups=function(H){var e=new q.Deferred(),x=sap.ushell.Container.getService("CommonDataModel"),G;if(H&&Array.isArray(H)){G="Failed to hide group. ";x.getSite().done(function(y){r.getGroupsArrayFromSite(y).forEach(function(z){var I=Array.prototype.indexOf.call(H,r.getGroupId(z))===-1;m.setGroupVisibility(z,I);});x.save().done(function(){e.resolve();}).fail(function(E){e.reject("Hiding of groups did not work as expected - "+E);});}).fail(function(E){e.reject(G+E);});}else{e.reject("Invalid input parameter aHiddenGroupIds. Please pass a valid input parameter.");}return e.promise();};this.moveGroup=function(G,e){var x=new q.Deferred(),y=sap.ushell.Container.getService("CommonDataModel"),z,B;if(!G||!r.getGroupId(G)||e<0){return x.reject("Unable to move groups - invalid parameters").promise();}B="Failed to move group with id '"+G.identification.id+"'. ";y.getSite().done(function(E){var F=r.getGroupIdsFromSite(E),H=r.getGroupId(G);if(!F){return x.reject("groupsOrder not found - abort operation of adding a group.");}else if(F.indexOf(H)===e){return x.resolve();}z=u.moveElementInsideOfArray(F,F.indexOf(H),e);if(!z){return x.reject("invalid move group operation - abort.");}m.setGroupsOrder(E,z);y.save().done(function(){x.resolve();}).fail(function(I){x.reject(I);});return undefined;}).fail(function(E){x.reject(B+E);});return x.promise();};this.removeGroup=function(G){var e=new q.Deferred(),x=sap.ushell.Container.getService("CommonDataModel"),y,z;if(typeof G!=="object"){return e.reject("invalid group parameter").promise();}z=r.getGroupId(G);if(!z){return e.reject("group without id given").promise();}y="Failed to remove group with id '"+z+"'. ";x.getSite().done(function(B){m.removeGroupFromSite(B,G);x.save().done(function(){e.resolve();}).fail(function(E){e.reject(E);});}).fail(function(E){e.reject(y+E);});return e.promise();};this.resetGroup=function(G){var e=new q.Deferred(),x=sap.ushell.Container.getService("CommonDataModel"),y=[],z=this,B,E;if(typeof G==="object"&&r.getGroupId(G)){E=r.getGroupId(G);B="Failed to reset group with id '"+E+"'. ";x.getSite().done(function(F){q.extend(true,y,r.getGroupsArrayFromSite(F));if(z.isGroupRemovable(G)===false){x.getGroupFromOriginalSite(E).done(function(H){if(typeof F==="object"&&r.getGroupFromSite(F,E)){m.overwriteGroup(F,H,E);}x.save().done(function(){e.resolve(H);}).fail(function(I){e.reject("Group could not be reset - "+I,y);});}).fail(function(H){e.reject("Group could not be reset - "+H,y);});}else{e.reject("Group could not be reset as it was created by the user",y);}}).fail(function(F){e.reject(B+F,[]);});}return e.promise();};this.getLinkTiles=function(G){return r.getGroupLinks(G);};this.isLinkPersonalizationSupported=function(){return true;};this._notifyTileAboutRefresh=function(T){if(typeof T.tileRefresh==="function"){T.tileRefresh();}};this.refreshTile=function(T){var e=this._mResolvedTiles[T.id];if(e){if(e.tileComponent){this._notifyTileAboutRefresh(e.tileComponent);}}};this._notifyTileAboutVisibility=function(T,N,e){if(typeof T.tileSetVisible==="function"&&e!==N){T.tileSetVisible(N);}};this.getTileView=function(G){var e=this;return new q.Deferred(function(x){return e._getTileView(G,false).then(function(T){x.resolve(T);},function(y){var E="Tile with ID '"+G.id+"' could not be initialized"+(y?":\n"+y:".");q.sap.log.error(E,null,G.tileType);x.reject(E);});}).promise();};this._getCatalogTileView=function(e){if(typeof e!=="object"){throw new Error(e);}var x;if(typeof e.tileResolutionResult!=="object"){x=this._mResolvedTiles[e.id];}else{x=e;}return this._getTileUiComponentContainerSync(e,x,true);};this._getCatalogTileViewControl=function(e){var x=new q.Deferred();if(typeof e!=="object"){var E="Invalid input parameter passed to _getCatalogTileView: "+e;q.sap.log.error(E);return x.reject(E).promise();}return this._getTileUiComponentContainer(e,e,true);};this._createLinkInstance=function(T,I,N,G,e){var x,y,z,B=this.getTileSubtitle(T);var E=G;if(I===true){x=this.getCatalogTileTitle(T);}else{x=this.getTileTitle(T);}y=new E({mode:g.LineMode,subheader:B,header:x,press:function(F){this._genericTilePressHandler(T,F);}.bind(this)});if(N){z=e.i18n.getText(N+"NavigationMode");y.setAriaLabel(z+" "+x+" "+B);}this._mResolvedTiles[T.id].linkTileControl=y;return y;};this._genericTilePressHandler=function(T,e){var x;if(e.getSource().getScope&&e.getSource().getScope()==="Display"){x=this.getTileTarget(T);if(x){if(x[0]==="#"){hasher.setHash(x);}else{window.open(x,"_blank");}}}};this._addTileToSite=function(P,G,N,e){var x=this,y=new q.Deferred(),I=sap.ushell.Container.getService("URLParsing").parseShellHash(N.properties.targetURL),T={"id":x.getTileId(N),"target":{"semanticObject":I.semanticObject,"action":I.action,"parameters":w(I.params)}};P.groups[G.identification.id].payload.tiles.push(T);e.save().done(function(){y.resolve(T);}).fail(function(z){y.reject(z);});return y.promise();};this.addTile=function(e,G){var x=new q.Deferred(),y,z=sap.ushell.Container.getService("CommonDataModel"),B;if(!G){G=this._oDefaultGroup;}if(e.contentProviderId){if(e.externalUrl){return this.addBookmark(this._getBookmarkDataForExtensionCatalogTile(e),G);}return x.reject("Extension Tile without URL").promise();}B=h();B.vizId=e.vizId;this._mResolvedTiles[B.id]={tileIntent:e.tileIntent,tileResolutionResult:e.tileResolutionResult,isLink:false};z.getSite().done(function(E){E.groups[G.identification.id].payload.tiles.push(B);z.save().done(function(){x.resolve(B);}).fail(function(F){x.reject(F);});}).fail(function(E){y="Failed to add tile with id '"+B.id+"' to group with id '"+G.identification.id+"'. ";x.reject(y+E);});return x.promise();};this._getBookmarkDataForExtensionCatalogTile=function(e){var B={title:e.tileResolutionResult.title,subtitle:e.tileResolutionResult.subTitle,icon:e.tileResolutionResult.icon,info:e.tileResolutionResult.info,url:e.externalUrl};if(e.tileResolutionResult.indicatorDataSource&&e.tileResolutionResult.indicatorDataSource.path){B.serviceUrl=e.tileResolutionResult.indicatorDataSource.path;B.serviceRefreshInterval=e.tileResolutionResult.indicatorDataSource.refresh;}return B;};this.removeTile=function(G,T,I){var x,y,z=new q.Deferred(),B=this;if(!G||typeof G!=="object"||!G.identification||!G.identification.id||!T||typeof T!=="object"||!T.id){return z.reject({},"Failed to remove tile. No valid input parameters passed to removeTile method.").promise();}y="Failed to remove tile with id '"+T.id+"' from group with id '"+G.identification.id+"'. ";x=sap.ushell.Container.getService("CommonDataModel");x.getSite().done(function(E){var P,F;I=+I;try{P=E.groups[G.identification.id].payload;}catch(e){z.reject(E.groups[G.identification.id],y);}F=B.getTileType(T)===B.TileType.Link?"links":"tiles";if(B.getTileType(T)===B.TileType.Link){I-=P.tiles.length;}if(I>=0){P[F].splice(I,1);}else{P[F]=P[F].filter(function(H){return H.id!==T.id;});}x.save().done(function(){z.resolve();}).fail(function(H){q.sap.log.error(H);z.reject(E.groups[G.identification.id],H);});}).fail(function(e){z.reject({},y+e);});return z.promise();};this.moveTile=function(T,e,x,y,z,B){var E=new q.Deferred(),F=sap.ushell.Container.getService("CommonDataModel"),G=this,H;if(!T||i(T)||e===undefined||e<0||x===undefined||x<0||!y||!y.identification||!y.identification.id||!z||!z.identification||!z.identification.id){return E.reject("Invalid input parameters").promise();}H="Failed to move tile with id '"+T.id+"'. ";F.getSite().done(function(I){var K,N,P=G.getTileType(T)===G.TileType.Link?"links":"tiles";if(!B){B=G._mResolvedTiles[T.id].isLink?"link":"tile";}K=B==="link"?"links":"tiles";if(P!==K&&G._mResolvedTiles[T.id]){G._mResolvedTiles[T.id].isLink=B==="link";}if(K==="links"){x-=I.groups[z.identification.id].payload.tiles.length;}if(P==="links"){e-=I.groups[y.identification.id].payload.tiles.length;}if(y.identification.id===z.identification.id){if(e!==x||P!==K){N=I.groups[z.identification.id].payload;N[P].splice(e,1);N[K].splice(x,0,T);}else{return E.resolve(T).promise();}}else{I.groups[y.identification.id].payload[P].splice(e,1);I.groups[z.identification.id].payload[K].splice(x,0,T);}F.save().done(function(){E.resolve(T);}).fail(function(Q){q.sap.log.error(H+Q);E.reject(H+Q);});return undefined;}).fail(function(I){q.sap.log.error(H+I);E.reject(H+I);});return E.promise();};this._compareCatalogs=function(e,B){if(e.identification.id>B.identification.id){return 1;}return-1;};this.getCatalogs=function(){var e=this,x=new q.Deferred(),y=[],z=sap.ushell.Container.getService("CommonDataModel");function B(E,F,y,G,P,H){var I=E.catalogs[F];if(P&&H){I.contentProviderId=P;H.catalogsMap[F]=I;}y.push(I);G.notify(I);}window.setTimeout(function(){z.getSite().done(function(E){Object.keys(E.catalogs).forEach(function(F){B(E,F,y,x);});z.getExtensionSites().progress(function(F){var P=F.providerId;var G=F.site;var H=Promise.resolve(G);var I={sitePromise:H,site:G,catalogsMap:{}};Object.keys(G.catalogs).forEach(function(K){e._mContentProviders[P]=I;B(G,K,y,x,P,I);});}).done(function(F){F.filter(function(G){return!G.success;}).forEach(function(G){y.push({identification:{id:G.providerId},contentProviderId:G.providerId,error:"The following content providers could not provide catalogs: "+G.providerId+(G.error?" -> "+G.error:"")});});x.resolve(y.sort(e._compareCatalogs));});});},0);return x.promise();};this._isStartableInbound=function(I){var N=["Shell-plugin","Shell-bootConfig"],e;if(!I.semanticObject||!I.action){return false;}if(N.indexOf(I.semanticObject+"-"+I.action)>-1){return false;}if(!O.get("signature.parameters",I)){return true;}e=Object.keys(I.signature.parameters).every(function(p){return!I.signature.parameters[p].filter||(!!I.signature.parameters[p].launcherValue||p==="sap-external-url");});return e;};this._isHiddenInbound=function(I){return!!I.hideLauncher;};this._toHashFromInbound=function(I){var e=U.toHashFromInbound(I);if(!e){return undefined;}return"#"+e;};this._getExternalUrlFromInbound=function(I){return O.get("signature.parameters.sap-external-url.launcherValue.value",I)||null;};this._toHashFromOutbound=function(e){var x=U.toHashFromOutbound(e);if(!x){return undefined;}return"#"+x;};this.getCatalogTiles=function(e){var x=this,y=new q.Deferred();if(typeof e!=="object"||e===null){return y.reject("Invalid input parameter '"+e+"' passed to getCatalogTiles.").promise();}if(e.contentProviderId&&this._mContentProviders[e.contentProviderId]){this._mContentProviders[e.contentProviderId].sitePromise.then(function(z){d.call(x,e,z).done(y.resolve).fail(y.reject);},function(E){y.reject("Failed to get site: "+E);});}else{sap.ushell.Container.getService("CommonDataModel").getSite().done(function(z){d.call(x,e,z).done(y.resolve).fail(y.reject);}).fail(function(E){y.reject("Failed to get site: "+E);});}return y.promise();};function d(e,x){var y=this,z=new q.Deferred();setTimeout(function(){var B=((e.payload&&e.payload.viz)||[]).reduce(function(E,V){var F,G,H,I,K,N,P,Q,T,W,X,Y,Z,$,_,a1,b1;if(!V){return E;}G=a.get(x,V);if(!G){return E;}H=a.getTypeId(G);I=a.getType(x,H);F=a.getAppId(G);if(F){K=a.getAppDescriptor(x,F);if(!K){return E;}N=r.getInbound(K,a.getTarget(G).inboundId);if(!N){return E;}if(!y._isStartableInbound(N.inbound)||y._isHiddenInbound(N.inbound)){return E;}Q=U.mapOne(N.key,N.inbound,K,G,I,x);if(!Q||!Q.tileResolutionResult){return E;}$=Q.resolutionResult.applicationType;_=Q.resolutionResult.additionalInformation;b1=C.last("/core/navigation/enableInPlaceForClassicUIs");a1=b1?b1[$]:false;T=n.computeNavigationModeForHomepageTiles($,_,a1);W=a.getOutbound(G,N.inbound);P=y._toHashFromOutbound(W);}else{var c1=a.getConfig(G);if(c1===undefined){return E;}Q=U.mapOne(undefined,undefined,undefined,G,I,x);if(u.getMember(c1,"sap|flp.target.type")==="URL"){Z=u.getMember(c1,"sap|flp.target.url");}}X=Q.tileResolutionResult;X.navigationMode=T;if(e.contentProviderId){Z=y._getMember(K,"sap|app.crossNavigation.inbounds.Shell-launchURL.signature.parameters.sap-external-url.launcherValue.value");}Y={id:V,vizId:V,tileIntent:Z||P,tileResolutionResult:X,isCatalogTile:true};if(e.contentProviderId&&Z){Y.contentProviderId=e.contentProviderId;Y.externalUrl=Z;}E.push(Y);return E;},[]);z.resolve(B);},0);return z.promise();}this.getCatalogError=function(e){if(e.error){return e.error;}return undefined;};this.getCatalogId=function(e){return R.getId(e);};this.getCatalogTitle=function(e){return R.getTitle(e);};this._isFailedCatalogTile=function(T){return!!(T&&this._mFailedResolvedCatalogTiles&&this._mFailedResolvedCatalogTiles[r.getTileId(T)]);};this.getCatalogTileTitle=function(G){if(this._isGroupTile(G)){if(this._isFailedGroupTile(G)){return"";}return this._mResolvedTiles[G.id].tileResolutionResult.title;}if(this._isCatalogTile(G)){if(this._isFailedCatalogTile(G)){return undefined;}return G.tileResolutionResult.title;}return undefined;};this.getCatalogTileSize=function(e){return this.getTileSize(e);};this.getCatalogTileView=function(e){return this._getCatalogTileView(e);};this.getCatalogTileViewControl=function(e){return this._getCatalogTileViewControl(e);};this.getCatalogTilePreviewSubtitle=function(G){if(this._isGroupTile(G)){return this.getTileSubtitle(G);}return(G.tileResolutionResult&&G.tileResolutionResult.subTitle)||"";};this.getCatalogTilePreviewIcon=function(G){if(this._isGroupTile(G)){return this.getTileIcon(G);}return(G.tileResolutionResult&&G.tileResolutionResult.icon)||"";};this.getCatalogTilePreviewInfo=function(G){if(this._isGroupTile(G)){return this.getTileInfo(G);}return(G.tileResolutionResult&&G.tileResolutionResult.info)||"";};this.getCatalogTilePreviewIndicatorDataSource=function(G){return G.tileResolutionResult&&G.tileResolutionResult.indicatorDataSource;};this.getCatalogTileKeywords=function(G){var K=[],e=G;if(!e){q.sap.log.error("Could not find the Tile","sap.ushell.adapters.cdm.LaunchPageAdapter");return K;}if(this._mResolvedTiles&&this._mResolvedTiles[G.id]){e=this._mResolvedTiles[G.id];}if(e&&e.tileResolutionResult&&e.tileResolutionResult.title){K.push(e.tileResolutionResult.title);}if(e&&e.tileResolutionResult&&e.tileResolutionResult.subTitle){K.push(e.tileResolutionResult.subTitle);}return K;};this._visitBookmarks=function(e,V){var x=sap.ushell.Container;var y=x.getService("URLParsing");var z=x.getService("CommonDataModel");var B;var I=y.parseShellHash(e);if(I){B=v(I);}else{B=s(e);}return z.getSite().then(function(E){var G=E.groups;var T=Object.keys(G).filter(function(K){return!G[K].payload.locked;}).map(function(K){return G[K].payload.tiles.filter(function(F){return F.isBookmark&&k(B,F.target);});}).reduce(function(F,H){Array.prototype.push.apply(F,H);return F;},[]);if(!V){return T.length;}return q.when(T.map(V)).then(function(){return T.length;});});};this.addBookmark=function(P,G){var e=this;return new q.Deferred(function(x){var y=sap.ushell.Container;var z=y.getService("URLParsing");var B=y.getService("CommonDataModel");q.when(G||e.getDefaultGroup(),B.getSite()).done(function(G,E){var T,F,I=z.parseShellHash(P.url),H,K=false;if(!I){F=s(P.url);K=true;}else{F=v(I);}T=f(P,F);if(K){H=new q.Deferred();H.resolve(e._getTileForUrl(T));}else{H=e._getTileFromHash(P.url);}H.done(function(N){N.isLink=false;e._mResolvedTiles[T.id]=N;E.groups[G.identification.id].payload.tiles.push(T);B.save().done(function(){x.resolve(T);}).fail(function(Q){x.reject(Q);});}).fail(function(N){x.reject("Bookmark creation failed because: "+N);});}).fail(function(E){x.reject(E);});}).promise();};this.countBookmarks=function(e){return this._visitBookmarks(e);};this.updateBookmarks=function(e,P){var x=sap.ushell.Container;var y=x.getService("URLParsing");var z=x.getService("CommonDataModel");var B=this._mResolvedTiles;function E(T){return new q.Deferred(function(F){var I,N;var G;var H=false;var K={};if(P.url||P.url===""){I=y.parseShellHash(P.url);if(!I){N=s(P.url);}else{N=v(I);}}if(T.icon!==P.icon){K.icon=P.icon;H=true;}if(T.title!==P.title){K.title=P.title;H=true;}if(T.subTitle!==P.subtitle){K.subtitle=P.subtitle;H=true;}if(P.url&&e!==P.url){K.targetURL=P.url;H=true;}if(T.info!==P.info){K.info=P.info;H=true;}j(T,P,N);if(H&&B[T.id]){G=B[T.id].tileComponent;if(G){G.tileSetVisualProperties(K);}}F.resolve(T);}).promise();}return this._visitBookmarks(e,E).then(function(F){return z.save().then(function(){return F;});});};this.deleteBookmarks=function(e){var x=sap.ushell.Container;var y=x.getService("URLParsing");var z=x.getService("CommonDataModel");var I=y.parseShellHash(e);var B;if(I){B=v(I);}else{B=s(e);}return z.getSite().then(function(E){var G=E.groups;var F=Object.keys(G).map(function(K){var P=G[K].payload;var H=0;P.tiles=P.tiles.filter(function(T){if(T.isBookmark&&k(B,T.target)){++H;return false;}return true;});return H;}).reduce(function(H,K){H+=K;return H;},0);return z.save().then(function(){return F;});});};this.onCatalogTileAdded=function(T){};this._onTileSettingsSave=function(T,e){var x=new q.Deferred(),y,z,N,B,E,F,G,H;if(T&&T.id&&e){N=e.oTitleInput.getValue();E=e.oSubTitleInput.getValue();B=e.oInfoInput.getValue();F=this.getTileTitle(T);G=this.getTileInfo(T);H=this.getTileSubtitle(T);if(F===N&&H===E&&G===B){return undefined;}y=sap.ushell.Container.getService("CommonDataModel");var I=this;y.getSite().done(function(K){if(!K.modifiedTiles){K.modifiedTiles={};}if(!K.modifiedTiles[T.id]){K.modifiedTiles[T.id]={id:T.id};}z={};if(F!==N){z.title=N;K.modifiedTiles[T.id].title=N;T.title=N;}if(H!==E){z.subtitle=E;K.modifiedTiles[T.id].subTitle=E;T.subTitle=E;}if(G!==B){z.info=B;K.modifiedTiles[T.id].info=B;T.info=B;}if(I._mResolvedTiles[T.id].tileComponent){I._mResolvedTiles[T.id].tileComponent.tileSetVisualProperties(z);}else if(I._mResolvedTiles[T.id].linkTileControl){if(z.title){I._mResolvedTiles[T.id].linkTileControl.setHeader(z.title);}if(z.subtitle){I._mResolvedTiles[T.id].linkTileControl.setSubheader(z.subtitle);}if((z.title)||(z.subtitle)){I._mResolvedTiles[T.id].linkTileControl.rerender();}}y.save().fail(function(P){q.sap.log.error(P);x.reject("Could not save personalization changes: "+P);}).done(function(){x.resolve();});}).fail(function(K){q.sap.log.error(K);x.reject("Cannot get site: "+K);});}return x.promise();};this.getTileActions=function(T){var e=[],x,y;if(this._isGroupTile(T)&&!this._isFailedGroupTile(T)){y=new J({config:{"display_title_text":this.getTileTitle(T),"display_subtitle_text":this.getTileSubtitle(T),"display_info_text":this.getTileInfo(T)}});x=o.getTileSettingsAction(y,this._onTileSettingsSave.bind(this,T),this.getTileType(T));e.push(x);}return e;};function f(P,T){var e=h(P,T);e.isBookmark=true;return e;}function h(P,T){var e={id:u.generateUniqueId([])};j(e,P,T);return e;}function j(T,P,e){P=q.extend(true,{},P);if(e){T.target=e;}if(P.title||P.title===""){T.title=P.title;}if(P.icon||P.icon===""){T.icon=P.icon;}if(P.subtitle||P.subtitle===""){T.subTitle=P.subtitle;}if(P.info||P.info===""){T.info=P.info;}if(P.dataSource){T.dataSource={};q.extend(true,T.dataSource,P.dataSource);delete P.serviceUrl;}else if(P.dataSource===null){delete T.dataSource;delete T.indicatorDataSource;delete P.serviceUrl;}if((P.dataSource||T.dataSource)&&P.serviceUrlPath){T.indicatorDataSource={path:P.serviceUrlPath};}if(P.serviceUrl||P.serviceUrl===""){if(T.dataSource){q.sap.log.warning("`serviceUrl` is marked for deprecation in the future."+"It is not the preferred means for defining a dynamic "+"tile's data source. Please use `oParameter.dataSource`");delete T.dataSource;}T.indicatorDataSource={path:P.serviceUrl};}else if(P.serviceUrl===null&&!T.dataSource){delete T.indicatorDataSource;}if(P.serviceRefreshInterval||P.serviceRefreshInterval===0){T.indicatorDataSource.refresh=P.serviceRefreshInterval;}}function k(T,e){if(T&&e){if(T.url){return T.url===e.url;}return T.semanticObject===e.semanticObject&&T.action===e.action&&l(T.parameters,e.parameters);}return T===e;}function l(P,e){var F,x;P=P||[];e=e||[];if(P.length===e.length){F=t(P);x=t(e);return F===x;}return false;}function t(e){return e.map(function(P){return P.name+P.value;}).sort().join();}function s(e){return{url:e};}function v(I){var T={semanticObject:I.semanticObject,action:I.action,parameters:w(I.params)};if(I.appSpecificRoute){T.appSpecificRoute=I.appSpecificRoute;}return T;}function w(I){return Object.keys(I).map(function(K){var V=I[K]&&I[K][0];return{name:K,value:V||""};});}this._getSiteData=function(){return sap.ushell.Container.getService("CommonDataModel").getSite();};this._addDefaultGroup=function(G,e){var x=r.getDefaultGroup(G);if(!x){x=m.createDefaultGroup(u.generateUniqueId(r.getGroupIdsFromSite(e)));e=m.addGroupToSite(e,x,0);G=r.getGroupsArrayFromSite(e);}this._oDefaultGroup=x;return G;};}L.prototype=Object.create(A.prototype);return L;},true);
