// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/thirdparty/jquery"],function(L,q){"use strict";var c={token:null},C=n.bind(null,c),f=l.bind(null,c),a=m.bind(null,c),e=g.bind(null,XMLHttpRequest),b=r.bind(null,e,u);return Object.create(null,{_executeRequest:{value:g},executeRequest:{value:e},executeRequestWithCsrfToken:{value:d},isSafeHttpMethod:{value:j},isValidHttpMethod:{value:k},summariseResponse:{value:s},processResponse:{value:p},getHttpRequestWrapper:{value:h},containsCSRFTokenHeaderEntry:{value:i},csrfTokenReadFromCache:{value:f},csrfTokenWriteToCache:{value:a},csrfTokenIsCached:{value:C},_csrfTokenFetch:{value:r},csrfTokenFetch:{value:b},_csrfTokenGet:{value:o},csrfTokenGet:{value:o.bind(null,C,f,a,b)},csrfTokenAddToRequestHeader:{value:t},csrfTokenExtractFromResponseHeader:{value:u}});function d(E,v,w,x,y,z,I,R,U,A){function B(F){return(F&&(F.status===403)&&(z(F).toLowerCase()==="required"));}var D;if(!/Function/.test(Object.prototype.toString.call(E))||!/Function/.test(Object.prototype.toString.call(v))||!/Function/.test(Object.prototype.toString.call(x))||!/Function/.test(Object.prototype.toString.call(w))||!/Function/.test(Object.prototype.toString.call(y))||!/Function/.test(Object.prototype.toString.call(z))||!/Function/.test(Object.prototype.toString.call(I))){throw new Error("DependencyInjectionError: one or more of the injected dependencies is invalid");}if(!/String/.test(Object.prototype.toString.call(R))||!/String/.test(Object.prototype.toString.call(U))){throw new Error("IllegalArgumentError: one or more of the arguments is invalid");}if(!A){A={};}return new Promise(function(F,G){function H(J){L.error(J,null,"sap.ushell.util.HttpClient");G(J);}if(!I(R)){w(U).then(function(J){D=y(J,A);return E(R,U,D);}).then(function(J){F(J);}).catch(function(J){if(B(J)){x(U).then(function(K){D=y(K,A);return E(R,U,D);}).then(function(K){F(K);}).catch(H);}else{H(J);}});}else{D=y("fetch",A);E(R,U,D).then(function(J){var K=z(J);if(K){v(K);}F(J);}).catch(H);}});}function g(F,R,U,v){var H,w,x;if(!/Function/.test(Object.prototype.toString.call(F))){throw new Error("DependencyInjectionError: one or more of the injected dependencies is invalid");}if(!/String/.test(Object.prototype.toString.call(R))||!/String/.test(Object.prototype.toString.call(U))){throw new Error("IllegalArgumentException: one or more of the arguments is invalid");}x=new F();if(/[a-z]/.test(R)){R=R.toUpperCase();}if(v){H=!v.headers?[]:Object.keys(v.headers).map(function(y){return{name:y,value:this[y]};},v.headers);w=v.data;}else{H=[];}return new Promise(function(y,z){["load","error"].forEach(function(E){x.addEventListener(E,p.bind(null,x,y,z));});x.open(R,U);H.forEach(function(A){x.setRequestHeader(A.name,A.value);});x.send(JSON.stringify(w));});}function h(M,H,B,v){if(!/String/.test(Object.prototype.toString.call(M))||!/Function/.test(Object.prototype.toString.call(H))||!/String/.test(Object.prototype.toString.call(B))){throw new Error("IllegalArgumentError: one or more of the arguments is invalid");}return function(P,S){return H(M,B.replace(/\/$/,"")+"/"+P.replace(/^\//,""),q.extend({},v,S));};}function p(x,O,E){var R;if(!x||!/Number/.test(Object.prototype.toString.call(x.status))||!/Function/.test(Object.prototype.toString.call(x.getAllResponseHeaders))){throw new Error("IllegalArgumentError: invalid XMLHttpRequest instance");}R=s(x);if(x.status<200||x.status>299){E(R);}else{O(R);}}function s(x){return{status:x.status,statusText:x.statusText,responseText:x.responseText,responseHeaders:x.getAllResponseHeaders().split(/\r\n/g).filter(function(I){return I.length>0;}).map(function(H){var P=H.split(":");return{name:P[0].trim(),value:P[1].trim()};})};}function i(H){var v=H["x-csrf-token"]||H["X-CSRF-TOKEN"];return!!v&&/String/.test(Object.prototype.toString.call(v));}function j(H){switch(H){case"HEAD":case"GET":case"OPTIONS":return true;case"POST":case"PUT":case"DELETE":return false;default:throw new Error("IllegalArgumentError: '"+H+"' is not a supported request method");}}function k(H){switch(H){case"HEAD":case"GET":case"OPTIONS":case"POST":case"PUT":case"DELETE":return true;default:throw new Error("IllegalArgumentError: '"+H+"' is not a supported request method");}}function l(v){return v.token;}function m(v,N){v.token=N;}function n(v){return!!v.token;}function o(v,w,x,y,U){if(!/Function/.test(Object.prototype.toString.call(v))||!/Function/.test(Object.prototype.toString.call(w))||!/Function/.test(Object.prototype.toString.call(x))||!/Function/.test(Object.prototype.toString.call(y))){throw new Error("DependencyInjectionError: one or more of the injected dependencies is invalid");}if(!/String/.test(Object.prototype.toString.call(U))){throw new Error("IllegalArgumentError: one or more of the arguments is invalid");}return new Promise(function(z,A){if(v()){z(w());}else{y(U).then(function(B){x(B);z(B);}).catch(function(E){A(E);});}});}function r(E,v,U){if(!/Function/.test(Object.prototype.toString.call(E))||!/Function/.test(Object.prototype.toString.call(v))){throw new Error("DependencyInjectionError: one or more of the injected dependencies is invalid");}if(!/String/.test(Object.prototype.toString.call(U))){throw new Error("IllegalArgumentError: one or more of the arguments is invalid");}return E("OPTIONS",U,{headers:{"x-csrf-token":"fetch"}}).then(function(R){return v(R);});}function t(H,v){var E,O={"x-csrf-token":H};if(!/String/.test(Object.prototype.toString.call(H))||!/object Object/.test(Object.prototype.toString.call(v))){throw new Error("IllegalArgumentError: one or more of the arguments is invalid");}E=q.extend(true,{},v);if(!E.headers){E.headers=O;}else{q.extend(E.headers,O);}return E;}function u(R){var v;if(!/Array/.test(Object.prototype.toString.call(R.responseHeaders))){return undefined;}v=R.responseHeaders.filter(function(H){return H.name==="x-csrf-token";})[0];return v&&v.value?v.value:undefined;}});
