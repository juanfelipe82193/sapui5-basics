// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/ListItem","sap/ui/model/Sorter","sap/m/MultiComboBox","sap/ui/model/BindingMode","sap/m/SearchField","sap/m/FlexBox","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/ToggleButton","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/m/Toolbar","sap/m/Page","sap/ushell/resources","sap/ui/Device","sap/ui/core/Component"],function(q,L,S,M,B,a,F,b,c,T,A,d,P,r,D,C){"use strict";sap.ui.jsview("sap.ushell.components.appfinder.AppFinder",{createContent:function(){this.oController=this.getController();this.parentComponent=C.getOwnerComponentFor(this);this.setModel(this.parentComponent.getModel());this.enableEasyAccessSAPMenu=this.getModel().getProperty("/enableEasyAccessSAPMenu");this.enableEasyAccessUserMenu=this.getModel().getProperty("/enableEasyAccessUserMenu");if((!this.enableEasyAccessSAPMenu&&!this.enableEasyAccessUserMenu)||(D.system.phone||D.system.tablet&&(!D.system.combi))){this.showEasyAccessMenu=false;}else{this.showEasyAccessMenu=true;}var R=r.i18n;this.oPage=new P("appFinderPage",{showHeader:false,showSubHeader:false,showFooter:false,showNavButton:false,enableScrolling:false,title:{parts:["/groupContext/title"],formatter:function(t){return!t?R.getText("appFinderTitle"):R.getText("appFinder_group_context_title",t);}}});return this.oPage;},_showSearch:function(m){var s="enableCatalogSearch";if(m==="userMenu"){s="enableEasyAccessUserMenuSearch";}else if(m==="sapMenu"){s="enableEasyAccessSAPMenuSearch";}return this.getModel().getProperty("/"+s);},_showSearchTag:function(m){if(m==="userMenu"||m==="sapMenu"){return false;}return this.getModel().getProperty("/enableCatalogTagFilter");},createSubHeader:function(){this.oToolbar=new d("appFinderSubHeader",{});if(D.system.desktop){this.oToolbar.addEventDelegate({onsapskipback:function(e){e.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(e);},onsapskipforward:function(e){var o=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(o.getVisible()&&!o.getPressed()){e.preventDefault();sap.ushell.components.ComponentKeysHandler.setFocusOnCatalogTile();}},onAfterRendering:function(){q("#catalog-button").attr("accesskey","a");}});}this.oToolbar.addCustomData(new A({key:"role",value:"heading",writeToDom:true}));this.oToolbar.addCustomData(new A({key:"aria-level",value:"2",writeToDom:true}));this.oToolbar.addStyleClass("sapUshellAppFinderHeader");this.oPage.setSubHeader(this.oToolbar);this.oPage.setShowSubHeader(true);if(!this.openCloseSplitAppButton){this.openCloseSplitAppButton=new T("openCloseButtonAppFinderSubheader",{icon:"sap-icon://menu2",visible:"{/openCloseSplitAppButtonVisible}",pressed:"{/openCloseSplitAppButtonToggled}",press:function(e){this.getController().oSubHeaderModel.setProperty("/openCloseSplitAppButtonToggled",e.getSource().getPressed());this.openCloseSplitAppButton.setTooltip(e.getParameter("pressed")?r.i18n.getText("ToggleButtonHide"):r.i18n.getText("ToggleButtonShow"));}.bind(this),tooltip:r.i18n.getText("ToggleButtonShow")});if(D.system.desktop){this.openCloseSplitAppButton.addEventDelegate({onsaptabprevious:function(e){e.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(e);}});}this.openCloseSplitAppButton.setModel(this.getController().oSubHeaderModel);this.oToolbar.addContent(this.openCloseSplitAppButton);}},updateSubHeader:function(m,e){var s,f;this.oToolbar.removeAllContent();this.oToolbar.addContent(this.openCloseSplitAppButton);if(e){s=this.createSegmentedButtons(m);this.oPage.addStyleClass("sapUshellAppFinderWithEasyAccess");this.oToolbar.addContent(s);}if(this._showSearch(m)){f=this.createSearchControl(m);this.oToolbar.addContent(f);}this.getController()._updateCurrentMenuName(m);},createSegmentedButtons:function(m){var o,R,s,e,f,i;if(this.segmentedButton){this.segmentedButton.setSelectedButton(m);return this.segmentedButton;}o=this.getController();R=r.i18n;s=[];s.push(new c("catalog",{text:R.getText("appFinderCatalogTitle"),press:function(E){o.onSegmentButtonClick(E);}}));if(this.enableEasyAccessUserMenu){s.push(new c("userMenu",{text:R.getText("appFinderUserMenuTitle"),press:function(E){o.onSegmentButtonClick(E);}}));}if(this.enableEasyAccessSAPMenu){s.push(new c("sapMenu",{text:R.getText("appFinderSapMenuTitle"),press:function(E){o.onSegmentButtonClick(E);}}));}this.segmentedButton=new b("appFinderSegmentedButtons",{items:s});if(D.system.desktop){this.segmentedButton.addEventDelegate({onsaptabprevious:function(E){var g=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(!g.getVisible()){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(E);}}});}this.segmentedButton.setSelectedButton(m);e=this.segmentedButton.getItems();for(i=0;i<e.length;i++){f=e[i];f.addCustomData(new A({key:"aria-controls",value:f.getId()+"View",writeToDom:true}));}return this.segmentedButton;},_handleSearch:function(){this.getController().searchHandler.apply(this.getController(),arguments);q("#appFinderSearch input").select();},createSearchControl:function(m){if(!this.oAppFinderSearchContainer){this.oAppFinderSearchContainer=new F("appFinderSearchContainer");}this.oAppFinderSearchContainer.removeAllItems();if(m==="catalog"&&this._showSearchTag("catalog")){this.createTagControl();this.oAppFinderSearchContainer.addItem(this.oAppFinderTagFilter);}if(!this.oAppFinderSearchControl){this.oAppFinderSearchControl=new a("appFinderSearch",{search:this._handleSearch.bind(this),value:{path:"subHeaderModel>/search/searchTerm",mode:B.OneWay}}).addStyleClass("help-id-catalogSearch");this.oAppFinderSearchControl.addCustomData(new A({key:"aria-controls",value:"",writeToDom:true}));if(D.system.desktop){this.oAppFinderSearchControl.addEventDelegate({onsaptabnext:function(e){var o=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(o.getVisible()&&!o.getPressed()){e.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.components.ComponentKeysHandler.setFocusOnCatalogTile();}}});}}this.oAppFinderSearchContainer.addItem(this.oAppFinderSearchControl);this._updateSearchWithPlaceHolder(m);return this.oAppFinderSearchContainer;},_updateSearchWithPlaceHolder:function(m){var s="";if(m==="catalog"){s="EasyAccessMenu_SearchPlaceHolder_Catalog";}else if(m==="userMenu"){s="EasyAccessMenu_SearchPlaceHolder_UserMenu";}else if(m==="sapMenu"){s="EasyAccessMenu_SearchPlaceHolder_SAPMenu";}if(s&&this.oAppFinderSearchControl){this.oAppFinderSearchControl.setPlaceholder(r.i18n.getText(s));this.oAppFinderSearchControl.setTooltip(r.i18n.getText(s));}},createTagControl:function(){if(this.oAppFinderTagFilter){return this.oAppFinderTagFilter;}this.oAppFinderTagFilter=new M("appFinderTagFilter",{selectedKeys:{path:"subHeaderModel>/tag/selectedTags"},tooltip:"{i18n>catalogTilesTagfilter_tooltip}",placeholder:"{i18n>catalogTilesTagfilter_HintText}",visible:{path:"/tagList",formatter:function(t){return t.length>0;}},items:{path:"/tagList",sorter:new S("tag",false,false),template:new L({text:"{tag}",key:"{tag}"})},selectionChange:[this.oController.onTagsFilter,this.oController]}).addStyleClass("help-id-catalogTagFilter");return this.oAppFinderTagFilter;},getControllerName:function(){return"sap.ushell.components.appfinder.AppFinder";}});});
