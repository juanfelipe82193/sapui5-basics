// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/model/json/JSONModel","sap/ui/core/Icon","sap/m/Label","sap/m/CustomListItem","sap/m/library","sap/m/Link","sap/base/Log","sap/ui/thirdparty/jquery"],function(J,I,L,C,m,a,b,q){"use strict";var c=m.ListType;sap.ui.controller("sap.ushell.components.treeview.NavTree",{onInit:function(){var v=this.getView().getViewData(),r=v.data.items,s=v.data.serviceURL||"",t={items:[],entryObject:{}};var M=new J(t);this.getView().setModel(M);q.getJSON(s).done(function(r){this.buidModelData(r);}.bind(this)).fail(function(j,d,e){var f=d+", "+e;b.error("Request Failed: "+f);this.buidModelData(r);}.bind(this));},buidModelData:function(r){var i,e,g=0,t={items:[],entryObject:{}};for(i in r.nodes){var d=r.nodes[i];if(d.type==="SUBMENU"){var f=d.title;for(e in d.nodes){var h=d.nodes[e];h.groupIndex=g.toString();h.groupName=f;t.items.push(h);t.entryObject[g.toString()]={title:d.title,type:d.type};}}else if(d.type==="URL"||d.type==="APP"){d.groupIndex=g.toString();d.groupName="";t.items.push(d);t.entryObject[g.toString()]={title:d.title,type:d.type,href:d.target};}g++;}var M=new J(t);this.getView().setModel(M);},getGroupHeader:function(g){var e=this.getView().getModel().getData().entryObject[g.key];if(e.type==="SUBMENU"){var i=new I({src:"slim-arrow-right",tooltip:e.title}).addStyleClass("sapUshellGroupListItemIcon");var l=new L({text:e.title}).addStyleClass("sapUshellNavTreeLink");return new C({press:[this.handleClickOnSubMenu,this],type:c.Active,content:[i,l]}).addStyleClass("sapUshellNavTreeListItem sapUshellNavTreeParent");}return new C({content:new a({text:e.title,href:e.href}).addStyleClass("sapUshellNavTreeLink")}).addEventDelegate({onclick:this.onNavTreeTitleChange.bind(this)}).addStyleClass("sapUshellNavTreeListItem sapUshellNavTreeSingle");},onNavTreeTitleChange:function(e){if(this._prevSelect){this._prevSelect.removeStyleClass("sapUshellNavTreeItemSelected");}var i=e.srcControl;if(e.srcControl.getContent){window.location.href=e.srcControl.getContent()[0].getHref();i.addStyleClass("sapUshellNavTreeItemSelected");this._prevSelect=i;}else{i.getParent().addStyleClass("sapUshellNavTreeItemSelected");this._prevSelect=i.getParent();}},handleClickOnSubMenu:function(e){var i=e.getSource().getContent()[0];if(i.getSrc()==="slim-arrow-down"){i.setSrc("slim-arrow-right");this.toggleSubItemsState(e,true);}else{i.setSrc("slim-arrow-down");this.toggleSubItemsState(e,false);}},toggleSubItemsState:function(e,i){if(e){var j=q(e.getSource().getDomRef());if(i){j.nextUntil(".sapUshellNavTreeSingle, .sapUshellNavTreeParent").addClass("sapUshellNavTreeChildHide");}else{j.nextUntil(".sapUshellNavTreeSingle, .sapUshellNavTreeParent").removeClass("sapUshellNavTreeChildHide");}}}});},true);
