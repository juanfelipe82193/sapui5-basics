// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/components/applicationIntegration/AppLifeCycle","sap/ushell/Config","sap/ui/thirdparty/jquery","sap/base/Log","sap/ui/core/Component","sap/ushell/resources"],function(A,C,q,L,a,r){"use strict";sap.ui.controller("sap.ushell.components.shell.UserSettings.userActivitiesHandler",{onInit:function(){this.oModel=A.getElementsModel().getModel();this.isTrackingEnable=this.oModel.getProperty("/enableTrackingActivity")!==undefined?this.oModel.getProperty("/enableTrackingActivity"):true;this.currentTrackingMode=this.isTrackingEnable;this.oView.trackUserActivitySwitch.setState(this.isTrackingEnable);},getContent:function(){var d=q.Deferred();d.resolve(this.getView());return d.promise();},getValue:function(){return q.Deferred().resolve(" ");},onCancel:function(){var d=q.Deferred();if(this.currentTrackingMode!==this.isTrackingEnable){this.isTrackingEnable=!this.isTrackingEnable;this.oView.trackUserActivitySwitch.setState(this.isTrackingEnable);}d.resolve();return d.promise();},onSave:function(){var d=q.Deferred();if(this.currentTrackingMode!==this.isTrackingEnable){this.oModel.setProperty("/enableTrackingActivity",this.isTrackingEnable);this.writeUserActivityModeToPersonalization(this.isTrackingEnable);this.currentTrackingMode=this.isTrackingEnable;C.emit("/core/shell/model/enableTrackingActivity",this.isTrackingEnable);}d.resolve();return d.promise();},writeUserActivityModeToPersonalization:function(i){var d,p;try{p=this._getPersonalizer().setPersData(i);}catch(e){L.error("Personalization service does not work:");L.error(e.name+": "+e.message);d=new q.Deferred();d.reject(e);p=d.promise();}return p;},_getPersonalizer:function(){var p=sap.ushell.Container.getService("Personalization"),c=a.getOwnerComponentFor(this),s={keyCategory:p.constants.keyCategory.FIXED_KEY,writeFrequency:p.constants.writeFrequency.LOW,clientStorageAllowed:true},P={container:"flp.settings.FlpSettings",item:"userActivitesTracking"};return p.getPersonalizer(P,s,c);},_handleCleanHistory:function(){sap.ushell.Container.getServiceAsync("UserRecents").then(function(s){s.clearRecentActivities();b();function b(){sap.ui.require(["sap/m/MessageToast"],function(M){var m=r.i18n.getText("savedChanges");M.show(m,{duration:3000,width:"15em",my:"center bottom",at:"center bottom",of:window,offset:"0 -50",collision:"fit fit"});});}});},_handleTrackUserActivitySwitch:function(i){this.isTrackingEnable=i;}});});
