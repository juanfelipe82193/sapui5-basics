// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/jquery"],function(q){"use strict";sap.ui.controller("sap.ushell.components.shell.UserSettings.UserProfiling",{onInit:function(){this.isContentLoaded=true;},onCancel:function(){var p=this.getView().getModel().getProperty("/userPreferences/profiling"),P,i;for(i=0;i<p.length;i++){P=p[i];if(P.onCancel){P.onCancel();}}},getValue:function(){var d=q.Deferred();var p=this.getView().getModel().getProperty("/userPreferences/profiling");p.forEach(function(e,i){if(e.entryHelpID==="usageAnalytics"){if(!sap.ushell.Container.getService("UsageAnalytics").systemEnabled()||!sap.ushell.Container.getService("UsageAnalytics").isSetUsageAnalyticsPermitted()){p.splice(i,1);}}},this);if(p!==undefined&&p.length>0){d.resolve({value:1,displayText:" "});}else{d.resolve({value:0,displayText:" "});}return d.promise();},onSave:function(){var r=q.Deferred(),p=this.getView().getModel().getProperty("/userPreferences/profiling"),w,P=[],t=0,s=0,f=0,F=[],T,a=function(){s++;r.notify();},b=function(e){F.push({entry:"currEntryTitle",message:e});f++;r.notify();};p.forEach(function(i){T=i.onSave();T.done(a);T.fail(b);P.push(T);t++;});w=q.when.apply(null,P);w.done(function(){r.resolve();});r.progress(function(){if(f>0&&(f+s===t)){r.reject("At least one save action failed");}});return r.promise();},getContent:function(){var t=this,d=q.Deferred(),p=this.getView().getModel().getProperty("/userPreferences/profiling");p.forEach(function(i){var c=i.contentFunc();c.done(function(r){t.getView().profilingContent.addItem(r);});});d.resolve(t.getView());return d.promise();}});});
