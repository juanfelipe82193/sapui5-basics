// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sinaDefine(['../../../sina/SinaObject','./NavigationTargetForIntent'],function(S,N){"use strict";return S.derive({_init:function(){if(typeof sap!=="undefined"&&sap.ushell&&sap.ushell.Container){this._launchpadNavigation=sap.ushell.Container.getService("SmartNavigation")||sap.ushell.Container.getService("CrossApplicationNavigation");this._fioriFrontendSystemInfo={systemId:sap.ushell.Container.getLogonSystem().getName(),client:sap.ushell.Container.getLogonSystem().getClient()};this._primaryIntentAction="-displayFactSheet";this._suppressInSearchTag="suppressInEnterpriseSearch".toLowerCase();}},resolveIntents:function(a){var t=this;if(!t._launchpadNavigation||!a){return Promise.resolve({defaultNavigationTarget:a.fallbackDefaultNavigationTarget});}if(Array.isArray(a)){var p=[];for(var k=0;k<a.length;k++){var b=t._doResolveIntents(a[k]);p.push(b);}return Promise.all(p);}return t._doResolveIntents(a);},_doResolveIntents:function(a){var t=this;var s=a.semanticObjectType;var b=a.semanticObjectTypeAttributes;var c=a.systemId;var d=a.client;var f=a.fallbackDefaultNavigationTarget;if(!s||s.length===0){return Promise.resolve({defaultNavigationTarget:f});}if(!b||b.length===0){return Promise.resolve();}var e={};var v;for(var i=0;i<b.length;i++){v=this.convertAttributeValueToUI5DataTypeFormats(b[i].value,b[i].type);e[b[i].name]=v;}var g={};g.systemId=c||(t._fioriFrontendSystemInfo&&t._fioriFrontendSystemInfo.systemId);g.client=d||(t._fioriFrontendSystemInfo.client&&t._fioriFrontendSystemInfo.client);if(c&&c.trim().length>0&&d&&d.trim().length>0&&(!t._fioriFrontendSystemInfo||!(t._fioriFrontendSystemInfo.systemId===c&&t._fioriFrontendSystemInfo.client===d))){g.urlParameter="sap-system=sid("+c+"."+d+")";}var p=new Promise(function(r,j){if(t._launchpadNavigation.getPrimaryIntent){t._launchpadNavigation.getPrimaryIntent(s,e).done(function(k){r(k);}).fail(function(){r();});}else{r();}});var h=new Promise(function(r,j){var k;if(t._launchpadNavigation.getLinks){k=t._launchpadNavigation.getLinks({semanticObject:s,params:e,withAtLeastOneUsedParam:true,sortResultOnTexts:true});}else{k=t._launchpadNavigation.getSemanticObjectLinks(s,e);}k.done(function(l){r(l);}).fail(function(){r();});});return Promise.all([p,h]).then(function(j){var i;var k=j[0];var l,m=j[1];var n;var r={};var o;if(k&&!t._shallIntentBeSuppressed(k)){o=t._getNavigationTargetForIntent(k,g);r.defaultNavigationTarget=o;}var q=r.defaultNavigationTarget!==undefined;r.navigationTargets=[];if(m){for(i=0;i<m.length;i++){l=m[i];if(t._shallIntentBeSuppressed(l)){continue;}n=t._getNavigationTargetForIntent(l,g);if(!q&&l.intent.substring(l.intent.indexOf("-"),l.intent.indexOf("?"))===t._primaryIntentAction){r.defaultNavigationTarget=n;q=true;}else if(!o||!n.isEqualTo(o)){r.navigationTargets.push(n);}}}return r;});},_shallIntentBeSuppressed:function(a){if(a.tags){for(var i=0;i<a.tags.length;i++){if(a.tags[i].toLowerCase()===this._suppressInSearchTag){return true;}}}return false;},_getNavigationTargetForIntent:function(i,s){var t=this;var a=i.intent;if(s.urlParameter){if(a.indexOf('?')===-1){a+="?";}else{a+="&";}a+=s.urlParameter;}var e={target:{shellHash:a}};var b=t._launchpadNavigation.hrefForExternal(e);var n=t.sina._createNavigationTargetForIntent({label:i.text,targetUrl:b,externalTarget:e,systemId:s.systemId,client:s.client});return n;},convertAttributeValueToUI5DataTypeFormats:function(v,s){var y,m,d,h,a,b,c;switch(s){case this.sina.AttributeType.Timestamp:y=v.getUTCFullYear();m=v.getUTCMonth()+1;d=v.getUTCDate();h=v.getUTCHours();a=v.getUTCMinutes();b=v.getUTCSeconds();c=v.getUTCMilliseconds()*1000;v=this.addLeadingZeros(y.toString(),4)+'-'+this.addLeadingZeros(m.toString(),2)+'-'+this.addLeadingZeros(d.toString(),2)+'T'+this.addLeadingZeros(h.toString(),2)+':'+this.addLeadingZeros(a.toString(),2)+':'+this.addLeadingZeros(b.toString(),2)+'.'+this.addLeadingZeros(c.toString(),3);break;case this.sina.AttributeType.Date:v=v.slice(0,4)+'-'+v.slice(5,7)+'-'+v.slice(8,10);break;}return v;},addLeadingZeros:function(v,l){return'00000000000000'.slice(0,l-v.length)+v;}});});
