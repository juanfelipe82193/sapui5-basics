// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sinaDefine(['../core/core','../core/util','./SearchQuery','./ChartQuery','./DataSourceQuery','./SuggestionQuery','./Filter','./DataSource','./ComplexCondition','./SimpleCondition','./AttributeMetadata','./AttributeGroupMetadata','./AttributeGroupMembership','./SearchResultSetItemAttribute','./SearchResultSetItemAttributeGroup','./SearchResultSetItemAttributeGroupMembership','./SearchResultSetItem','./SearchResultSet','./AttributeType','./AttributeFormatType','./AttributeSemanticsType','./AttributeGroupTextArrangement','./DataSourceType','./SuggestionType','./SuggestionCalculationMode','./FacetType','./MatchingStrategy','./LogicalOperator','./ComparisonOperator','./AttributeUsageType','./FacetResultSet','./FacetResultSetItem','./SearchTermSuggestion','./SearchTermAndDataSourceSuggestion','./DataSourceSuggestion','./ObjectSuggestion','./SuggestionResultSet','./ChartResultSet','./DataSourceResultSet','./ChartResultSetItem','./DataSourceResultSetItem','./EqualsMode','./SortOrder','./Capabilities','./ConditionType','./Configuration','../providers/inav2/typeConverter','./NavigationTarget','../providers/tools/fiori/FioriIntentsResolver','../providers/tools/fiori/NavigationTargetForIntent','../providers/tools/cds/CDSAnnotationsParser','../providers/tools/ItemPostParser','../providers/tools/fiori/SuvNavTargetResolver','../providers/tools/sors/NavigationTargetGenerator','./formatters/ConfigSearchResultSetFormatter','./formatters/ConfigMetadataFormatter','./formatters/Formatter','./formatters/NavtargetsInResultSetFormatter','./formatters/RemovePureAdvancedSearchFacetsFormatter','./formatters/ResultValueFormatter'],function(c,u,S,C,D,a,F,b,d,e,A,f,g,h,k,l,m,n,o,p,q,r,s,t,v,w,M,L,x,y,z,B,E,G,H,O,I,J,K,N,P,Q,R,T,U,V,W,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1){"use strict";return c.defineClass({AttributeType:o,AttributeFormatType:p,AttributeSemanticsType:q,AttributeGroupTextArrangement:r,DataSourceType:s,AttributeUsageType:y,MatchingStrategy:M,LogicalOperator:L,ComparisonOperator:x,FacetType:w,SuggestionCalculationMode:v,SuggestionType:t,EqualsMode:Q,SortOrder:R,ConditionType:U,SearchResultSet:n,SearchResultSetItem:m,SearchResultSetItemAttribute:h,ObjectSuggestion:O,_init:function(i){this.core=c;this.util=u;this.inav2TypeConverter=W;this.provider=i;this.createSearchQuery=this.generateFactoryMethod(S);this.createChartQuery=this.generateFactoryMethod(C);this.createSuggestionQuery=this.generateFactoryMethod(a);this.createDataSourceQuery=this.generateFactoryMethod(D);this.createFilter=this.generateFactoryMethod(F);this.createComplexCondition=this.generateFactoryMethod(d);this.createSimpleCondition=this.generateFactoryMethod(e);this._createAttributeMetadata=this.generateFactoryMethod(A);this._createAttributeGroupMetadata=this.generateFactoryMethod(f);this._createAttributeGroupMembership=this.generateFactoryMethod(g);this._createSearchResultSetItemAttribute=this.generateFactoryMethod(h);this._createSearchResultSetItemAttributeGroup=this.generateFactoryMethod(k);this._createSearchResultSetItemAttributeGroupMembership=this.generateFactoryMethod(l);this._createSearchResultSetItem=this.generateFactoryMethod(m);this._createSearchResultSet=this.generateFactoryMethod(n);this._createSearchTermSuggestion=this.generateFactoryMethod(E);this._createSearchTermAndDataSourceSuggestion=this.generateFactoryMethod(G);this._createDataSourceSuggestion=this.generateFactoryMethod(H);this._createObjectSuggestion=this.generateFactoryMethod(O);this._createSuggestionResultSet=this.generateFactoryMethod(I);this._createChartResultSet=this.generateFactoryMethod(J);this._createDataSourceResultSet=this.generateFactoryMethod(K);this._createChartResultSetItem=this.generateFactoryMethod(N);this._createDataSourceResultSetItem=this.generateFactoryMethod(P);this._createCapabilities=this.generateFactoryMethod(T);this._createConfiguration=this.generateFactoryMethod(V);this._createNavigationTarget=this.generateFactoryMethod(X);this._createSorsNavigationTargetGenerator=this.generateFactoryMethod(b1);this._createFioriIntentsResolver=this.generateFactoryMethod(Y);this._createNavigationTargetForIntent=this.generateFactoryMethod(Z);this._createCDSAnnotationsParser=this.generateFactoryMethod($);this._createItemPostParser=this.generateFactoryMethod(_);this._createSuvNavTargetResolver=this.generateFactoryMethod(a1);this.searchResultSetFormatters=[];this.metadataFormatters=[];this.dataSources=[];this.dataSourceMap={};this.allDataSource=this._createDataSource({id:'All',label:'All',type:this.DataSourceType.Category});this.searchResultSetFormatters.push(new f1());this.searchResultSetFormatters.push(new h1());},_initAsync:function(i){i=i||{};this.isDummyProvider=i.provider.indexOf("dummy")>-1;this.provider.label=i.label;return c.Promise.resolve().then(function(){return this._evaluateConfigurationAsync(i);}.bind(this)).then(function(){i.sina=this;return this.provider._initAsync.apply(this.provider,[i]);}.bind(this)).then(function(j){j=j||{};this.capabilities=j.capabilities||this._createCapabilities();return this._formatMetadataAsync();}.bind(this)).then(function(){if(this.getBusinessObjectDataSources().length===0&&!this.isDummyProvider){return Promise.reject(new c.Exception('Not active - no datasources'));}}.bind(this));},_formatMetadataAsync:function(){return c.executeSequentialAsync(this.metadataFormatters,function(i){return i.formatAsync({dataSources:this.dataSources});}.bind(this));},_evaluateConfigurationAsync:function(i1){var j1=[];if(i1.searchResultSetFormatters){for(var i=0;i<i1.searchResultSetFormatters.length;++i){var k1=i1.searchResultSetFormatters[i];if(!(k1 instanceof e1)){k1=new c1(k1);}this.searchResultSetFormatters.push(k1);j1.push(k1.initAsync());}}if(i1.metadataFormatters){for(var j=0;j<i1.metadataFormatters.length;++j){var l1=i1.metadataFormatters[j];if(!(l1 instanceof e1)){l1=new d1(l1);}this.metadataFormatters.push(l1);j1.push(l1.initAsync());}}return c.Promise.all(j1);},loadMetadata:function(i){if(this.provider.loadMetadata){return this.provider.loadMetadata(i);}return c.Promise.resolve();},createDataSourceMap:function(j){var i1={};for(var i=0;i<j.length;++i){var j1=j[i];i1[j1.id]=j1;}return i1;},generateFactoryMethod:function(i){return function(j){j=j||{};j.sina=this;return new i(j);};},_createDataSource:function(i){i=i||{};i.sina=this;var j=new b(i);if(this.dataSourceMap[j.id]===j){throw new c.Exception('cannot create an already existing datasource: "'+j.id+'"');}this.dataSources.push(j);this.dataSourceMap[j.id]=j;return j;},getAllDataSource:function(){return this.allDataSource;},getBusinessObjectDataSources:function(){var j=[];for(var i=0;i<this.dataSources.length;++i){var i1=this.dataSources[i];if(!i1.hidden&&i1.type===this.DataSourceType.BusinessObject){j.push(i1);}}return j;},getDataSource:function(i){return this.dataSourceMap[i];},getConfigurationAsync:function(i){if(!this.provider.getConfigurationAsync){return c.Promise.resolve(this._createConfiguration({personalizedSearch:false,isPersonalizedSearchEditable:false}));}i=i||{};if(this.configurationPromise&&!i.forceReload){return this.configurationPromise;}this.configurationPromise=this.provider.getConfigurationAsync();return this.configurationPromise;},logUserEvent:function(i){if(!this.provider.logUserEvent){return;}this.provider.logUserEvent(i);},getDebugInfo:function(){var i=['Sina Provider:'+this.provider.id];if(this.provider.getDebugInfo){var j=this.provider.getDebugInfo();if(j){i.push(j);}}return i.join('\n');},parseDataSourceFromJson:function(j){var i=this.getDataSource(j.id);if(i){return i;}if(j.type!==this.DataSourceType.Category){throw new c.Exception('Datasource in URL does not exist '+j.id);}i=this._createDataSource(j);return i;},parseSimpleConditionFromJson:function(j){var i;if(c.isObject(j.value)){i=u.dateFromJson(j.value);}else{i=j.value;}var i1;if(j.userDefined){i1=true;}else{i1=false;}return this.createSimpleCondition({operator:j.operator,attribute:j.attribute,value:i,attributeLabel:j.attributeLabel,valueLabel:j.valueLabel,userDefined:i1});},parseComplexConditionFromJson:function(j){var i1=[];for(var i=0;i<j.conditions.length;++i){var j1=j.conditions[i];i1.push(this.parseConditionFromJson(j1));}var k1;if(j.userDefined){k1=true;}else{k1=false;}return this.createComplexCondition({operator:j.operator,conditions:i1,attributeLabel:j.attributeLabel,valueLabel:j.valueLabel,userDefined:k1});},parseConditionFromJson:function(j){switch(j.type){case'Simple':return this.parseSimpleConditionFromJson(j);case'Complex':return this.parseComplexConditionFromJson(j);default:throw new c.Exception('unknown condition type "'+j.type+'"');}},parseFilterFromJson:function(j){return this.createFilter({searchTerm:j.searchTerm,rootCondition:this.parseConditionFromJson(j.rootCondition),dataSource:this.parseDataSourceFromJson(j.dataSource)});}});});
