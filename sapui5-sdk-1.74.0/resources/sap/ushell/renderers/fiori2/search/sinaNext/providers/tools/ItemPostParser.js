// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sinaDefine(['../../sina/SinaObject'],function(S){"use strict";return S.derive({_init:function(p){this._searchResultSetItem=p.searchResultSetItem;this._dataSource=p.searchResultSetItem.dataSource;this._allAttributesMap=p.allAttributesMap||p.searchResultSetItem._private.allAttributesMap;this._intentsResolver=this.sina._createFioriIntentsResolver();},postParseResultSetItem:function(){var p=this.enhanceResultSetItemWithNavigationTargets();this.enhanceResultSetItemWithGroups();return p;},enhanceResultSetItemWithNavigationTargets:function(){var t=this;var s=t._dataSource._private.semanticObjectType;var a=t._searchResultSetItem._private.semanticObjectTypeAttributes;var b=t._dataSource._private.system;var c=t._dataSource._private.client;return t._intentsResolver.resolveIntents({semanticObjectType:s,semanticObjectTypeAttributes:a,systemId:b,client:c,fallbackDefaultNavigationTarget:t._searchResultSetItem.defaultNavigationTarget}).then(function(d){var e=d&&d.defaultNavigationTarget;var n=d&&d.navigationTargets;if(e){t._searchResultSetItem.defaultNavigationTarget=e;e.parent=t._searchResultSetItem;}if(n){t._searchResultSetItem.navigationTargets=n;for(var i=0;i<n.length;i++){n[i].parent=t._searchResultSetItem;}}return t._searchResultSetItem;});},enhanceResultSetItemWithGroups:function(){var a=this._searchResultSetItem.dataSource.attributesMetadata;for(var i=0;i<a.length;i++){var b=a[i];if(b.type===this.sina.AttributeType.Group){var g=this._addAttributeGroup(b);if(b.usage.Detail){this._searchResultSetItem.detailAttributes.push(g);}if(b.usage.Title){this._searchResultSetItem.titleAttributes.push(g);}if(b.usage.TitleDescription){this._searchResultSetItem.titleDescriptionAttributes.push(g);}}}this.sortAttributes();},sortAttributes:function(){var c=function(a){return function(b,d){var e=b.metadata.usage&&b.metadata.usage[a]?b.metadata.usage[a].displayOrder:undefined;var f=d.metadata.usage&&d.metadata.usage[a]?d.metadata.usage[a].displayOrder:undefined;if(e===undefined||f===undefined){if(f!==undefined){return 1;}return-1;}return e-f;};};this._searchResultSetItem.titleAttributes.sort(c("Title"));this._searchResultSetItem.titleDescriptionAttributes.sort(c("TitleDescription"));this._searchResultSetItem.detailAttributes.sort(c("Detail"));},_addAttributeGroup:function(a){var g=this.sina._createSearchResultSetItemAttributeGroup({id:a.id,metadata:a,label:a.label,template:a.template,attributes:[],groups:[]});var p,c;if(a._private){p=a._private.parentAttribute;c=a._private.childAttribute;}for(var k=0;k<a.attributes.length;k++){var b=a.attributes[k];var d=b.attribute;var e;if(d.type===this.sina.AttributeType.Group){e=this._addAttributeGroup(d,this._allAttributesMap);}else{e=this._allAttributesMap[d.id];}if(e){var f=this.sina._createSearchResultSetItemAttributeGroupMembership({group:g,attribute:e,metadata:b});g.attributes.push(f);e.groups.push(f);}if(d==p){g._private.parentAttribute=e;}else if(d==c){g._private.childAttribute=e;}}return g;}});});
