// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
(function(){"use strict";sap.ui.define(["sap/ushell/services/Container","sap/ushell/services/AppConfiguration","sap/ushell/services/Personalization","sap/ushell/services/URLParsing","sap/ushell/services/CrossApplicationNavigation","sap/ushell/services/_SmartNavigation/complements","sap/ushell/utils"],function(c,a,p,u,C,P,b){c=sap.ushell.Container;u=c.getService("URLParsing");C=c.getService("CrossApplicationNavigation");p=c.getService("Personalization");function d(o,s,e){return new S(o,s,e,P,a,p,u,C,b);}d.hasNoAdapter=true;return d;});sap.ushell.services.SmartNavigation=S;function S(c,p,s,P,a,o,u,C,b){if(!S.instance){Object.defineProperty(S,"instance",{value:Object.create(null,{getLinks:{value:function(A){var d=C.getLinks(A);if(!P.isTrackingEnabled(s,b)){return jQuery.when(d);}var e=a.getCurrentApplication(),f=e.sShellHash,g=e.componentHandle;if(e.componentHandle){g=e.componentHandle.getInstance();}if(!f){jQuery.sap.log.warning("Call to SmartNavigation#getLinks() simply delegated to CrossApplicationNavigation#getLinks()"+" because oAppConfiguration#getCurrentApplication()#sShellHash evaluates to undefined.");return d;}return jQuery.when(d,P.getNavigationOccurrences(f,o,g,u)).then(function(l,n){if(n.length===0){return l;}return P.prepareLinksForSorting(l,n,u).sort(function(L,O){return O.clickCount-L.clickCount;});});}},toExternal:{value:function(A){var _=arguments,d=P.getHashFromOArgs(A.target,u),t=function(){return C.toExternal.apply(C,_);};if(!P.isTrackingEnabled(s,b)){return jQuery.when(t());}var e=a.getCurrentApplication(),f=e.sShellHash,g=e.componentHandle;if(e.componentHandle){g=e.componentHandle.getInstance();}if(!f){jQuery.sap.log.warning("Current shell hash could not be identified. Navigation will not be tracked.",null,"sap.ushell.services.SmartNavigation");return jQuery.when(t());}if(!d){jQuery.sap.log.warning("Destination hash does not conform with the ushell guidelines. Navigation will not be tracked.",null,"sap.ushell.services.SmartNavigation");return jQuery.when(t());}return P.recordNavigationOccurrences(f,d,o,g,u).then(t);}},hrefForExternal:{value:function(){var h=C.hrefForExternal.apply(C,arguments);return h;}},getPrimaryIntent:{value:function(){var d=C.getPrimaryIntent.apply(C,arguments);return d;}},trackNavigation:{value:function(A){if(!P.isTrackingEnabled(s,b)){jQuery.sap.log.debug("Call to SmartNavigation#trackNavigation() ignored"+" because Service is not enabled via Configuration",null,"sap.ushell.services.SmartNavigation");return jQuery.when(null);}var t=A.target,d=a.getCurrentApplication(),f=d.sShellHash,D;if(!f){jQuery.sap.log.warning("Call to SmartNavigation#trackNavigation() simply ignored"+" because oAppConfiguration#getCurrentApplication()#sShellHash evaluates to undefined.");return jQuery.when(null);}D=P.getHashFromOArgs(t,u);if(!D){jQuery.sap.log.warning("Navigation not tracked - no valid destination provided",null,"sap.ushell.services.SmartNavigation");return jQuery.when(null);}jQuery.sap.log.debug("Navigation to "+D+" was tracked out of "+f,null,"sap.ushell.services.SmartNavigation");return P.recordNavigationOccurrences(f,D,o,d.componentHandle.getInstance(),u);}},constructor:{value:S}})});}return S.instance;}})();
