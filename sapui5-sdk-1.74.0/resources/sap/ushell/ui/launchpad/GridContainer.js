// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/f/dnd/GridDropInfo","sap/ui/core/dnd/DragInfo","sap/ui/core/Control","sap/ui/core/Icon","sap/m/Input","sap/m/Text","sap/ushell/resources","sap/f/GridContainer","sap/f/GridContainerSettings","sap/f/GridContainerItemLayoutData","sap/ushell/utils","sap/m/library","sap/ushell/ui/launchpad/Tile","sap/ushell/library","sap/ushell/ui/launchpad/GridContainerRenderer"],function(G,D,C,I,a,T,r,U,b,c,d,m){"use strict";var H=m.HeaderLevel;var e={RESPONSIVE:"Responsive",SMALL:"Small"};var f=C.extend("sap.ushell.ui.launchpad.GridContainer",{metadata:{library:"sap.ushell",properties:{groupId:{type:"string",group:"Misc",defaultValue:null},showHeader:{type:"boolean",group:"Misc",defaultValue:true},defaultGroup:{type:"boolean",group:"Misc",defaultValue:false},isLastGroup:{type:"boolean",group:"Misc",defaultValue:false},headerText:{type:"string",group:"Misc",defaultValue:null},headerLevel:{type:"sap.m.HeaderLevel",group:"Misc",defaultValue:H.H2},groupHeaderLevel:{type:"sap.m.HeaderLevel",group:"Misc",defaultValue:H.H4},showGroupHeader:{type:"boolean",group:"Misc",defaultValue:true},homePageGroupDisplay:{type:"string",defaultValue:null},isGroupLocked:{type:"boolean",group:"Misc",defaultValue:null},isGroupSelected:{type:"boolean",group:"Misc",defaultValue:false},editMode:{type:"boolean",group:"Misc",defaultValue:false},showBackground:{type:"boolean",group:"Misc",defaultValue:false},icon:{type:"string",group:"Misc",defaultValue:"sap-icon://locked"},showIcon:{type:"boolean",group:"Misc",defaultValue:false},enableHelp:{type:"boolean",group:"Misc",defaultValue:false},tileActionModeActive:{type:"boolean",group:"Misc",defaultValue:false},ieHtml5DnD:{type:"boolean",group:"Misc",defaultValue:false},showEmptyLinksArea:{type:"boolean",group:"Misc",defaultValue:false},showEmptyLinksAreaPlaceHolder:{type:"boolean",group:"Misc",defaultValue:false},supportLinkPersonalization:{type:"boolean",group:"Misc",defaultValue:false},tileSizeBehavior:{type:"string",group:"Misc",defaultValue:e.RESPONSIVE}},aggregations:{tiles:{type:"sap.ui.core.Control",multiple:true,singularName:"tile",forwarding:{getter:"_getInternalGrid",aggregation:"items"},dnd:true},links:{type:"sap.ui.core.Control",multiple:true,singularName:"link"},_grid:{type:"sap.f.GridContainer",multiple:false,visibility:"hidden"},beforeContent:{type:"sap.ui.core.Control",multiple:true,singularName:"beforeContent"},afterContent:{type:"sap.ui.core.Control",multiple:true,singularName:"afterContent"},footerContent:{type:"sap.ui.core.Control",multiple:true,singularName:"footerContent"},headerActions:{type:"sap.ui.core.Control",multiple:true,singularName:"headerAction"}},events:{afterRendering:{},titleChange:{},tileDragStart:{},tileDragEnter:{},tileDrop:{},layoutChange:{}},dnd:{draggable:true,droppable:true}}});f.prototype.init=function(){var u=new U({snapToRow:true,layoutChange:this.fireLayoutChange.bind(this),containerQuery:true});this.setAggregation("_grid",u);this.oNoLinksText=new T({text:r.i18n.getText("emptyLinkContainerInEditMode")}).addStyleClass("sapUshellNoLinksAreaPresentTextInner");this.oTransformationErrorText=new T({text:r.i18n.getText("transformationErrorText")}).addStyleClass("sapUshellTransformationErrorText");this.oTransformationErrorIcon=new I({src:"sap-icon://message-error"}).addStyleClass("sapUshellTransformationErrorIcon");this.oIcon=new I({src:this.getIcon()});this.oIcon.addStyleClass("sapUshellContainerIcon");this.oEditInputField=new a({placeholder:r.i18n.getText("new_group_name"),value:this.getHeaderText(),maxLength:100}).addStyleClass("sapUshellTileContainerTitleInput");this.oEditInputField.addEventDelegate({onfocusout:this.setEditMode.bind(this,false),onsapenter:this.setEditMode.bind(this,false)});this._setGridLayout();};f.prototype.exit=function(){if(this.oNoLinksText){this.oNoLinksText.destroy();}if(this.oTransformationErrorText){this.oTransformationErrorText.destroy();}if(this.oTransformationErrorIcon){this.oTransformationErrorIcon.destroy();}if(this.oIcon){this.oIcon.destroy();}if(this.oEditInputField){this.oEditInputField.destroy();}C.prototype.exit.apply(this,arguments);};f.prototype.onAfterRendering=function(){var t=window.document.getElementById(this.getId()+"-titleText");if(t){t.addEventListener("click",function(){var g=this.getModel()&&this.getModel().getProperty("/enableRenameLockedGroup"),h=(g||!this.getIsGroupLocked())&&!this.getDefaultGroup()&&this.getTileActionModeActive();this.setEditMode(h);}.bind(this));}var E=this.oEditInputField.getDomRef();if(E){setTimeout(function(){E.querySelector("input").focus();this.oEditInputField.selectText(0,this.oEditInputField.getValue().length);}.bind(this),0);}var o=sap.ui.getCore().getEventBus();o.publish("launchpad","GroupHeaderVisibility");this.fireAfterRendering();};f.prototype.getShowPlaceholder=function(){return false;};f.prototype.setGroupId=function(v){this.setProperty("groupId",v,true);return this;};f.prototype.groupHasTiles=function(){var t=this.getTiles();if(this.getBindingContext()){var p=this.getBindingContext().sPath;t=this.getModel().getProperty(p).tiles;}return d.groupHasVisibleTiles(t,[]);};f.prototype.getInnerContainersDomRefs=function(){var o=this.getDomRef();if(!o){return null;}var i=o.querySelector(".sapUshellTilesContainer-sortable"),l=o.querySelector(".sapUshellLineModeContainer");return[i,l];};f.prototype.setTileActionModeActive=function(v){if(this.getTileActionModeActive()===v){return;}this.setProperty("tileActionModeActive",v);var g=this.getAggregation("_grid");if(v){g.addDragDropConfig(new D({groupName:"GridContainer",sourceAggregation:"items",dragStart:function(){this.fireTileDragStart();}.bind(this)}));g.addDragDropConfig(new G({groupName:"GridContainer",dropLayout:sap.ui.core.dnd.DropLayout.Horizontal,dropPosition:sap.ui.core.dnd.DropPosition.Between,targetAggregation:"items",dropIndicatorSize:function(i){return this._getItemLayoutData(i);}.bind(this),drop:function(i){this.fireTileDrop(i.getParameters());}.bind(this),dragEnter:function(){this.fireTileDragEnter();}.bind(this)}));}else{g.destroyDragDropConfig();}};f.prototype.setEditMode=function(v,n){if(this.getEditMode()===v){return;}this.setProperty("editMode",v,false);this.getModel().setProperty("/editTitle",v,false);if(v){this.addStyleClass("sapUshellEditing");this.oEditInputField.setValue(n?"":this.getHeaderText());var E=sap.ui.getCore().getEventBus();E.publish("launchpad","scrollToGroup",{group:this,groupChanged:false,focus:false});}else{this.removeStyleClass("sapUshellEditing");var N=this.oEditInputField.getValue();N=N.substring(0,256).trim()||this.oEditInputField.getPlaceholder();if(N&&N!==this.getHeaderText()){this.fireTitleChange({newTitle:N});this.setHeaderText(N);}}};f.prototype.setShowEmptyLinksArea=function(v){this.setProperty("showEmptyLinksArea",v,true);this.toggleStyleClass("sapUshellLinksAreaHidden",!v);};f.prototype.setShowEmptyLinksAreaPlaceHolder=function(v){this.setProperty("showEmptyLinksArea",v,true);this.toggleStyleClass("sapUshellTileContainerEditMode",v);this.toggleStyleClass("sapUshellTileContainerTabsModeEmptyLinksArea",v);this.toggleStyleClass("sapUshellEmptyLinksAreaPlaceHolder",!v);};f.prototype.setTileSizeBehavior=function(t){this.setProperty("tileSizeBehavior",t);this._setGridLayout();};f._generateSetting=function(s,i){return new b({columns:i,rowSize:s,columnSize:s,gap:"0.5rem"});};f.prototype._setGridLayout=function(){var t=this.getProperty("tileSizeBehavior"),u=this._getInternalGrid(),l;l=t==="Small"?{oBreakpoints:{"S":4,"M":6,"L":12,"XL":16},sSize:"4.375rem"}:{oBreakpoints:{"S":4,"M":6,"L":10,"XL":14},sSize:"5.25rem"};u.setLayout(new b({rowSize:l.sSize,columnSize:l.sSize,gap:"0.5rem"}));u.setLayoutXS(f._generateSetting("4.375rem",4));u.setLayoutS(f._generateSetting(l.sSize,l.oBreakpoints.S));u.setLayoutM(f._generateSetting(l.sSize,l.oBreakpoints.M));u.setLayoutL(f._generateSetting(l.sSize,l.oBreakpoints.L));u.setLayoutXL(f._generateSetting(l.sSize,l.oBreakpoints.XL));return this;};f.prototype._getInternalGrid=function(){return this.getAggregation("_grid");};f.prototype.addAggregation=function(A,o){C.prototype.addAggregation.apply(this,arguments);if(A==="tiles"){this._addItemLayoutData(o);}return this;};f.prototype.insertAggregation=function(A,o,i){C.prototype.insertAggregation.apply(this,arguments);if(A==="tiles"){this._addItemLayoutData(o);}return this;};f.prototype._getItemLayoutData=function(i){var l={rows:2,columns:2};if(i.isA("sap.ushell.ui.launchpad.Tile")){l={rows:2,columns:{path:"long",formatter:f._getItemLayoutColumn}};}else if(i.isA("sap.m.GenericTile")){l={rows:2,columns:2};}else if(i.isA("sap.ui.integration.widgets.Card")){var o=i.getManifest(),s=d.getMember(o,"sap|flp.rows")||3,g=d.getMember(o,"sap|flp.columns")||3;l={rows:parseInt(s,10),columns:parseInt(g,10)};}return l;};f.prototype._addItemLayoutData=function(i){var l=this._getItemLayoutData(i),o=new c(l);i.setLayoutData(o);};f._getItemLayoutColumn=function(l){return l?4:2;};f.prototype.getMaximumItemNumber=function(){return this._getInternalGrid().getActiveLayoutSettings().getColumns()/2;};f.prototype.getActiveGapSize=function(){return this._getInternalGrid().getActiveLayoutSettings().getGapInPx();};return f;});
