// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Control","sap/ushell/ui/launchpad/TileContainerUtils","sap/ui/thirdparty/jquery","sap/ui/performance/Measurement","sap/base/Log","sap/ui/base/ManagedObject"],function(C,T,q,M,L,a){"use strict";var b=C.extend("sap.ushell.ui.launchpad.CatalogsContainer",{metadata:{properties:{categoryFilter:{type:"string",defaultValue:"ALL"},categoryAllocateTiles:{type:"int",defaultValue:"0"}},aggregations:{catalogs:{type:"sap.ushell.ui.launchpad.CatalogEntryContainer",multiple:true}}},renderer:{render:function(r,c){var d=c.getCatalogs();if(d.length){c.setBusy(false);}r.write("<div");r.addClass("sapUshellCatalogsContainer");r.writeClasses();r.writeControlData(c);r.write(">");q.each(d,function(){r.renderControl(this);});r.write("</div>");}}});b.prototype.setPagingManager=function(p){M.start("FLP:DashboardManager.CatalogsRendering","CatalogsRendering","FLP");M.pause("FLP:DashboardManager.CatalogsRendering");this.oPagingManager=p;};b.prototype.updateAllocatedUnits=function(n){this.nAllocatedUnits=n;};b.prototype.applyPagingCategoryFilters=function(n,c){var i=this.getCatalogs();this.nAllocatedUnits=n;if(c&&c!="All"&&c!=""){this.sCatalogTerm=c;}else{this.sCatalogTerm="";}if(!this.filters){this.filters={};}if(!this.filters.catalogEntry){this.filters.catalogEntry=function(e){var p=e.getPath(),I=e.getProperty("title")===this.sCatalogTerm,d;if(!this.sCatalogTerm){return;}d=this.indexingMaps.onScreenPathIndexMap[p];if(d){d.isVisible=I;}}.bind(this);}if(!this.filters.pagination){this.filters.pagination=function(e){var p=e.getPath(),d;d=this.indexingMaps.onScreenPathIndexMap[p];if(!this.nAllocatedUnits){d.isVisible=false;}}.bind(this);}if(!this.indexingMaps){return;}this.indexingMaps=T.indexOnScreenElements(i);T.applyFilterOnAllItems(this.mBindingInfos.catalogs,this.filters,this.processFiltering.bind(this));if(this.indexingMaps){T.showHideTilesAndHeaders(this.indexingMaps,this.getCatalogs());}};b.prototype.processFiltering=function(e){var c=this.getCatalogs(),p=e.getPath(),i=this.indexingMaps.onScreenPathIndexMap[p],o=c[i.aItemsRefrenceIndex],d;if(i.isVisible&&(!this.catalogPagination[p]||this.catalogPagination[p]=="start")){if(this.catalogPagination[p]==undefined){this.catalogPagination[p]="start";o.catalogState={};}else if(this.catalogPagination[p]=="start"){var n=o.nNumberOfVisibileElements;this.nAllocatedUnits+=(n.appBoxesContainer+n.customTilesContainer);}d=this.nAllocatedUnits;o.handleElements("appBoxesContainer");o.handleElements("customTilesContainer");if(o.catalogState.appBoxesContainer=="full"&&o.catalogState.customTilesContainer=="full"){this.catalogPagination[p]="full";}if(d-this.nAllocatedUnits>0){this.bSearchResults=true;}else{i.isVisible=false;}}else if(i.isVisible&&this.catalogPagination[p]=="full"){var f=o.nNumberOfVisibileElements;var g=f.appBoxesContainer+f.customTilesContainer;if(g==0){i.isVisible=false;}}};b.prototype.resetCatalogPagination=function(){this.catalogPagination={};};b.prototype.updateAggregation=function(r){L.debug("Updating TileContainer. Reason: ",r);try{M.resume("FLP:DashboardManager.CatalogsRendering");this.filterElements();M.pause("FLP:DashboardManager.CatalogsRendering");}catch(e){a.prototype.updateAggregation.apply(this,arguments);}};b.prototype.addNewItem=function(e,n){var N,c,i,p=e.getPath();N=T.createNewItem.bind(this)(e,n);if(!N.filters){N.filters={};N.filters.appBoxesContainer={};N.filters.customTilesContainer={};N.filters.appBoxesContainer.pagination=function(d){var p=d.getPath(),f;f=this.indexingMaps.appBoxesContainer.onScreenPathIndexMap[p];if(this.getAllocatedUnits){f.isVisible=!!this.getAllocatedUnits();}}.bind(N);N.filters.customTilesContainer.pagination=function(d){var p=d.getPath(),f;f=this.indexingMaps.customTilesContainer.onScreenPathIndexMap[p];if(this.getAllocatedUnits){f.isVisible=!!this.getAllocatedUnits();}}.bind(N);}N.nAllocatedUnits=this.nAllocatedUnits;N.getAllocatedUnits=function(){return this.nAllocatedUnits;}.bind(this);N.elementFiltered=function(d){c=this.oPagingManager.getSizeofSupportedElementInUnits("tile");this.nAllocatedUnits+=d*c;if(this.nAllocatedUnits<=0){this.nAllocatedUnits=0;}}.bind(this);N.elementsVisible=function(d){c=this.oPagingManager.getSizeofSupportedElementInUnits("tile");this.nAllocatedUnits-=d*c;if(this.nAllocatedUnits<=0){this.nAllocatedUnits=0;}}.bind(this);N.newElementCreated=function(E,o){this.nAllocatedUnits-=this.oPagingManager.getSizeofSupportedElementInUnits("tile");if(this.nAllocatedUnits<=0){this.nAllocatedUnits=0;}}.bind(this);N.currElementVisible=function(){this.nAllocatedUnits-=this.oPagingManager.getSizeofSupportedElementInUnits("tile");if(this.nAllocatedUnits<=0){this.nAllocatedUnits=0;}}.bind(this);T.addNewItem.bind(this)(N,n);i=this.getCatalogs();this.indexingMaps.onScreenPathIndexMap[p]={aItemsRefrenceIndex:i.length-1,isVisible:true};return true;};b.prototype.handleFilters=function(){if(!this.catalogPagination){this.catalogPagination={};}if(!this.catalogsElementsMap){this.catalogsElementsMap={};}if(!this.filters){this.filters={};}};b.prototype.setHandleSearchCallback=function(h){this.handleSearchCallback=h;};b.prototype.filterElements=function(){var n="catalogs",B=this.mBindingInfos[n].binding,c=B.getContexts(),i=this.getCatalogs(),d;if(!this.indexingMaps){this.indexingMaps=T.indexOnScreenElements(i);}this.handleFilters();d=T.markVisibleOnScreenElements(c,this.indexingMaps,false);if(!T.validateOrder(c,i,d)){throw true;}T.createMissingElementsInOnScreenElements(this.indexingMaps,c,d,this.addNewItem.bind(this),i,this.filters,n);i=this.getCatalogs();T.showHideTilesAndHeaders(this.indexingMaps,i);if(this.handleSearchCallback){this.handleSearchCallback();}};return b;});
