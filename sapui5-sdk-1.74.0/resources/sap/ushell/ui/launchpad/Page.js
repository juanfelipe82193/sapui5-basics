// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/Button","sap/m/library","sap/m/Text","sap/ui/core/Control","sap/ui/core/dnd/DragDropInfo","sap/ui/core/library","sap/ushell/resources","sap/ushell/ui/launchpad/PageRenderer"],function(B,l,T,C,D,c,r){"use strict";var a=l.ButtonType;var b=c.TextAlign;var P=C.extend("sap.ushell.ui.launchpad.Page",{metadata:{library:"sap.ushell",properties:{edit:{type:"boolean",group:"Misc",defaultValue:false},enableSectionReordering:{type:"boolean",group:"Misc",defaultValue:false},noSectionsText:{type:"string",group:"Misc",defaultValue:""},showTitle:{type:"boolean",group:"Misc",defaultValue:false},showNoSectionsText:{type:"boolean",group:"Misc",defaultValue:true},title:{type:"string",group:"Misc",defaultValue:""}},defaultAggregation:"sections",aggregations:{"sections":{type:"sap.ushell.ui.launchpad.Section",multiple:true,dnd:true},"_addSectionButtons":{type:"sap.m.Button",multiple:true,visibility:"hidden"},"_noSectionText":{type:"sap.m.Text",multiple:false,visibility:"hidden"}},events:{addSectionButtonPressed:{parameters:{index:{type:"int"}}},sectionDrop:{parameters:{draggedControl:{type:"sap.ushell.ui.launchpad.Section"},droppedControl:{type:"sap.ushell.ui.launchpad.Section"},dropPosition:{type:"string"}}}}}});P.prototype.init=function(){this.setAggregation("_noSectionText",new T({text:r.i18n.getText("Page.NoSectionText"),width:"100%",textAlign:b.Center}));this._oDragDropInfo=new D({sourceAggregation:"sections",targetAggregation:"sections",dropPosition:"Between",drop:function(i){this.fireSectionDrop(i.getParameters());}.bind(this)});this.addEventDelegate({onsappageup:this._handleKeyboardPageNavigation.bind(this),onsappagedown:this._handleKeyboardPageNavigation.bind(this),onsapdown:this._handleKeyboardArrowNavigation.bind(this,false),onsapdownmodifiers:this._handleKeyboardArrowNavigation.bind(this,true),onsapup:this._handleKeyboardArrowNavigation.bind(this,false),onsapupmodifiers:this._handleKeyboardArrowNavigation.bind(this,true),onsaphome:this._handleKeyboardHomeEndNavigation.bind(this,false),onsaphomemodifiers:this._handleKeyboardHomeEndNavigation.bind(this,false),onsapend:this._handleKeyboardHomeEndNavigation.bind(this,true),onsapendmodifiers:this._handleKeyboardHomeEndNavigation.bind(this,true)});};P.prototype.exit=function(){this._oDragDropInfo.destroy();};P.prototype.onBeforeRendering=function(){var n=this.getSections().length,A=this.getAggregation("_addSectionButtons")||[],o;for(var i=A.length;i<n+1;i++){o=new B({type:a.Transparent,icon:"sap-icon://add",text:r.i18n.getText("Page.Button.AddSection"),press:this.fireAddSectionButtonPressed.bind(this,{index:i})});o.addStyleClass("sapUshellPageAddSectionButton");this.addAggregation("_addSectionButtons",o);}};P.prototype.setEnableSectionReordering=function(v){this.setProperty("enableSectionReordering",!!v);if(v){this.addDragDropConfig(this._oDragDropInfo);}else{this.removeDragDropConfig(this._oDragDropInfo);}return this;};P.prototype.setNoSectionsText=function(t){this.setProperty("noSectionsText",t);var n=this.getAggregation("_noSectionText");n.setText(t||r.i18n.getText("Page.NoSectionText"));return this;};P.prototype._focusOrMovetoNextVisualization=function(i){var s=this.getSections(),S=this.indexOfSection(i.section),v=i.prefIndex,d=i.direction;while(true){if(d==="down"&&S<s.length-1){S++;}else if(d==="up"&&S>0){S--;}else{return;}var o=s[S],V=o.getVisualizations();if((i.visualization||V.length)&&(o.getShowSection()||o.getEdit())){if(i.prefIndex===undefined){v=d==="down"?0:Math.max(V.length-1,0);}if(i.visualization){o.fireVisualizationDrop({draggedControl:i.visualization,droppedControl:V.length?V[v]:o,dropPosition:d==="down"?"Before":"After"});if(d==="up"){v=V.length;}}i.event.preventDefault();break;}}window.setTimeout(function(){var e=this.getSections()[S].getVisualizations()[v],I=e.getInnerControl().getContent?e.getInnerControl().getContent()[0]:e.getInnerControl();I.focus();}.bind(this),0);};P.prototype._handleKeyboardPageNavigation=function(e){var s=this.getSections();for(var i=0;i<s.length;i++){var S=this.getEdit()?this.getDomRef().getElementsByClassName("sapUshellPageSection")[i]:s[i].getDomRef();if(S.contains(window.document.activeElement)){this._focusOrMovetoNextVisualization({event:e,section:s[i],direction:e.type==="sappagedown"?"down":"up",prefIndex:0});return;}}};P.prototype._handleKeyboardArrowNavigation=function(m,e){if((m&&!this.getEnableSectionReordering())||(m&&!e.ctrlKey)){return;}var s=this.getDomRef().getElementsByClassName("sapUshellPageSection");for(var i=0;i<s.length;i++){if(window.document.activeElement===s[i]){if(e.type==="sapup"&&i>0){s[i-1].focus();}else if(e.type==="sapdown"&&(i+1)<s.length){s[i+1].focus();}else if(e.type==="sapupmodifiers"&&i>0){this.fireSectionDrop({draggedControl:this.getSections()[i],droppedControl:this.getSections()[i-1],dropPosition:"Before"});e.preventDefault();s[i-1].focus();}else if(e.type==="sapdownmodifiers"&&(i+1)<s.length){this.fireSectionDrop({draggedControl:this.getSections()[i],droppedControl:this.getSections()[i+1],dropPosition:"After"});e.preventDefault();s[i+1].focus();}return;}}};P.prototype._handleKeyboardHomeEndNavigation=function(L,e){var s=this.getSections(),v=[],S=this.getDomRef().getElementsByClassName("sapUshellPageSection"),E=this.getEdit(),o;for(var i=0;i<s.length;i++){if(e.type==="saphomemodifiers"||e.type==="sapendmodifiers"){o=s[i];if(o.getShowSection()||o.getEdit()){v=v.concat(o.getVisualizations());}}else if(E&&S[i].contains(window.document.activeElement)){v=s[i].getVisualizations();break;}}if(v.length){var V=L?v[v.length-1]:v[0],I=V.getInnerControl().getContent?V.getInnerControl().getContent()[0]:V.getInnerControl();e.preventDefault();I.focus();}};P.prototype._handleSectionBorderReached=function(i){this._focusOrMovetoNextVisualization(i.getParameters());};P.prototype.addAggregation=function(A,o){C.prototype.addAggregation.apply(this,arguments);if(A==="sections"){o.attachEvent("borderReached",this._handleSectionBorderReached.bind(this));}return this;};P.prototype.insertAggregation=function(A,o){C.prototype.insertAggregation.apply(this,arguments);if(A==="sections"){o.attachEvent("borderReached",this._handleSectionBorderReached.bind(this));}return this;};return P;});
