/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["../threejs/thirdparty/three","./Tool","./AnchorPointToolHandler","./AnchorPointToolGizmo","./AnchorPointToolOperation"],function(t,T,A,a,b){"use strict";var c=T.extend("sap.ui.vk.tools.AnchorPointTool",{metadata:{properties:{enableStepping:{type:"boolean",defaultValue:false},showEditingUI:{type:"boolean",defaultValue:false},allowOperation:{type:"sap.ui.vk.tools.AnchorPointToolOperation",defaultValue:b.All},allowContextMenu:{type:"boolean",defaultValue:true},position:{type:"any",defaultValue:null},quaternion:{type:"any",defaultValue:null}},events:{moving:{parameters:{x:"float",y:"float",z:"float"}},moved:{parameters:{x:"float",y:"float",z:"float"}},rotating:{parameters:{x:"float",y:"float",z:"float"}},rotated:{parameters:{x:"float",y:"float",z:"float"}}}},constructor:function(i,s){T.apply(this,arguments);this._viewport=null;this._handler=new A(this);this._gizmo=null;}});c.prototype.init=function(){if(T.prototype.init){T.prototype.init.call(this);}this.setFootprint(["sap.ui.vk.threejs.Viewport"]);var g=new a();this.setAggregation("gizmo",g);this.setProperty("position",g._gizmo.position);this.setProperty("quaternion",g._gizmo.quaternion);};c.prototype.setViewport=function(v){if(this._viewport!==v){this._deactivateScreenAlignment();}T.prototype.setViewport.call(this,v);if(v){this.getGizmo()._initAnchorPoint(v);}};c.prototype.setActive=function(v,d,g){T.prototype.setActive.call(this,v,d,g);if(this._viewport){if(v){this._gizmo=this.getGizmo();this._gizmo.show(this._viewport,this);this._addLocoHandler();}else{this._removeLocoHandler();if(this._gizmo){this._gizmo.hide();this._gizmo=null;}}}return this;};c.prototype.queueCommand=function(d){if(this._addLocoHandler()){if(this.isViewportType("sap.ui.vk.threejs.Viewport")){d();}}return this;};c.prototype.setShowEditingUI=function(v){this.setProperty("showEditingUI",v,true);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};c.prototype.setAllowOperation=function(v){this.setProperty("allowOperation",v,true);if(this._gizmo){this._gizmo._updateHandlesVisibility();}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};c.prototype.move=function(x,y,z){if(this._gizmo){this._gizmo.move(x,y,z);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};c.prototype.rotate=function(x,y,z){if(this._gizmo){this._gizmo.rotate(x,y,z);}if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};c.prototype.moveTo=function(d,u){var n=Array.isArray(d)?d:[d];var p=new THREE.Vector3();if(u){var e=0;var f=new THREE.Vector3();n.forEach(function(h){p.add(f.setFromMatrixPosition(h.matrixWorld));e++;});p.multiplyScalar(1/e);}else{var g=new THREE.Box3();n.forEach(function(h){g.expandByObject(h);});g.getCenter(p);}this.getGizmo().setPosition(p);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};c.prototype.alignTo=function(n){this._deactivateScreenAlignment();var q=new THREE.Quaternion();if(n){n.matrixWorld.decompose(new THREE.Vector3(),q,new THREE.Vector3());}this.getGizmo().setQuaternion(q);if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};c.prototype.alignToWorld=function(){this._deactivateScreenAlignment();this.getGizmo().setQuaternion(new THREE.Quaternion());if(this._viewport){this._viewport.setShouldRenderFrame();}return this;};c.prototype.alignToScreen=function(){if(this._viewport){this._activateScreenAlignment();this.alignToScreenCallback();this._viewport.setShouldRenderFrame();}return this;};c.prototype._activateScreenAlignment=function(){if(!this.alignToScreenCallback){this.alignToScreenCallback=function(){var d=this._viewport.getCamera().getCameraRef();this.getGizmo().setQuaternion(d.quaternion);}.bind(this);this._viewport.attachCameraChanged(this.alignToScreenCallback);}};c.prototype._deactivateScreenAlignment=function(){if(this.alignToScreenCallback&&this._viewport){this._viewport.detachCameraChanged(this.alignToScreenCallback);this.alignToScreenCallback=null;}};c.prototype.setPosition=function(){throw new Error("The AnchorPointTool position is read-only");};c.prototype.setQuaternion=function(){throw new Error("The AnchorPointTool quaternion is read-only");};return c;});
