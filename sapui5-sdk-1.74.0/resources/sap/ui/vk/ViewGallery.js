/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/Control","./library","./Core","./ContentConnector","sap/m/Slider","./ViewGalleryRenderer","./getResourceBundle","./ViewGalleryThumbnail","sap/m/HBox","sap/m/VBox","sap/m/FormattedText","sap/m/FlexItemData","sap/m/Image","sap/m/ScrollContainer","sap/m/Button","sap/m/ToggleButton","sap/m/Toolbar","sap/m/Popover","sap/m/Title","sap/m/SelectList","sap/m/ToolbarSpacer","sap/ui/model/json/JSONModel","sap/ui/core/dnd/DropInfo","sap/ui/core/dnd/DragInfo"],function(C,v,a,b,A,V,g,c,H,d,F,e,I,S,B,T,f,P,h,l,m,J,D,o){"use strict";var p=C.extend("sap.ui.vk.ViewGallery",{metadata:{library:"sap.ui.vk",properties:{showAnimationTimeSlider:{type:"boolean",defaultValue:true},showToolbar:{type:"boolean",defaultValue:true},showThumbnailContainer:{type:"boolean",defaultValue:true},selectedViewIndex:{type:"int",defaultValue:-1},selectedViewGroupIndex:{type:"int",defaultValue:-1},enableViewReordering:{type:"boolean",defaultValue:false},transparency:{type:"float",defaultValue:1}},associations:{host:{type:"sap.ui.core.Control"},contentConnector:{type:"sap.ui.vk.ContentConnector"},viewManager:{type:"sap.ui.vk.ViewManager"}},aggregations:{toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"},container:{type:"sap.m.ScrollContainer",multiple:false,visibility:"hidden"},animationTimeSlider:{type:"sap.m.Slider",multiple:false,visibility:"hidden"}},events:{selectionChange:{parameters:{item:"sap.ui.core.Control"}},viewOrderChange:{parameters:{view:"sap.ui.vk.View",viewIndex:"int"}}}}});p.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}var t=this;window.addEventListener("resize",function(){t.resizeToolbarSpacer();},true);this._scene=null;this._vkScene=null;this._viewItems=[];this._cdsLoader=null;this._selectedGroupIndex=-1;this._previousOrientationVertical=false;this._playingAnimation=true;this._draggedModelView={};this._animationPlayer=null;this._manualTimeChange=false;sap.ui.core.IconPool.addIcon("landscape-text","vk-icons","vk-icons","e019");sap.ui.core.IconPool.addIcon("portrait-text","vk-icons","vk-icons","e01a");this.oModel=new J();if(this.getShowThumbnailContainer()){this.createThumbnailContainer();}if(this.getShowToolbar()){this.createToolbar();}if(this.getShowAnimationTimeSlider()){this.setAggregation("animationTimeSlider",new A());this._attachAnimationTimeSlider(this.getAnimationTimeSlider());}a.getEventBus().subscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);a.getEventBus().subscribe("sap.ui.vk","procedureFinished",this._onProcedureFinished,this);};p.prototype.exit=function(){a.getEventBus().unsubscribe("sap.ui.vk","viewActivated",this._onViewActivated,this);a.getEventBus().unsubscribe("sap.ui.vk","procedureFinished",this._onProcedureFinished,this);};p.prototype._getViewManager=function(){var i=this.getViewManager();if(i){return sap.ui.getCore().byId(i);}return undefined;};p.prototype._getSelectedViewGroup=function(){var i=this.getSelectedViewGroupIndex();var r;if(this._vkScene){var j=this._vkScene.getViewGroups();if(i>=0&&i<j.length){r=j[i];}}return r;};p.prototype._getSelectedView=function(){var r;var i=this.getSelectedViewIndex();var j=this._getViews();if(j&&i>=0&&i<j.length){r=j[i];}return r;};p.prototype._getViewGroups=function(){var r;if(this._vkScene){r=this._vkScene.getViewGroups();}return r;};p.prototype._getViews=function(){var i=this._getSelectedViewGroup();var j;if(i){j=i.getViews();}else if(this._vkScene){j=this._vkScene.getViews();}return j;};p.prototype._getViewIndex=function(i){var r=-1;var j=this._getViews();if(Array.isArray(j)){r=j.indexOf(i);}return r;};p.prototype._getViewAnimationDuration=function(i){i=i||this._getSelectedView();var r;if(i){var j=i.getPlaybacks();if(Array.isArray(j)&&j.length){r=j.reduce(function(k,n){return k+n.getDuration();},0);}}return r;};p.prototype.setVisible=function(i){if(C.prototype.setVisible){C.prototype.setVisible.call(this,i);}this.setDescription();};p.prototype.resizeToolbarSpacer=function(){if(this.getDomRef()){var i=this._nextItemButton.getDomRef().getBoundingClientRect().width;i+=this._playButton.getDomRef().getBoundingClientRect().width;i+=this._previousItemButton.getDomRef().getBoundingClientRect().width;var t=this.toolbar.getDomRef().getBoundingClientRect().width;var w=(i/t)*100;var j=50-w;this._toolbarSpacer.setWidth(j+"%");}};p.prototype.onAfterRendering=function(){this.resizeToolbarSpacer();if(document.getElementById("body")){var i=window.getComputedStyle(document.getElementById("body"));var j=i.getPropertyValue("background-color");var t;var k=this.getDomRef();if(j){if(j.indexOf("a")===-1){t=j.replace("rgb","rgba").replace(")",", "+this.getTransparency()+")");k.style.backgroundColor=t;}else{var r=new RegExp("([^,]*)$");t=j.replace(r," "+this.getTransparency()+")");k.style.backgroundColor=t;}}if(this.toolbar){var n=this.toolbar.getDomRef();n.style.backgroundColor="rgba(0, 0, 0, 0)";}}var s=null;if(this.getHost()){s=sap.ui.getCore().byId(this.getHost());if(s.getContent().includes(this)){this.adjustStepDescriptionBoxes();}}};p.prototype.setShowAnimationTimeSlider=function(i){this.setProperty("showAnimationTimeSlider",i);if(i){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setAggregation("animationTimeSlider",new A());this._attachAnimationTimeSlider(this.getAnimationTimeSlider());}else{this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.destroyAggregation("animationTimeSlider");}this._setupAnimationSlider();};p.prototype.getAnimationTimeSlider=function(){return this.getAggregation("animationTimeSlider");};p.prototype.destroyToolbar=function(){this.destroyAggregation("toolbar");};p.prototype.destroyThumbnailContainer=function(){this.destroyAggregation("container");};p.prototype.createThumbnailContainer=function(){var t=this;this._hbox=new H();if(this.getEnableViewReordering()){this._hbox.addDragDropConfig(new D({dropEffect:sap.ui.core.dnd.DropEffect.Move,dropPosition:sap.ui.core.dnd.DropPosition.On,targetAggregation:"items",drop:function(E){var i=E.getParameter("droppedControl");t.reorderViews(i);t.fireViewOrderChange({view:t._draggedModelView,viewIndex:t._viewItems.indexOf(i)});}}));this._hbox.getMetadata().getAggregation().dnd.droppable=true;}this._scrollContainer=new S(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false,focusable:true,content:[this._hbox]});this._scrollContainer.addStyleClass("sapVizKitViewGalleryScrollContainer");this.setAggregation("container",this._scrollContainer);};p.prototype.reorderViews=function(i){var j=this._modelViews.indexOf(this._draggedModelView);this._modelViews.splice(j,1);var k=this._viewItems.indexOf(i);this._modelViews.splice(k,0,this._draggedModelView);this._refreshItems();};p.prototype.createToolbar=function(){var t=this;this.toolbar=new f({design:sap.m.ToolbarDesign.Auto});this.setAggregation("toolbar",this.toolbar);this._previousItemButton=new B(this.getId()+"-previousItemButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://close-command-field",tooltip:g().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),press:function(j){var i=t.getSelectedViewIndex();if(i>0){t.setSelectedItem(t._viewItems[i-1]);}}});this._nextItemButton=new B(this.getId()+"-nextItemButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://open-command-field",tooltip:g().getText("STEP_NAV_NEXTSTEPBUTTON"),press:function(j){var i=t.getSelectedViewIndex();if(i>=0&&i+1<t._viewItems.length){t.setSelectedItem(t._viewItems[i+1]);}}});this._viewGroupSelector=new P({showHeader:false,contentWidth:"20%",placement:sap.m.PlacementType.Top,horizontalScrolling:false,verticalScrolling:false,content:[new S({horizontal:false,vertical:true,content:[this._procedureList=new l({width:"100%",itemPress:function(i){t._clearUI();var j=this.indexOfItem(i.getParameter("item"));t.setSelectedViewGroupIndex(j);}})]})]});this._playButton=new T(this.getId()+"-playButton",{type:sap.m.ButtonType.Transparent,pressed:false,icon:"sap-icon://media-play",visible:true,tooltip:g().getText("STEP_NAV_PLAYMENU_PLAY"),press:function(E){this._setPlayState(E.getSource().getPressed());if(E.getSource().getPressed()){this._playProcedure();}else{this._pauseAnimation();}}.bind(this)});this._stepCount=new h({textAlign:sap.ui.core.TextAlign.Right,level:"H5",titleStyle:"H5"});this._currentGroupTitle=new h({text:g().getText("STEP_NAV_PROCEDURES"),tooltip:g().getText("STEP_NAV_PROCEDURES"),level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitViewGalleryCurrentGroupTitle");this._separatorTitle=new h({width:(5/1920)*100+"%",level:"H5",titleStyle:"H5"});this._currentStepTitle=new h({level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitViewGalleryCurrentStepTitle");this._currentGroupTitle.addEventDelegate({ontap:function(){this._viewGroupSelector.openBy(this._currentGroupTitle);}.bind(this)});this._toolbarSpacer=new m();this.toolbar.addContent(this._currentGroupTitle).addContent(this._separatorTitle).addContent(this._currentStepTitle).addContent(new m()).addContent(this._stepCount).addContent(this._toolbarSpacer).addContent(this._previousItemButton).addContent(this._playButton).addContent(this._nextItemButton);};p.prototype._setPlayState=function(i){if(this.getAggregation("toolbar")){this._playButton.setPressed(i);if(i){this._playButton.setIcon("sap-icon://media-pause");this._playButton.setTooltip(g().getText("STEP_NAV_PLAYMENU_PAUSE"));}else{this._playButton.setIcon("sap-icon://media-play");this._playButton.setTooltip(g().getText("STEP_NAV_PLAYMENU_PLAY"));}}};p.prototype._createStepDescriptionBoxes=function(){this._stepDescription=new d({renderType:sap.m.FlexRendertype.Bare,fitContainer:false,alignContent:sap.m.FlexAlignContent.Start,alignItems:sap.m.FlexAlignItems.Start,justifyContent:sap.m.FlexJustifyContent.End,items:[this._stepDescriptionToolbar=new f({design:sap.m.ToolbarDesign.Solid,content:[this._stepDescriptionIcon=new sap.ui.core.Icon({src:"sap-icon://navigation-up-arrow",press:function(i){this._toggleViewDescription();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionIcon sapVizKitViewGalleryStepDescriptionIconTransform"),new m(),this._stepDescriptionOrientationIcon=new sap.ui.core.Icon({src:"sap-icon://vk-icons/landscape-text",press:function(i){this._toggleOrientation();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionOrientationIcon")],layoutData:new e({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionToolbar"),this._stepDescriptionScroll=new S({horizontal:false,vertical:true,content:[this._stepDescriptionText=new F({visible:true}).addStyleClass("sapVizKitViewGalleryStepDescriptionText")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionScroll")]}).addStyleClass("sapVizKitViewGalleryStepDescription");this._stepDescription.vitId="VIT-StepDescription";this._stepDescriptionVertical=new H({renderType:sap.m.FlexRendertype.Bare,fitContainer:false,alignContent:sap.m.FlexAlignContent.Start,alignItems:sap.m.FlexAlignItems.Start,justifyContent:sap.m.FlexJustifyContent.End,items:[this._stepDescriptionVerticalScroll=new S({horizontal:false,vertical:true,content:[this._stepDescriptionVerticalText=new F({visible:false}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalText")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalScroll"),this._stepDescriptionVerticalToolbar=new f({design:sap.m.ToolbarDesign.Solid,content:[this._stepDescriptionVerticalIcon=new sap.ui.core.Icon({src:"sap-icon://navigation-right-arrow",press:function(i){this._toggleViewDescriptionVertical();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalIcon sapVizKitViewGalleryStepDescriptionIconTransform"),this._stepDescriptionVerticalOrientationIcon=new sap.ui.core.Icon({src:"sap-icon://vk-icons/portrait-text",press:function(i){this._toggleOrientation();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalOrientationIcon")],layoutData:new e({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalToolbar")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVertical");this._stepDescriptionVertical.vitId="VIT-StepDescriptionVertical";};p.prototype.adjustStepDescriptionBoxes=function(){if(this._stepDescription.getDomRef()){var i=this.getDomRef().getBoundingClientRect().height;var s=this._stepDescription.getDomRef().id;var j=this._stepDescriptionVertical.getDomRef().id;document.getElementById(s).style.bottom=i+"px";document.getElementById(j).style.bottom=i+"px";var k=sap.ui.getCore().byId(this.getHost());var n=k.getDomRef().getBoundingClientRect().height;document.getElementById(j).style.height=n-i+"px";}};p.prototype._toggleOrientation=function(){if(this._stepDescriptionToolbar.getVisible()){this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true;if(this._stepDescriptionText.getVisible()){this._stepDescriptionVerticalText.setVisible(true);}this._stepDescriptionText.setVisible(false);}else{this._stepDescriptionToolbar.setVisible(true);this._previousOrientationVertical=false;if(this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionText.setVisible(true);}this._stepDescriptionVerticalToolbar.setVisible(false);this._stepDescriptionVerticalText.setVisible(false);}this._stepDescription.rerender();this._stepDescriptionVertical.rerender();var i=null;if(this.getHost()){i=sap.ui.getCore().byId(this.getHost());if(i.getContent().includes(this)){this.adjustStepDescriptionBoxes();}}};p.prototype._toggleViewDescription=function(){if(!this._stepDescriptionText.getVisible()){this._stepDescriptionText.setVisible(true);this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}else{this._stepDescriptionText.setVisible(false);this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}this._stepDescriptionText.rerender();};p.prototype._toggleViewDescriptionVertical=function(){if(!this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionVerticalText.setVisible(true);this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}else{this._stepDescriptionVerticalText.setVisible(false);this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}this._stepDescriptionVerticalText.rerender();};p.prototype._getHBox=function(){return this._hbox;};p.prototype._playProcedure=function(){this._manualTimeChange=false;var i=this._getViewManager();if(i){var s=this._getSelectedView();if(!s){var j=this._getViews();if(j&&j.length){s=j[0];}}if(s){i.playViewGroup(s,this._getSelectedViewGroup());}}};p.prototype._pauseAnimation=function(){var i=this._getViewManager();if(i){i.stopPlayingViewGroup();}};p.prototype.setPlayingAnimation=function(i){this._playingAnimation=i;};p.prototype.setAnimationPlayer=function(i){if(this._animationPlayer){this._animationPlayer.detachTimeChanged(this._onAnimationPlayerTimeChanged,this);this._animationPlayer.detachStateChanged(this._onAnimationPlayerStateChanged,this);}this._animationPlayer=i;if(this._animationPlayer){this._animationPlayer.attachTimeChanged(this._onAnimationPlayerTimeChanged,this);this._animationPlayer.attachStateChanged(this._onAnimationPlayerStateChanged,this);}this._setupAnimationSlider();};p.prototype._setupAnimationSlider=function(){var i=this.getAnimationTimeSlider();if(i&&this._animationPlayer){var j=this._getViewAnimationDuration();if(j){i.setMax(j);i.setStep(j/100);i.setValue(this._animationPlayer.getTime());}}};p.prototype._onAnimationPlayerTimeChanged=function(i){var t=i.getParameter("time");var j=this.getAnimationTimeSlider();if(j){j.setValue(t);}};p.prototype._onAnimationPlayerStateChanged=function(i){var j=i.getParameter("playing");this._setPlayState(j);};p.prototype._onProcedureFinished=function(i){this._setPlayState(false);};p.prototype.setScene=function(s){if(s&&s.getSceneRef()===this._scene){return;}if(s&&s.loaders){for(var i=0;i<s.loaders.length;i++){var j=s.loaders[i];if(j&&j.getMetadata&&j.getMetadata().getName()==="sap.ui.vk.threejs.ContentDeliveryService"){this._cdsLoader=j;this._cdsLoader.detachLoadingFinished(this._handleCdsViewGroupUpdate,this);this._cdsLoader.attachLoadingFinished(this._handleCdsViewGroupUpdate,this);break;}}}this._vkScene=s;this._scene=s?s.getSceneRef():null;this._refreshProcedures();this._resetCurrentView();};p.prototype._onViewActivated=function(n,r,s){var t;var u=s.view;var w=this._getViewGroups();if(w&&w.length>0){var x=w[this.getSelectedViewGroupIndex()];if(x&&x.getViewGroupId()!=u.viewGroupId){for(var i=0;i<w.length;i++){if(w[i].getViewGroupId()===u.viewGroupId){for(var k=0;k<w[i].getViews().length;k++){if(w[i].getViews()[k]===u){t=k;this.setSelectedViewGroupIndex(i,t);break;}}}}}else{for(var j=0;j<x.getViews().length;j++){if(x.getViews()[j]===u){t=j;this.viewActivated(t,u);break;}}}}};p.prototype.setHost=function(j){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setAssociation("host",j,true);if(j){if(j.getContent()){var k=function(n){var r=j.getContent();for(var i=0;i<r.length;i++){if(r[i].vitId==n){return i;}}};j.removeContent(k("VIT-StepDescription"));j.removeContent(k("VIT-StepDescriptionVertical"));}this._createStepDescriptionBoxes();j.addContent(this._stepDescription);j.addContent(this._stepDescriptionVertical);this._attachAnimationTimeSlider(this.getAnimationTimeSlider());}};p.prototype._attachAnimationTimeSlider=function(i){if(!i){return;}i.attachChange(this._onSliderValueChange,this);i.attachLiveChange(this._onSliderValueLiveChange,this);};p.prototype._detachAnimationTimeSlider=function(i){if(!i){return;}i.detachChange(this._onSliderValueChange,this);i.detachLiveChange(this._onSliderValueLiveChange,this);};p.prototype._onSliderValueLiveChange=function(i){var j=i.getParameter("value");this._manualTimeChange=true;if(this._animationPlayer&&this._animationPlayer.getTime()!==j){this._animationPlayer.setTime(j);}};p.prototype._onSliderValueChange=function(i){var j=i.getParameter("value");this._manualTimeChange=true;if(this._animationPlayer&&this._animationPlayer.getTime()!==j){this._animationPlayer.setTime(j);}};p.prototype._refreshProcedures=function(i){if(this.getAggregation("toolbar")){this._procedureList.removeAllItems();}this._modelViews=null;if(this._scene&&this._scene.userData){var j=this._getViewGroups();if(j&&j.length>0){this._selectedGroupIndex=0;var k=0;j.forEach(function(n){if(this.getAggregation("toolbar")){this._procedureList.addItem(new sap.ui.core.Item({key:n.getViewGroupId(),text:n.getName()}));}if(i&&n.getViewGroupId()===i){this._selectedGroupIndex=k;}k++;}.bind(this));this._modelViews=this._getViews();if(this.getAggregation("toolbar")){this._currentGroupTitle.setText(j[this._selectedGroupIndex].getName()).setTooltip(j[this._selectedGroupIndex].getName());}}else if(this.getAggregation("toolbar")){this._currentGroupTitle.setText(g().getText("STEP_NAV_PROCEDURES"));}}this._refreshItems();};p.prototype.refresh=function(s){this.setScene(s);};var q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE4AAAA8CAYAAADIQIzXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTA1VDEzOjU1OjAzKzEyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRm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";p.prototype._clearUI=function(){if(this.getAggregation("toolbar")){this._currentStepTitle.setText("");this._separatorTitle.setText("");this._viewGroupSelector.close();this._nextItemButton.setEnabled(false);this._previousItemButton.setEnabled(false);this._stepCount.setText("");this._stepDescriptionText.setHtmlText("");this._stepDescriptionVerticalText.setHtmlText("");}if(this.getAggregation("container")){this._hbox.removeAllItems();}this._viewItems=[];this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(false);};p.prototype._refreshItems=function(){this._clearUI();var t=this;if(this._modelViews){var j=function(i){this.setSelectedItem(i.getSource());}.bind(this);this._modelViews.forEach(function(k){var n=true;var r=k.name||k.getName&&k.getName();var s=new c({alt:r,densityAware:false,tooltip:r,viewGallery:this,source:k.thumbnailData||q,press:function(i){s.detachBrowserEvent("mouseenter",function(i){t.startAnimate();});s.setSource(k.thumbnailData||q);clearInterval(i.getSource().interval);j(i);},layoutData:new e({shrinkFactor:0})});var u=function(w,y){var z=w.width/y;var E=w.height;var G=y;var K=E;var L=document.createElement("canvas");var M=L.getContext("2d");var N=[];L.width=G;L.height=K;for(var i=0;i<z;i++){var x=G*i;M.clearRect(0,0,G,K);M.drawImage(w,x,0,G,K,0,0,G,K);N.push(L.toDataURL());}t.startAnimate=function(){if(n){n=false;s.detachBrowserEvent("mouseenter",function(Q){t.startAnimate();});var i=0;var O=function(){if(i<z){s.setSource(N[i]);i++;}else{s.setSource(N[0]);i=0;}};s.interval=setInterval(function(){O();},250);}};s.attachBrowserEvent("mouseenter",function(O){t.startAnimate();});s.attachBrowserEvent("mouseout",function(O){n=true;s.attachBrowserEvent("mouseenter",function(O){t.startAnimate();});clearInterval(s.interval);s.setSource(k.thumbnailData);});};if(k.animatedThumbnailData!==undefined){var w=document.createElement("img");w.onload=function(){u(w,k.tileWidth);};w.src=k.animatedThumbnailData;}if(this.getEnableViewReordering()){s.addDragDropConfig(new o({dragStart:function(){t._draggedModelView=k;}}));s.getMetadata().dnd.draggable=true;}s.data("modelView",k);this._viewItems.push(s);if(this.getAggregation("container")){this._hbox.addItem(s);}}.bind(this));this.rerender();}};p.prototype.setSelectedItem=function(i){if(i.getCustomData().length>0){var j=i.getCustomData()[0].getValue();var k=this._getViewManager();if(k){k.activateView(j);}}return this;};p.prototype.setDescription=function(){if(!this._selectedItem){return;}if(!this.getVisible()){this._stepDescription.setVisible(false);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVertical.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(false);return;}if(this._selectedItem.getCustomData().length>0){var i=this._selectedItem.getCustomData()[0].getValue();var j=i.getDescription();if(j){if(this._previousOrientationVertical===false){this._stepDescription.setVisible(true);this._stepDescriptionToolbar.setVisible(true);this._stepDescriptionVerticalToolbar.setVisible(false);}else{this._stepDescriptionVertical.setVisible(true);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true;}}else if(this._previousOrientationVertical===true){this._stepDescriptionVertical.setVisible(false);}else{this._stepDescription.setVisible(false);this._previousOrientationVertical=false;}if(j!=null){this._stepDescriptionText.setHtmlText(j);this._stepDescriptionVerticalText.setHtmlText(j);}}};p.prototype.viewActivated=function(i){if(this._selectedItem){if(this.getSelectedViewIndex()!==i){this._selectedItem.removeStyleClass("selected");}}this._selectedItem=this._viewItems[i];if(!this._selectedItem){return this;}if(this.getAggregation("toolbar")){var t=g().getText("VIEWS_TITLE_WITH_COUNT",[i+1,this._viewItems.length]);this._stepCount.setText(t);this._previousItemButton.setEnabled(this._selectedItem!==this._viewItems[0]&&this._viewItems.length>1);this._nextItemButton.setEnabled(this._selectedItem!==this._viewItems[this._viewItems.length-1]&&this._viewItems.length>1);this._setPlayState(true);}this._selectedItem.addStyleClass("selected");if(this._isScrollingNecessary(this._selectedItem.getDomRef(),this._scrollContainer.getDomRef())){this._scrollContainer.scrollToElement(this._selectedItem,500);}if(this._selectedItem.getCustomData().length>0){var j=this._selectedItem.getCustomData()[0].getValue();var k=j.getPlaybacks();var s=this.getAnimationTimeSlider();if(s){if(!k||k.length===0){s.setEnabled(false);s.setValue(0);}else{s.setEnabled(true);}}var n=j.name||j.getName&&j.getName();if(this.getAggregation("toolbar")){this._separatorTitle.setText("/");this._currentStepTitle.setText(n).setTooltip(n);}}this.setDescription();this.fireSelectionChange({item:this._selectedItem});this._setupAnimationSlider();return this;};p.prototype.getSelectedItem=function(){return this._selectedItem;};p.prototype.getSelectedViewIndex=function(){for(var n=0;n<this._viewItems.length;n++){if(this._viewItems[n]===this.getSelectedItem()){return n;}}return-1;};p.prototype.setSelectedViewIndex=function(i){if(this._viewItems.length>i){this.setSelectedItem(this._viewItems[i]);}};p.prototype.getSelectedViewGroupIndex=function(){return this._selectedGroupIndex;};p.prototype.setSelectedViewGroupIndex=function(i,j){var k=this._getViewGroups();if(k&&k.length>i){this._selectedGroupIndex=i;if(j==null){j=0;}this._currentGroupTitle.setText(k[i].getName()).setTooltip(k[i].getName());this._separatorTitle.setVisible(true);this._modelViews=this._getViews();if((!this._modelViews||this._modelViews.length===0)&&this._cdsLoader){var n=k[i].getViewGroupId();var s=k[i].sceneId;var t=this;this._cdsLoader.loadViewGroup(s,n).then(function(r){t._refreshItems();t.setSelectedViewIndex(j);});}else{this._refreshItems();this.setSelectedViewIndex(j);}}};p.prototype._isScrollingNecessary=function(i,s){if(i&&s){var r=i.getBoundingClientRect();return r.left<0||r.right>s.clientWidth;}return false;};p.prototype._setContent=function(j){var k=j&&j.getMetadata&&j.getMetadata().getName()==="sap.ui.vk.threejs.Scene";this.setScene(k?j:null);if(k&&j.builders){for(var i=0;i<j.builders.length;i++){j.builders[i]._fireThumbnailLoaded=function(r){var s=null;for(var n=0;n<this._viewItems.length;n++){if(this._viewItems[n].data("modelView")==r.modelView){s=this._viewItems[n];break;}}if(s){s.setSource(r.modelView.thumbnailData);}}.bind(this);}}this._attachAnimationTimeSlider(this.getAnimationTimeSlider());};p.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};p.prototype._handleContentChangesStarted=function(){this._detachAnimationTimeSlider(this.getAnimationTimeSlider());this.setScene(null);};p.prototype._handleContentReplaced=function(i){var j=i.getParameter("newContent");this._setContent(j);};p.prototype._handleCdsViewGroupUpdate=function(i){var j=i.getParameter("currentViewGroupId");if(this._modelViews&&this._modelViews.length){this._refreshItems();}else{this._refreshProcedures(j);}this._resetCurrentView();};p.prototype._resetCurrentView=function(){var j=this._getViewManager();if(j){var k=j.getActiveView();if(k&&this._viewItems){for(var i=0;i<this._viewItems.length;i++){var n=this._viewItems[i];var r=n.getCustomData()[0].getValue();if(r===k){if(this._selectedItem!==n){this.viewActivated(i);break;}}}}if(this._selectedGroupIndex!==-1){var s=this._getViewGroups();if(s&&s.length){this._procedureList.setSelectedKey(s[0].getViewGroupId());}}}};b.injectMethodsIntoClass(p);return p;});
