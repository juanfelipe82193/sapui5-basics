/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["../abgrToColor","../ObjectType","./thirdparty/three","../NodeContentType"],function(a,O,t,N){"use strict";THREE.Object3D.prototype.defaultEmissive={r:0.0235,g:0.0235,b:0.0235};THREE.Object3D.prototype.defaultSpecular={r:0.0602,g:0.0602,b:0.0602};THREE.Box3.prototype._setFromObjectExcludingHotSpotAndPMI=function(o){this.makeEmpty();var v=new THREE.Vector3();var c=this;o.updateMatrixWorld(true);o.traverse(function(n){if(n.userData.objectType===O.Hotspot||n.userData.objectType===O.PMI){return;}var i,l;var g=n.geometry;if(g!==undefined){if(g.isGeometry){var d=g.vertices;for(i=0,l=d.length;i<l;i++){v.copy(d[i]);v.applyMatrix4(n.matrixWorld);c.expandByPoint(v);}}else if(g.isBufferGeometry){var e=g.attributes.position;if(e!==undefined){for(i=0,l=e.count;i<l;i++){v.fromBufferAttribute(e,i).applyMatrix4(n.matrixWorld);c.expandByPoint(v);}}}}});return this;};THREE.Object3D.prototype._vkCalculateObjectOrientedBoundingBox=function(){var p=this.parent,m=this.matrix.clone(),c=this.matrixAutoUpdate;this.parent=null;this.matrix.identity();this.matrixAutoUpdate=false;this.userData.boundingBox._setFromObjectExcludingHotSpotAndPMI(this);this.matrixAutoUpdate=c;this.matrix.copy(m);this.parent=p;this.updateMatrixWorld(true);};THREE.Object3D.prototype._vkTraverseNodeGeometry=function(c){c(this);for(var i=0,l=this.children.length;i<l;i++){var d=this.children[i];if(d.geometry!==undefined&&d.layers===this.layers){c(d);}}};THREE.Object3D.prototype._vkSetTintColor=function(c){this._vkTraverseNodeGeometry(function(n){n.userData.tintColor=c;n._vkUpdateMaterialColor();});};THREE.Object3D.prototype._vkSetOpacity=function(o,j){this.userData.opacity=o;var n;var p;if(j){n=new Map();p=new Map();j.forEach(function(c){n.set(c.node,c);if(c.parent){var d=p.get(c.parent);if(!d){d=[];}d.push(c);p.set(c.parent,d);}});}this._vkTraverseNodes(function(c){c._vkUpdateMaterialOpacity(n);},n,p);};THREE.Object3D.prototype._vkUpdateMaterialColor=function(){if(!this.material||!this.material.color){return;}var u=this.userData;if(u.originalMaterial){if(u.originalMaterial.color.r===undefined){u.originalMaterial=null;}else if(u.originalMaterial.userData&&u.originalMaterial.userData.textureAdded){this.material=u.originalMaterial.clone();if(u.opacity!==undefined){this.material.opacity*=u.opacity;this.material.transparent=this.material.transparent||this.material.opacity<0.99;}delete u.originalMaterial.userData.textureAdded;}else{this.material.color.copy(u.originalMaterial.color);if(this.material.emissive!==undefined){this.material.emissive.copy(u.originalMaterial.emissive);}if(this.material.specular!==undefined){this.material.specular.copy(u.originalMaterial.specular);}}}if(u.highlightColor!==undefined||u.tintColor!==undefined||u.highlightingColor!==undefined){if(!u.originalMaterial){u.originalMaterial=this.material;this.material=this.material.clone();}if(u.highlightingColor!==undefined){var d=new THREE.Color();d.fromArray(u.highlightingColor).lerp(u.originalMaterial.color,1-u.highlightingColor[3]);this.material.color.copy(d);}var c;if(u.tintColor!==undefined){c=a(u.tintColor);this.material.color.lerp(new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0),c.alpha);if(this.material.emissive!==undefined){if(this.material.userData.defaultHighlightingEmissive){this.material.emissive.copy(this.material.userData.defaultHighlightingEmissive);}else{this.material.emissive.copy(THREE.Object3D.prototype.defaultEmissive);}}if(this.material.specular!==undefined){if(this.material.userData.defaultHighlightingSpecular){this.material.specular.copy(this.material.userData.defaultHighlightingSpecular);}else{this.material.specular.copy(THREE.Object3D.prototype.defaultSpecular);}}}if(u.highlightColor!==undefined){c=a(u.highlightColor);this.material.color.lerp(new THREE.Color(c.red/255.0,c.green/255.0,c.blue/255.0),c.alpha);if(this.material.emissive!==undefined){if(this.material.userData.defaultHighlightingEmissive){this.material.emissive.copy(this.material.userData.defaultHighlightingEmissive);}else{this.material.emissive.copy(THREE.Object3D.prototype.defaultEmissive);}}if(this.material.specular!==undefined){if(this.material.userData.defaultHighlightingSpecular){this.material.specular.copy(this.material.userData.defaultHighlightingSpecular);}else{this.material.specular.copy(THREE.Object3D.prototype.defaultSpecular);}}}}};THREE.Object3D.prototype._vkUpdateMaterialOpacity=function(n){if(!this.material){return;}var u=this.userData;if(u.originalMaterial){this.material.opacity=u.originalMaterial.opacity;this.material.transparent=u.originalMaterial.transparent;}var o=1.0;var h=false;var c=this;do{if(c.userData&&c.userData.opacity!==undefined){o*=c.userData.opacity;h=true;}if(n){var j=n.get(c);if(j&&j.parent){c=j.parent;continue;}}c=c.parent;}while(c);if(h){if(!u.originalMaterial){u.originalMaterial=this.material;this.material=this.material.clone();}if(this.material.opacity){this.material.opacity*=o;this.material.transparent=this.material.transparent||this.material.opacity<0.99;}}};THREE.Object3D.prototype._vkTraverseMeshNodes=function(c){if(this._vkUpdate!==undefined||this.isDetailView){return;}c(this);var d=this.children;for(var i=0,l=d.length;i<l;i++){d[i]._vkTraverseMeshNodes(c);}};THREE.Object3D.prototype._vkTraverseNodes=function(c,n,p){c(this);var d;if(p){d=p.get(this);}var j;if(d){for(j=0;j<d.length;j++){d[j].node._vkTraverseNodes(c,n,p);}}var e=this.children;if(e){for(j=0;j<e.length;j++){var f=e[j];if(n){var g=n.get(f);if(g){continue;}}f._vkTraverseNodes(c,n,p);}}};function b(c,d){var e=c.min,f=c.max,m=d.elements,g=(e.x+f.x)*0.5,h=(e.y+f.y)*0.5,i=(e.z+f.z)*0.5,j=f.x-g,k=f.y-h,l=f.z-i;var n=m[0]*g+m[4]*h+m[8]*i+m[12];var o=m[1]*g+m[5]*h+m[9]*i+m[13];var p=m[2]*g+m[6]*h+m[10]*i+m[14];var q=Math.abs(m[0]*j)+Math.abs(m[4]*k)+Math.abs(m[8]*l);var r=Math.abs(m[1]*j)+Math.abs(m[5]*k)+Math.abs(m[9]*l);var s=Math.abs(m[2]*j)+Math.abs(m[6]*k)+Math.abs(m[10]*l);e.set(n-q,o-r,p-s);f.set(n+q,o+r,p+s);}THREE.Object3D.prototype._expandBoundingBox=function(c,v,d){var n=new THREE.Box3();function e(g){var h=g.geometry;if(h!==undefined){if(!h.boundingBox){h.computeBoundingBox();}if(!h.boundingBox.isEmpty()){n.copy(h.boundingBox);b(n,g.matrixWorld);if(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.min.z)&&isFinite(n.max.x)&&isFinite(n.max.y)&&isFinite(n.max.z)){c.min.min(n.min);c.max.max(n.max);}}}var s=g.userData.boundingBox;if(s!==undefined&&!s.isEmpty()&&!v){n.copy(s);b(n,g.matrixWorld);c.min.min(n.min);c.max.max(n.max);}}function f(g){if(d&&g._vkUpdate!==undefined){return;}if(!v||g.layers.test(v)){e(g);}var h=g.children;for(var i=0,l=h.length;i<l;i++){f(h[i]);}}this.updateMatrixWorld();f(this);return c;};THREE.Object3D.prototype._vkPersistentId=function(){var o=this;do{if(o.userData.treeNode&&o.userData.treeNode.sid){return o.userData.treeNode.sid;}o=o.parent;}while(o);return null;};THREE.Object3D.prototype._vkSetNodeContentType=function(n){this.userData.nodeContentType=n;if(n===N.Reference){for(var i=0;i<32;i++){this.layers.disable(i);}this.userData.skipIt=true;}};THREE.Object3D.prototype._vkGetNodeContentType=function(n){return this.userData.nodeContentType;};});
