/*
 * ! SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/thirdparty/jquery','sap/m/library','sap/ui/core/library','sap/ui/core/Core','sap/ui/events/KeyCodes','sap/ui/comp/util/DateTimeUtil','sap/ui/comp/util/FilterUtil','sap/m/Column','sap/m/ColumnListItem','sap/m/Label','sap/m/MessageBox','sap/m/Table','sap/m/Text','sap/m/Title','sap/m/OverflowToolbar','sap/m/ToolbarSpacer','sap/m/OverflowToolbarButton','sap/m/ToolbarSeparator','sap/m/VBox','sap/m/FlexItemData','sap/ui/comp/library','sap/ui/comp/providers/TableProvider','sap/ui/comp/smartfilterbar/FilterProvider','sap/ui/comp/smartvariants/SmartVariantManagement','sap/ui/model/Sorter','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/model/json/JSONModel','sap/ui/table/AnalyticalColumn','sap/ui/table/AnalyticalTable','sap/ui/table/Column','sap/ui/table/Table','sap/ui/table/TreeTable','sap/ui/comp/personalization/Controller','sap/ui/comp/personalization/Util','sap/ui/comp/util/FormatUtil','sap/ui/comp/util/FullScreenUtil','sap/ui/comp/odata/ODataModelUtil','sap/ui/comp/odata/ODataType','sap/ui/comp/state/UIState','sap/ui/comp/smartvariants/PersonalizableInfo','sap/ui/core/format/NumberFormat','sap/ui/Device','sap/base/Log','sap/base/util/deepEqual','sap/base/util/merge',"sap/m/ColumnHeaderPopover",'sap/m/ColumnPopoverActionItem','sap/m/ColumnPopoverSortItem','sap/m/Menu','sap/m/MenuButton','sap/m/MenuItem'],function(q,M,c,C,K,D,F,a,b,L,d,R,T,f,O,g,h,j,V,k,l,m,n,S,o,p,r,J,A,s,t,u,v,w,P,x,y,z,B,U,E,N,G,H,I,Q,W,X,Y,Z,$,_){"use strict";var a1=M.ButtonType;var b1=M.MenuButtonMode;var c1=M.ToolbarDesign;var d1=c.SortOrder;var e1=l.smarttable.InfoToolbarBehavior;var f1=V.extend("sap.ui.comp.smarttable.SmartTable",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smarttable/SmartTable.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null},ignoredFields:{type:"string",group:"Misc",defaultValue:null},initiallyVisibleFields:{type:"string",group:"Misc",defaultValue:null},requestAtLeastFields:{type:"string",group:"Misc",defaultValue:null},ignoreFromPersonalisation:{type:"string",group:"Misc",defaultValue:null},tableType:{type:"sap.ui.comp.smarttable.TableType",group:"Misc",defaultValue:null},useVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},showVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},useExportToExcel:{type:"boolean",group:"Misc",defaultValue:true},exportType:{type:"sap.ui.comp.smarttable.ExportType",group:"Misc",defaultValue:"UI5Client"},useTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},toolbarStyleClass:{type:"string",group:"Misc",defaultValue:null},enableCustomFilter:{type:"boolean",group:"Misc",defaultValue:true},persistencyKey:{type:"string",group:"Misc",defaultValue:null},useOnlyOneSolidToolbar:{type:"boolean",group:"Misc",defaultValue:false},placeToolbarInTable:{type:"boolean",group:"Misc",defaultValue:false},currentVariantId:{type:"string",group:"Misc",defaultValue:null},editable:{type:"boolean",group:"Misc",defaultValue:false},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},tableBindingPath:{type:"string",group:"Misc",defaultValue:null},editTogglable:{type:"boolean",group:"Misc",defaultValue:false},demandPopin:{type:"boolean",group:"Misc",defaultValue:false},showFullScreenButton:{type:"boolean",group:"Misc",defaultValue:false},initialNoDataText:{type:"string",group:"Misc",defaultValue:null},useInfoToolbar:{type:"sap.ui.comp.smarttable.InfoToolbarBehavior",group:"Behavior",defaultValue:e1.Auto}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},aggregations:{customToolbar:{type:"sap.m.Toolbar",multiple:false},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false},noData:{type:"sap.ui.core.Control",altTypes:["string"],multiple:false},semanticKeyAdditionalControl:{type:"sap.ui.core.Control",multiple:false}},events:{initialise:{},beforeRebindTable:{},editToggled:{},dataRequested:{},dataReceived:{},afterVariantInitialise:{},afterVariantSave:{parameters:{currentVariantId:{type:"string"}}},afterVariantApply:{parameters:{currentVariantId:{type:"string"}}},showOverlay:{},fieldChange:{},fullScreenToggled:{parameters:{fullScreen:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"}}},beforePaste:{allowPreventDefault:true,parameters:{columnInfos:{type:"object[]"}}},paste:{parameters:{result:{type:"object"}}}}},renderer:{apiVersion:2},constructor:function(){V.apply(this,arguments);this._aExistingColumns=[];this._aAlwaysSelect=[];this._oTemplate=null;this._mFieldMetadataByKey={};this._createToolbar();this._oP13nDialogSettings=this.data("p13nDialogSettings");if(typeof this._oP13nDialogSettings==="string"){try{this._oP13nDialogSettings=JSON.parse(this._oP13nDialogSettings);}catch(e){this._oP13nDialogSettings=null;}}this._bIsFilterPanelEnabled=(this._oP13nDialogSettings&&this._oP13nDialogSettings.filter)?this._oP13nDialogSettings.filter.visible!==false:true;this._createTable();this.attachModelContextChange(this._initialiseMetadata,this);}});f1.prototype.init=function(){V.prototype.init.call(this);this.addStyleClass("sapUiCompSmartTable");this.setFitContainer(true);this._aColumnKeys=[];this._aDeactivatedColumns=[];this._mLazyColumnMap={};};f1.prototype._getVariantManagementControl=function(e){var i=null;if(e){if(typeof e==='string'){i=C.byId(e);}else{i=e;}if(i){if(!(i instanceof S)){H.error("Control with the id="+e.getId?e.getId():e+" not of expected type");return null;}}}return i;};f1.prototype._createVariantManagementControl=function(){if(this._oVariantManagement||(!this.getUseVariantManagement()&&!this.getUseTablePersonalisation())||!this.getPersistencyKey()){return;}var e=new E({type:"table",keyName:"persistencyKey",dataSource:"TODO"});e.setControl(this);var i=this.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}else if(this._oSmartFilter&&this._oSmartFilter.data("pageVariantPersistencyKey")){i=this._oSmartFilter.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}}else{this._oVariantManagement=new S(this.getId()+"-variant",{showShare:true});}if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(e);this._oVariantManagement.attachSave(this._variantSaved,this);this._oVariantManagement.attachAfterSave(this._variantAfterSave,this);this._oVariantManagement.initialise(this._variantInitialised,this);}};f1.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD";}this.fireAfterVariantInitialise();if(this._oVariantManagement&&!this._oVariantManagement.getEnabled()){this._checkAndTriggerBinding();}};f1.prototype._variantSaved=function(){if(this._oPersController){this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}};f1.prototype._variantAfterSave=function(){this.fireAfterVariantSave({currentVariantId:this.getCurrentVariantId()});};f1.prototype.setTableBindingPath=function(e){this.setProperty("tableBindingPath",e,true);return this;};f1.prototype.setShowTablePersonalisation=function(e){this.setProperty("showTablePersonalisation",e,true);if(this._oTablePersonalisationButton){this._oTablePersonalisationButton.setVisible(e);}return this;};f1.prototype.setUseVariantManagement=function(e){this.setProperty("useVariantManagement",e,true);if(this._oPersController){this._oPersController.setResetToInitialTableState(!e);}return this;};f1.prototype.setShowVariantManagement=function(e){this.setProperty("showVariantManagement",e,true);if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(e);if(this._oSeparator){this._oSeparator.setVisible(e);}}return this;};f1.prototype.setToolbarStyleClass=function(e){this.setProperty("toolbarStyleClass",e,true);return this;};f1.prototype.setCustomToolbar=function(e){this._oCustomToolbar=e;return this;};f1.prototype.getCustomToolbar=function(){return this._oCustomToolbar;};f1.prototype.setHeader=function(e){var i=this.getProperty("header"),g1;this.setProperty("header",e,true);if(this.bIsInitialised&&this._oToolbar){g1=(!i===!e);if(!g1){this._createToolbarContent();}else{this._refreshHeaderText();}}return this;};f1.prototype.setShowRowCount=function(e){this.setProperty("showRowCount",e,true);this._refreshHeaderText();return this;};f1.prototype.setEditable=function(e){this.setProperty("editable",e,true);if(this._oEditModel){this._oEditModel.setProperty("/editable",e);}if(this._oEditButton){this._oEditButton.setIcon(e?"sap-icon://display":"sap-icon://edit");}if(this._isMobileTable&&this._oTable.setKeyboardMode){this._oTable.setKeyboardMode(e?"Edit":"Navigation");}return this;};f1.prototype.setDemandPopin=function(e){var i=this.getDemandPopin();if(i===e){return this;}this.setProperty("demandPopin",e,true);if(this.bIsInitialised){if(e){this._updateColumnsPopinFeature();}else{this._deactivateColumnsPopinFeature();}}return this;};f1.prototype._refreshHeaderText=function(){if(!this._headerText){return;}if(!this._oNumberFormatInstance){this._oNumberFormatInstance=N.getFloatInstance();}var e=this.getHeader();this._headerText.setVisible(!!e);if(this.getShowRowCount()){var i=parseInt(this._getRowCount(true));var g1=this._oNumberFormatInstance.format(i);e+=" ("+g1+")";}this._headerText.setText(e);};f1.prototype._addFullScreenButton=function(){if(this._oFullScreenButton){this._oToolbar.removeContent(this._oFullScreenButton);}if(this.getShowFullScreenButton()){if(!this._oFullScreenButton){this._oFullScreenButton=new h(this.getId()+"-btnFullScreen",{press:[function(){this._toggleFullScreen(!this.bFullScreen);},this]});}this._renderFullScreenButton();this._oToolbar.addContent(this._oFullScreenButton);}};f1.prototype._createToolbar=function(){var e=null;if(!this._oToolbar){e=this.getCustomToolbar();if(e){this._oToolbar=e;}else{this._oToolbar=new O({design:c1.Transparent});this._oToolbar.addStyleClass("sapUiCompSmartTableToolbar");if(this.getToolbarStyleClass()){this._oToolbar.addStyleClass(this.getToolbarStyleClass());}}this._oToolbar.setLayoutData(new k({shrinkFactor:0}));}};f1.prototype._toggleFullScreen=function(e,i){if(!this._oFullScreenButton||(e===this.bFullScreen&&!i)){return;}this.bFullScreen=e;y.toggleFullScreen(this,this.bFullScreen,this._oFullScreenButton,this._toggleFullScreen);this._renderFullScreenButton();this.fireFullScreenToggled({fullScreen:e});};f1.prototype._renderFullScreenButton=function(){var e=C.getLibraryResourceBundle("sap.ui.comp"),i;i=this.bFullScreen?e.getText("CHART_MINIMIZEBTN_TOOLTIP"):e.getText("CHART_MAXIMIZEBTN_TOOLTIP");this._oFullScreenButton.setTooltip(i);this._oFullScreenButton.setText(i);this._oFullScreenButton.setIcon(this.bFullScreen?"sap-icon://exit-full-screen":"sap-icon://full-screen");};f1.prototype._createToolbarContent=function(){if(!this._oToolbar){this._createToolbar();}this._addVariantManagementToToolbar();this._addSeparatorToToolbar();this._addHeaderToToolbar();this._addSpacerToToolbar();this._addEditTogglableToToolbar();this._addTablePersonalisationToToolbar();this._addExportToExcelToToolbar();this._addFullScreenButton();this._bToolbarInsertedIntoItems=true;this._placeToolbar();};f1.prototype._placeToolbar=function(){if(!this.getPlaceToolbarInTable()){this.insertItem(this._oToolbar,0);}else if(this._isMobileTable){this._oTable.setHeaderToolbar(this._oToolbar);}else{this._oTable.addExtension(this._oToolbar);}};f1.prototype.getToolbar=function(){return this._oToolbar;};f1.prototype._addEditTogglableToToolbar=function(){var e;if(this._oEditButton){this._oToolbar.removeContent(this._oEditButton);}if(this.getEditTogglable()){if(!this._oEditButton){e=C.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_EDITTOGGLE_TOOLTIP");this._oEditButton=new h(this.getId()+"-btnEditToggle",{icon:this.getEditable()?"sap-icon://display":"sap-icon://edit",text:e,tooltip:e,press:[function(){var i=this.getEditable();i=!i;this.setEditable(i,true);this.fireEditToggled({editable:i});},this]});}this._oToolbar.addContent(this._oEditButton);}};f1.prototype._addHeaderToToolbar=function(){if(this._headerText){this._oToolbar.removeContent(this._headerText);}if(!this._headerText){this._headerText=new f(this.getId()+"-header");this._headerText.addStyleClass("sapMH4Style");this._headerText.addStyleClass("sapUiCompSmartTableHeader");}this._refreshHeaderText();this._oToolbar.insertContent(this._headerText,0);};f1.prototype._addSeparatorToToolbar=function(){if(this._oSeparator){this._oToolbar.removeContent(this._oSeparator);}if(this.getHeader()&&this.getUseVariantManagement()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){if(!this._oSeparator){this._oSeparator=new j(this.getId()+"-toolbarSeperator");if(!this.getShowVariantManagement()){this._oSeparator.setVisible(false);}}this._oToolbar.insertContent(this._oSeparator,0);}if(this._oToolbar){this._oToolbar.addStyleClass("sapMTBHeader-CTX");}};f1.prototype._addVariantManagementToToolbar=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oToolbar.removeContent(this._oVariantManagement);if(this.getUseVariantManagement()){this._oToolbar.insertContent(this._oVariantManagement,0);if(!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(this.getShowVariantManagement());}}}};f1.prototype._addSpacerToToolbar=function(){var e=false,g1=this._oToolbar.getContent(),i,h1;if(g1){h1=g1.length;i=0;for(i;i<h1;i++){if(g1[i]instanceof g){e=true;break;}}}if(!e){this._oToolbar.addContent(new g(this.getId()+"-toolbarSpacer"));}};f1.prototype._addTablePersonalisationToToolbar=function(){var e;if(this._oTablePersonalisationButton){this._oToolbar.removeContent(this._oTablePersonalisationButton);}if(this.getUseTablePersonalisation()){if(!this._oTablePersonalisationButton){e=C.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_PERSOBTN_TOOLTIP");this._oTablePersonalisationButton=new h(this.getId()+"-btnPersonalisation",{icon:"sap-icon://action-settings",text:e,tooltip:e,press:[function(i){this._oPersController.openDialog();},this]});this._oTablePersonalisationButton.setVisible(this.getShowTablePersonalisation());}this._oToolbar.addContent(this._oTablePersonalisationButton);}};f1.prototype._triggerGWExport=function(){var e=C.getLibraryResourceBundle("sap.ui.comp");var i=function(){var h1=this._getRowBinding();var i1=h1.getDownloadUrl("xlsx");i1=this._removeExpandParameter(i1);if(i1&&i1.length>2048&&G.browser.msie){d.error(e.getText("DOWNLOAD_TOO_COMPLEX_TEXT"));return;}var j1={url:i1};this.fireBeforeExport({exportSettings:j1});window.open(j1.url);}.bind(this);var g1=this._getRowCount(true);if(g1>10000){d.confirm(e.getText("DOWNLOAD_CONFIRMATION_TEXT",g1),{actions:[d.Action.YES,d.Action.NO],onClose:function(h1){if(h1===d.Action.YES){i();}}});}else{i();}};f1.prototype._addExportToExcelToToolbar=function(){if(this._oUseExportToExcel){this._oToolbar.removeContent(this._oUseExportToExcel);}if(!this.getUseExportToExcel()){return;}if(!this._oUseExportToExcel){var e=this.getId()+"-btnExcelExport";var i="sap-icon://excel-attachment";var g1=C.getLibraryResourceBundle("sap.ui.comp");if(this.getExportType()==="UI5Client"){this._oUseExportToExcel=this._createClientExportButton(e,i);}if(this._bTableSupportsExcelExport&&this.getExportType()==="GW"){var h1;h1=g1.getText("TABLE_EXPORT_TEXT");this._oUseExportToExcel=new h(e,{icon:i,text:h1,tooltip:h1,press:[this._triggerGWExport,this]});}this._setExcelExportEnableState();}this._oToolbar.addContent(this._oUseExportToExcel);};f1.prototype._openExportSettings=function(){var e=this;this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils'],function(i){i.getExportSettingsViaDialog(e._cachedExcelSettings,e).then(function(g1){e._cachedExcelSettings=g1;e._triggerUI5ClientExport(g1);});});});};f1.prototype._createClientExportButton=function(e,i){var g1=C.getLibraryResourceBundle("sap.ui.comp");var h1={fileName:this.getHeader()};if(!this._cachedExcelSettings){this._cachedExcelSettings=h1;}return new $(e,{icon:i,tooltip:g1.getText("TABLE_EXPORT_TEXT"),type:a1.Ghost,buttonMode:b1.Split,useDefaultActionOnly:true,defaultAction:[function(){this._triggerUI5ClientExport(h1);},this],menu:[new Z({items:[new _({text:g1.getText("QUICK_EXPORT"),press:[function(){this._triggerUI5ClientExport(h1);},this]}),new _({text:g1.getText("EXPORT_WITH_SETTINGS"),press:[this._openExportSettings,this]})]})]});};f1.prototype.onkeydown=function(e){if(e.isMarked()){return;}if((e.metaKey||e.ctrlKey)&&e.shiftKey&&e.which===K.E){if(this.getUseExportToExcel()&&this.getExportType()==="UI5Client"&&this._oUseExportToExcel&&this._oUseExportToExcel.getEnabled()){this._openExportSettings();e.setMarked();e.preventDefault();}}else if((e.metaKey||e.ctrlKey)&&e.which===K.COMMA){if(this.getUseTablePersonalisation()&&this._oTablePersonalisationButton&&this._oTablePersonalisationButton.getVisible()){this._oPersController.openDialog();e.setMarked();e.preventDefault();}}};f1.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=C.loadLibrary("sap.ui.export",true);}return this._oExportLibLoadPromise;};f1.prototype._getColumnLabel=function(e){var i;if(typeof e==='string'){e=this._getColumnByKey(e);}if(!e){return null;}if(e.getLabel){i=e.getLabel();}if(e.getHeader){i=e.getHeader();}return(i&&i.getText)?i.getText():null;};f1.prototype._getColumnWidthNumber=function(e){if(e.indexOf("em")>0){return Math.round(parseFloat(e));}if(e.indexOf("px")>0){return Math.round(parseInt(e)/16);}return"";};f1.prototype._triggerUI5ClientExport=function(e){var i=this._createExportColumnConfiguration(e);if(!i||!i.length){d.error(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS_EXPORT"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}var g1=this._getRowBinding();var h1=this._getColumnLabel.bind(this);var i1={workbook:{columns:i,hierarchyLevel:(this._isTreeTable&&g1.getTreeAnnotation)?g1.getTreeAnnotation("hierarchy-level-for"):undefined},dataSource:g1,fileName:e?e.fileName:this.getHeader()};this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils','sap/ui/export/Spreadsheet'],function(j1,k1){var l1=Promise.resolve();if(e.includeFilterSettings){l1=j1.parseFilterConfiguration(g1,h1).then(function(m1){if(e.includeFilterSettings&&m1){i1.workbook.context={metaSheetName:m1.name,metainfo:[m1]};}});}l1.then(function(){var m1={splitCells:false,includeFilterSettings:false};if(e){m1.splitCells=e.splitCells;m1.includeFilterSettings=e.includeFilterSettings;}var n1=new k1(i1);n1.attachBeforeExport(function(p1){this.fireBeforeExport({exportSettings:p1.getParameter('exportSettings'),userExportSettings:m1});},this);var o1=function(){n1.destroy();};n1.build().then(o1,o1);}.bind(this));}.bind(this));}.bind(this));};f1.prototype._createExportColumnConfiguration=function(e){var g1,i,h1,i1,j1,k1,l1,m1,n1,o1,p1,q1,r1,s1,t1,u1,v1,w1=[];var x1=e&&e.splitCells;g1=this._isMobileTable?this._oTable.getColumns(true):this._oTable.getColumns();h1=g1.length;for(i=0;i<h1;i++){l1=null;m1=null;n1=null;i1=g1[i];if(i1.getVisible()){if(i1.getLeadingProperty){l1=i1.getLeadingProperty();}j1=i1.data("p13nData");if(!l1&&j1){l1=j1["leadingProperty"];}if(Array.isArray(l1)){l1=l1[0];}if(l1){k1=this._getColumnLabel(i1);s1=i1.getWidth().toLowerCase()||j1.width||"";s1=this._getColumnWidthNumber(s1);t1=j1.type==="numeric"?"number":j1.type;v1=null;u1=null;if(j1.unit){t1=j1.isCurrency?"currency":"number";if(x1){n1=j1.unit;}}else if(t1!="date"&&B.isDateOrTime(j1.edmType)){t1=B.getTypeName(j1.edmType);if(t1==="DateTimeOffset"){t1="DateTime";}}else if(t1==="stringdate"){t1="date";u1="YYYYMMDD";}else if(t1==="boolean"){v1=B.getType(j1.edmType);}else if(j1.description){t1="string";if(x1&&j1.displayBehaviour!=="idOnly"){n1=j1.description;}else{m1=x.getFormattedExpressionFromDisplayBehaviour(j1.displayBehaviour,"{0}","{1}");}}else if(j1.isDigitSequence){t1="number";}w1.push({columnId:i1.getId(),property:m1?[l1,j1.description]:l1,type:t1,inputFormat:u1,label:k1?k1:l1,width:s1,textAlign:i1.getHAlign(),template:m1,trueValue:(t1==="boolean"&&v1)?v1.formatValue(true,"string"):undefined,falseValue:(t1==="boolean"&&v1)?v1.formatValue(false,"string"):undefined,unitProperty:(t1==="currency"||(t1==="number"&&!x1))?j1.unit:undefined,displayUnit:t1==="currency"&&!x1,precision:j1.precision,scale:j1.scale});if(n1){o1=this._getColumnByKey(n1);p1=k1;k1=null;if(o1){k1=this._getColumnLabel(o1);s1=o1.getWidth().toLowerCase()||"";s1=this._getColumnWidthNumber(s1);r1=o1.getHAlign();}else{q1=this._mFieldMetadataByKey[n1];if(q1){k1=q1.label;s1=q1.width;}}w1.push({columnId:i1.getId()+"-additionalProperty",property:n1,type:"string",label:k1||(p1?p1+" (2)":n1),width:s1,textAlign:r1});}}}}return w1;};f1.prototype._removeExpandParameter=function(e){var i=e.replace(new RegExp("([\\?&]\\$expand=[^&]+)(&?)"),function(g1,h1,i1){return i1?h1.substring(0,1):"";});return i;};f1.prototype._getRowCount=function(e){var i=this._getRowBinding();if(!i){return 0;}var g1=0;if(e&&i.getTotalSize){g1=i.getTotalSize();}else{g1=i.getLength();}if(g1<0||g1==="0"){g1=0;}return g1;};f1.prototype._setExcelExportEnableState=function(){if(this._oUseExportToExcel){var i=this._getRowCount();this._oUseExportToExcel.setEnabled(i>0);}};f1.prototype._createPersonalizationController=function(){if(this._oPersController||!this.getUseTablePersonalisation()){return;}var e=this._oP13nDialogSettings;e=this._setIgnoreFromPersonalisationToSettings(e);if(this._isTreeTable){e=e||{};e.stableColumnKeys=[];e.stableColumnKeys.push(this._aColumnKeys[0]);}this._oPersController=new w(this.getId()+"-persoController",{table:this._oTable,columnKeys:this._aColumnKeys,setting:e,resetToInitialTableState:!this.getUseVariantManagement(),beforePotentialTableChange:[this._beforePersonalisationModelDataChange,this],afterPotentialTableChange:[this._afterPersonalisationModelDataChange,this],afterP13nModelDataChange:[this._personalisationModelDataChange,this],requestColumns:[this._personalisationRequestColumns,this]});};f1.prototype._setIgnoreFromPersonalisationToSettings=function(e){var i=P.createArrayFromString(this.getIgnoreFromPersonalisation());if(i.length){if(!e){e={};}var g1=function(h1){if(!e[h1]){e[h1]={};}e[h1].ignoreColumnKeys=i;};g1("filter");g1("sort");g1("group");g1("columns");}return e;};f1.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation);}};f1.prototype.setEntitySet=function(e){this.setProperty("entitySet",e,true);this._initialiseMetadata();return this;};f1.prototype._initialiseMetadata=function(e){var i=this,g1=i;if(e){g1=e.getSource();}if(!g1.bIsInitialised){z.handleModelInit(g1,g1._onMetadataInitialised);}};f1.prototype._onMetadataInitialised=function(){this._bMetaModelLoadAttached=false;if(!this.bIsInitialised){this._createTableProvider();if(this._oTableProvider){this._aTableViewMetadata=this._oTableProvider.getTableViewMetadata();if(this._aTableViewMetadata){if(!this._isMobileTable&&this.getDemandPopin()){this.setDemandPopin(false);H.error("use SmartTable property 'demandPopin' only  with responsive table, property has been set to false");}this.detachModelContextChange(this._initialiseMetadata,this);this.bIsInitialised=true;this._bTableSupportsExcelExport=this._oTableProvider.getSupportsExcelExport();this._bMultiUnitBehaviorEnabled=this._oTableProvider.getMultiUnitBehaviorEnabled();this._listenToSmartFilter();this._createVariantManagementControl();this._createToolbarContent();this._aAlwaysSelect=this._oTableProvider.getRequestAtLeastFields();this._createContent();this._createPersonalizationController();this._oEditModel=new J({editable:this.getEditable()});this.setModel(this._oEditModel,"sm4rtM0d3l");this.attachEvent("_change",this._onPropertyChange,this);this.fireInitialise();if(!this._oVariantManagement||(this._oVariantManagement&&this._bVariantInitialised)){this._checkAndTriggerBinding();}}}}};f1.prototype._checkAndTriggerBinding=function(){if(!this._bAutoBindingTriggered){this._bAutoBindingTriggered=true;if(this.getEnableAutoBinding()){if(this._oSmartFilter){if(this._oSmartFilter.isInitialised()){this._oSmartFilter.search();}else{this._oSmartFilter.attachEventOnce("initialise",function(){this._oSmartFilter.search();},this);}}else{this._reBindTable();}}}};f1.prototype._aStaticProperties=["entitySet","ignoredFields","initiallyVisibleFields","ignoreFromPersonalisation","tableType","useTablePersonalisation","enableAutoBinding","persistencyKey","smartFilterId"];f1.prototype._aToolbarRelatedProperties=["useExportToExcel","exportType","showFullScreenButton","editTogglable","placeToolbarInTable"];f1.prototype._onPropertyChange=function(e){var i=e.getParameter("name");if(this._aStaticProperties.indexOf(i)>-1){H.error("Property "+i+" cannot be changed after the SmartTable with id "+this.getId()+" is initialised");}if(this._oToolbar&&this._aToolbarRelatedProperties.indexOf(i)>-1){if(i==="exportType"&&this._oUseExportToExcel){this._oUseExportToExcel.destroy();this._oUseExportToExcel=null;}this._createToolbarContent();}};f1.prototype._createTableProvider=function(){var e,i,g1;i=this.getEntitySet();g1=this.getIgnoredFields();e=this.getModel();if(e&&i){if(this._aExistingColumns.length){if(g1){g1+=","+this._aExistingColumns.toString();}else{g1=this._aExistingColumns.toString();}}this._oTableProvider=new m({entitySet:i,ignoredFields:g1,initiallyVisibleFields:this.getInitiallyVisibleFields(),isEditableTable:this.getEditable(),smartTableId:this.getId(),isAnalyticalTable:!!this._isAnalyticalTable,isMobileTable:!!this._isMobileTable,dateFormatSettings:this.data("dateFormatSettings"),useUTCDateTime:this.data("useUTCDateTime"),currencyFormatSettings:this.data("currencyFormatSettings"),defaultDropDownDisplayBehaviour:this.data("defaultDropDownDisplayBehaviour"),useSmartField:this.data("useSmartField"),useSmartToggle:this.data("useSmartToggle"),skipAnnotationParse:this.data("skipAnnotationParse"),lineItemQualifier:this.data("lineItemQualifier"),presentationVariantQualifier:this.data("presentationVariantQualifier"),enableInResultForLineItem:this.data("enableInResultForLineItem"),_semanticKeyAdditionalControl:this.getAggregation("semanticKeyAdditionalControl"),model:e,semanticObjectController:this.getSemanticObjectController()});}};f1.prototype._listenToSmartFilter=function(){var e,i,g1=false;e=this.getSmartFilterId();this._oSmartFilter=this._findControl(e,"sap.ui.comp.filterbar.FilterBar");if(this._oSmartFilter){this._oSmartFilter.attachSearch(this._reBindTable,this);this._oSmartFilter.attachFilterChange(this._filterChangeEvent,this);g1=true;}i=this.getInitialNoDataText();if(i){g1=i==="$FILTERBAR";if(!g1&&i!=="$NO_FILTERBAR"){this._setNoDataText(i);return;}}if(g1){this._setNoDataText(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA"));}else{this._setNoDataText(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR"));}};f1.prototype._filterChangeEvent=function(){if(this._isTableBound()&&this._oSmartFilter&&!this._oSmartFilter.getLiveMode()&&!this._oSmartFilter.isDialogOpen()){this._showOverlay(true);}};f1.prototype._showOverlay=function(e){if(e){var i={show:true};this.fireShowOverlay({overlay:i});e=i.show;}this._oTable.setShowOverlay(e);};f1.prototype._findControl=function(i,e){var g1,h1;if(i){g1=C.byId(i);if(!g1||!g1.isA(e)){h1=this._getView();if(h1){g1=h1.byId(i);}}if(g1&&!g1.isA(e)){g1=undefined;}}return g1;};f1.prototype._getView=function(){if(!this._oView){var e=this.getParent();while(e){if(e.isA("sap.ui.core.mvc.View")){this._oView=e;break;}e=e.getParent();}}return this._oView;};f1.prototype.rebindTable=function(e){this._reBindTable(null,e);};f1.prototype._reBindTable=function(e,g1){var h1,i1,j1,i,k1,l1,m1=[],n1,o1,p1,q1,r1,s1,t1,u1={},v1={preventTableBind:false};j1=this._getTablePersonalisationData()||{};n1=j1.filters;o1=j1.excludeFilters;t1=j1.sorters;if(this._oSmartFilter){l1=this._oSmartFilter.getFilters();u1=this._oSmartFilter.getParameters()||{};}if(l1&&l1.length){if(o1){m1=[new p([l1[0],o1],true)];}else{m1=l1;}}else if(o1){m1=[o1];}if(n1){n1=m1.concat(n1);}else{n1=m1;}p1=this._getRequestAtLeastFields();r1=this._getRelevantColumnPaths();q1=r1["select"];if(!q1||!q1.length){q1=p1;}else{k1=p1.length;for(i=0;i<k1;i++){if(q1.indexOf(p1[i])<0){q1.push(p1[i]);}}}if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.select){this._mSelectExpandForGroup.select.forEach(function(y1){if(q1.indexOf(y1)<0){q1.push(y1);}});}if(q1.length){u1["select"]=q1.toString();s1=r1["expand"]||[];if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.expand){this._mSelectExpandForGroup.expand.forEach(function(y1){if(s1.indexOf(y1)<0){s1.push(y1);}});}if(s1.length){u1["expand"]=s1.join(",");}}u1["useBatchRequests"]=true;if(!t1){t1=[];}v1.filters=n1;v1.sorter=t1;v1.parameters=u1;v1.length=undefined;v1.startIndex=undefined;v1.events={};this.fireBeforeRebindTable({bindingParams:v1});if(!v1.preventTableBind){t1=v1.sorter;n1=v1.filters;u1=v1.parameters;q1=v1.parameters["select"];if(!q1||!q1.length){d.error(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}i1=this.getTableBindingPath()||("/"+this.getEntitySet());if(this._oTable.resumeUpdateAnalyticalInfo){this._oTable.resumeUpdateAnalyticalInfo(true,false);}this._bDataLoadPending=true;this._bIgnoreChange=false;if(this._bForceTableUpdate){g1=true;this._bForceTableUpdate=false;}if(!g1){h1=this._oTable.getBinding(this._sAggregation);if(h1&&h1.mParameters){g1=!(I(u1,h1.mParameters,true)&&I(u1.custom,h1.mParameters.custom)&&!v1.length&&!v1.startIndex&&i1===h1.getPath());}}if(!this._bNoDataUpdated){this._bNoDataUpdated=true;this._setNoDataText();}if(!h1||!this._bIsTableBound||g1){f1._addBindingListener(v1,"change",this._onBindingChange.bind(this));f1._addBindingListener(v1,"dataRequested",this._onDataRequested.bind(this));f1._addBindingListener(v1,"dataReceived",this._onDataReceived.bind(this));if(this._isMobileTable){var w1=this._oTable?this._oTable.getColumns():[];var x1=this._oTemplate?this._oTemplate.getCells():[];if(w1.length===x1.length){w1.forEach(function(y1,z1){x1[z1].setBindingContext(y1.getVisible()?undefined:null);});}}this._oTable.bindRows({path:i1,filters:n1,sorter:t1,parameters:u1,length:v1.length,startIndex:v1.startIndex,template:this._oTemplate,events:v1.events});this._bIsTableBound=true;}else{h1.sort(t1);h1.filter(n1,"Application");}this._showOverlay(false);}};f1.prototype._onDataRequested=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=true;this.fireDataRequested(e.getParameters());};f1.prototype._onDataReceived=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=false;this._onDataLoadComplete(e,true);this.fireDataReceived(e);};f1.prototype._onBindingChange=function(e){if(this._bIgnoreChange){return;}var i,g1=false;i=(e&&e.getParameter)?e.getParameter("reason"):undefined;if(!i||i==="filter"||i==="context"||(!this._bDataLoadPending&&i==="change")){g1=true;}if(i==="change"||g1){this._onDataLoadComplete(e,g1);}};f1._addBindingListener=function(e,i,g1){if(!e.events){e.events={};}if(!e.events[i]){e.events[i]=g1;}else{var h1=e.events[i];e.events[i]=function(){g1.apply(this,arguments);h1.apply(this,arguments);};}};f1.prototype._onDataLoadComplete=function(e,i){if(this._bDataLoadPending||i){this._bDataLoadPending=false;this.updateTableHeaderState();}};f1.prototype._isTableBound=function(){if(this._bIsTableBound){return true;}if(this._oTable){return this._oTable.isBound(this._sAggregation);}return false;};f1.prototype.setNoData=function(e){this._oNoData=e;if(this._bNoDataUpdated||this._isTableBound()){this._setNoDataText();}return this;};f1.prototype.getNoData=function(){return this._oNoData;};f1.prototype._setNoDataText=function(e){var i=this._oTable.setNoData;if(!i){i=this._oTable.setNoDataText;}if(!i){return;}var g1=e;if(!g1){g1=this.getNoData();}if(!g1){g1=C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_RESULTS");}i.call(this._oTable,g1,true);};f1.prototype.updateTableHeaderState=function(){this._refreshHeaderText();this._setExcelExportEnableState();};f1.prototype._createContent=function(){var i,e=0,g1,h1,i1,j1=[];if(this._aExistingColumns&&this._aExistingColumns.length){this._aColumnKeys=[].concat(this._aExistingColumns.reverse());}h1=this._parseIndexedColumns();e=this._aTableViewMetadata.length;for(i=0;i<e;i++){g1=this._aTableViewMetadata[i];if(g1.isInitiallyVisible){this._aColumnKeys.push(g1.name);}else{j1.push(g1.name);}if(!(g1.isInitiallyVisible||g1.inResult)){this._mLazyColumnMap[g1.name]=g1;}else{i1=this._createColumnForField(g1);this._oTable.addColumn(i1);}this._mFieldMetadataByKey[g1.name]=g1;}this._insertIndexedColumns(h1);this._aColumnKeys=this._aColumnKeys.concat(j1);this._updateColumnsPopinFeature();this._storeInitialColumnSettings();};f1.prototype._createColumnForField=function(e){var i,g1;g1=this.getId()+"-"+e.name.replace(/[^A-Za-z0-9_.:-]+/g,"_");i=this._createColumn(e,g1);e.isColumnCreated=true;i.data("p13nData",{columnKey:e.name,leadingProperty:e.name,additionalProperty:e.additionalProperty,navigationProperty:e.navigationProperty,sortProperty:e.sortable?e.name:undefined,filterProperty:e.filterable?e.name:undefined,isGroupable:e.sortable&&e.filterable&&e.aggregationRole==="dimension",fullName:e.hasValueListAnnotation?e.fullName:null,type:e.filterType,typeInstance:e.modelType,maxLength:e.maxLength,precision:e.precision,scale:e.scale,align:e.align,edmType:e.type,displayBehaviour:e.displayBehaviour,description:e.description,isDigitSequence:e.isDigitSequence,isCurrency:e.isCurrencyField,unit:e.unit,width:e.width,aggregationRole:e.aggregationRole,nullable:e.nullable!=="false"});if(e.filterable&&i.setFilterProperty){i.setFilterProperty(e.name);}if(e.sortable&&i.setSortProperty){i.setSortProperty(e.name);}this._registerContentTemplateEvents(e.template);return i;};f1.prototype._parseIndexedColumns=function(){var i,e,g1,h1,i1,j1,k1,l1,m1;var n1=this._oTable.getColumns();var o1=null;if(this._oTemplate&&this._oTemplate.getCells){o1=this._oTemplate.getCells();}if(!n1){return null;}h1=[];e=n1.length;for(i=0;i<e;i++){g1=n1[i];i1=g1.data("p13nData");j1=null;k1=null;if(i1){j1=i1.columnIndex;k1=i1.columnKey;}l1=-1;if(j1!==null&&j1!==undefined){l1=parseInt(j1);}if(!isNaN(l1)&&l1>-1){if(o1){m1=o1[i];this._oTemplate.removeCell(m1);}else{m1=null;}this._aColumnKeys.splice(i-h1.length,1);h1.push({index:l1,columnKey:k1,column:g1,template:m1});this._oTable.removeColumn(g1);}}h1.sort(function(p1,q1){return p1.index-q1.index;});return h1;};f1.prototype._insertIndexedColumns=function(e){var i,g1,h1;if(!e){return;}g1=e.length;for(i=0;i<g1;i++){h1=e[i];this._aColumnKeys.splice(h1.index,0,h1.columnKey);this._oTable.insertColumn(h1.column,h1.index);if(h1.template){this._oTemplate.insertCell(h1.template,h1.index);}}};f1.prototype._updateColumnsPopinFeature=function(){if(!this._isMobileTable||!this.getDemandPopin()){return;}var e=this._oTable.getColumns();if(!e){return;}e=e.filter(function(l1){return l1.getVisible();});e.sort(function(l1,m1){return l1.getOrder()-m1.getOrder();});var g1,h1,i1=0,j1=e.length,k1=parseFloat(M.BaseFontSize);for(var i=0;i<j1;i++){g1=e[i];h1=g1.getWidth();if(h1&&h1.endsWith("px")){h1=parseFloat(h1)/k1;}else if(h1&&(h1.endsWith("rem")||h1.endsWith("em"))){h1=parseFloat(h1);}else{h1=10;}i1=i1+h1;if(i<2){g1.setDemandPopin(false);g1.setMinScreenWidth("1px");}else{g1.setDemandPopin(true);if(g1.getPopinDisplay()!="WithoutHeader"){g1.setPopinDisplay("Inline");}g1.setMinScreenWidth(i1+"rem");}}};f1.prototype._storeInitialColumnSettings=function(){this._aInitialSorters=[];P.createSort2Json(this._oTable,this._aInitialSorters,P.createArrayFromString(this.getIgnoreFromPersonalisation()));};f1.prototype._deactivateColumnsPopinFeature=function(){if(!this._isMobileTable){return;}var e=this._oTable.getColumns();if(!e){return;}var g1,h1=e.length;for(var i=0;i<h1;i++){g1=e[i];g1.setDemandPopin(false);g1.setMinScreenWidth("1px");}};f1.prototype._registerContentTemplateEvents=function(e){if(e.isA("sap.ui.comp.SmartToggle")){e=e.getEdit();}if(e&&e.attachChange){e.attachChange(function(i){this.fireFieldChange({changeEvent:i});},this);}};f1.prototype._updateInitialColumns=function(){var i=this._oTable.getColumns(),g1=i?i.length:0,h1,i1,j1;while(g1--){j1=null;h1=i[g1];if(h1){i1=h1.data("p13nData");if(typeof i1==="string"){try{i1=JSON.parse(i1);}catch(e){}if(i1){h1.data("p13nData",i1);}}if(i1){j1=i1["columnKey"];}if(j1){this._aExistingColumns.push(j1);}}}};f1.prototype._getRelevantColumnPaths=function(){var e={},g1=[],h1=[],i1=this._oTable.getColumns(),i,j1=i1?i1.length:0,k1,l1,m1,n1,o1;var p1=function(m1,q1){var r1,s1;if(m1){s1=m1.split(",");r1=s1.length;while(r1--){m1=s1[r1];if(m1&&q1.indexOf(m1)<0){q1.push(m1);}}}};for(i=0;i<j1;i++){k1=i1[i];m1=null;if(k1.getVisible()||(k1.getInResult&&k1.getInResult())){if(k1.getLeadingProperty){m1=k1.getLeadingProperty();}l1=k1.data("p13nData");if(l1){if(!m1){m1=l1["leadingProperty"];}n1=l1["additionalProperty"];o1=l1["navigationProperty"];}if(m1&&g1.indexOf(m1)<0){g1.push(m1);}p1(n1,g1);p1(o1,h1);}}e["select"]=g1;e["expand"]=h1;return e;};f1.prototype._createTable=function(){var e=this.getItems(),i=e?e.length:0,g1,h1;this._sAggregation="rows";while(i--){g1=e[i];if(g1 instanceof u||g1 instanceof R){break;}g1=null;}if(g1){this._oTable=g1;if(g1 instanceof s){this._isAnalyticalTable=true;}else if(g1 instanceof R){this._isMobileTable=true;this._oTemplate=(g1.getItems()&&g1.getItems().length>0)?g1.getItems()[0]:new b();g1.removeAllItems();}else if(g1 instanceof v){this._isTreeTable=true;}this._updateInitialColumns();}else{h1=this.getId()+"-ui5table";if(this.getTableType()==="AnalyticalTable"){this._isAnalyticalTable=true;this._oTable=new s(h1,{enableCustomFilter:true});}else if(this.getTableType()==="ResponsiveTable"){this._isMobileTable=true;this._oTable=new R(h1,{growing:true});this._oTemplate=new b();}else if(this.getTableType()==="TreeTable"){this._isTreeTable=true;this._oTable=new v(h1,{selectionMode:"MultiToggle"});}else{this._oTable=new u(h1,{selectionMode:"MultiToggle"});}if(this._oTable.setVisibleRowCountMode){this._oTable.setVisibleRowCountMode("Auto");}this.insertItem(this._oTable,2);}if(!this._oTable.getLayoutData()){if(this._oTable instanceof R||(this._oTable.getVisibleRowCountMode&&this._oTable.getVisibleRowCountMode()!=="Auto")){this._oTable.setLayoutData(new k({growFactor:1,baseSize:"auto"}));}else{this._oTable.setLayoutData(new k({growFactor:1,baseSize:"0%"}));}}if(this._oTable.addAriaLabelledBy){this._oTable.addAriaLabelledBy(this.getId()+"-header");}this._oTable.addStyleClass("sapUiCompSmartTableInnerTable");this._oTable.setEnableBusyIndicator(true);this._oTable.setBusyIndicatorDelay(100);if(this._oTable.setEnableCustomFilter){this._oTable.setEnableCustomFilter(this.getEnableCustomFilter());}if(this._oTable.setShowColumnVisibilityMenu){this._oTable.setShowColumnVisibilityMenu(false);}if(this._oTable.getEnableCustomFilter&&this._oTable.getEnableCustomFilter()&&this._bIsFilterPanelEnabled){if(this._oTable.setEnableCellFilter){this._oTable.setEnableCellFilter(false);}if(this._oTable.attachCustomFilter){this._oTable.attachCustomFilter(this._onCustomFilter,this);}}if(this._isAnalyticalTable){this._createColumn=this._createAnalyticalColumn;}else if(this._isMobileTable){if(this.getUseTablePersonalisation()){this._oTable.bActiveHeaders=true;this._oTable.attachEvent("columnPress",this._onColumnPress,this);this._oTable.attachSort=function(){this.attachEvent("sort",arguments[0],arguments[1],arguments[2]);};this._oTable.detachSort=function(){this.detachEvent("sort",arguments[0],arguments[1]);};}this._sAggregation="items";this._createColumn=this._createMobileColumn;this._oTable.bindRows=this._oTable.bindItems;}if(!this._isMobileTable){this._oTable.attachEvent("_rowsUpdated",function(){this._setExcelExportEnableState();},this);}if(this._oTable._setLargeDataScrolling){this._oTable._setLargeDataScrolling(true);}this._oTable.attachPaste(this._onInnerTablePaste,this);};f1.prototype._createResponsivePopover=function(){this._oFilterButton=new X({text:C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_RP_FILTER"),icon:"sap-icon://filter",press:[function(e){this._onCustomFilter(e);},this]});this._oSortButton=new Y({sort:[function(e){this._onCustomSort(e);},this]});this._oColumnHeaderPopover=new W({items:[this._oSortButton,this._oFilterButton]});};f1.prototype._onColumnPress=function(e){this._oColumnClicked=e.getParameter("column");var i=this._oColumnClicked.data("p13nData");if(!i){return;}var g1=i.filterProperty;var h1=i.sortProperty;if(!this._oColumnHeaderPopover){this._createResponsivePopover();}this._oFilterButton.setVisible(!!g1&&this._bIsFilterPanelEnabled);this._oSortButton.setVisible(!!h1);if((g1&&this._bIsFilterPanelEnabled)||h1){this._oColumnHeaderPopover.removeAllAriaLabelledBy();this._oColumnHeaderPopover.addAriaLabelledBy(this._oColumnClicked.getHeader());this._oColumnHeaderPopover.openBy(this._oColumnClicked);}};f1.prototype._onCustomSort=function(){var e=this._oColumnClicked.data("p13nData");if(e){if(!e.sorted){e.sorted={"ascending":true};this._oColumnClicked.data("p13nData",e);}else{e.sorted.ascending=!e.sorted.ascending;}}var i=e.sorted;var g1=i&&i.ascending;this._oTable.fireEvent("sort",{column:this._oColumnClicked,sortOrder:g1?d1.Ascending:d1.Descending,columnAdded:false});};f1.prototype._onCustomFilter=function(e){this._showTableFilterDialog(e.getParameter("column")||this._oColumnClicked);};f1.prototype.getTable=function(){return this._oTable;};f1.prototype._showTableFilterDialog=function(e){if(this._oPersController&&e){this._oPersController.openDialog({filter:{visible:true,payload:{column:e}}});}};f1.prototype._createColumn=function(e,i){var g1;g1=new t(i,{autoResizable:true,hAlign:e.align,width:e.width,visible:e.isInitiallyVisible,label:new L(i+"-header",{textAlign:e.align,text:e.label}),sorted:e.sorted,sortOrder:e.sortOrder,tooltip:e.quickInfo,showSortMenuEntry:e.sortable,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,name:e.fieldName,template:e.template});return g1;};f1.prototype._createAnalyticalColumn=function(e,i){var g1;if(e.aggregationRole!=="measure"&&e.isMeasureField&&e.unit&&e.template.addStyleClass){e.template.addStyleClass("sapUiAnalyticalTableSumCellHidden sapUiAnalyticalTableGroupCellHidden");}else if(e.isCurrencyField&&e.template.addStyleClass){e.template.addStyleClass("sapUiCompCurrencyBold");}g1=new A(i,{autoResizable:true,hAlign:e.align,width:e.width,visible:e.isInitiallyVisible,inResult:e.inResult,label:new L(i+"-header",{textAlign:e.align,text:e.label}),tooltip:e.quickInfo,sorted:e.sorted,sortOrder:e.sortOrder,grouped:e.grouped,showIfGrouped:e.grouped,showSortMenuEntry:e.sortable,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,summed:e.summed,leadingProperty:e.name,template:e.template,groupHeaderFormatter:x.getInlineGroupFormatterFunction(e,true)});return g1;};f1.prototype._createMobileColumn=function(e,i){var g1;g1=new a(i,{hAlign:e.align,visible:e.isInitiallyVisible,header:new T(i+"-header",{textAlign:e.align,text:e.label,tooltip:e.quickInfo,wrappingType:M.WrappingType.Hyphenated}),tooltip:e.quickInfo,width:e.isImageURL?"3em":undefined});if(this._oTemplate){this._oTemplate.addCell(e.template);}return g1;};f1.prototype.fetchVariant=function(){if(this._oCurrentVariant==="STANDARD"||this._oCurrentVariant===null){return{};}return this._oCurrentVariant;};f1.prototype.applyVariant=function(e,i){this._oCurrentVariant=e;if(this._oCurrentVariant==="STANDARD"){this._oCurrentVariant=null;}this._bApplyingVariant=true;if(this._oTable._setSuppressRefresh){this._oTable._setSuppressRefresh(true);}if(this._oPersController){if(this._oCurrentVariant===null||q.isEmptyObject(this._oCurrentVariant)){this._oPersController.resetPersonalization("ResetFull");}else{this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}}this._bApplyingVariant=false;this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId()});};f1.prototype.variantsInitialized=function(){this._bVariantInitialised=true;this._checkAndTriggerBinding();};f1.prototype.getUiState=function(){var e=this._oPersController?this._oPersController.getDataSuiteFormatSnapshot():null;return new U({presentationVariant:{SortOrder:e?e.SortOrder:[],GroupBy:e?e.GroupBy:[],Total:e?e.Total:[],RequestAtLeast:this._getRequestAtLeastFields(),Visualizations:e?e.Visualizations:[]},selectionVariant:{SelectOptions:e?e.SelectOptions:[]},variantName:this.getCurrentVariantId()});};f1.prototype.setUiState=function(e){this._setUiState(e,false);};f1.prototype.setUiStateAsVariant=function(e){this._setUiState(e,true);};f1.prototype._setUiState=function(e,i){var g1=e.getPresentationVariant()&&e.getPresentationVariant().RequestAtLeast?[].concat(e.getPresentationVariant().RequestAtLeast):[];if(!I(g1,this._getRequestAtLeastFields())){this._aAlwaysSelect=g1;}if(this._oPersController){if(i){this._oPersController.setPersonalizationDataAsDataSuiteFormat(Q({},e.getPresentationVariant(),e.getSelectionVariant()),true);}else{var h1=(this._oVariantManagement&&e.getVariantName())?this._oVariantManagement.getVariantContent(this,e.getVariantName()):{};this._oPersController.setDataSuiteFormatSnapshot(Q({},e.getPresentationVariant(),e.getSelectionVariant()),h1,true);}}};f1.prototype._getRequestAtLeastFields=function(){var e=this.getRequestAtLeastFields();var i=e?e.split(","):[];return i.concat(this._aAlwaysSelect);};f1.prototype._personalisationRequestColumns=function(e){var g1=e.getParameter("columnKeys"),h1,i,i1,j1,k1,l1={};i1=g1.length;for(i=0;i<i1;i++){h1=g1[i];j1=this._mLazyColumnMap[h1];if(j1){k1=this._createColumnForField(j1);if(this._isMobileTable){this._oTable.addColumn(k1);}l1[j1.name]=k1;}}this._oPersController.addColumns(l1);};f1.prototype._beforePersonalisationModelDataChange=function(e){if(this._oTable.suspendUpdateAnalyticalInfo){this._oTable.suspendUpdateAnalyticalInfo();}};f1.prototype._afterPersonalisationModelDataChange=function(e){this._updateColumnsPopinFeature();};f1.prototype._personalisationModelDataChange=function(e){this._oCurrentVariant=e.getParameter("persistentData");var i=e.getParameter("runtimeDeltaDataChangeType");var g1=this._getChangeStatus(i);if(g1==="Unchanged"){return;}if(!(this._bApplyingVariant||this._bDeactivatingColumns)){if(!this.getUseVariantManagement()){this._persistPersonalisation();}else if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true);}}if(g1==="ModelChanged"&&this._isTableBound()){if(i&&i.columns==="ModelChanged"){this._bForceTableUpdate=true;}if(this._oSmartFilter){this._oSmartFilter.search();}else{this._reBindTable(null);}}if(this._isMobileTable){this._adaptCustomSort();}this._createInfoToolbar();};f1.prototype._adaptCustomSort=function(){if(this._oCurrentVariant){var e,i,g1,h1=[],i1;if(this._oCurrentVariant.sort&&this._oCurrentVariant.sort.sortItems){h1=this._oCurrentVariant.sort.sortItems;}this._oTable.getColumns().forEach(function(j1){e=j1.data("p13nData");i=e&&e.columnKey;if(i){g1=h1.filter(function(k1){return i===k1.columnKey;});i1=g1[0];if(i1){if(!e.sorted){e.sorted={"ascending":false};}if(i1.operation!==d1.Descending){e.sorted={"ascending":true};}j1.setSortIndicator(i1.operation);}else if(e&&e.sorted){e.sorted=null;j1.setSortIndicator(c.None);}}else if(j1.getSortIndicator()!==d1.None){j1.setSortIndicator(d1.None);}},this);}};f1.prototype.setUseInfoToolbar=function(e){this.setProperty("useInfoToolbar",e,true);this._createInfoToolbar();return this;};f1.prototype._createInfoToolbar=function(){var e=this.getUseInfoToolbar(),i=this.getTable(),g1=this.getId()+"-infoToolbarText";if(e===e1.Off){if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);i.removeAriaLabelledBy(g1);}return;}if(this._isMobileTable){if(i.getInfoToolbar()&&!this._oInfoToolbar){H.error("Custom infoToolbar is used, hence set useInfoToolbar property on the SmartTable with id='"+this.getId()+"' to Off");return;}var h1=this._oCurrentVariant&&this._oCurrentVariant.filter&&this._oCurrentVariant.filter.filterItems,i1=h1&&h1.length,j1=i.getAriaLabelledBy();if(i1){var k1=[],l1=C.getLibraryResourceBundle("sap.ui.comp"),m1=l1.getText("SMARTTABLE_FILTERED_BY")+" ";h1.forEach(function(n1){var o1=this._getColumnLabel(n1.columnKey);if(o1&&k1.indexOf(o1)===-1){k1.push(o1);}},this);m1+=k1.join(", ");if(!this._oInfoToolbar){this._oInfoToolbar=new O({active:true,design:c1.Info,content:[new T({id:g1,text:m1,wrapping:false})],press:function(){this._showTableFilterDialog(this._getColumnByKey(h1[0].columnKey));}.bind(this)});}else{this._oInfoToolbar.getContent()[0].setText(m1);if(!this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(true);}}if(!i.getInfoToolbar()){i.setInfoToolbar(this._oInfoToolbar);}if(j1.indexOf(g1)===-1){i.addAriaLabelledBy(g1);}}else if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);i.removeAriaLabelledBy(g1);}}};f1.prototype._getChangeStatus=function(e){if(!e){return"ModelChanged";}if(e.sort==="ModelChanged"||e.filter==="ModelChanged"||e.columns==="ModelChanged"||e.group==="ModelChanged"){return"ModelChanged";}if(e.sort==="TableChanged"||e.filter==="TableChanged"||e.columns==="TableChanged"||e.group==="TableChanged"){return"TableChanged";}return"Unchanged";};f1.prototype._getTablePersonalisationData=function(){this._mSelectExpandForGroup=null;if(!this._oCurrentVariant){return null;}var e=[],i=[],g1=[],h1,i1,j1,k1,l1,m1,n1,o1,p1,q1,r1={},s1={},t1="",u1;if(this._isMobileTable&&this._oCurrentVariant.group&&this._oCurrentVariant.group.groupItems){i1=this._oCurrentVariant.group.groupItems[0];if(this._aDeactivatedColumns.indexOf(i1.columnKey)<0){l1=this._getColumnByKey(i1.columnKey);if(l1){t1=l1.getHeader().getText();}q1=this._getPathFromColumnKeyAndProperty(i1.columnKey,"sortProperty");}if(q1){n1=q1;o1=null;var v1=this._mFieldMetadataByKey[i1.columnKey],w1;if(v1){o1=v1.unit||v1.description;w1=x.getInlineGroupFormatterFunction(v1);}j1=new o(n1,i1.operation==="GroupDescending",function(z1){var A1=z1.getProperty(n1),B1;if(w1){if(o1){B1=z1.getProperty(o1);}A1=w1(A1,B1);}if(A1===undefined||A1===null){A1="";}return{key:A1,text:t1?t1+": "+A1:A1};});this._mSelectExpandForGroup={select:[n1]};if(v1){if(v1.additionalProperty){this._mSelectExpandForGroup.select.push(v1.additionalProperty);}if(v1.navigationProperty){this._mSelectExpandForGroup.expand=[v1.navigationProperty];}}e.push(j1);}}if(this._oCurrentVariant.sort){k1=this._oCurrentVariant.sort.sortItems;}else{k1=this._aInitialSorters;}if(k1){k1.forEach(function(z1,A1){var B1=z1.operation==="Descending";q1=null;p1=null;if(this._aDeactivatedColumns.indexOf(z1.columnKey)<0){q1=this._getPathFromColumnKeyAndProperty(z1.columnKey,"sortProperty");}if(q1){if(j1&&j1.sPath===q1){j1.bDescending=B1;}else{var v1=this._mFieldMetadataByKey[z1.columnKey];if(!v1){l1=this._getColumnByKey(z1.columnKey);m1=l1.data("p13nData");}if(this._bMultiUnitBehaviorEnabled&&((v1&&v1.isCurrencyField)||(m1&&m1.isCurrency))){p1=v1?v1.unit:m1.unit;if(p1&&!r1[p1]){r1[p1]={index:A1,descending:B1};}}s1[q1]={};if(s1[p1]){delete r1[p1];}else if(r1[q1]){delete r1[q1];}e.push(new o(q1,B1));}}},this);var x1=Object.keys(r1),y1;if(x1.length){x1.reverse().forEach(function(z1){y1=j1?r1[z1].index+1:r1[z1].index;e.splice(y1,0,new o(z1,r1[z1].descending));});}}if(this._oCurrentVariant.filter){this._oCurrentVariant.filter.filterItems.forEach(function(z1){var A1=z1.value1,B1=z1.value2,C1;q1=null;u1=false;l1=null;if(this._aDeactivatedColumns.indexOf(z1.columnKey)<0){l1=this._getColumnByKey(z1.columnKey);}if(l1){if(l1.getFilterProperty){q1=l1.getFilterProperty();}m1=l1.data("p13nData");if(m1){u1=m1.type==="time";if(!q1){q1=m1["filterProperty"];}}}if(q1){if(u1){if(A1 instanceof Date){A1=x.getEdmTimeFromDate(A1);}if(B1 instanceof Date){B1=x.getEdmTimeFromDate(B1);}}else{var D1=m1&&m1.typeInstance&&m1.typeInstance.getName()==="sap.ui.model.odata.type.DateTimeOffset";if(A1 instanceof Date&&!D1&&this._oTableProvider&&this._oTableProvider.getIsUTCDateHandlingEnabled()){A1=D.localToUtc(A1);B1=B1?D.localToUtc(B1):B1;}}var E1=(z1.exclude?g1:i);if(z1.operation==="Empty"){var F1=z1.exclude?r.NE:r.EQ;if(m1.edmType==="Edm.String"){E1.push(new p(q1,F1,""));}if(m1.nullable){E1.push(new p(q1,F1,null));}}else{C1=z1.exclude?F.getTransformedExcludeOperation(z1.operation):z1.operation;E1.push(new p(q1,C1,A1,B1));}}},this);if(g1.length){h1=new p(g1,true);}}return{filters:i,excludeFilters:h1,sorters:e};};f1.prototype._getColumnByKey=function(e){var g1,h1,i1,i,j1;if(this._oTable){g1=this._oTable.getColumns();i1=g1.length;for(i=0;i<i1;i++){h1=g1[i];j1=h1.data("p13nData");if(j1&&j1.columnKey===e){return h1;}}}return null;};f1.prototype._getPathFromColumnKeyAndProperty=function(e,i){var g1=null,h1,i1;h1=this._getColumnByKey(e);if(h1){if(i=="sortProperty"&&h1.getSortProperty){g1=h1.getSortProperty();}else if(i=="filterProperty"&&h1.getFilterProperty){g1=h1.getFilterProperty();}else if(i=="leadingProperty"&&h1.getLeadingProperty){g1=h1.getLeadingProperty();}if(!g1){i1=h1.data("p13nData");if(i1){g1=i1[i];}}}return g1;};f1.prototype._persistPersonalisation=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){var e=this.getCurrentVariantId();if(!this._bSaving){this._bSaving=true;this._oVariantManagement.fireSave({name:"Personalisation",implicit:true,global:false,overwrite:!!e,key:e,def:true});delete this._bSaving;}}};f1.prototype.getCurrentVariantId=function(){return this._oVariantManagement?this._oVariantManagement.getCurrentVariantId():"";};f1.prototype.setCurrentVariantId=function(e){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setCurrentVariantId(e);}else{H.error("sap.ui.comp.smarttable.SmartTable.prototype.setCurrentVariantId: VariantManagement does not exist, or is a page variant");}return this;};f1.prototype.isInitialised=function(){return!!this.bIsInitialised;};f1.prototype._aAvailablePanels=["Columns","Sort","Filter","Group"];f1.prototype.openPersonalisationDialog=function(e){if(!e||this._aAvailablePanels.indexOf(e)<0){H.warning("sap.ui.comp.smarttable.SmartTable.prototype.openPersonalisationDialog: "+e+" is not a valid panel!");return;}if(this._oPersController){var i={};i[e.toLowerCase()]={visible:true};this._oPersController.openDialog(i);}};f1.prototype.deactivateColumns=function(e){this._aDeactivatedColumns=e||[];this._bDeactivatingColumns=true;if(this._oPersController){this._oPersController.addToSettingIgnoreColumnKeys(e);}this._bDeactivatingColumns=false;};f1.prototype._onInnerTablePaste=function(e){if(!this.hasListeners("beforePaste")&&!this.hasListeners("paste")){return;}var i=e.getParameter("data");var g1=i.slice(0);var h1=this._getColumnInfoForPaste();if(this.fireBeforePaste({columnInfos:h1})){sap.ui.require(["sap/ui/core/util/PasteHelper"],function(i1){i1.parse(g1,h1).then(function(j1){this.firePaste({result:j1});}.bind(this));}.bind(this));}};f1.prototype._getColumnInfoForPaste=function(){var e=[],g1=this._oTable.getColumns(),i,h1=g1.length,i1,j1,k1,l1,m1,n1;if(this._isMobileTable&&g1.length){g1=g1.sort(function(o1,p1){return o1.getOrder()-p1.getOrder();});}for(i=0;i<h1;i++){i1=g1[i];k1=null;n1=null;if(i1.getVisible()){if(i1.getLeadingProperty){k1=i1.getLeadingProperty();}j1=i1.data("p13nData");if(!k1&&j1){k1=j1["leadingProperty"];}l1=j1.type==="numeric"?"number":j1.type;m1=j1["typeInstance"];if(j1.isCurrency||l1==="number"){n1=j1.unit;}else if(j1.description&&j1.displayBehaviour!=="idOnly"){n1=j1.description;}}e.push({columnId:i1.getId(),property:k1,ignore:!k1,type:m1});m1=B.getType("Edm.String");if(n1){e.push({columnId:i1.getId(),additionalProperty:true,property:n1,type:m1});}}return e;};f1.prototype.exit=function(){var i,e;this.detachEvent("_change",this._onPropertyChange,this);if(this._oSmartFilter){this._oSmartFilter.detachSearch(this._reBindTable,this);this._oSmartFilter.detachFilterChange(this._filterChangeEvent,this);this._oSmartFilter=null;}if(this._oTableProvider&&this._oTableProvider.destroy){this._oTableProvider.destroy();}this._oTableProvider=null;if(this._oPersController&&this._oPersController.destroy){this._oPersController.destroy();}this._oPersController=null;if(this._oVariantManagement){this._oVariantManagement.detachSave(this._variantSaved,this);this._oVariantManagement.detachAfterSave(this._variantAfterSave,this);if(!this._oVariantManagement.isPageVariant()&&this._oVariantManagement.destroy){this._oVariantManagement.destroy();}}this._oNumberFormatInstance=null;y.cleanUpFullScreen(this);if(this._oEditModel){this._oEditModel.destroy();}if(this._oNoData&&this._oNoData.destroy){this._oNoData.destroy();}this.oNoData=null;if(this._aTableViewMetadata){i=this._aTableViewMetadata.length;while(i--){e=this._aTableViewMetadata[i];if(e&&!e.isColumnCreated&&e.template){e.template.destroy();}}}this._aTableViewMetadata=null;this._mFieldMetadataByKey=null;this._mSelectExpandForGroup=null;this._oEditModel=null;this._oVariantManagement=null;this._oCurrentVariant=null;this._aExistingColumns=null;this._mLazyColumnMap=null;this._aColumnKeys=null;this._aDeactivatedColumns=null;this._aAlwaysSelect=null;this._oCustomToolbar=null;if(this._oToolbar&&!this._bToolbarInsertedIntoItems){this._oToolbar.destroy();}this._oToolbar=null;if(this._oUseExportToExcel&&!this.getUseExportToExcel()){this._oUseExportToExcel.destroy();}this._oUseExportToExcel=null;this._oTablePersonalisationButton=null;this._oP13nDialogSettings=null;if(this._oTemplate){this._oTemplate.destroy();}this._oTemplate=null;this._InterceptService=null;if(this._oColumnHeaderPopover){this._oColumnHeaderPopover.destroy();}this._oColumnHeaderPopover=null;this._oFilterButton=null;this._oSortButton=null;this._oInfoToolbar=null;this._oView=null;this._oTable=null;};return f1;});
