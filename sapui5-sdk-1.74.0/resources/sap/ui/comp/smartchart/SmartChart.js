/*
 * ! SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
if(sap.ui&&sap.ui.performance&&sap.ui.performance.Measurement&&sap.ui.performance.Measurement.getActive()){sap.ui.performance.Measurement.start("SmartChartInit","Measurement of SmartChart init time");}sap.ui.define(['jquery.sap.global','sap/ui/comp/library','sap/ui/comp/util/DateTimeUtil','sap/m/Button','sap/m/Text','sap/m/FlexItemData','sap/m/OverflowToolbar','sap/m/OverflowToolbarButton','sap/m/OverflowToolbarToggleButton','sap/m/ToolbarSeparator','sap/m/ToolbarSpacer','sap/m/FlexBox','sap/m/VBox','sap/ui/comp/providers/ChartProvider','sap/ui/comp/smartfilterbar/FilterProvider','sap/ui/comp/smartvariants/SmartVariantManagement','sap/ui/comp/smartvariants/PersonalizableInfo','sap/ui/model/json/JSONModel','sap/ui/model/Sorter','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/comp/personalization/Util','sap/ui/Device','sap/ui/comp/odata/ODataModelUtil','sap/ui/comp/odata/MetadataAnalyser','sap/ui/comp/state/UIState','sap/m/SelectionDetails','sap/m/SelectionDetailsItem','sap/m/SelectionDetailsItemLine','sap/m/Title','sap/ui/comp/util/FormatUtil','sap/ui/comp/navpopover/NavigationPopoverHandler','sap/ui/core/InvisibleText','sap/m/OverflowToolbarLayoutData','sap/m/library','sap/ui/comp/personalization/Controller','sap/ui/comp/personalization/ChartWrapper','sap/ui/comp/navpopover/SemanticObjectController','sap/ui/performance/Measurement','sap/base/Log','sap/base/util/merge'],function(q,c,D,B,T,F,O,d,f,g,h,j,V,C,k,S,P,J,m,o,p,r,s,t,M,U,u,v,w,x,y,N,I,z,A,E,G,H,K,L,Q){"use strict";var R=A.ToolbarDesign;var W=A.ListMode;var X=A.ListType;var Y=A.PlacementType;var Z=c.personalization.ChangeType;var $=c.personalization.ResetType;var _;var a1;var b1;var c1;var d1;var e1;var f1;var g1;var h1;var i1;var j1;var k1;var l1;var m1;var n1;var o1;var p1=V.extend("sap.ui.comp.smartchart.SmartChart",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartchart/SmartChart.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null},ignoredFields:{type:"string",group:"Misc",defaultValue:null},requestAtLeastFields:{type:"string",group:"Misc",defaultValue:null},ignoreFromPersonalisation:{type:"string",group:"Misc",defaultValue:null},chartType:{type:"string",group:"Misc",defaultValue:null},ignoredChartTypes:{type:"string",group:"Misc",defaultValue:null},useVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},useChartPersonalisation:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},persistencyKey:{type:"string",group:"Misc",defaultValue:null},currentVariantId:{type:"string",group:"Misc",defaultValue:null},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},chartBindingPath:{type:"string",group:"Misc",defaultValue:null},showDrillButtons:{type:"boolean",group:"Misc",defaultValue:true},showZoomButtons:{type:"boolean",group:"Misc",defaultValue:true},showSemanticNavigationButton:{type:"boolean",group:"Misc",defaultValue:true},showVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},showDownloadButton:{type:"boolean",group:"Misc",defaultValue:false},showDetailsButton:{type:"boolean",group:"Misc",defaultValue:false},showDrillBreadcrumbs:{type:"boolean",group:"Misc",defaultValue:false},showChartTooltip:{type:"boolean",group:"Misc",defaultValue:true},showLegendButton:{type:"boolean",group:"Misc",defaultValue:true},legendVisible:{type:"boolean",group:"Misc",defaultValue:true},selectionMode:{type:"sap.ui.comp.smartchart.SelectionMode",group:"Misc",defaultValue:sap.ui.comp.smartchart.SelectionMode.Multi},showFullScreenButton:{type:"boolean",group:"Misc",defaultValue:true},useTooltip:{type:"boolean",group:"Misc",defaultValue:true},useListForChartTypeSelection:{type:"boolean",group:"Misc",defaultValue:true},showChartTypeSelectionButton:{type:"boolean",group:"Misc",defaultValue:true},noData:{type:"string",group:"Misc",defaultValue:null},showToolbar:{type:"boolean",group:"Misc",defaultValue:true},toolbarStyle:{type:"sap.m.ToolbarStyle",group:"Appearance"},showDimensionsTitle:{type:"boolean",group:"Misc",defaultValue:true},showMeasuresTitle:{type:"boolean",group:"Misc",defaultValue:true}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},aggregations:{toolbar:{type:"sap.m.Toolbar",multiple:false},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false},selectionDetailsItemActions:{type:"sap.ui.core.Item",multiple:true},selectionDetailsActions:{type:"sap.ui.core.Item",multiple:true},selectionDetailsActionGroups:{type:"sap.ui.core.Item",multiple:true}},events:{initialise:{},initialized:{},beforeRebindChart:{},dataReceived:{},afterVariantInitialise:{},afterVariantSave:{parameters:{currentVariantId:{type:"string"}}},afterVariantApply:{parameters:{currentVariantId:{type:"string"}}},showOverlay:{},fullScreenToggled:{parameters:{fullScreen:{type:"boolean"}}},selectionDetailsActionPress:{parameters:{action:{type:"sap.ui.core.Item"},itemContexts:{type:"sap.ui.model.Context"},level:{type:"sap.m.SelectionDetailsActionLevel"}}},chartDataChanged:{parameters:{changeTypes:{type:"object"}}}}},renderer:{apiVersion:2}});p1.prototype.init=function(){j.prototype.init.call(this);this.addStyleClass("sapUiCompSmartChart");this.setFitContainer(true);this._bUpdateToolbar=true;this._oChartTypeModel=null;var a=new J({items:[]});this.setModel(a,"$smartChartTypes");this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");if(!this.getLayoutData()){this.setLayoutData(new F({growFactor:1,baseSize:"auto"}));}};p1.prototype._getVariantManagementControl=function(a){var b=null;if(a){if(typeof a==='string'){b=sap.ui.getCore().byId(a);}else{b=a;}if(b){if(!(b instanceof S)){L.error("Control with the id="+typeof a.getId=="function"?a.getId():a+" not of expected type");return null;}}}return b;};p1.prototype._createVariantManagementControl=function(){if(this._oVariantManagement||(!this.getUseVariantManagement()&&!this.getUseChartPersonalisation())||!this.getPersistencyKey()){return;}var a=new P({type:"chart",keyName:"persistencyKey",dataSource:this.getEntitySet()});a.setControl(this);var b=this.getSmartVariant();if(b){this._oVariantManagement=this._getVariantManagementControl(b);}else if(this._oSmartFilter&&this._oSmartFilter.data("pageVariantPersistencyKey")){b=this._oSmartFilter.getSmartVariant();if(b){this._oVariantManagement=this._getVariantManagementControl(b);}}else{this._oVariantManagement=new S(this.getId()+"-variant",{showShare:true});}if(this._oVariantManagement){if(!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(this.getShowVariantManagement());}this._oVariantManagement.addPersonalizableControl(a);this._oVariantManagement.attachSave(this._variantSaved,this);this._oVariantManagement.attachAfterSave(this._variantAfterSave,this);this._oVariantManagement.initialise(this._variantInitialised,this);}};p1.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD";}this.fireAfterVariantInitialise();if(this._oVariantManagement&&!this._oVariantManagement.getEnabled()){this._checkAndTriggerBinding();}};p1.prototype._variantSaved=function(){if(this._oPersController){this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}};p1.prototype._variantAfterSave=function(){this.fireAfterVariantSave({currentVariantId:this.getCurrentVariantId()});};p1.prototype.setUseChartPersonalisation=function(b){this.setProperty("useChartPersonalisation",b,true);this._bUpdateToolbar=true;return this;};p1.prototype.setUseTooltip=function(b){this.setProperty("useTooltip",b,true);this._createTooltipOrPopover();return this;};p1.prototype._createTooltipOrPopover=function(){if(this.getUseTooltip()&&this.getShowChartTooltip()){this._toggleChartTooltipVisibility(true);}else{this._createPopover();}};p1.prototype._createPopover=function(){if(this._oChart){if(!f1&&!this._bVizPopoverRequested){f1=sap.ui.require("sap/viz/ui5/controls/Popover");if(!f1){sap.ui.require(["sap/viz/ui5/controls/Popover"],q1.bind(this));this._bVizPopoverRequested=true;}}if(!this._oPopover&&f1&&!this._oChart._getVizFrame()._connectPopover){this._oPopover=new f1({});}if(this._oPopover){this._oPopover.connect(this._oChart.getVizUid());}}};function q1(a){f1=a;this._bVizPopoverRequested=false;if(!this._bIsBeingDestroyed){this._createPopover();}}p1.prototype._destroyPopover=function(){if(this._oPopover){this._oPopover.destroy();this._oPopover=null;}};p1.prototype.setUseVariantManagement=function(b){this.setProperty("useVariantManagement",b,true);if(this._oPersController){this._oPersController.setResetToInitialTableState(!b);}this._bUpdateToolbar=true;return this;};p1.prototype.setToolbar=function(a){if(this._oToolbar){this.removeItem(this._oToolbar);}this._oToolbar=a;this._bUpdateToolbar=true;this._oToolbar.setVisible(this.getShowToolbar());this._oToolbar.setStyle(this.getToolbarStyle());return this;};p1.prototype.getToolbar=function(){return this._oToolbar;};p1.prototype.setHeader=function(a){this.setProperty("header",a,true);this._refreshHeaderText();return this;};p1.prototype._refreshHeaderText=function(){if(!this._headerText){this._bUpdateToolbar=true;return;}var a=this.getHeader();this._headerText.setText(a);};p1.prototype._createToolbar=function(){if(!this._oToolbar){this._oToolbar=new O({design:R.Transparent});this._oToolbar.addStyleClass("sapUiCompSmartChartToolbar");this._oToolbar.addStyleClass("sapMTBHeader-CTX");}this._oToolbar.setLayoutData(new F({shrinkFactor:0}));this.insertItem(this._oToolbar,0);this._oToolbar.setVisible(this.getShowToolbar());this._oToolbar.setStyle(this.getToolbarStyle());};p1.prototype._createToolbarContent=function(){this._addVariantManagementToToolbar();this._addSeparatorToToolbar();this._addHeaderToToolbar();this._addSpacerToToolbar();this._addSemanticNavigationButton();this._addDetailsButton();this._addDrillUpDownButtons();this._addLegendButton();this._addZoomInOutButtons();this._addDownloadButton();this._addPersonalisationToToolbar();this._addFullScreenButton();this._addChartTypeToToolbar();if(this._oToolbar&&(this._oToolbar.getContent().length===0||(this._oToolbar.getContent().length===1&&this._oToolbar.getContent()[0]instanceof h))){this.removeItem(this._oToolbar);this._oToolbar.destroy();this._oToolbar=null;}};p1.prototype.setShowVariantManagement=function(b){this.setProperty("showVariantManagement",b);if(this._oVariantManagement&&this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(b);}return this;};p1.prototype.setShowDetailsButton=function(b){this.setProperty("showDetailsButton",b);if(this._oSelectionDetails){this._oSelectionDetails.setVisible(b);if(this._oDrillDownTextButton){this._oDrillDownTextButton.setVisible(b);}this._setBehaviorTypeForDataSelection();}if(this._oDrillDownButton){this._oDrillDownButton.setVisible(!b);}return this;};p1.prototype.setShowChartTypeSelectionButton=function(b){this.setProperty("showChartTypeSelectionButton",b);if(this._oChartTypeButton){this._oChartTypeButton.setVisible(b);}return this;};p1.prototype.setShowDownloadButton=function(b){this.setProperty("showDownloadButton",b);if(this._oDownloadButton){this._oDownloadButton.setVisible(b);}return this;};p1.prototype.setShowDrillBreadcrumbs=function(b){this.setProperty("showDrillBreadcrumbs",b);if(this._oDrillBreadcrumbs){this._oDrillBreadcrumbs.setVisible(b);}if(this._oDrillUpButton){this._oDrillUpButton.setVisible(!b);}return this;};p1.prototype.setShowChartTooltip=function(b){this.setProperty("showChartTooltip",b);this._toggleChartTooltipVisibility(b);return this;};p1.prototype._setBehaviorTypeForDataSelection=function(){if(this.getShowDetailsButton()){this._oChart.setVizProperties({"interaction":{"behaviorType":"noHoverBehavior"}});}else if(this._oChart.getVizProperties().interaction.behaviorType){var i=this._oChart.getVizProperties().interaction;delete i.behaviorType;this._oChart.setVizProperties({"interaction":i});}};p1.prototype._addDrillBreadcrumbs=function(){if(!this._oDrillBreadcrumbs&&this.getShowDrillBreadcrumbs()){if((!h1||!i1)&&!this._bBreadcrumbsRequested){h1=sap.ui.require("sap/m/Breadcrumbs");i1=sap.ui.require("sap/m/Link");if(!h1){sap.ui.require(["sap/m/Breadcrumbs","sap/m/Link"],r1.bind(this));this._bBreadcrumbsRequested=true;}}if(this._oChart&&h1&&i1){this._oDrillBreadcrumbs=new h1(this.getId()+"-drillBreadcrumbs",{visible:this.getShowDrillBreadcrumbs()}).addStyleClass("sapUiCompSmartChartBreadcrumbs");this.insertItem(this._oDrillBreadcrumbs,1);this._updateDrillBreadcrumbs();this._oChart.attachDrilledUp(function(e){this._updateDrillBreadcrumbs();}.bind(this));this._oChart.attachDrilledDown(function(e){this._updateDrillBreadcrumbs();}.bind(this));}}};function r1(b,l){h1=b;i1=l;this._bBreadcrumbsRequested=false;if(!this._bIsBeingDestroyed){this._addDrillBreadcrumbs();}}p1.prototype.getDrillStackFilters=function(){var a=this._oChart.getDrillStack();var b=[];var e=function(i){if(!i){return;}if(i&&i.sPath&&i.sOperator){b.push(i);}if(i.aFilters){i.aFilters.forEach(function(l){e(l);});}};a.forEach(function(i){e(i.filter);});return b;};p1.prototype._getDrillStackDimensions=function(){var a=this._oChart.getDrillStack();var b=[];a.forEach(function(e){e.dimension.forEach(function(i){if(i!=null&&i!=""&&b.indexOf(i)==-1){b.push(i);}});});return b;};p1.prototype._updateDrillBreadcrumbs=function(){if(!this._oDrillBreadcrumbs){return;}var a=this._oChart.getDrillStack();var n=[];if(a){a.reverse();a.forEach(function(l,y1,z1){if(l.dimension.length>0&&typeof this._oChart.getDimensionByName(l.dimension[l.dimension.length-1])!='undefined'){if(this.getShowDrillBreadcrumbs()){this._oDrillBreadcrumbs.setVisible(true);}var A1=this._oChart.getDimensionByName(l.dimension[l.dimension.length-1]).getLabel();if(y1==0){this._oDrillBreadcrumbs.setCurrentLocationText(A1);}else{var B1=new i1({text:A1,press:function(C1){var D1=this._oDrillBreadcrumbs.indexOfLink(C1.getSource());this._oChart.drillUp(D1+1);this._oChart.fireDeselectData(C1);this._updateDrillBreadcrumbs();}.bind(this)});n.push(B1);}}else{if(y1==0){this._oDrillBreadcrumbs.setVisible(false);}}}.bind(this));}var b=this._oDrillBreadcrumbs.getLinks();n.reverse();var e=false;if(b.length!==n.length){e=true;}else{for(var i=0;i<n.length;i++){if(n[i].getText()!=b[i].getText()){e=true;break;}}}if(e){if(this._oDrillBreadcrumbs.getLinks()){this._oDrillBreadcrumbs.removeAllLinks();}for(var i=0;i<n.length;i++){this._oDrillBreadcrumbs.addLink(n[i]);}}};p1.prototype._addDetailsButton=function(){this._oSelectionDetails=new u(this.getId()+"-selectionDetails",{visible:this.getShowDetailsButton()});this._oSelectionDetails.registerSelectionDetailsItemFactory([],function(a,b,e,l){var n=[];var y1=function(z1){var z1=a[i].value;if(z1){return z1 instanceof Object?z1:z1.toString();}else{return z1;}};for(var i=0;i<a.length;i++){n.push(new w({label:a[i].label,value:y1(a[i].value),unit:a[i].unit}));}return new v({enableNav:(function(){if(this._determineSemanticObjectsforDetailsPopover(b,e).length>0){return true;}else{return false;}}.bind(this)()),lines:n}).setBindingContext(e);}.bind(this));this._oSelectionDetails.attachNavigate(function(e){if(e.getParameter("direction")==="back"){e.getParameter("content").destroy();}else{this._navigateToSemanticObjectDetails(e);}}.bind(this));this._oSelectionDetails.attachActionPress(function(e){var i=[];e.getParameter("items").forEach(function(a){i.push(a.getBindingContext());});this.fireSelectionDetailsActionPress({id:e.getParameter("id"),action:e.getParameter("action"),itemContexts:i,level:e.getParameter("level")});}.bind(this));this._oSelectionDetails.attachBeforeOpen(function(e){var a=this._oSelectionDetails.getItems();a.forEach(function(l){var b=this._getDetailsActionsClones();b.selectionDetailsItemActions.forEach(function(n){l.addAction(n);});}.bind(this));var b=this._getDetailsActionsClones().selectionDetailsActions;this._oSelectionDetails.removeAllActions();b.forEach(function(l){this._oSelectionDetails.addAction(l);}.bind(this));var i=this._getDetailsActionsClones().selectionDetailsActionGroups;this._oSelectionDetails.removeAllActionGroups();i.forEach(function(l){this._oSelectionDetails.addActionGroup(l);}.bind(this));}.bind(this));this._oSelectionDetails.attachBeforeClose(function(e){if(this._oNavigationContainer){this._oNavigationContainer.destroy();}}.bind(this));this._oToolbar.addContent(this._oSelectionDetails);this._addDrillDownTextButton();};p1.prototype._getDetailsActionsClones=function(){var a={selectionDetailsItemActions:[],selectionDetailsActions:[],selectionDetailsActionGroups:[]};this.getSelectionDetailsItemActions().forEach(function(i){a.selectionDetailsItemActions.push(i.clone());});this.getSelectionDetailsActions().forEach(function(i){a.selectionDetailsActions.push(i.clone());});this.getSelectionDetailsActionGroups().forEach(function(i){a.selectionDetailsActionGroups.push(i.clone());});return a;};p1.prototype._addDownloadButton=function(){if(!this._oDownloadButton){this._oDownloadButton=new d(this.getId()+"btnDownload",{type:"Transparent",text:this._oRb.getText("CHART_DOWNLOADBTN_TEXT"),tooltip:this._oRb.getText("CHART_DOWNLOADBTN_TOOLTIP"),icon:"sap-icon://download",visible:this.getShowDownloadButton(),enabled:false,press:function(e){if(window.navigator&&window.navigator.msSaveOrOpenBlob){var a=new window.Blob([this._getVizFrame().exportToSVGString()],{'type':"image/svg+xml"});window.navigator.msSaveOrOpenBlob(a);}else{this._downloadChartPNG();}}.bind(this)});this._oToolbar.addContent(this._oDownloadButton);}};p1.prototype._downloadChartSVG=function(){var a=this.getHeader();var b=document.createElement('a');b.setAttribute('href','data:image/svg+xml,'+encodeURIComponent(this._getVizFrame().exportToSVGString()));b.setAttribute('download',a?a:'Chart'+'.svg');b.click();};p1.prototype._downloadChartPNG=function(){var a=this.getHeader();var b=this._getVizFrame().exportToSVGString();var e=document.createElement('canvas');var i=e.getContext('2d');var l=new Image();l.width=e.width=document.getElementById(this._oChart.getId()).offsetWidth;l.height=e.height=document.getElementById(this._oChart.getId()).offsetHeight;l.onload=function(){i.drawImage(l,0,0);var n=document.createElement('a');n.setAttribute('href',e.toDataURL());n.setAttribute('download',a?a:'Chart'+'.png');n.click();};l.setAttribute('crossOrigin','anonymous');l.src='data:image/svg+xml,'+encodeURIComponent(b);};p1.prototype._addFullScreenButton=function(){var a;if(this.getShowFullScreenButton()){a=new d(this.getId()+"-btnFullScreen",{type:"Transparent",press:function(){this._toggleFullScreen(!this.bFullScreen);}.bind(this),enabled:false});this.oFullScreenButton=a;this._renderFullScreenButton();this._oToolbar.addContent(a);}};p1.prototype._addZoomInOutButtons=function(){var a=this;this._oZoomInButton=new d(this.getId()+"-btnZoomIn",{type:"Transparent",text:this._oRb.getText("CHART_ZOOMINBTN_TEXT"),tooltip:this._oRb.getText("CHART_ZOOMINBTN_TOOLTIP"),icon:"sap-icon://zoom-in",press:function(){if(a._oChart){a._oChart.zoom({direction:"in"});this._toggleZoomButtonEnablement();}}.bind(this),visible:this.getShowZoomButtons(),enabled:false});this._oZoomOutButton=new d(this.getId()+"-btnZoomOut",{type:"Transparent",text:this._oRb.getText("CHART_ZOOMOUTBTN_TEXT"),tooltip:this._oRb.getText("CHART_ZOOMOUTBTN_TOOLTIP"),icon:"sap-icon://zoom-out",press:function(){if(a._oChart){a._oChart.zoom({direction:"out"});this._toggleZoomButtonEnablement();}}.bind(this),visible:this.getShowZoomButtons(),enabled:false});this._oToolbar.addContent(this._oZoomInButton);this._oToolbar.addContent(this._oZoomOutButton);};p1.prototype._toggleZoomButtonEnablement=function(){var i=this._oChart.getZoomInfo().currentZoomLevel;if(i===undefined){return;}else if(i===null){this._oZoomOutButton.setEnabled(false);this._oZoomInButton.setEnabled(false);}else if(i===0){this._oZoomInButton.focus();this._oZoomOutButton.setEnabled(false);this._oZoomInButton.setEnabled(true);}else if(i===1){this._oZoomOutButton.focus();this._oZoomInButton.setEnabled(false);this._oZoomOutButton.setEnabled(true);}else{if(this._oZoomOutButton.getEnabled()==false){this._oZoomOutButton.setEnabled(true);}if(this._oZoomInButton.getEnabled()==false){this._oZoomInButton.setEnabled(true);}}};p1.prototype.setShowZoomButtons=function(b){this.setProperty("showZoomButtons",b);if(this._oZoomInButton){this._oZoomInButton.setVisible(b);}if(this._oZoomOutButton){this._oZoomOutButton.setVisible(b);}return this;};p1.prototype.setShowFullScreenButton=function(b){this.setProperty("showFullScreenButton",b);if(this.oFullScreenButton){this.oFullScreenButton.setVisible(b);}return this;};p1.prototype.setLegendVisible=function(b){this.setProperty("legendVisible",b);this._setLegendVisible(b);return this;};p1.prototype._setLegendVisible=function(b){var a=this._getVizFrame();if(a){a.setLegendVisible(b);}};p1.prototype._getVizFrame=function(){var a=null;if(this._oChart){a=this._oChart.getAggregation("_vizFrame");}return a;};p1.prototype._addLegendButton=function(){var a=this;this._oLegendButton=new f(this.getId()+"-btnLegend",{type:"Transparent",text:this._oRb.getText("CHART_LEGENDBTN_TEXT"),tooltip:this._oRb.getText("CHART_LEGENDBTN_TOOLTIP"),icon:"sap-icon://legend",press:function(){a.setLegendVisible(!a.getLegendVisible());this.setPressed(a.getLegendVisible());},pressed:this.getLegendVisible(),visible:this.getShowLegendButton(),enabled:false});this._oToolbar.addContent(this._oLegendButton);};p1.prototype.setShowLegendButton=function(b){this.setProperty("showLegendButton",b);if(this._oLegendButton){this._oLegendButton.setVisible(b);}return this;};p1.prototype.setShowSemanticNavigationButton=function(b){this.setProperty("showSemanticNavigationButton",b);if(this._oSemanticalNavButton){this._oSemanticalNavButton.setVisible(b);}else{if(b){this._addSemanticNavigationButton();}}return this;};p1.prototype._addSemanticNavigationButton=function(){var a=this;if(!this._oSemanticalNavButton&&this.getShowSemanticNavigationButton()&&this._oToolbar){this._oSemanticalNavButton=new B(this.getId()+"-btnNavigation",{type:"Transparent",text:this._oRb.getText("CHART_SEMNAVBTN"),tooltip:this._oRb.getText("CHART_SEMNAVBTN_TOOLTIP"),visible:this.getShowSemanticNavigationButton(),enabled:false});this._oNavHandler=new N({control:this._oSemanticalNavButton,navigationTargetsObtained:function(e){var l=e.getParameters().mainNavigation;if(l){var n=e.getSource().getBindingContext().getObject();var y1=this._getField(e.getSource().getFieldName());var z1=y.getTextsFromDisplayBehaviour(y1.displayBehaviour,n[y1.name],n[y1.description]);l.setDescription(z1.secondText);e.getParameters().show(z1.firstText,l,undefined,undefined);}e.getParameters().show();}.bind(this)});var b=this.getSemanticObjectController();if(b){this._oNavHandler.setSemanticObjectController(b);}this._oSemanticalNavButton.attachPress(function(e){if(this._aSemanticObjects&&(this._aSemanticObjects.length>0)){if(this._aSemanticObjects.length===1){var l=M.getSemanticObjectsFromProperty(this._aSemanticObjects[0]);if(l){this._oNavHandler.setFieldName(this._aSemanticObjects[0].name);this._oNavHandler.setSemanticObject(l.defaultSemanticObject);this._oNavHandler.setAdditionalSemanticObjects(l.additionalSemanticObjects);this._oNavHandler.openPopover();}}else{a._semanticObjectList(this._aSemanticObjects,this._oNavHandler);}}}.bind(this));if(this._oChart){this._attachDataPointHandling();}else{this.attachInitialized(function(){this._attachDataPointHandling();}.bind(this));}var i=this._indexOfSpacerOnToolbar();this._oToolbar.insertContent(this._oSemanticalNavButton,i+1);}};p1.prototype._attachDataPointHandling=function(){if(this._oChart){this._oChart.attachDeselectData(function(){this._aSemanticObjects=this._setSelectionDataPointHandling(this._oNavHandler);}.bind(this));this._oChart.attachSelectData(function(){this._aSemanticObjects=this._setSelectionDataPointHandling(this._oNavHandler);}.bind(this));}};p1.prototype.setSelectionMode=function(a){this.setProperty("selectionMode",a);if(this._oChart){this._oChart.setSelectionMode(a);}return this;};p1.prototype._setSelectionDataPointHandling=function(n){var a=this._setSelectionDataPoint(n);if(a&&a.length>0){this._oSemanticalNavButton.setEnabled(true);}else{this._oSemanticalNavButton.setEnabled(false);}return a;};p1.prototype._setSemanticObjectsContext=function(e){var a,b,i=null;a=e.getParameter("item").getBindingContext();if(a){b=a.getObject();if(b){i=this._determineSemanticObjectsforDetailsPopover(b,a);}}return i;};p1.prototype._setSelectionDataPoint=function(n){var a,b,e=null,l;var y1=this._oChart.getSelectedDataPoints();if(!y1||!y1.dataPoints||(y1.dataPoints.length===0)){return e;}if(y1.dataPoints.length===1){a=y1.dataPoints[0].context;if(a){b=a.getObject();if(b){e=this._determineSemanticObjects(b,a);if(e&&(e.length>0)){n.setBindingContext(a);}}}return e;}l=[];for(var i=0;i<y1.dataPoints.length;i++){a=y1.dataPoints[i].context;if(a){b=a.getObject();if(b){l.push(b);}}}if(l&&l.length>0){e=this._condensBasedOnSameValue(l);if(e&&e.length>0){n.setBindingContext(y1.dataPoints[y1.dataPoints.length-1].context);}}return e;};p1.prototype._condensBasedOnSameValue=function(a){var b=null,e,l,n;b=this._determineSemanticObjects(a[0]);if(b&&b.length>0){for(var i=0;i<b.length;i++){l=b[i];n=l.name;if(this._bAllValuesAreEqual(a,n)){if(!e){e=[];}e.push(l);}}b=e;}return b;};p1.prototype._bAllValuesAreEqual=function(a,b){var e,l;for(var i=0;i<a.length;i++){e=a[i];if(i===0){l=e[b];continue;}if(l!=e[b]){return false;}}return true;};p1.prototype._semanticObjectList=function(a,n){var b,l,e,y1;if(this._oChart){if((!j1||!k1||!l1)&&!this._bSemanticObjectListRequested){j1=sap.ui.require("sap/m/ResponsivePopover");k1=sap.ui.require("sap/m/List");l1=sap.ui.require("sap/m/StandardListItem");if(!j1||!k1||!l1){sap.ui.require(["sap/m/ResponsivePopover","sap/m/List","sap/m/StandardListItem"],s1.bind(this));this._bSemanticObjectListRequested=true;this._oSemanticObjectListAttr={object:a,nav:n};}}if(!j1||!k1||!l1){return;}l=new k1({mode:W.SingleSelectMaster,selectionChange:function(z1){if(z1&&z1.mParameters&&z1.mParameters.listItem){var A1=z1.mParameters.listItem.data("semObj");if(A1){n.setFieldName(z1.mParameters.listItem.data("fieldName"));n.setSemanticObject(A1.defaultSemanticObject);n.setAdditionalSemanticObjects(A1.additionalSemanticObjects);n.openPopover();}}b.close();}});for(var i=0;i<a.length;i++){y1=a[i];e=new l1({title:y1.fieldLabel,type:X.Active});e.data("semObj",M.getSemanticObjectsFromProperty(y1));e.data("fieldName",y1.name);l.addItem(e);}b=new j1({title:this._oRb.getText("CHART_SEMNAVBTN"),showHeader:false,contentWidth:"12rem",placement:Y.Left});b.addContent(l);b.openBy(this._oSemanticalNavButton);}};function s1(a,l,b){j1=a;k1=l;l1=b;this._bSemanticObjectListRequested=false;if(!this._bIsBeingDestroyed){this._semanticObjectList(this._oSemanticObjectListAttr.object,this._oSemanticObjectListAttr.nav);}delete this._oSemanticObjectListAttr;}p1.prototype._semanticObjectListForDetails=function(a,b){var l,e,n;if(!this._oChart){return undefined;}l=new k1({mode:W.SingleSelectMaster,rememberSelections:false,itemPress:function(i){if(i&&i.mParameters&&i.mParameters.listItem){var y1=i.mParameters.listItem.data("semObj");if(y1){var z1=new N({fieldName:i.mParameters.listItem.data("fieldName"),control:i.mParameters.listItem,semanticObject:y1.defaultSemanticObject,additionalSemanticObjects:y1.additionalSemanticObjects,navigationTargetsObtained:function(i){var A1=i.getParameters().mainNavigation;if(A1){var B1=b.getObject();var C1=this._getField(i.getSource().getFieldName());var D1=y.getTextsFromDisplayBehaviour(C1.displayBehaviour,B1[C1.name],B1[C1.description]);A1.setDescription(D1.secondText);i.getParameters().show(D1.firstText,A1,undefined,undefined);}i.getParameters().show();}.bind(this)});z1._getNavigationContainer().then(function(A1){var B1=A1.getDirectLink();if(B1){z1._fireInnerNavigate({text:B1.getText(),href:B1.getHref()});window.location.href=B1.getHref();A1.destroy();return;}A1.attachBeforePopoverOpen(function(){this._oSelectionDetails.setPopoverModal(true);}.bind(this));A1.attachAfterPopoverClose(function(){this._oSelectionDetails.setPopoverModal(false);}.bind(this));this._oSelectionDetails.navTo("",A1);}.bind(this),function(A1){L.error("NavigationContainer could not be determined: "+A1);});}}}.bind(this)});H.getDistinctSemanticObjects().then(function(y1){for(var i=0;i<a.length;i++){n=a[i];if(n["com.sap.vocabularies.Common.v1.SemanticObject"]&&n["com.sap.vocabularies.Common.v1.SemanticObject"].String&&H.hasDistinctSemanticObject([n["com.sap.vocabularies.Common.v1.SemanticObject"].String],y1)){e=new l1({title:n.fieldLabel,type:X.Navigation});e.setBindingContext(b);e.data("semObj",M.getSemanticObjectsFromProperty(n));e.data("fieldName",n.name);l.addItem(e);}}});return l;};p1.prototype._determineSemanticObjects=function(e,i){var n,l,y1=[];if(e){for(n in e){if(n){l=this._getField(n);if(l&&l.isDimension&&l.isSemanticObject){y1.push(l);}}}}if(y1){y1.sort(function(a,b){return a.fieldLabel.localeCompare(b.fieldLabel);});}return y1;};p1.prototype._determineSemanticObjectsforDetailsPopover=function(e,i){var n,l,y1=[];if(e){for(n in e){if(n){l=this._getField(n);if(l&&l.isDimension&&l.isSemanticObject){y1.push(l);}}}}if(y1){y1.sort(function(a,b){return a.fieldLabel.localeCompare(b.fieldLabel);});}return y1;};p1.prototype._addDrillUpDownButtons=function(){if(this.getShowDrillButtons()){var a=this;this._oDrillUpButton=new d(this.getId()+"-btnDrillUp",{type:"Transparent",tooltip:this._oRb.getText("CHART_DRILLUPBTN_TOOLTIP"),text:this._oRb.getText("CHART_DRILLUPBTN_TEXT"),icon:"sap-icon://drill-up",press:function(){if(a._oChart){a._oChart.drillUp();}},visible:!this.getShowDrillBreadcrumbs(),enabled:false});this._oDrillDownButton=new d(this.getId()+"-btnDrillDown",{type:"Transparent",tooltip:this._oRb.getText("CHART_DRILLDOWNBTN_TOOLTIP"),text:this._oRb.getText("CHART_DRILLDOWNBTN_TEXT"),icon:"sap-icon://drill-down",press:function(e){a._drillDown(e);},visible:!this.getShowDetailsButton(),enabled:false});this._oToolbar.addContent(this._oDrillUpButton);this._oToolbar.addContent(this._oDrillDownButton);}};p1.prototype._addDrillDownTextButton=function(){this._oDrillDownTextButton=new B(this.getId()+"-btnDrillDownText",{type:"Transparent",text:this._oRb.getText("CHART_DRILLDOWNBTN_TEXT"),tooltip:this._oRb.getText("CHART_DRILLDOWNBTN_TOOLTIP"),enabled:false,visible:this.getShowDetailsButton(),layoutData:new z({closeOverflowOnInteraction:false}),press:function(e){this._drillDown(e);}.bind(this)});this._oToolbar.addContent(this._oDrillDownTextButton);};p1.prototype.setShowDrillButtons=function(b){this.setProperty("showDrillButtons",b);if(this._oDrillUpButton){this._oDrillUpButton.setVisible(b);}if(this._oDrillDownButton){this._oDrillDownButton.setVisible(b);}return this;};p1.prototype._triggerSearchInPopover=function(e,l){var a,i,b,n,y1,z1;if(!e||!l){return;}a=e.getParameters();if(!a){return;}y1=a.newValue?a.newValue.toLowerCase():"";if(this._oChart){z1=l.getItems();for(i=0;i<z1.length;i++){n=z1[i].getTooltip();b=z1[i].getTitle();if((b&&(b.toLowerCase().indexOf(y1)>-1))||(n&&(n.toLowerCase().indexOf(y1)>-1))){z1[i].setVisible(true);}else{z1[i].setVisible(false);}}}};p1.prototype._drillDown=function(e,a){var b=this,l,n,y1,z1,A1,B1,C1,D1,i,E1,F1;if(this._oChart){if((!j1||!k1||!m1||!n1||!l1)&&!this._bDrillDownRequested){j1=sap.ui.require("sap/m/ResponsivePopover");k1=sap.ui.require("sap/m/List");m1=sap.ui.require("sap/m/Bar");n1=sap.ui.require("sap/m/SearchField");l1=sap.ui.require("sap/m/StandardListItem");if(!j1||!k1||!m1||!n1||!l1){sap.ui.require(["sap/m/ResponsivePopover","sap/m/List","sap/m/Bar","sap/m/SearchField","sap/m/StandardListItem"],t1.bind(this));this._bDrillDownRequested=true;this._oDrillDownSource=e.getSource();}}if(!j1||!k1||!m1||!n1||!l1){return;}B1=new k1({mode:W.SingleSelectMaster,selectionChange:function(e){if(e&&e.mParameters&&e.mParameters.listItem){if(e.mParameters.listItem.getType()===X.Inactive){return;}var z1=e.mParameters.listItem.data("dim");if(z1){b._oChart.drillDown(z1);}}l.close();}});C1=new m1();D1=new n1({placeholder:this._oRb.getText("CHART_DRILLDOWN_SEARCH")});D1.attachLiveChange(function(e){b._triggerSearchInPopover(e,B1);});C1.addContentRight(D1);l=new j1({contentWidth:"25rem",contentHeight:"20rem",placement:Y.Bottom,subHeader:C1});if(s.system.desktop){var G1=new I({text:this._oRb.getText("CHART_DRILLDOWN_TITLE")});l.setShowHeader(false);l.addContent(G1);l.addAriaLabelledBy(G1);}else{l.setTitle(this._oRb.getText("CHART_DRILLDOWN_TITLE"));}l.addContent(B1);n=this._getDrillStackDimensions();y1=this._getSortedDimensions();if(y1.length<7){C1.setVisible(false);}for(i=0;i<y1.length;i++){z1=y1[i];if(n.indexOf(z1.getName())>-1){continue;}F1=this._oChartProvider.getViewField(z1.getName());if(!F1.filterable&&this._oChart.getSelectedDataPoints().count>0){continue;}A1=new l1({title:z1.getLabel(),type:X.Active});A1.data("dim",z1);E1=this._getFieldTooltip(z1.name);if(E1){A1.setTooltip(E1);}B1.addItem(A1);}l.openBy(e?e.getSource():a);}};function t1(a,l,b,e,i){j1=a;k1=l;m1=b;n1=e;l1=i;this._bDrillDownRequested=false;if(!this._bIsBeingDestroyed){this._drillDown(null,this._oDrillDownSource);}delete this._oDrillDownSource;}p1.prototype._navigateToSemanticObjectDetails=function(e){var a=this._setSemanticObjectsContext(e);if(a&&(a.length>0)){if(a.length===1){var b=M.getSemanticObjectsFromProperty(a[0]);if(b){var i=e.getParameter("item");var n=new N({fieldName:a[0].name,control:i,semanticObject:b.defaultSemanticObject,additionalSemanticObjects:b.additionalSemanticObjects,navigationTargetsObtained:function(z1){var A1=z1.getParameters().mainNavigation;if(A1){var B1=i.getBindingContext().getObject();var C1=this._getField(z1.getSource().getFieldName());var D1=y.getTextsFromDisplayBehaviour(C1.displayBehaviour,B1[C1.name],B1[C1.description]);A1.setDescription(D1.secondText);z1.getParameters().show(D1.firstText,A1,undefined,undefined);}z1.getParameters().show();}.bind(this)});n._getNavigationContainer().then(function(z1){this._oNavigationContainer=z1;this._oNavigationContainer.attachBeforePopoverOpen(function(){this._oSelectionDetails.setPopoverModal(true);}.bind(this));this._oNavigationContainer.attachAfterPopoverClose(function(){this._oSelectionDetails.setPopoverModal(false);}.bind(this));this._oSelectionDetails.navTo("",this._oNavigationContainer);}.bind(this),function(z1){L.error("NavigationContainer could not be determined");});}}else{var l=e.getParameter("item").getBindingContext();if((!k1||!l1)&&!this._bObjectListRequested){k1=sap.ui.require("sap/m/List");l1=sap.ui.require("sap/m/StandardListItem");if(!k1||!l1){sap.ui.require(["sap/m/List","sap/m/StandardListItem"],u1.bind(this));this._bObjectListRequested=true;this._oObjectListAttr={context:l,objects:a};}}if(k1&&l1){var y1=this._semanticObjectListForDetails(a,l);this._oSelectionDetails.navTo(this._oRb.getText("CHART_SEMNAVBTN"),y1);}}}};function u1(l,a){k1=l;l1=a;this._bObjectListRequested=false;if(!this._bIsBeingDestroyed){var b=this._semanticObjectListForDetails(this._oObjectListAttr.objects,this._oObjectListAttr.context);this._oSelectionDetails.navTo(this._oRb.getText("CHART_SEMNAVBTN"),b);}delete this._oObjectListAttr;}p1.prototype._addHeaderToToolbar=function(){if(this.getHeader()&&this._oToolbar){if(!this._headerText){this._headerText=new x({});this._headerText.addStyleClass("sapMH4Style");this._headerText.addStyleClass("sapUiCompSmartChartHeader");}this._refreshHeaderText();this._oToolbar.insertContent(this._headerText,0);}else if(this._headerText&&this._oToolbar){this._oToolbar.removeContent(this._headerText);}};p1.prototype._addSeparatorToToolbar=function(){if(this.getHeader()&&this.getUseVariantManagement()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oSeparator=new g();this._oToolbar.insertContent(this._oSeparator,0);if(!this._oToolbar.getHeight()){this._oToolbar.setHeight("auto");}}else if(this._oSeparator){this._oToolbar.removeContent(this._oSeparator);}};p1.prototype._addVariantManagementToToolbar=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){if(this.getUseVariantManagement()){this._oToolbar.insertContent(this._oVariantManagement,0);}else if(this._oVariantManagement){this._oToolbar.removeContent(this._oVariantManagement);}}};p1.prototype._addSpacerToToolbar=function(){if(this._indexOfSpacerOnToolbar()===-1){this._oToolbar.addContent(new h());}};p1.prototype._indexOfSpacerOnToolbar=function(){var a=this._oToolbar.getContent(),i,l;if(a){l=a.length;i=0;for(i;i<l;i++){if(a[i]instanceof h){return i;}}}return-1;};p1.prototype._addPersonalisationToToolbar=function(){if(this.getUseChartPersonalisation()){if(!this._oChartPersonalisationButton){this._oChartPersonalisationButton=new d(this.getId()+"-btnPersonalisation",{type:"Transparent",icon:"sap-icon://action-settings",text:this._oRb.getText("CHART_PERSOBTN_TEXT"),tooltip:this._oRb.getText("CHART_PERSOBTN_TOOLTIP"),press:function(e){if(this._oPersController){this._oPersController.openDialog({dimeasure:{visible:true,payload:{availableChartTypes:this._getAvailableChartTypes()}},sort:{visible:true},filter:{visible:true}});}}.bind(this),enabled:false});}this._oToolbar.addContent(this._oChartPersonalisationButton);}else if(this._oChartPersonalisationButton){this._oToolbar.removeContent(this._oChartPersonalisationButton);}};p1.prototype._addChartTypeToToolbar=function(){this._oChartTypeButton=this._createChartTypeButton();this._oToolbar.addContent(this._oChartTypeButton);};p1.prototype._createChartTypeButton=function(){var a=new d(this.getId()+"-btnChartType",{visible:this.getShowChartTypeSelectionButton(),enabled:false,type:"Transparent",text:this._oRb.getText("CHART_TYPEBTN_TEXT"),layoutData:new z({closeOverflowOnInteraction:false}),press:function(e){this._displayChartTypes(e);}.bind(this)});return a;};p1.prototype._displayChartTypes=function(e,a){var b=this,i,l,n,y1,z1=false;if(this._bAvailableChartListIsOpen){return;}if(this._oChart&&(e||a)){if((!j1||!k1||!m1||!n1||!l1)&&!this._bChartTypesRequested){j1=sap.ui.require("sap/m/ResponsivePopover");k1=sap.ui.require("sap/m/List");m1=sap.ui.require("sap/m/Bar");n1=sap.ui.require("sap/m/SearchField");l1=sap.ui.require("sap/m/StandardListItem");if(!j1||!k1||!m1||!n1||!l1){sap.ui.require(["sap/m/ResponsivePopover","sap/m/List","sap/m/Bar","sap/m/SearchField","sap/m/StandardListItem"],v1.bind(this));this._bChartTypesRequested=true;this._oChartTypesSource=e.getSource();}}if(!j1||!k1||!m1||!n1||!l1){return;}var A1=e?e.getSource():a;var B1=new l1({title:"{$smartChartTypes>text}",icon:"{$smartChartTypes>icon}",selected:"{$smartChartTypes>selected}"});l=new k1({mode:W.SingleSelectMaster,items:{path:"$smartChartTypes>/items",template:B1},selectionChange:function(e){if(e&&e.mParameters&&e.mParameters.listItem){var D1=e.mParameters.listItem.getBinding("title");if(D1){var E1=D1.getContext();if(E1){var F1=E1.getObject();if(F1&&F1.key){b._setChartType(F1.key);b._enrichPassedButton(b._oChartTypeButton,b._oChart.getChartType());}}}}z1=true;b._rerenderControlInFullscreen();i.close();}});n=new m1();y1=new n1({placeholder:this._oRb.getText("CHART_TYPE_SEARCH")});y1.attachLiveChange(function(e){b._triggerSearchInPopover(e,l);});n.addContentRight(y1);i=new j1({placement:Y.Bottom,subHeader:n,contentWidth:"25rem"});i.attachAfterClose(function(e){if(!z1){}b._bAvailableChartListIsOpen=false;});i.setModel(this.getModel("$smartChartTypes"),"$smartChartTypes");if(s.system.desktop){var C1=new I({text:this._oRb.getText("CHART_TYPELIST_TEXT")});i.setShowHeader(false);i.addContent(C1);i.addAriaLabelledBy(C1);}else{i.setTitle(this._oRb.getText("CHART_TYPELIST_TEXT"));}i.addContent(l);if(l.getItems().length<7){n.setVisible(false);}this._bAvailableChartListIsOpen=true;i.openBy(A1);}};function v1(a,l,b,e,i){j1=a;k1=l;m1=b;n1=e;l1=i;this._bChartTypesRequested=false;if(!this._bIsBeingDestroyed){this._displayChartTypes(null,this._oChartTypesSource);}delete this._oChartTypesSource;}var w1={"bar":"sap-icon://horizontal-bar-chart","bullet":"sap-icon://horizontal-bullet-chart","bubble":"sap-icon://bubble-chart","column":"sap-icon://vertical-bar-chart","combination":"sap-icon://business-objects-experience","dual_bar":"sap-icon://horizontal-bar-chart","dual_column":"sap-icon://vertical-bar-chart","dual_combination":"sap-icon://business-objects-experience","dual_horizontal_combination":"sap-icon://business-objects-experience","dual_horizontal_stacked_combination":"sap-icon://business-objects-experience","dual_line":"sap-icon://line-chart","dual_stacked_bar":"sap-icon://full-stacked-chart","dual_stacked_column":"sap-icon://vertical-stacked-chart","dual_stacked_combination":"sap-icon://business-objects-experience","donut":"sap-icon://donut-chart","heatmap":"sap-icon://heatmap-chart","horizontal_stacked_combination":"sap-icon://business-objects-experience","line":"sap-icon://line-chart","pie":"sap-icon://pie-chart","scatter":"sap-icon://scatter-chart","stacked_bar":"sap-icon://full-stacked-chart","stacked_column":"sap-icon://vertical-stacked-chart","stacked_combination":"sap-icon://business-objects-experience","treemap":"sap-icon://Chart-Tree-Map","vertical_bullet":"sap-icon://vertical-bullet-chart","100_dual_stacked_bar":"sap-icon://full-stacked-chart","100_dual_stacked_column":"sap-icon://vertical-stacked-chart","100_stacked_bar":"sap-icon://full-stacked-chart","100_stacked_column":"sap-icon://full-stacked-column-chart","waterfall":"sap-icon://vertical-waterfall-chart","horizontal_waterfall":"sap-icon://horizontal-waterfall-chart"};p1.prototype._rerenderControlInFullscreen=function(){if(this.bFullScreen&&this._oFullScreenUtil){this._oChart.setLayoutData(new F({baseSize:"100%"}));this.invalidate(this._oChart);}};p1.prototype._getMatchingIcon=function(a){var i=w1[a];if(!i){i="";}return i;};p1.prototype._enrichPassedButton=function(b,a,e){if(!b){return;}if(e===undefined){e=a;var i=this._retrieveChartTypeDescription(a);if(i&&i.text){e=i.text;}}b.data("chartType",a);var l=this._getMatchingIcon(a);b.setIcon(l?l:"sap-icon://vertical-bar-chart");var n=(this._oChart.getChartType()===a)?"CHART_TYPE_TOOLTIP":"CHART_TYPE_UNSEL_TOOLTIP";b.setTooltip(this._oRb.getText(n,[e]));};p1.prototype._updateAvailableChartType=function(){var a=this,b,e,i=[];b=this.getModel("$smartChartTypes");if(!b){return;}e={items:i};var l=this._oChart.getChartType();this._getAvailableChartTypes().forEach(function(n){var y1={key:n.key,text:n.text,icon:a._getMatchingIcon(n.key),selected:l===n.key};i.push(y1);});b.setData(e);if(this._oSegmentedButton){this._updateVisibilityOfChartTypes(this._oSegmentedButton);}this._updateVizTooltipFormatter();};p1.prototype._createPersonalizationController=function(){if(this._oPersController){return;}var a=this.data("p13nDialogSettings");if(typeof a==="string"){try{a=JSON.parse(a);}catch(e){a=null;}}a=this._setIgnoreFromPersonalisationToSettings(a);a=a||{};var b=G.createChartWrapper(this._oChart,this._oChart.data("p13nData"),this._aColumnKeysOrdered);if(this.$()&&this.$().closest(".sapUiSizeCompact").length>0){this._oChart.addStyleClass("sapUiSizeCompact");}this._oPersController=new E(this.getId()+"-persoController",{table:b,setting:a,resetToInitialTableState:!this.getUseVariantManagement(),afterP13nModelDataChange:this._personalisationModelDataChange.bind(this)});this._oPersController.attachDialogConfirmedReset(function(){if(this._oDrillBreadcrumbs){this._updateDrillBreadcrumbs();}var i=sap.ui.getCore().byId(this.getId()+"-btnChartType");if(i){this._enrichPassedButton(i,this._oChart.getChartType());}}.bind(this));};p1.prototype._setIgnoreFromPersonalisationToSettings=function(a){var i=r.createArrayFromString(this.getIgnoreFromPersonalisation());if(i.length){if(!a){a={};}var b=function(e){if(!a[e]){a[e]={};}a[e].ignoreColumnKeys=i;};b("dimeasure");b("filter");b("sort");}return a;};p1.prototype._personalisationModelDataChange=function(e){this._oCurrentVariant=e.getParameter("persistentData");var a=e.getParameter("runtimeDeltaDataChangeType");var b=this._getChangeStatus(a);if(b===Z.Unchanged){return;}this._fireChartDataChanged(a);if(!this._bApplyingVariant){if(!this.getUseVariantManagement()){this._persistPersonalisation();}else if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true);}}this._updateAvailableChartType();this._enrichPassedButton(this._oChartTypeButton,this._oChart.getChartType());this._checkDimensionColoring();if(b===Z.TableChanged){if(this._oSemanticalNavButton){this._oSemanticalNavButton.setEnabled(false);}}else if(b===Z.ModelChanged&&this._bIsChartBound){if(this._oSmartFilter){this._oSmartFilter.search();}else{this._reBindChart();}}if(this._oDrillBreadcrumbs){this._updateDrillBreadcrumbs();}};p1.prototype._fireChartDataChanged=function(a){var b={dimeasure:false,filter:false,sort:false};for(var e in a){if(a[e]!=="Unchanged"){b[e]=true;}}this.fireChartDataChanged({changeTypes:b});};p1.prototype._getChangeStatus=function(a){if(!a){return Z.ModelChanged;}if(a.sort===Z.ModelChanged||a.filter===Z.ModelChanged||a.dimeasure===Z.ModelChanged||a.group===Z.ModelChanged){return Z.ModelChanged;}if(a.sort===Z.TableChanged||a.filter===Z.TableChanged||a.dimeasure===Z.TableChanged||a.group===Z.TableChanged){return Z.TableChanged;}return Z.Unchanged;};p1.prototype.setEntitySet=function(e){this.setProperty("entitySet",e);this._initialiseMetadata();return this;};p1.prototype.propagateProperties=function(){V.prototype.propagateProperties.apply(this,arguments);this._initialiseMetadata();};p1.prototype._initialiseMetadata=function(){if(!this._bMetadataIsInitialised){t.handleModelInit(this,this._onMetadataInitialised);}};p1.prototype._onMetadataInitialised=function(){this._bMetaModelLoadAttached=false;if(!this._bMetadataIsInitialised){this._listenToSmartFilter();this._createToolbar();this._createVariantManagementControl();this._createToolbarContent();this._bMetadataIsInitialised=true;if(o1){this._initialiseInnerChart();}if(K.getActive()){K.end("SmartChartInit");}if(!this._oVariantManagement||(this._oVariantManagement&&this._bVariantInitialised)){this._checkAndTriggerBinding();}}};p1.prototype._checkAndTriggerBinding=function(){if(!this._bAutoBindingTriggered){this._bAutoBindingTriggered=true;if(this.getEnableAutoBinding()){if(this._oSmartFilter){this._oSmartFilter.search();}else{this._reBindChart();}}else if(!this._oChart){this._createTempNoData();}}};p1.prototype._createTempNoData=function(){var n=new T({text:this.getNoData()});this._oNoDataStruct=new V({items:[n],justifyContent:"Center",alignItems:"Center",height:"100%"});this.insertItem(this._oNoDataStruct,2);};p1.prototype._createChartProvider=function(){var a,e;e=this.getEntitySet();a=this.getModel();if(a&&!this._bChartCreated){this._aAlwaysSelect=[];this._aInitialSorters=[];this._addDrillBreadcrumbs();this._bChartCreated=true;}if(a&&e){this._oChartProvider=new C({entitySet:e,ignoredFields:this.getIgnoredFields(),dateFormatSettings:this.data("dateFormatSettings"),defaultDropDownDisplayBehaviour:this.data("defaultDimensionDisplayBehaviour"),skipAnnotationParse:this.data("skipAnnotationParse"),chartQualifier:this.data("chartQualifier"),presentationVariantQualifier:this.data("presentationVariantQualifier"),model:a,chartLibrary:_});}};p1.prototype._listenToSmartFilter=function(){this._fetchSmartFilter();if(this._oSmartFilter){this._oSmartFilter.attachSearch(this._reBindChart,this);this._oSmartFilter.attachFilterChange(this._filterChangeEvent,this);this.setNoData(this._oRb.getText("CHART_NO_RESULTS"));}else{this.setNoData(this._oRb.getText("CHART_NO_DATA_WITHOUT_FILTERBAR"));}if(this._oChart){this._oChart.setCustomMessages({'NO_DATA':this.getNoData()});}};p1.prototype.getNoData=function(){var n=this.getProperty("noData");if(!n){this._fetchSmartFilter();if(this._oSmartFilter){n=this._oRb.getText("CHART_NO_DATA");}else{n=this._oRb.getText("CHART_NO_DATA_WITHOUT_FILTERBAR");}this.setNoData(n,true);}return n;};p1.prototype._fetchSmartFilter=function(){var a=null;a=this.getSmartFilterId();this._oSmartFilter=this._findControl(a);};p1.prototype._filterChangeEvent=function(){if(this._bIsChartBound&&this._oSmartFilter&&!this._oSmartFilter.getLiveMode()&&!this._oSmartFilter.isDialogOpen()){this._showOverlay(true);}};p1.prototype._renderOverlay=function(b){if(this._oChart){var a=this._oChart.$(),e=a.find(".sapUiCompSmartChartOverlay");if(b&&e.length===0){e=q("<div>").addClass("sapUiOverlay sapUiCompSmartChartOverlay").css("z-index","1");a.append(e);}else if(!b){e.remove();}}};p1.prototype.showOverlay=function(b){this._showOverlay(b);};p1.prototype._showOverlay=function(b){if(b){var a={show:true};this.fireShowOverlay({overlay:a});b=a.show;}this._hasOverlay=b;this._renderOverlay(b);};p1.prototype._findControl=function(i){var a,b;if(i){a=sap.ui.getCore().byId(i);if(!a){b=this._getView();if(b){a=b.byId(i);}}}return a;};p1.prototype._getView=function(){if(!this._oView){var a=this.getParent();while(a){if(a.isA("sap.ui.core.mvc.View")){this._oView=a;break;}a=a.getParent();}}return this._oView;};p1.prototype._updateInResultDimensions=function(){var a=this._getInResultDimensionTotal();var b=function(n){var e=this._oChart.getInResultDimensions();if(e.length!=n.length){return false;}for(var i=0,l=e.length;i<l;i++){if(e[i]!=n[i]){return false;}}return true;}.bind(this);if(a.length>0&&!b(a)){this._oChart.setInResultDimensions(a);}};p1.prototype._initialiseInnerChart=function(){this._createChart();this._createChartProvider();if(this._oChartProvider){this._oChartViewMetadata=this._oChartProvider.getChartViewMetadata();if(this._oChartViewMetadata){this._assignData();this._createContent();this._createPersonalizationController();this._oChart.attachRenderComplete(this._toggleZoomButtonEnablement,this);this._oSelectionDetails.attachSelectionHandler("_selectionDetails",this._oChart);this._enrichPassedButton(this._oChartTypeButton,this._oChart.getChartType());this._enableToolbarButtons();this._checkDimensionColoring();this._updateDrillBreadcrumbs();this.bIsInitialised=true;this.fireInitialise();this.fireInitialized();this.applyVariant(this.fetchVariant());}}};p1.prototype._enableToolbarButtons=function(){if(this._oDrillUpButton&&this._oDrillDownButton){this._oDrillUpButton.setEnabled(true);this._oDrillDownButton.setEnabled(true);}if(this._oDrillDownTextButton){this._oDrillDownTextButton.setEnabled(true);}if(this._oLegendButton){this._oLegendButton.setEnabled(true);}if(this._oZoomInButton&&this._oZoomOutButton){this._oZoomInButton.setEnabled(true);this._oZoomOutButton.setEnabled(true);}if(this._oDownloadButton){this._oDownloadButton.setEnabled(true);}if(this._oChartPersonalisationButton){this._oChartPersonalisationButton.setEnabled(true);}if(this.oFullScreenButton){this.oFullScreenButton.setEnabled(true);}if(this._oChartTypeButton){this._oChartTypeButton.setEnabled(true);}};function x1(a,b,e,i,l,n,y1){_=a;a1=b;b1=e;c1=i;d1=l;e1=n;g1=y1;this._bChartRequested=false;if(!this._bIsBeingDestroyed){this._reBindChart();}}p1.prototype.rebindChart=function(){this._reBindChart();};p1.prototype._reBindChart=function(){var a,b,e=[],i,l,n,y1={},z1={preventChartBind:false};if(!this._oChart){if((!_||!a1||!b1||!c1||!d1||!e1||!g1)&&!this._bChartRequested){_=sap.ui.require("sap/chart/library");a1=sap.ui.require("sap/chart/Chart");b1=sap.ui.require("sap/chart/data/Dimension");c1=sap.ui.require("sap/chart/data/HierarchyDimension");d1=sap.ui.require("sap/chart/data/TimeDimension");e1=sap.ui.require("sap/chart/data/Measure");g1=sap.ui.require("sap/viz/ui5/controls/VizTooltip");if(!_||!a1||!b1||!c1||!d1||!e1||!g1){sap.ui.getCore().loadLibrary("sap.chart",{async:true}).then(function(){sap.ui.require(['sap/chart/library','sap/chart/Chart','sap/chart/data/Dimension','sap/chart/data/HierarchyDimension','sap/chart/data/TimeDimension','sap/chart/data/Measure','sap/viz/ui5/controls/VizTooltip'],x1.bind(this));this._bChartRequested=true;}.bind(this));}}if(!_||!a1||!b1||!c1||!d1||!e1||!g1){return;}this._initialiseInnerChart();}a=this._getChartPersonalisationData()||{};i=a.filters;l=a.excludeFilters;n=a.sorters;if(this._oSmartFilter){b=this._oSmartFilter.getFilters();y1=this._oSmartFilter.getParameters()||{};}if(b&&b.length){if(l){e=[new o([b[0],l],true)];}else{e=b;}}else if(l){e=[l];}if(i){i=e.concat(i);}else{i=e;}this._updateInResultDimensions();y1["entitySet"]=this.getEntitySet();if(!n){n=[];}z1.filters=i;z1.sorter=n;z1.parameters=y1;z1.events={};this.fireBeforeRebindChart({bindingParams:z1});if(!z1.preventChartBind&&this._oChartViewMetadata){n=z1.sorter;i=z1.filters;y1=z1.parameters;this._oChart.setBusy(true);this._bDataLoadPending=true;p1._addBindingListener(z1,"change",this._onDataLoadComplete.bind(this));p1._addBindingListener(z1,"dataReceived",this._onDataReceived.bind(this));var A1={path:this.getChartBindingPath()||("/"+this.getEntitySet()),parameters:y1,filters:i,events:z1.events};if(!this._bIsChartBound){A1.sorter=n;}if(z1.length){A1.length=Math.min(z1.length,100);}else{var B1=this._oChartProvider.getMaxItems();if(B1>0){A1.length=B1;}}this._oChart.bindData(A1);if(this._bIsChartBound){this._oChart.getBinding("data").sort(n);}this._showOverlay(false);this._bIsChartBound=true;}};p1.prototype._validateSorters=function(a){var b=[];var e=this._oChart.getVisibleDimensions().concat(this._oChart.getVisibleMeasures());if(a){a.forEach(function(i){e.forEach(function(l){if(i.sPath===l){b.push(i);}});});}return b;};p1.prototype._onDataReceived=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._onDataLoadComplete(e,true);this.fireDataReceived(e);};p1._addBindingListener=function(b,e,a){if(!b.events){b.events={};}if(!b.events[e]){b.events[e]=a;}else{var i=b.events[e];b.events[e]=function(){a.apply(this,arguments);i.apply(this,arguments);};}};p1.prototype._onDataLoadComplete=function(e,b){if(this._oSemanticalNavButton){this._oSemanticalNavButton.setEnabled(false);}if(this._bDataLoadPending||b){this._bDataLoadPending=false;this._updateAvailableChartType();this._oChart.setBusy(false);}};p1.prototype._assignData=function(){if(this._oChartViewMetadata&&this._oChart){this._oChart.resetLayout();if(this._oChartViewMetadata.measureFields&&(this._oChartViewMetadata.measureFields.length>0)){this._oChart.setVisibleMeasures(this._oChartViewMetadata.measureFields);}if(this._oChartViewMetadata.dimensionFields&&(this._oChartViewMetadata.dimensionFields.length>0)){this._oChart.setVisibleDimensions(this._oChartViewMetadata.dimensionFields);}if(!this.getChartType()&&this._oChartViewMetadata.chartType){this._setChartType(this._oChartViewMetadata.chartType);}}};p1.prototype._createP13nObject=function(a){if(a.sortable&&a.sorted){var b={columnKey:a.name,operation:a.sortOrder};if(a.sortIndex!=null){this._aInitialSorters.splice(a.sortIndex,0,b);}else{this._aInitialSorters.push(b);}}return{columnKey:a.name,leadingProperty:a.name,additionalProperty:a.additionalProperty,sortProperty:a.sortable?a.name:undefined,filterProperty:a.filterable?a.name:undefined,fullName:a.hasValueListAnnotation?a.fullName:null,type:a.filterType,typeInstance:a.modelType,maxLength:a.maxLength,precision:a.precision,scale:a.scale,isMeasure:a.isMeasure,isDimension:a.isDimension,isHierarchyDimension:a.isHierarchyDimension,hierarchyLevel:a.hierarchyLevel,aggregationRole:a.aggregationRole,label:a.label,tooltip:a.quickInfo,sorted:a.sorted,sortOrder:a.sortOrder,criticality:a.valueCriticality};};p1.prototype._createContent=function(){var i,l=0,a,b,e,n=[],y1;var z1=[];this._aColumnKeysOrdered=[];Object.assign(this._aColumnKeysOrdered,this._oChartViewMetadata.dimensionFields);this._aColumnKeysOrdered=this._aColumnKeysOrdered.concat(this._oChartViewMetadata.measureFields);l=this._oChartViewMetadata.fields.length;var A1=this._oChartViewMetadata.dimensionFields||[];var B1=this._oChartViewMetadata.measureFields||[];for(i=0;i<l;i++){b=null;a=this._oChartViewMetadata.fields[i];a.label=a.fieldLabel||a.name;if(this._aColumnKeysOrdered.indexOf(a.name)===-1){this._aColumnKeysOrdered.push(a.name);}if(this._oChart.getDimensionByName(a.name)===undefined&&this._oChart.getMeasureByName(a.name)===undefined){y1=this._createP13nObject(a);e={name:a.name,label:a.label,tooltip:a.quickInfo};}if(a.inResult){this._aAlwaysSelect.push(a.name);}if(a.isDimension||a.isHierarchyDimension||(A1.indexOf(a.name)!=-1)){if(this._oChart.getDimensionByName(a.name)===undefined){if(a.isDimension){if(a.isTimeDimension){b=new d1(e);switch(a.timeUnitType){case"Date":b.setTimeUnit(sap.chart.TimeUnitType.Date);break;case"yearmonthday":b.setTimeUnit(sap.chart.TimeUnitType.yearmonthday);break;default:break;}}else{b=new b1(e);}}else{e.level=a.hierarchyLevel;b=new c1(e);}this._oChart.addDimension(b);if(a.description){b.setTextProperty(a.description);b.setTextFormatter(y.getFormatterFunctionFromDisplayBehaviour(a.displayBehaviour));}else if(a.dateFormatter){b.setTextFormatter(a.dateFormatter);}}else{var C1=this._oChart.getDimensionByName(a.name).data("p13nData");if(C1){this._oChart.getDimensionByName(a.name).data("p13nData",typeof C1==="string"?JSON.parse(C1):C1);}}}else if(a.isMeasure||(B1.indexOf(a.name)!=-1)){if(this._oChart.getMeasureByName(a.name)===undefined){b=new e1(e);this._oChart.addMeasure(b);if(a.dataPoint){z1.push({dataPoint:a.dataPoint,measure:b});}if(a.unit){b.setUnitBinding(a.unit);}}else{var C1=this._oChart.getMeasureByName(a.name).data("p13nData");if(C1){this._oChart.getMeasureByName(a.name).data("p13nData",typeof C1==="string"?JSON.parse(C1):C1);}}}else if(a.sortable||a.filterable){n.push(y1);}if(b){if(a.role){b.setRole(a.role);}b.data("p13nData",y1);}}if(this._oChart){this._oChart.data("p13nData",n);}if(z1.length>0){this._enrichFromDataPoints(z1);}};p1.prototype._getField=function(n){var a,i,l;if(n&&this._oChartViewMetadata&&this._oChartViewMetadata.fields){l=this._oChartViewMetadata.fields.length;for(i=0;i<l;i++){a=this._oChartViewMetadata.fields[i];if(a.name===n){return a;}}}return null;};p1.prototype.attachInitialise=function(a,b,l){this.attachEvent("initialise",a,b,l);o1=true;sap.ui.getCore().loadLibrary('sap.chart');_=sap.ui.requireSync('sap/chart/library');a1=sap.ui.requireSync('sap/chart/Chart');b1=sap.ui.requireSync('sap/chart/data/Dimension');c1=sap.ui.requireSync('sap/chart/data/HierarchyDimension');d1=sap.ui.requireSync('sap/chart/data/TimeDimension');e1=sap.ui.requireSync('sap/chart/data/Measure');g1=sap.ui.requireSync('sap/viz/ui5/controls/VizTooltip');if(this._bMetadataIsInitialised){this._initialiseInnerChart();}L.error("The event 'initialise' is deprecated, please use 'initialized' instead");return this;};p1.prototype._createChart=function(){if(this._oNoDataStruct){this._oNoDataStruct.destroy();}var a=this.getItems(),l=a?a.length:0,b,e=this;while(l--){b=a[l];if(b instanceof a1){break;}b=null;}if(b){this._oChart=b;}else{this._oChart=new a1({uiConfig:{applicationSet:'fiori'},busyIndicatorDelay:0,vizProperties:{title:{text:''},plotArea:{dataLabel:{hideWhenOverlap:false}},general:{groupData:false},valueAxis:{title:{visible:e.getShowMeasuresTitle()}},categoryAxis:{title:{visible:e.getShowDimensionsTitle()},layout:{autoHeight:true,autoWidth:true}}},selectionMode:this.getSelectionMode(),width:"100%"});if(this.getHeight()){this._oChart.setHeight("100%");}this._toggleChartTooltipVisibility(this.getShowChartTooltip());this._setBehaviorTypeForDataSelection();this.insertItem(this._oChart,2);}this.setLegendVisible(this.getLegendVisible());if(!this._oChart.getLayoutData()){var i={growFactor:1};var n=this.getLayoutData();if(n&&n.getBaseSize){i.baseSize=n.getBaseSize();}else{i.baseSize="100%";}this._oChart.setLayoutData(new F(i));}if(this.getChartType()){this._setChartType(this.getChartType());}this._oChart.attachRenderComplete(function(){if(this._hasOverlay){setTimeout(function(){this._showOverlay(true);}.bind(this),0);}}.bind(this));this._oChart.setCustomMessages({'NO_DATA':this.getNoData()});this._createTooltipOrPopover();};p1.prototype._toggleChartTooltipVisibility=function(b){if(this._oChart){if(b){if(!this._vizTooltip){this._vizTooltip=new g1();}this._vizTooltip.connect(this._oChart.getVizUid());}else{if(this._vizTooltip){this._vizTooltip.destroy();}}}};p1.prototype._updateVizTooltipFormatter=function(){if(this._vizTooltip){if(this._oChart.getChartType().match(/100/)!==null){this._vizTooltip.setFormatString(sap.viz.ui5.format.ChartFormatter.DefaultPattern.PERCENT);}else{this._vizTooltip.setFormatString(sap.viz.ui5.format.ChartFormatter.DefaultPattern.STANDARDFLOAT);}}};p1.prototype.getChart=function(){if(!this._oChart&&this._bMetadataIsInitialised){sap.ui.getCore().loadLibrary('sap.chart');_=sap.ui.requireSync('sap/chart/library');a1=sap.ui.requireSync('sap/chart/Chart');b1=sap.ui.requireSync('sap/chart/data/Dimension');c1=sap.ui.requireSync('sap/chart/data/HierarchyDimension');d1=sap.ui.requireSync('sap/chart/data/TimeDimension');e1=sap.ui.requireSync('sap/chart/data/Measure');g1=sap.ui.requireSync('sap/viz/ui5/controls/VizTooltip');this._initialiseInnerChart();}L.error("This function is deprecated, please use getChartAsync instead");return this._oChart;};p1.prototype.getChartAsync=function(){if(!this._oChart&&this._bMetadataIsInitialised){return new Promise(function(a,b){sap.ui.require(["sap/chart/library","sap/chart/Chart","sap/chart/data/Dimension","sap/chart/data/HierarchyDimension","sap/chart/data/TimeDimension","sap/chart/data/Measure","sap/viz/ui5/controls/VizTooltip"],function(e,i,l,n,y1,z1,A1){_=e;a1=i;b1=l;c1=n;d1=y1;e1=z1;g1=A1;if(!this._oChart){this._initialiseInnerChart();}if(this._oChart){a(this._oChart);}else{b("The inner chart couldn't be created");}}.bind(this));}.bind(this));}else{return Promise.resolve(this._oChart);}};p1.prototype._getChartTypes=function(){var a;try{a=sap.chart.api.getChartTypes();}catch(e){a={};L.error("sap.chart.api..getChartTypes throws an exception.\n"+e.toString());}return a;};p1.prototype._getAvailableChartTypes=function(){var i,a,b=[],e,l={},n;if(this._oChart){n=r.createArrayFromString(this.getIgnoredChartTypes());l=this._getChartTypes();e=this._oChart.getAvailableChartTypes().available;if(e){for(i=0;i<e.length;i++){a=e[i].chart;if(n.indexOf(a)<0){b.push({key:a,text:l[a]});}}}}return b;};p1.prototype._getAllChartTypes=function(){var a,b=[],e,i;i=r.createArrayFromString(this.getIgnoredChartTypes());e=this._getChartTypes();for(a in e){if(a){if(i.indexOf(a)<0){b.push({key:a,text:e[a]});}}}return b;};p1.prototype._retrieveChartTypeDescription=function(a){var b=this._getChartTypes();return({key:a,text:b[a]});};p1.prototype._setChartType=function(a){if(this._oChart){var b=this._oChart.getHeight();this._oChart.setChartType(a);this._aDetailsEntries=[];this._toggleMeasureUnitBinding(a,this._oChart.getMeasures());this._oChart.setHeight(b);}};p1.prototype._toggleMeasureUnitBinding=function(a,b){if(typeof b!='undefined'&&b instanceof Array){if(a.substring(0,4)==="100_"){b.forEach(function(i){i.setUnitBinding();});}else{if(this._oChartProvider){var e=this._oChartProvider._aODataFieldMetadata;b.forEach(function(l){for(var i=e.length-1;i>=0;i--){if(e[i].name==l.getName()){if(e[i]["Org.OData.Measures.V1.ISOCurrency"]&&e[i]["Org.OData.Measures.V1.ISOCurrency"].Path){l.setUnitBinding(e[i]["Org.OData.Measures.V1.ISOCurrency"].Path);}break;}}});}}}};p1.prototype._getDimensions=function(){var a=[];if(this._oChart){a=this._oChart.getDimensions();}return a;};p1.prototype._getVisibleDimensions=function(){var a=[];if(this._oChart){a=this._oChart.getVisibleDimensions();}return a;};p1.prototype._getMeasures=function(){var a=[];if(this._oChart){a=this._oChart.getMeasures();}return a;};p1.prototype._getVisibleMeasures=function(){var a=[];if(this._oChart){a=this._oChart.getVisibleMeasures();}return a;};p1.prototype._getSortedDimensions=function(){var e=[];if(this._oChart){e=this._oChart.getDimensions();if(e){e.sort(function(a,b){if(a.getLabel()&&b.getLabel()){return a.getLabel().localeCompare(b.getLabel());}});}}return e;};p1.prototype.fetchVariant=function(){if(this._oCurrentVariant==="STANDARD"||this._oCurrentVariant===null){return{};}return this._oCurrentVariant;};p1.prototype.applyVariant=function(a,b){this._oCurrentVariant=a;if(this._oCurrentVariant==="STANDARD"){this._oCurrentVariant=null;}this._bApplyingVariant=true;if(this._oPersController){if(this._oCurrentVariant===null||q.isEmptyObject(this._oCurrentVariant)){this._oPersController.resetPersonalization($.ResetFull);}else{this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}}this._bApplyingVariant=false;this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId()});};p1.prototype.variantsInitialized=function(){this._bVariantInitialised=true;this._checkAndTriggerBinding();};p1.prototype.getUiState=function(){this.getChart();var a=this._oPersController?this._oPersController.getDataSuiteFormatSnapshot():null;return new U({presentationVariant:{ContextUrl:"",MaxItems:this._oChartProvider?this._oChartProvider.getMaxItems():undefined,SortOrder:a?a.SortOrder:[],GroupBy:a?a.GroupBy:[],Total:a?a.Total:[],RequestAtLeast:this._getInResultDimensionTotal(),Visualizations:a?a.Visualizations:[]},selectionVariant:{SelectOptions:a?a.SelectOptions:[]},variantName:this.getCurrentVariantId()});};p1.prototype.setUiState=function(a){if(this._oPersController){var b=(this._oVariantManagement&&a.getVariantName())?this._oVariantManagement.getVariantContent(this,a.getVariantName()):{};this._oPersController.setDataSuiteFormatSnapshot(Q({},a.getPresentationVariant(),a.getSelectionVariant()),b,true);}if(a.getPresentationVariant()&&this._oChart){this._oChart.setInResultDimensions(a.getPresentationVariant().RequestAtLeast);}else{this._oUiStateRequestAtLeast=a.getPresentationVariant().RequestAtLeast;}};p1.prototype.setUiStateAsVariant=function(a){if(this._oPersController){this._oPersController.setPersonalizationDataAsDataSuiteFormat(Q({},a.getPresentationVariant(),a.getSelectionVariant()),true);}if(a.getPresentationVariant()){this._oChart.setInResultDimensions(a.getPresentationVariant().RequestAtLeast);}};p1.prototype.setRequestAtLeastFields=function(a){this.setProperty("requestAtLeastFields",a);if(this._oChart){this._updateInResultDimensions();}return this;};p1.prototype._getInResultDimensionTotal=function(){var i=[];if(this.getRequestAtLeastFields()){i=this.getRequestAtLeastFields().split(",");}i=i.concat(this._aAlwaysSelect);if(this._oChart){i=i.concat(this._oChart.getInResultDimensions());}if(this._oUiStateRequestAtLeast){i.concat(this._oUiStateRequestAtLeast);this._oUiStateRequestAtLeast=null;}return i.filter(function(e,a,b){return a==b.indexOf(e);});};p1.prototype._getFieldTooltip=function(a){var b=this._getFieldByKey(a);if(b){return b.quickInfo;}return"";};p1.prototype._getFieldByKey=function(a){var i,b=null;if(this._oChartViewMetadata&&this._oChartViewMetadata.fields){for(i=0;i<this._oChartViewMetadata.fields.length;i++){b=this._oChartViewMetadata.fields[i];if(a===b.name){return b;}}return null;}};p1.prototype._getByKey=function(a,b){var i,l,e,n;if(a){l=a.length;for(i=0;i<l;i++){e=a[i];n=e.data("p13nData");if(n&&n.columnKey===b){return e;}}}return null;};p1.prototype._getDimensionByKey=function(a){if(this._oChart){return this._getByKey(this._oChart.getDimensions(),a);}return null;};p1.prototype._getMeasureByKey=function(a){if(this._oChart){return this._getByKey(this._oChart.getMeasures(),a);}return null;};p1.prototype._getChartObjByKey=function(a){var b=this._getDimensionByKey(a);if(!b){b=this._getMeasureByKey(a);}return b;};p1.prototype._getPathFromColumnKeyAndProperty=function(a,b){var e=null,i,l;i=this._getChartObjByKey(a);if(i){l=i.data("p13nData");if(l){e=l[b];}}return e;};p1.prototype._getChartPersonalisationData=function(){if(!this._oCurrentVariant){return null;}var a=[],b=[],e=[],i,l,n;if(this._oCurrentVariant.sort){l=this._oCurrentVariant.sort.sortItems;}else{l=this._aInitialSorters;}if(l){l.forEach(function(y1){var z1=y1.operation==="Descending";n=y1.columnKey;a.push(new m(n,z1));},this);}if(this._oCurrentVariant.filter){this._oCurrentVariant.filter.filterItems.forEach(function(y1){var z1=y1.value1,A1=y1.value2;n=y1.columnKey;if(z1 instanceof Date&&this._oChartProvider&&this._oChartProvider.getIsUTCDateHandlingEnabled()){z1=D.localToUtc(z1);A1=A1?D.localToUtc(A1):A1;}if(y1.exclude){e.push(new o(n,"NE",y1.operation==="Empty"?"":z1));}else if(y1.operation==="Empty"){b.push(new o(n,"EQ",""));}else{b.push(new o(n,y1.operation,z1,A1));}},this);if(e.length){i=new o(e,true);}}return{filters:b,excludeFilters:i,sorters:a};};p1.prototype._persistPersonalisation=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){var a=this.getCurrentVariantId();if(!this._bSaving){this._bSaving=true;this._oVariantManagement.fireSave({name:"Personalisation",implicit:true,global:false,overwrite:!!a,key:a,def:true});delete this._bSaving;}}};p1.prototype.getCurrentVariantId=function(){var a="";if(this._oVariantManagement){a=this._oVariantManagement.getCurrentVariantId();}return a;};p1.prototype.setCurrentVariantId=function(a){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setCurrentVariantId(a);}else{L.error("sap.ui.comp.smartchart.SmartChart.prototype.setCurrentVariantId: VariantManagement does not exist or is a page variant");}return this;};p1.prototype._adjustHeight=function(){if(this._oChart){var i=0,b=0;var a=this.getDomRef()?this.getDomRef().offsetHeight:0;if(a===0){return;}if(this._oToolbar&&this._oToolbar.getDomRef()){i=this._oToolbar.getDomRef().offsetHeight;}if(this._oDrillBreadcrumbs&&this._oDrillBreadcrumbs.getDomRef()){var e=this._oDrillBreadcrumbs.getDomRef().parentNode?this._oDrillBreadcrumbs.getDomRef().parentNode:this._oDrillBreadcrumbs.getDomRef();b=e.offsetHeight;}var l=a-i-b;this._oChart.setHeight(l+"px");this._updateDrillBreadcrumbs();if(this._hasOverlay){setTimeout(function(){this._showOverlay(true);}.bind(this),0);}}};p1.prototype._toggleFullScreen=function(b,a){if(!this.oFullScreenButton||(b===this.bFullScreen&&!a)){return;}if(b==true&&this._oChart){this._sChartHeight=this._oChart.getHeight();}this.bFullScreen=b;if(!this._oFullScreenUtil){this._oFullScreenUtil=sap.ui.requireSync("sap/ui/comp/util/FullScreenUtil");}this._oFullScreenUtil.toggleFullScreen(this,this.bFullScreen,this.oFullScreenButton,this._toggleFullScreen,"sapContrastPlus");this._renderFullScreenButton();this.fireFullScreenToggled({fullScreen:b});if(b==false&&this._oChart){this._oChart.setHeight(this._sChartHeight);}};p1.prototype._renderFullScreenButton=function(){this.oFullScreenButton.setTooltip(this.bFullScreen?this._oRb.getText("CHART_MINIMIZEBTN_TOOLTIP"):this._oRb.getText("CHART_MAXIMIZEBTN_TOOLTIP"));this.oFullScreenButton.setText(this.bFullScreen?this._oRb.getText("CHART_MINIMIZEBTN_TEXT"):this._oRb.getText("CHART_MAXIMIZEBTN_TEXT"));this.oFullScreenButton.setIcon(this.bFullScreen?"sap-icon://exit-full-screen":"sap-icon://full-screen");};p1.prototype._enrichFromDataPoints=function(a){var l=a.length;var b=[];var e={};for(var i=0;i<l;i++){this._interpretDataPoint(a[i].dataPoint,a[i].measure,e,b);}if(b.length>0){this._oChart.setActiveColoring({coloring:sap.chart.ColoringType.Criticality,parameters:{measure:b}});this._oChart.setColorings({Criticality:{MeasureValues:e}});}};p1.prototype._interpretDataPoint=function(a,b,e,i){this._setSemanticPatterns(a,b);if(b.setBoundaryValues){this._setBoundaryValues(a,b);}if(a.Criticality||a.CriticalityCalculation){e[a.Value.Path]=this._oChartProvider.provideSemanticColoring(a);i.push(a.Value.Path);}};p1.prototype._setSemanticPatterns=function(a,b){var e=a.TargetValue?a.TargetValue.Path:null;var i=a.ForecastValue?a.ForecastValue.Path:null;b.setSemantics(sap.chart.data.MeasureSemantics.Actual);if(e!=null){var l=this._oChart.getMeasureByName(e);if(l){l.setSemantics(sap.chart.data.MeasureSemantics.Reference);}else{L.error("sap.ui.comp.SmartChart: "+a.TargetValue.Path+" is not a valid measure");}}if(i){var n=this._oChart.getMeasureByName(i);if(n){n.setSemantics(sap.chart.data.MeasureSemantics.Projected);}else{L.error("sap.ui.comp.SmartChart: "+a.ForecastValue.Path+" is not a valid measure");}}b.setSemanticallyRelatedMeasures({referenceValueMeasure:e,projectedValueMeasure:i});};p1.prototype._setBoundaryValues=function(a,b){var e={};if(a.MinimumValue){e.minimum=a.MinimumValue;}if(a.MaximumValue){e.maximum=a.MaximumValue;}if(e.minimum||e.maximum){b.setBoundaryValues(e);}};p1.prototype.isInitialised=function(){return!!this.bIsInitialised;};p1.prototype.exit=function(){this._oRb=null;if(this._oSmartFilter){this._oSmartFilter.detachSearch(this._reBindChart,this);this._oSmartFilter.detachFilterChange(this._filterChangeEvent,this);}if(this._oChartProvider&&this._oChartProvider.destroy){this._oChartProvider.destroy();}this._oChartProvider=null;if(this._oPersController&&this._oPersController.destroy){this._oPersController.destroy();}if(this._oSegmentedButton){this._oSegmentedButton.removeAllButtons();this._oButtonChart1.destroy();this._oButtonChart2.destroy();this._oButtonChart3.destroy();this._oButtonChart4.destroy();this._oButtonChart5.destroy();this._oButtonChart1=null;this._oButtonChart2=null;this._oButtonChart3=null;this._oButtonChart4=null;this._oButtonChart5=null;}this._oPersController=null;if(this._oVariantManagement){this._oVariantManagement.detachSave(this._variantSaved,this);this._oVariantManagement.detachAfterSave(this._variantAfterSave,this);if(!this._oVariantManagement.isPageVariant()&&this._oVariantManagement.destroy){this._oVariantManagement.destroy();}}this._oVariantManagement=null;this._destroyPopover();if(this._oFullScreenUtil){this._oFullScreenUtil.cleanUpFullScreen(this);this._oFullScreenUtil=null;}if(this._oDetailsPopover){this._oDetailsPopover.destroy();if(this._oRelatedAppsMasterList){this._oRelatedAppsMasterList.destroy();}}if(this.oChart){this._oChart.detachRenderComplete(this._toggleZoomButtonEnablement,this);}this._oCurrentVariant=null;this._oChartViewMetadata=null;this._aAlwaysSelect=null;this._aInitialSorters=null;this._oSmartFilter=null;this._oToolbar=null;this._oChartPersonalisationButton=null;this._oView=null;this._oChart=null;};p1.prototype._processResizeHandler=function(a){if(a){this.sResizeListenerId=null;if(s.system.desktop){this.sResizeListenerId=sap.ui.core.ResizeHandler.register(this,this._adjustHeight.bind(this));}else{s.orientation.attachHandler(this._adjustHeight,this);s.resize.attachHandler(this._adjustHeight,this);}}else{if(s.system.desktop&&this.sResizeListenerId){sap.ui.core.ResizeHandler.deregister(this.sResizeListenerId);this.sResizeListenerId=null;}else{s.orientation.detachHandler(this._adjustHeight,this);s.resize.detachHandler(this._adjustHeight,this);}}};p1.prototype.setShowToolbar=function(b){if(this._oToolbar){this._oToolbar.setVisible(b);}return this.setProperty("showToolbar",b,true);};p1.prototype.setToolbarStyle=function(a){if(this._oToolbar){this._oToolbar.setStyle(a);}return this.setProperty("toolbarStyle",a,true);};p1.prototype.setShowDimensionsTitle=function(b){if(this._oChart){this._oChart.setVizProperties({"categoryAxis":{"title":{"visible":b}}});}return this.setProperty("showDimensionsTitle",b,true);};p1.prototype.setShowMeasuresTitle=function(b){if(this._oChart){this._oChart.setVizProperties({"valueAxis":{"title":{"visible":b}}});}return this.setProperty("showMeasuresTitle",b,true);};p1.prototype._checkDimensionColoring=function(){var a=this._getVisibleDimensions(),b,e={Criticality:{DimensionValues:{}}},l;for(var i=0;i<a.length;i++){b=this._getField(a[i]);l=this._oChartProvider.calculateDimensionColoring(b);if(l){if(this._sColoringDimension!=b.name){e.Criticality.DimensionValues[b.name]=l;this._oChart.setActiveColoring({coloring:sap.chart.ColoringType.Criticality,parameters:{dimension:b.name}});this._oChart.setColorings(e);this._sColoringDimension=b.name;}return;}}};p1.prototype.getIdForLabel=function(){if(this._headerText){return this._headerText.getId();}return V.prototype.getIdForLabel.apply(this,[]);};return p1;});
