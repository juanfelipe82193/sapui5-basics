/*
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/comp/smartfield/BindingUtil","sap/ui/model/ParseException","sap/base/strings/capitalize","sap/base/util/isPlainObject"],function(B,P,c,a){"use strict";var F=function(p,h){this._bIsDestroyed=false;this._oBinding=new B();this._oStoredProperties={};this._bVisibleSet=false;this._bEditableSet=false;this._bMandatorySet=false;this._bUomEditableSet=false;this._oStoredBindings={};this._oParent=p;this._oHelper=h;this._oAnnotation=h.oAnnotation;};F.prototype.getPropertyNames=function(n){if(n){return["editable","visible"];}return["editable","visible","mandatory"];};F.prototype.getControlFormatters=function(m,p){var M,l,n,r={};if(m&&p){l=p.length;while(l--){n=p[l];M="_get"+c(n);if(this[M]){r[n]=this[M](m,this._oParent.getBindingInfo(n));}}}return r;};F.prototype._getEditable=function(m,b,p){if(p===undefined){p="editable";}var d,i=-1,e=-1,f=-1,t=this;var o={length:0};if(p==="uomEditable"){this._bUomEditableSet=true;}else{this._bEditableSet=true;}if(!b){d=this._oParent["get"+c(p)]();this._oStoredProperties[p]=d;this._oStoredBindings.editable=null;}else if(this._oStoredBindings.editable===undefined){this._oStoredBindings.editable=b;}return{path:function(){var g=[],s,l=0;if(!m.property||!m.property.property){return[""];}s=t._oAnnotation.getFieldControlPath(m.property.property);if(s){g.push(t._toPath(m,s));i=l;l++;}if(m.entitySet["sap:updatable-path"]){g.push(m.entitySet["sap:updatable-path"]);e=l;l++;}if(b){f=l;t._oBinding.getBindingParts(b,g,o);l=l+o.length;}if(l>0){return g;}return[""];},formatter:function formatEditable(v,g,h,j){if(t._bIsDestroyed){return false;}if(!t._oAnnotation){return false;}var s=this||t._oParent;var k;if(s&&(typeof s.getBindingContext==="function")){k=s.getBindingContext();}var E=k&&k.getObject(),l=E&&E.__metadata,n=!!(l&&l.created),q=m.property&&m.property.property;if(E&&q){if(n){if(!t._getCreatableStatic(m)){return false;}}else if(!t._getUpdatableStatic(m)){return false;}}var r=[];if(i>-1){r.push(arguments[i]!==1);}if(e>-1&&(!E||!l||!n)){r.push(!!arguments[e]);}if(f>-1){if(b.formatter){r.push(t._execFormatter(b.formatter,arguments,f,o.length));}else{r.push(!!arguments[f]);}}if(r.length==0){var u=s&&s.getBinding(p),w=s&&s.getBindingPath(p),x=w==="",y=!!u&&u.isInitial(),V=(v==null);if(y&&V&&x){}else if(!y&&V){d=true;}else if(!y&&!V&&x&&!a(v)){d=v;}else{d=t._oParent["get"+c(p)]();}r.push(d);}return t._compare(r,false,true);}};};F.prototype._execFormatter=function(f,A,s,l){var b=[],i;if(s>-1&&l>-1){for(i=0;i<l;i++){b.push(A[s+i]);}}return f.apply(this._oParent,b);};F.prototype._getCreatableStatic=function(m){return(this._oAnnotation.canCreateEntitySet(m.entitySet)&&this._oAnnotation.canCreateProperty(m.property.property));};F.prototype._getUpdatableStatic=function(m){return(this._oAnnotation.canUpdateEntitySet(m.entitySet)&&this._oAnnotation.canUpdateProperty(m.property.property));};F.prototype._compare=function(A,p,d){var i,l=A.length;for(i=0;i<l;i++){if(A[i]===p){return p;}}return d;};F.prototype._getVisible=function(m,b,p){if(p===undefined){p="visible";}var d,i=-1,e=-1,t=this;var o={length:0};this._bVisibleSet=true;if(!b){d=this._oParent["get"+c(p)]();this._oStoredProperties[p]=d;this._oStoredBindings.visible=null;}else if(this._oStoredBindings.visible===undefined){this._oStoredBindings.visible=b;}return{path:function(){var f=[],s,l=0;if(!m.property||!m.property.property){return[""];}s=t._oAnnotation.getFieldControlPath(m.property.property);if(s){f.push(t._toPath(m,s));e=l;l++;}if(b){i=l;t._oBinding.getBindingParts(b,f,o);l=l+o.length;}if(l>0){return f;}return[""];},formatter:function formatVisible(v,f){if(t._bIsDestroyed){return false;}if(!t._oAnnotation){return false;}var s=this||t._oParent;var E=m.property&&m.property.property;if(E&&(t._oAnnotation.getVisible(E)==="false")){return false;}var V=[];if(e>-1){V.push(arguments[e]!==0);}if(i>-1){if(b.formatter){V.push(t._execFormatter(b.formatter,arguments,i,o.length));}else{V.push(!!arguments[i]);}}if(V.length==0){var g=s&&s.getBinding(p),h=s&&s.getBindingPath(p),j=h==="",k=!!g&&g.isInitial(),l=(v==null),n;if(k&&l&&j){n=d;}else if(!k&&l){n=true;}else if(!k&&!l&&j&&!a(v)){n=v;}else{n=t._oParent["get"+c(p)]();}V.push(n);}return t._compare(V,false,true);}};};F.prototype._getMandatory=function(m,b){var i=-1,p=-1,t=this;var o={length:0};this._bMandatorySet=true;if(!b){this._oStoredProperties.mandatory=this._oParent.getMandatory();this._oStoredBindings.mandatory=null;}else if(this._oStoredBindings.mandatory===undefined){this._oStoredBindings.mandatory=b;}return{path:function(){var d=[],s,l=0;if(!m.property||!m.property.property){return[""];}s=t._oAnnotation.getFieldControlPath(m.property.property);if(s){d.push(t._toPath(m,s));p=l;l++;}if(b){i=l;t._oBinding.getBindingParts(b,d,o);l=l+o.length;}if(l>0){return d;}return[""];},formatter:function formatMandatory(d,e){if(t._bIsDestroyed){return true;}var E=m.property&&m.property.property,M=[];if(E){if((E.nullable==="false")||(t._oAnnotation&&t._oAnnotation.isStaticMandatory(E))){M.push(true);}else if(E.nullable){M.push(false);}}var f=p>-1;if(f){M.push(arguments[p]===7);}var g=i>-1;if(g){if(b.formatter){M.push(t._execFormatter(b.formatter,arguments,i,o.length));}else{M.push(!!arguments[i]);}}if((M.length===0)||((E.nullable==="true")&&!f&&!g)){M.push(t._oParent.getMandatory());}return t._compare(M,true,false);}};};F.prototype._toPath=function(m,p){if(m.property.complex){return m.path.replace(m.property.property.name,p);}if(m.navigationPath){return m.navigationPath+"/"+p;}return p;};F.prototype.getMandatoryCheck=function(p){if(p){switch(p.property.type){case"Edm.DateTimeOffset":case"Edm.DateTime":case"Edm.Time":case"Edm.String":case"Edm.Decimal":case"Edm.Double":case"Edm.Float":case"Edm.Single":case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":case"Edm.Byte":case"Edm.SByte":return function(v,s){var e=(v===""||v==null);if(e){var m=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("VALUEHELPVALDLG_FIELDMESSAGE");if(this._oAnnotation&&!this._oAnnotation.isNullable(p.property)){throw new P(m);}if(this._oParent.getClientSideMandatoryCheck()&&this._oParent.getMandatory()){throw new P(m);}}}.bind(this);}}};F.prototype.getUOMEditState=function(m){var n,u,U,l=0,b;b=this._oParent.getBindingInfo("editable");n=this._getEditable(m,b);U={model:m.model,path:this._oHelper.getUOMPath(m),entitySet:m.entitySet,entityType:m.entityType,property:{property:m.annotations.uom.property,complex:m.property.complex,typePath:this._oHelper.getUOMTypePath(m)}};u=this._getEditable(U,this._oParent.getBindingInfo("uomEditable"),"uomEditable");return{path:function(){var N=n.path(),d=u.path();if(N[0]===""&&d===""){return[""];}l=N.length;return N.concat(d);},formatter:function formatUOMEditable(v,p,d,e){var A=[],i,N,f,g=arguments.length;for(i=0;i<l;i++){A.push(arguments[i]);}N=n.formatter.apply(null,A);A=[];for(i=0;i<g;i++){A.push(arguments[i]);}for(i=0;i<l;i++){A.shift();}f=u.formatter.apply(null,A);if(!f&&!N){return 0;}return 1;}};};F.prototype.hasUomEditState=function(m){var p;if(m&&m.annotations&&m.annotations.uom){p=this._oParent.getControlProposal();if(p){if(p.getControlType()==="ObjectNumber"){return true;}if(p.getObjectStatus()){return true;}}return this._oParent.getProposedControl()==="ObjectNumber";}return false;};F.prototype.bindProperties=function(s){var d={propertiesNames:this.getPropertyNames()};s=Object.assign(d,s);var p=s.propertiesNames,m=s.metadata;if(p.length){var f=this.getControlFormatters(m,p);for(var b in f){var o=this._oBinding.fromFormatter(m.model,f[b]);this._oParent.bindProperty(b,o);}}};F.prototype.destroy=function(){if(this._oBinding){this._oBinding.destroy();this._oBinding=null;}this._oAnnotation=null;var s=this._oParent;if(s&&!s._bInDestroy){var S=true;for(var p in this._oStoredProperties){s.unbindProperty(p,S);var m="set"+c(p),M=s[m];if(typeof M==="function"){M.call(s,this._oStoredProperties[p]);}}if(this._oStoredProperties){if(!this._oStoredProperties.editable&&this._bEditableSet){s.unbindProperty("editable");}if(!this._oStoredProperties.visible&&this._bVisibleSet){s.unbindProperty("visible");}if(!this._oStoredProperties.mandatory&&this._bMandatorySet){s.unbindProperty("mandatory");}if(!this._oStoredProperties.uomEditable&&this._bUomEditableSet){s.unbindProperty("uomEditable");}}if(this._oStoredBindings){if(this._oStoredBindings.editable){s.bindProperty("editable",this._oStoredBindings.editable);}if(this._oStoredBindings.visible){s.bindProperty("visible",this._oStoredBindings.visible);}if(this._oStoredBindings.mandatory){s.bindProperty("mandatory",this._oStoredBindings.mandatory);}if(this._oStoredBindings.uomEditable){s.bindProperty("uomEditable",this._oStoredBindings.uomEditable);}}}this._oStoredProperties=null;this._oStoredBindings=null;this._oParent=null;this._oHelper=null;this._bIsDestroyed=true;this._bEditableSet=false;this._bMandatorySet=false;this._bVisibleSet=false;this._bUomEditableSet=false;};return F;},true);
