sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/Control","sap/m/ResponsivePopover","sap/m/List","sap/ui/model/json/JSONModel","sap/m/ListMode","sap/m/PlacementType","sap/m/StandardListItem","sap/ui/core/CustomData","sap/ui/model/Sorter","sap/rules/ui/parser/infrastructure/util/utilsBase","sap/rules/ui/services/AstExpressionLanguage","sap/rules/ui/ExpressionAdvanced","sap/rules/ui/AutoCompleteSuggestionContent","sap/rules/ui/ExpressionBase","sap/rules/ui/ast/constants/Constants","sap/rules/ui/ast/util/AggregateFunctionDialog","sap/rules/ui/ast/util/SelectFunctionDialog","sap/rules/ui/ast/provider/TermsProvider","sap/rules/ui/ast/parser/bundlelibrary","sap/ui/core/LocaleData"],function(q,l,C,R,L,J,a,P,S,b,c,d,A,E,f,g,h,j,k,T,m,n){"use strict";var o=g.extend("sap.rules.ui.AstExpressionBasic",{metadata:{properties:{library:"sap.rules.ui",value:{type:"string",defaultValue:""},dataObjectInfo:{type:"string",bindable:"bindable",defaultValue:""},resultDataObjectId:{type:"string",defaultValue:""},conditionContext:{type:"boolean",defaultValue:false},operationsContext:{type:"boolean",defaultValue:false},jsonData:{type:"array",bindable:"bindable",defaultValue:[]},enableAggregateFunctionVocabulary:{type:"boolean",defaultValue:false},enableAggregateFunctionWhereClause:{type:"boolean",defaultValue:false},isAttributeContext:{type:"boolean",defaultValue:false},countFunctionSelected:{type:"boolean",defaultValue:false},placeholder:{type:"string",defaultValue:""},isAssociationContext:{type:"boolean",defaultValue:false}},aggregations:{},events:{"change":{},"liveChange":{}}},init:function(){this.infraUtils=new sap.rules.ui.parser.infrastructure.util.utilsBase.lib.utilsBaseLib();this.oBundle=sap.ui.getCore().getLibraryResourceBundle("sap.rules.ui.i18n");this.aggregateFunctionCallBack=q.proxy(this._updateAggregateFunction,this);this.functionCallBack=q.proxy(this._updateSelectFunction,this);this._reference=q.proxy(this.callback,this);this._isDialogOpenedCallbackReference=q.proxy(this.isDialogOpenedCallback,this);this._uiModel=[];this._cursorPostion=0;this._selectedSpans=null;this._hasTextContent=false;this._createPopver();this._attributeContext=false;this._bCtrlSpacePressed=false;this.bShiftPressed=false;this.shiftKey="";this.isDialogOpen=false;this._focusedOut=false;this._jsonArray=[];this.functionClicked=false;this.isAutoSuggestionRequired=true;this.isDotRequired=true;this.aggregateFunctionDialog=j.getInstance();this.selectFunctionDialog=k.getInstance();this.astLibInstance=m.getInstance();this.bTypingFlow=false;this.bEditInBetween=false;this.nIndexOfToken=0;this.tempRelString="";this.filterText="";this.filterTextLength=0;var e=sap.ui.getCore().getEventBus();e.subscribeOnce("sap.ui.rules","_onHiddenSelected",this._hiddenAccessModeSelected,this);},onBeforeRendering:function(){this._enableAggregateFunctionVocabulary=this.getEnableAggregateFunctionVocabulary();this._enableAggregateFunctionWhereClause=this.getEnableAggregateFunctionWhereClause();this.isCountFunctionSelected=this.getCountFunctionSelected();},callback:function(e,i){this._setTextOnCursorPosition(e);},isDialogOpenedCallback:function(i){this.isDialogOpen=i;if(!i){this.functionClicked=false;}},onAfterRendering:function(){this.referenceId="";this.isAutoSuggestionRequired=true;this.dotInOperationsContext=false;this._oAstExpressionLanguage=sap.ui.getCore().byId(this.getAstExpressionLanguage());this._input=this.$("input");this._validateControl();this._input[0].contentEditable=this.getEditable();this._input[0].classList.add("sapAstExpressionInput");if(!this.getEditable()){this._input[0].classList.add("sapAstExpressionInputNotEditable");}else{this._input[0].classList.remove("sapAstExpressionInputNotEditable");}if(this.aCustomStyleClasses&&this.aCustomStyleClasses.length>0){this._input[0].classList.add(this.aCustomStyleClasses[0]);}if(this.getJsonData()){this._jsonArray=this.getJsonData();}if(this.getValue()&&this.getValue().trim()){var e=this.markerString?this.markerString.trim():"";if(e===this.getValue()){this.setValue("");}this._uiModel=this._convertInputToUiModel(this.getValue());this._uiModelToSpan(this._uiModel);this._selectedSpans=[];this._selectedSpans.push(this._input.children()[this._input.children().length-1]);if(!this.bTypingFlow&&this._selectedSpans[0]&&!this._selectedSpans[0].textContent.endsWith(h.DOT)&&this._selectedSpans[0].getAttribute(h.TOKEN_TYPE)!==h.WS&&this._selectedSpans[0].getAttribute(h.TOKEN_TYPE)!==h.UNDEFINED&&!this.dotInOperationsContext&&!(this._enableAggregateFunctionVocabulary&&this.isCountFunctionSelected&&this._jsonArray.length===0)){this._createSpaceSpanItem();}this.bTypingFlow=false;if(!this.dataObjectInfo){this.dataObjectInfo=this.getDataObjectInfo()+this.relString;}this._hasTextContent=true;}else{this.relString="";this._uiModel=[];this._uiModelToSpan(this._uiModel);this.dataObjectInfo="";}this._cursorPostion=this._getCaretPosition();this._setCurrentCursorPosition(this._cursorPostion);this._setUpEventHandlers();},_convertInputToUiModel:function(i){if(i){this.astNodesString=this._oAstExpressionLanguage.getAstNodesString(i);this.relString=this._oAstExpressionLanguage.getRelStringForGivenAstString(this.astNodesString).relString;this._tokens=this._oAstExpressionLanguage.getTokensForGivenStringInput(i);try{this.astresponseNodes=JSON.parse(this.astNodesString);}catch(e){q.sap.log.error("Error in parsing string to JSON: "+e.message);}if(this.astresponseNodes&&this.astresponseNodes[0]&&(this.astresponseNodes[0].Function||(this.astresponseNodes[0].Type&&this.astresponseNodes[0].Type!=="I"))){this.displayString=this._oAstExpressionLanguage._astBunldeInstance.ASTUtil.toAstExpressionString(astNodes);this._jsonArray=this.displayString.JSON;}return this._oAstExpressionLanguage.convertTokensToUiModel(this._tokens,this._jsonArray);}return[];},_generateIDStringFromUIModel:function(){var i="";for(var t in this._uiModel){if(this._uiModel[t].reference!==null){if(this._uiModel[t].text.length>0){i=i+this._uiModel[t].reference;}}else{i=i+this._uiModel[t].text;}}return i;},_getSuggestionsForTheGivenInput:function(i){var _=this._attributeContext;var e=false;var p=false;var r=this.getIsAssociationContext();if(this.getDataObjectInfo()&&!this.functionClicked&&!this.bEditInBetween){i=this.dataObjectInfo;}if(this.getHeaderInfo()&&this.getHeaderInfo().headerValue){i=this.getHeaderInfo().headerValue+" "+i;}if(this.getAttributeInfo()&&i===""){i=this.getAttributeInfo()+" "+h.EQUAL+" ";}if(!this._oAstExpressionLanguage){this._oAstExpressionLanguage=sap.ui.getCore().byId(this.getAstExpressionLanguage());}if(this.getDataObjectInfo()&&this.getIsAttributeContext()){_=this.getIsAttributeContext();i=i.replace(/\./g,"");}if(this.isCountFunctionSelected){_=false;r=true;}if(this.getOperationsContext()&&!this._enableAggregateFunctionVocabulary){e=true;}if(this.getOperationsContext()&&i!==""){if(this.dotInOperationsContext&&this._selectedSpans[0]&&this._selectedSpans[0].textContent.endsWith(h.DOT)){_=true;}else if(this._isFirstTokenAnOperation()&&this._selectedSpans[0].textContent===" "+h.DOT){_=true;i=i.trim();}else if(!_){_=false;p=this._addDotToMiscellaneousSuggestions();}}var t=this._oAstExpressionLanguage.getTokensForGivenStringInput(i);var u=this._oAstExpressionLanguage.convertTokensToUiModelForAutoSuggestion(t);var s={};s.AttributeContext=_;s.OperationsContext=e;s.AssociationContext=r;var v=this._oAstExpressionLanguage.getSuggesstions(u,s);if(p){var w={name:h.DOT,label:this.oBundle.getText("DOTLABEL")};v.autoComplete.categories.operators=v.autoComplete.categories.operators?v.autoComplete.categories.operators:{};var x=v.autoComplete.categories.operators;if(!("miscellaneous"in x)){x.miscellaneous=[];}x.miscellaneous.push(w);}v.autoComplete.businessDataTypeList=v.businessDataTypeList;return v;},_getSuggestionsForEditedInput:function(F){this.tempRelString=this._cursorPostion===0?"":this._calculateStringAndIndexOfNewToken();if(this._enableAggregateFunctionWhereClause){this.tempRelString=this.getDataObjectInfo()+this.tempRelString;}var t=this._oAstExpressionLanguage.getTokensForGivenStringInput(this.tempRelString);var e=this._getStringForFilterAndTempRelString(t);this._suggestionsList=this._getSuggestionsForTheGivenInput(e.tempRelString);if(F){var s=e.filterText;var i=this._filterSuggestionList(s);if(i.hasSuggestions){this._suggestionsList=i;}}if(!F&&e.filterText){var p=this._getTermIdForTheGivenText(e.filterText);var r=e.tempRelString+p;this._suggestionsList=this._getSuggestionsForTheGivenInput(r);}},_addDotToMiscellaneousSuggestions:function(){if(this._uiModel&&this._uiModel[0]&&"getText"in this._uiModel[0]&&(this._uiModel[0].getText().toUpperCase()===h.UPDATE)){var u=this._uiModel.length;var e=this._uiModel[u-1];if(this.bEditInBetween&&this.nIndexOfToken){e=this._uiModel[this.nIndexOfToken];}var i=e.dataObjectType;var p=e.getReference();var r=p?p.split("/"):[];if(!p){return false;}if(i===h.ASSOCIATIONDOTYPE){return true;}else if(r&&r.length>2){return false;}else{p=r[1];p=this._oAstExpressionLanguage._astBunldeInstance.TermsProvider.TermsProvider.getTermByTermId(p);if(p&&p._isDataObjectElement){return false;}else{return true;}}}return false;},_constructExpandedRelString:function(e){var i="";if(e.function===h.AVG||e.function===h.SUM||e.function===h.MIN||e.function===h.MAX){i=this._hasAssociationId(e.vocabulary,e.function)?this._returnAttributeBasedOnCardinality(e.vocabulary):this._fetchAttributes(e.vocabulary);return e.function+"("+this.getTable(e)+","+i+this.getGroupByAttributes(e.groupBy)+")";}else if(e.function===h.COUNTDISTINCT||e.function===h.DISTINCT){i=this._hasAssociationId(e.vocabulary,e.function)?this._returnAttributeBasedOnCardinality(e.vocabulary):this._fetchAttributes(e.vocabulary);return e.function+"("+this.getTable(e)+","+i+")";}else if(e.function===h.COUNT){return e.function+"("+this.getTable(e)+this.getGroupByAttributes(e.groupBy)+")";}else if(e.function===h.TOP||e.function===h.BOTTOM||e.function===h.SELECT||e.function===h.FIRST){return this._constructExpandedRelStringForSelect(e);}},_getAttributesSelectQuery:function(e){var s=",";var i="";if(e&&!q.isEmptyObject(e.attributes)){for(var p in e.attributes){i+=s+p;}}return i;},_constructSelectQuery:function(e){var i="";if(e.doVocabId){i=e.doVocabId;}else{i=e.dataObject;}if(this._getAttributesSelectQuery(e)){return h.SELECT+"("+this._constructSortQuery(e)+this._getAttributesSelectQuery(e)+")";}else if(e.filter){return h.FILTER+"("+i+","+e.filter+")"}else{return i;}},_constructSortQuery:function(e){var i="";var p="";if(e.doVocabId){p=e.doVocabId;}else{p=e.dataObject;}if(!e.filter){i=p;}else{i=h.FILTER+"("+p+","+e.filter+")";}if(!q.isEmptyObject(e.attributes)){for(var r in e.attributes){if(e.attributes[r]!==h.NOSORT){i=e.attributes[r]+"("+i+","+r+")";}}}return i;},_constructExpandedRelStringForSelect:function(e){if(e.function===h.TOP||e.function===h.BOTTOM){return e.function+"("+this._constructSelectQuery(e)+","+e.count+")";}else if(e.function===h.SELECT){return this._constructSelectQuery(e);}else if(e.function===h.FIRST){return e.function+"("+this._constructSelectQuery(e)+")";}},getTable:function(e){var i=e.dataObject;if(this._hasAssociationId(e.vocabulary,e.function)){i=this._returnDataObjectBasedOnCardinality(e.vocabulary);}if(!e.filter&&(typeof e.vocabulary==="object"||e.vocabulary instanceof Object)){return this._constructExpandedRelStringForSelect(e.vocabulary);}else if(e.filter&&(typeof e.vocabulary==="object"||e.vocabulary instanceof Object)){return h.FILTER+"("+this._constructExpandedRelStringForSelect(e.vocabulary)+","+e.filter+")";}else if(!e.filter){return i;}else{return h.FILTER+"("+i+","+e.filter+")";}},_hasAssociationId:function(v,e){var i="";if((typeof v==="object"||v instanceof Object)){if(v&&v.attributes){for(var p in v.attributes){i=v.doVocabId+p.replace(h.DOT,"");break;}}}else{i=v;}if(i){var s=i.split("/");var r=s[1];if(e===h.COUNT&&s.length>2){for(var t=2;t<s.length;t++){r+=h.DOT+s[t];}}else if(s.length>3){for(var t=2;t<s.length-1;t++){r+=h.DOT+s[t];}}if(this._oAstExpressionLanguage._astBunldeInstance.TermsProvider.TermsProvider.getTermByTermId(r)&&this._oAstExpressionLanguage._astBunldeInstance.TermsProvider.TermsProvider.getTermByTermId(r)._dataObjectType==="AO"){return true;}}return false;},_returnAttributeBasedOnCardinality:function(v){var e="";if((typeof v==="object"||v instanceof Object)){if(v&&v.attributes){for(var i in v.attributes){e=v.doVocabId+i.replace(h.DOT,"");break;}}}else{e=v;}if(e){var s=e.split("/");var p=s[1];var r=0;var t;var u="";if(s.length>2){for(var w=2;w<s.length;w++){p+=h.DOT+s[w];t=this._oAstExpressionLanguage._astBunldeInstance.TermsProvider.TermsProvider.getTermByTermId(p);if(t&&t._dataObjectType==="AO"&&t._cardinality==="1..n"){r=w;}}if(r>0){for(var w=r+1;w<s.length;w++){u+="/"+s[w];}}if(r===0){for(var w=2;w<s.length;w++){u+="/"+s[w];}}}if(u){return h.DOT+u;}else{return"./"+s[s.length-1];}}},_returnDataObjectBasedOnCardinality:function(v){var e="";if((typeof v==="object"||v instanceof Object)){if(v&&v.attributes){for(var i in v.attributes){e=v.doVocabId+i.replace(h.DOT,"");break;}}}else{e=v;}if(e){var s=e.split("/");var p=s[1];var r=0;var t;var u="";if(s.length>2){for(var w=2;w<s.length;w++){p+=h.DOT+s[w];t=this._oAstExpressionLanguage._astBunldeInstance.TermsProvider.TermsProvider.getTermByTermId(p);if(t&&t._dataObjectType==="AO"&&t._cardinality==="1..n"){r=w;}}if(r>0){for(var w=1;w<=r;w++){u+="/"+s[w];}}}if(u){return u;}else{return"/"+s[1];}}},getGroupByAttributes:function(e){var s=",";var p="";if(e&&e.length>0){for(var i=0;i<e.length;i++){p+=(s+e[i]);}}return p;},_fetchAttributes:function(v){if(typeof v==="string"||v instanceof String){var s=v.split("/");var e="";if(s.length>3){for(var i=2;i<s.length;i++){e+="/"+s[i];}return h.DOT+e;}else{return"./"+s[2];}}else if(Object.keys(v.attributes).length===1){for(var p in v.attributes){return p;}}else{}},_createUUID:function(){return this.infraUtils.createUUID();},_createSpanItem:function(i){var p=this.getId();this.ruleWithElementDO=false;if(i.tokenType===h.TERM){this.termsProvider=this._oAstExpressionLanguage._astBunldeInstance.TermsProvider.TermsProvider;var t=i.reference.split("/")[1];var e=this.termsProvider.getTermByTermId(t);if(e&&e.Type==="Rule"&&e.ResultDataObjectId!==""&&e.ResultDataObjectId!==undefined){var r=this.termsProvider.getTermByTermId(e.ResultDataObjectId);if(r&&r.getIsDataObjectElement()){e=r;this.ruleWithElementDO=true;}}if(e&&i&&(e._isDataObjectElement||i.dataObjectType==="ruleWithElementDO")){t="/"+t;}else{t=i.reference;}var s=this.termsProvider.getTermNameFromASTNodeReference(t);if(s){if("dataObjectType"in i&&i.dataObjectType!=h.Element&&!this.isCountFunctionSelected&&!this.ruleWithElementDO){i.text=s;if(this._addDotToReferenceText(i)){i.text=s+h.DOT;}}else if((i.resultDataObjectId!==""&&i.resultDataObjectId!==undefined&&!this.ruleWithElementDO)||(i.tokenType===h.TERM&&i.dataObjectType!=h.Element&&!this.ruleWithElementDO&&!this.isCountFunctionSelected)){i.text=s;if(this._addDotToReferenceText(i)){i.text=s+h.DOT;}}else{i.text=s;}}}if(i.tokenType===h.FUNCTION&&i.json){this.termsProvider=this._oAstExpressionLanguage._astBunldeInstance.TermsProvider.TermsProvider;var s=this.termsProvider.getTermNameFromASTNodeReference(i.json.dataObject);i.text=i.text.replace(i.json.dataObject,s)}if(i.tokenType===h.DATEBUSINESSDATATYPE||i.tokenType===h.TIMEBUSINESSDATATYPE){var u=this._getDateTimeFormatter(i.tokenType);i.text="'"+u.format(new Date(i.text.replace(/\'/g,"")))+"'";}var v=i.id.replace("/","");var N=q('<span>',{id:p+"-"+v,class:i.cssClass,reference:i.reference,resultDataObjectId:i.resultDataObjectId,json:JSON.stringify(i.json),tokenType:i.tokenType})["text"](i.text);return N;},_getDateTimeFormatter:function(t){var e=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();var i=n.getInstance(e);if(t===h.DATEBUSINESSDATATYPE){var p=i.getDatePattern('medium');var r=sap.ui.core.format.DateFormat.getDateInstance({pattern:p});return r;}else if(t===h.TIMEBUSINESSDATATYPE){var p=i.getDatePattern('medium');var s=i.getTimePattern('medium');var u=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:p+" "+s});return u;}},_isFirstTokenAnOperation:function(){if(this._uiModel&&this._uiModel.length>0&&"getText"in this._uiModel[0]&&(this._uiModel[0].getText().toUpperCase()===h.UPDATE||this._uiModel[0].getText().toUpperCase()===h.APPEND)&&this._uiModel[0].getTokenType()===h.FUNCTION){return true;}return false;},_addDotToReferenceText:function(i){if(this._uiModel&&this.nIndexOfToken&&this._uiModel[this.nIndexOfToken]&&this._uiModel[this.nIndexOfToken].startIndex!==i.startIndex){return false;}var O=this._isFirstTokenAnOperation()&&this.dotInOperationsContext;if(O||(!O&&this._attributeContext)||(!O&&i.dataObjectType==="AO")||(!this._isFirstTokenAnOperation()&&(i.dataObjectType==="S"||i.dataObjectType==="T"))){this._attributeContext=true;return true;}return false;},_uiModelToSpan:function(u){var t="";var H="";for(var i=0;i<u.length;i++){H+=this._createSpanItem(u[i])[0].outerHTML;}this._input.html(H);return t;},_closeAutoSuggestionPopup:function(){if(this._oAutoSuggestionPopUp)this._oAutoSuggestionPopUp.close();},_setUpEventHandlers:function(){var t=this,i=q(this._input),p=[16,17,18,93,13,9,35,36,45,34,33,40,37,38,39,27,44,145,19,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135];if(!this._focusedOut){t._setCurrentCursorPosition(t._cursorPostion);}this._input.on('keydown',function(e){if(e.keyCode===8||e.keyCode==46){t._selectedSpans=t._getSelectedSpans();t._handleBackSpaceAndDeleteKey(e);}else if(e.keyCode===40||e.keyCode===38){t._handleArrowNavigation(e);}else if(e.key==="Control"){t.ctrlPressed=true;}else if(t.ctrlPressed&&(e.keyCode===32||e.key===" ")){t._initializeCursorSpan();t.ctrlPressed=false;t._bCtrlSpacePressed=true;if(!t.dataObjectInfo){t.dataObjectInfo=t.getDataObjectInfo();}if(!t.relString){t.relString="";}}else if(e.key==="Shift"){t.bShiftPressed=true;}else if(t.bShiftPressed&&p.indexOf(e.keyCode)===-1){t.shiftKey=e.key;t.bShiftPressed=false;}else if(e.key==="Tab"||e.keyCode===27){t._closeAutoSuggestionPopup();}else if(p.indexOf(e.keyCode)!==-1&&e.keyCode!==35&&e.keyCode!==36&&e.keyCode!==37&&e.keyCode!==39){e.preventDefault();}});this._input.on("click",function(r){t.ctrlPressed=false;t.forceFireChange=false;t._initializeCursorSpan();var s;if(!t.getEditable()){return;}if(t._selectedSpans&&t._selectedSpans[0]&&t._selectedSpans[0].getAttribute(h.JSON)){t.functionClicked=true;var _=t._getSuggestionsForTheGivenInput(t._contextForPerviousSpans(t._selectedSpans));t.isDialogOpen=true;try{s=JSON.parse(t._selectedSpans[0].getAttribute(h.JSON));if(s.function===h.TOP||s.function===h.BOTTOM||s.function===h.SELECT||s.function===h.FIRST){t.selectFunctionDialog._createSelectFunctionDialog(_.autoComplete.categories.functions,t.functionCallBack,t._oAstExpressionLanguage,t._isDialogOpenedCallbackReference,s);}else{s.selectExpression=typeof s.vocabulary==="object"||s.vocabulary instanceof Object?t._constructExpandedRelStringForSelect(s.vocabulary):"";t.aggregateFunctionDialog._createAggregationFunctionDialog(_.autoComplete.categories.functions,t.aggregateFunctionCallBack,t._oAstExpressionLanguage,t._isDialogOpenedCallbackReference,s);}}catch(e){q.sap.log.error("Error in parsing string to JSON: "+e.message);}}t._closeAutoSuggestionPopup();});this._input.on('keyup',function(e){var r=q(this);var s=false;if(e.keyCode==8||e.keyCode==46){t._updateUiModel();t._calculateStringAndIndexOfNewToken();}t._initializeCursorSpan();if(!t.dataObjectInfo){t.dataObjectInfo=t.getDataObjectInfo();}if(e.key==="Control"||e.keyCode===35||e.keyCode===36||e.keyCode===37||e.keyCode===39){return;}if(t.bEditInBetween){t.bTypingFlow=!t._bCtrlSpacePressed;t._getSuggestionsForEditedInput(true);}if(t._bCtrlSpacePressed){if(!t.bEditInBetween){t._suggestionsList=t._getSuggestionsForTheGivenInput(t.relString);var u=t._input.children()[t._input.children().length-1];if(u){t._selectedSpans=[];t._selectedSpans.push(u);}}if((t._selectedSpans[0]&&t._selectedSpans[0].getAttribute(h.TOKEN_TYPE)===h.UNDEFINED&&t._selectedSpans[0].textContent.startsWith(h.SINGLE_QUOTE))||(t._selectedSpans[0].className==="sapAstLiteralClass")){t._suggestionsList.autoComplete.showLiteral=true;t._suggestionsList.autoComplete.literalInput=t._selectedSpans[0].textContent;if(t._selectedSpans[0]&&t._selectedSpans[0].getAttribute("reference")){t._suggestionsList.autoComplete.literalInput=t._selectedSpans[0].getAttribute("reference");}}t._showAutoSuggestion(t._suggestionsList);t._bCtrlSpacePressed=false;return;}var v=r.data('before');var w=this.textContent;if(w&&e.key!==" "){w=w.trim();}if(v){v=v.trim();}if(w!==v){t.bTypingFlow=true;if(((e.keyCode!==8&&e.keyCode!==46)&&p.indexOf(e.keyCode)===-1)||(e.key==="Shift"&&t.shiftKey!=="")){var x=e.key==="Shift"?t.shiftKey:e.key;t._updateUIModelForFreeFlow(x);if(x===" "&&((t._selectedSpans[0].className!=="sapAstLiteralClass"&&t._selectedSpans[0].className!=="sapAstAuxilaryNodeClass")||(t._selectedSpans[0].className==="sapAstLiteralClass"&&!(t.filterTextLength<t._selectedSpans[0].textContent.length)))){t.nIndexOfToken+=1;t._setCaretPosition({spanIndex:t.nIndexOfToken,position:0});}s=true;t.shiftKey="";}t._handleKeyUpEvent(w,e,s);r.data('before',w);t._bCtrlSpacePressed=false;}});this._input.on('focusout',function(e){t._focusedOut=true;if(!t.isDialogOpen&&!t._oAutoSuggestionPopUp.isOpen()){t._validateControl();}t._handlePopupFocusOut(e);});this._input.on('focus',function(e){t._focusedOut=false;var r=q(this);r.data('before',r.context.textContent);});},_handleBackSpaceAndDeleteKey:function(e){var p=false;var t=this;if(e.keyCode==46){p=true;}t._calculateStringAndIndexOfNewToken();if(p&&t.bEditInBetween&&t._selectedSpans&&"className"in t._selectedSpans[0]&&(t._selectedSpans[0].className=="sapAstAuxilaryNodeClass"&&this._getFullTextContentLength()===this._cursorPostion)){var r=t._getSelectedSpanGivenIndex(this.nIndexOfToken+1);if(r&&r[0]&&r[0].className==="sapAstObjectClass"){t._selectedSpans=r;t._setCaretPosition({spanIndex:t.nIndexOfToken+1,position:0});t._calculateStringAndIndexOfNewToken();}}if(t._selectedSpans[0].className==="sapAstObjectClass"){var s=t._selectedSpans[0].textContent;var u=t._selectedSpans[0].getAttribute(h.REFERENCE).split("/");var v="";var w="";var x=s.split(h.DOT);var y="";var z="";if((t.filterTextLength>0&&!p)||p){for(var i=1;i<u.length;i++){y=w;w+=x[i-1]+h.DOT;t._attributeContext=true;if(t.filterText.indexOf(w)>=0&&(!(t.filterText==w)||(p&&t.filterText==w))){v+="/"+u[i];continue;}else{break;}}var B=T.getInstance();z=v.replace(/\//,"");z=z.replace(/\//g,".");var D=B.getTermByTermId(z);if(D&&D._dataObjectType==="AO"&&t._enableAggregateFunctionWhereClause&&!t.getIsAttributeContext()){v=h.DOT+v;this.isDotRequired=false;}var F=t._cursorPostion>0?y.length:t._cursorPostion-t._selectedSpans[0].textContent.length-y.length;t._selectedSpans[0].textContent=y;t._setCaretPosition({spanIndex:t.nIndexOfToken,position:F});t._selectedSpans[0].setAttribute(h.REFERENCE,v);e.preventDefault();if(v===""){t._removeSpans();t.nIndexOfToken=t.nIndexOfToken>0?t.nIndexOfToken-1:0;t._selectedSpans=t._getSelectedSpanGivenIndex(this.nIndexOfToken);var G=t._selectedSpans?t._selectedSpans[0].textContent.length:0;t._setCaretPosition({spanIndex:t.nIndexOfToken,position:G});}}}else if(t._selectedSpans[0]&&t.filterTextLength!==0&&((t._selectedSpans[0].className==="sapAstFunctionClass"&&t._selectedSpans[0].getAttribute(h.JSON))||(t._selectedSpans[0].className==="sapAstLiteralClass"&&t._selectedSpans[0].textContent.startsWith("'")&&t.bEditInBetween&&t.filterTextLength===t._selectedSpans[0].textContent.length))){t._removeSpans();t.nIndexOfToken=t.nIndexOfToken>0?t.nIndexOfToken-1:0;t._setCaretPosition({spanIndex:t.nIndexOfToken,position:t._cursorPostion});e.preventDefault();}else if(t._selectedSpans[0]&&t._selectedSpans[0].getAttribute("class")==="sapAstLiteralClass"&&(t._selectedSpans[0].getAttribute("tokentype")==="D"||t._selectedSpans[0].getAttribute("tokentype")==="T"||t._selectedSpans[0].getAttribute("tokentype")==="U")){t._removeSpans();t.nIndexOfToken=t.nIndexOfToken>0?t.nIndexOfToken-1:0;t._setCaretPosition({spanIndex:t.nIndexOfToken,position:t._cursorPostion});}t._updateUiModel();},_handlePopupFocusOut:function(e){var i=e.currentTarget.id;var r=e.relatedTarget?e.relatedTarget.id:null;var p=sap.ui.getCore().byId(r);var s=p&&p.getParent()?p.getParent().getId():"";if(r&&i!==r){if(!r.startsWith("__item")&&!r.startsWith("__panel")&&!r.startsWith("__link")&&!r.startsWith("__input")&&!r.startsWith("__popover")&&!r.startsWith("content")){this._closeAutoSuggestionPopup();this._fireChange(this.textContent);}else if(r.startsWith("__item")&&(s==="idPredefinedTable")||s.startsWith("__table")){this._closeAutoSuggestionPopup();this._fireChange(this.textContent);}}},_initializeCursorSpan:function(){this._selectedSpans=this._getSelectedSpans();this._cursorPostion=this._getCaretPosition();if(this._cursorPostion===0){this.filterTextLength=0;}if(this._cursorPostion<this._input.text().length){this.bEditInBetween=true;this._calculateStringAndIndexOfNewToken();}else{this.bEditInBetween=false;this.filterTextLength=this._selectedSpans[0].textContent.length;this.nIndexOfToken=this._input.children().length-1;}},_handleArrowNavigation:function(e){e.preventDefault();this._bPopUpFocused=true;var s=this._oAutoSuggestionPopUp.getContent()[0];var i=s.getAggregation("mainLayout").getItems()[0];$(i).focus();},_handleKeyUpEvent:function(e,i,p){var t=this;var r;var s=this._oAstExpressionLanguage.getTokensForGivenStringInput(this._uiModeltoString());if(!this.bEditInBetween){r=this._getStringForFilterAndTempRelString(s);if(i.keyCode===8||i.keyCode===46){this.dataObjectInfo=this.getDataObjectInfo()+r.tempRelString;}}if(this._jsonArray.length>0){s=this._convertInputToUiModel(this.relString);}this._uiModel=t._oAstExpressionLanguage.convertTokensToUiModelForAutoSuggestion(s);this._uiModelToSpan(this._uiModel);this._uiModeltoString();this._getSelectedSpanFromIndex();if(!this._bCtrlSpacePressed&&p&&this.getDataObjectInfo()&&s[s.length-2].type!==this.astLibInstance.IDPParser.ALL_STRING){this.dataObjectInfo=this.getDataObjectInfo()+r.tempRelString;}var u=this.filterTextLength;if(this.bEditInBetween){if(i.keyCode===8||i.keyCode===46){u=this._cursorPostion===0&&this.nIndexOfToken===0&&this.filterTextLength>0?0:this.filterTextLength;}else if(!this._uiModel[this.nIndexOfToken].text.endsWith(i.key)&&(this._selectedSpans[0].className!=="sapAstLiteralClass")&&(this._selectedSpans[0].className!=="")){this.nIndexOfToken+=1;u=1;}else if(i.key==="'"){u=1;}this._getSelectedSpanFromIndex();if(i.key!=="'"&&this._selectedSpans[0]&&"className"in this._selectedSpans[0]&&this._selectedSpans[0].className==="sapAstLiteralClass"){u=this.filterTextLength;}}else{this.nIndexOfToken=this._input.children().length-1;u=this._cursorPostion;}this._setCaretPosition({spanIndex:this.nIndexOfToken,position:u,keyCode:i.keyCode});if(e!==""&&i.key!=='Backspace'){var v=i.key!==" ";if(!this.bEditInBetween){this._selectedSpans=[];this._selectedSpans.push(this._input.children()[this._input.children().length-1]);this._suggestionsList=this._getSuggestionsForTheGivenInput(r.tempRelString);var w=r.filterText;var F=this._filterSuggestionList(w);if(F.hasSuggestions){this._suggestionsList=F;}if(!F.hasSuggestions&&r.filterText){var x=this._getTermIdForTheGivenText(r.filterText);if(x){var y=r.tempRelString+x;this._suggestionsList=this._getSuggestionsForTheGivenInput(y);}else{this._suggestionsList=F;}}if(!(i.keyCode===8||i.keyCode===46)){this._showAutoSuggestion(this._suggestionsList,v);}}if(this._selectedSpans[0]&&this._selectedSpans[0].className!==""&&this._selectedSpans[0].className!=="sapAstLiteralClass"||(this._selectedSpans[0]&&this._selectedSpans[0].getAttribute(h.TOKEN_TYPE)===h.UNDEFINED&&!t._selectedSpans[0].textContent.startsWith(h.SINGLE_QUOTE))){this._showAutoSuggestion(this._suggestionsList,v);}}else{this._closeAutoSuggestionPopup();}},_getTermIdForTheGivenText:function(t){var e=this._oAstExpressionLanguage._astBunldeInstance.TermsProvider.TermsProvider;var i=e.getTermByTermLabel(t);var p="";if(i){p="/"+i._termId;}else{var r=e.getTermByTermName(t);p=r?"/"+r._termId:"";}return p;},_setCaretPosition:function(p){var s=window.getSelection(),e=this.$("input"),r,t,I,F,u=0;var v=function(u){var w=e.children(),x,y,z=0;for(var i=0;i<w.length;i++){x=w[i];y=x.innerText||"";if(z+y.length>u){return{spanIndex:i,position:z+y.length-u};}z+=y.length;}return{spanIndex:Math.max(i-1,0),position:100};};if(typeof p==="number"){p=v(p);}I=p&&p.span;if(p){r=e[0];if(!I){I=r&&r.children&&r.children.length>p.spanIndex?r.childNodes[p.spanIndex]:null;}if(I){t=document.createRange();F=I.firstChild?I.firstChild:I;if(this.bEditInBetween&&this.bTypingFlow){if(p.spanIndex===0&&p.position===0){u=0;}else if(F&&F.length){u=Math.min(F.length,p.position);}}else if(F&&F.length){u=Math.min(F.length,p.position);}}if(!(typeof u==="number")||(F&&F.length&&u>F.length)||u<0){u=0;}if(F){t.setStart(F,u);t.collapse(true);s.removeAllRanges();s.addRange(t);}}},_getStringForFilterAndTempRelString:function(t){var s="";var i="";var e;var p;var r;var u;for(var v in t){e=t[v];u=t[v-1];p=e.type?e.type:e._type;r=u?(u.type?u.type:u._type):null;if(p===this.astLibInstance.IDPParser.EOF||p===this.astLibInstance.IDPParser.DOT){continue;}else if(p===this.astLibInstance.IDPParser.ALL_STRING||(r&&r===this.astLibInstance.IDPParser.ALL_STRING)){i+=e.text;}else{s+=e.text;}}return{tempRelString:s,filterText:i};},_isEmptySpace:function(s){return s===String.fromCharCode(160)||s===" ";},_bRequiredFilteredSuggestion:function(t){return!(this._isEmptySpace(t)||t===""||this._selectedSpans[0].className==="sapAstLiteralClass");},_updateUIModelForFreeFlow:function(s){var t=this;var e=this._selectedSpans[0];if(this._uiModel.length===0){var i={id:t._createUUID(),tokenType:h.UNDEFINED,text:s};var p=this._createSpanItem(i);this._uiModel.push(i);this._uiModelToSpan(this._uiModel);}else if(e.className==="sapAstObjectClass"){if(s===h.DOT&&this.getOperationsContext()){this.dotInOperationsContext=true;this._attributeContext=true;}else{var r=e.getAttribute(h.REFERENCE);if(e.textContent.startsWith(s)){e.setAttribute(h.REFERENCE,s+" "+r);this._cursorPosition+=1;}else if(e.textContent.endsWith(s)){e.setAttribute(h.REFERENCE,r+s);}}}else if(s===h.SINGLE_QUOTE&&this.bEditInBetween){e.textContent=e.textContent.replace(h.SINGLE_QUOTE,h.SINGLE_QUOTE+h.SINGLE_QUOTE);}else if(this.bEditInBetween&&e.nextSibling&&e.nextSibling.className&&e.nextSibling.className==="sapAstFunctionClass"&&((e.className!=="sapAstLiteralClass"&&e.className!=="sapAstAuxilaryNodeClass")||(s!==" "&&e.className==="sapAstAuxilaryNodeClass"&&e.textContent.endsWith(event.key)))){e.textContent+=" ";}this._updateUiModel();},_filterSuggestionList:function(t){var p=false;var F={autoComplete:{categories:{functions:{},operators:{},terms:[]},showLiteral:this._suggestionsList.autoComplete.showLiteral,businessDataTypeList:this._suggestionsList.autoComplete.businessDataTypeList},businessDataTypeList:this._suggestionsList.autoComplete.businessDataTypeList};var s=this._suggestionsList.autoComplete.categories;var e=function(x){var D=[];var y,z,N;for(var i=0;i<x.length;i++){y=(x[i].label).toLowerCase();N=(x[i].name).toLowerCase();z=t.toLowerCase();if(((" "+y).indexOf(" "+z)!==-1)||((" "+N).indexOf(" "+z)!==-1)){D.push(x[i]);p=true;}}return D;};var r=function(){if(s.terms){F.autoComplete.categories.terms=e(s.terms);}if(s.operations){F.autoComplete.categories.operations=e(s.operations);}if(s.functions){var i=s.functions.advanced;if(i&&i.length>0){var x=e(i);if(x&&x.length>0){F.autoComplete.categories.functions.advanced=x;}}var y=s.functions.aggregate;if(y&&y.length>0){var x=e(y);if(x&&x.length>0){F.autoComplete.categories.functions.aggregate=x;}}var z=s.functions.selection;if(z&&z.length>0){var x=e(z);if(x&&x.length>0){F.autoComplete.categories.functions.selection=x;}}var B=s.functions.window;if(B&&B.length>0){var x=e(B);if(x&&x.length>0){F.autoComplete.categories.functions.window=x;}}var D=s.functions.time_duration;if(D&&D.length>0){var x=e(D);if(x&&x.length>0){F.autoComplete.categories.functions.time_duration=x;}}}if(s.operators){var G=s.operators.arithmetic;if(G&&G.length>0){var x=e(G);if(x&&x.length>0){F.autoComplete.categories.operators.arithmetic=x;}}var H=s.operators.comparision;if(H&&H.length>0){var x=e(H);if(x&&x.length>0){F.autoComplete.categories.operators.comparision=x;}}var I=s.operators.logical;if(I&&I.length>0){var x=e(I);if(x&&x.length>0){F.autoComplete.categories.operators.logical=x;}}var K=s.operators.array;if(K&&K.length>0){var x=e(K);if(x&&x.length>0){F.autoComplete.categories.operators.array=x;}}var M=s.operators.range;if(M&&M.length>0){var x=e(M);if(x&&x.length>0){F.autoComplete.categories.operators.range=x;}}var N=s.operators.miscellaneous;if(N&&N.length>0){var x=e(N);if(x&&x.length>0){F.autoComplete.categories.operators.miscellaneous=x;}}var O=s.operators.functional;if(O&&O.length>0){var x=e(O);if(x&&x.length>0){F.autoComplete.categories.operators.functional=x;}}}};if(s){r();}if(!p){var u;if(this.bEditInBetween){u=this._oAstExpressionLanguage.getTokensForGivenStringInput(this.tempRelString)}else{u=this._oAstExpressionLanguage.getTokensForGivenStringInput(this.relString);}var v=u.length-2;t=u[v].text;u=u.slice(0,v);var w=this._getStringForFilterAndTempRelString(u);s=this._getSuggestionsForTheGivenInput(w.tempRelString).autoComplete.categories;r();}F.hasSuggestions=p;return F;},_fireChange:function(t){if(this.isDialogOpen&&!this.forceFireChange){return;}var e="";if(!this.relString&&t){this.relString=t;}if(!this.relString){this.relString="";}if(this.markerString){this.markerRelString=this.markerString+this.relString;e=this._oAstExpressionLanguage.getAstNodesString(this.markerRelString);}else{e=this._oAstExpressionLanguage.getAstNodesString(this.relString);}this.astresponseNodes=JSON.parse(e);if(this.astresponseNodes.length>=0&&this.getValue().replace(/\s/g,"")!==this.relString.replace(/\s/g,"")){this.setValue(this.relString);this.setJsonData(this._jsonArray);this.fireChange({newValue:this.relString,astNodes:this.astresponseNodes,displayText:this._input[0].textContent.trim()});}},_contextForPerviousSpans:function(s){var i="";var p;var r=this.getDomRef("input").children;for(var t=0;t<r.length;t++){var u=$("#"+r[t].id);if(r[t].id!==s[0].id){if(u[0].getAttribute(h.JSON)){try{p=JSON.parse(u[0].getAttribute(h.JSON));if(p.expandedText){i+=p.expandedText;}}catch(e){q.sap.log.error("Error in parsing string to JSON: "+e.message);}}else if(u[0].getAttribute(h.REFERENCE)){i+=u[0].getAttribute(h.REFERENCE);}else{i+=u[0].textContent}}else{i+="";break;}}return i;},_updateSelectFunction:function(e){this.isDialogOpen=false;this._selectedSpans[0].setAttribute(h.JSON,JSON.stringify(e.getSource().mProperties.jsonData));this._selectedSpans[0].textContent=e.getSource().mProperties.value;this._updateUiModel();this._uiModel=this._convertInputToUiModel(this.relString);this._input.empty();this._uiModelToSpan(this._uiModel);this._setCurrentCursorPosition(this._cursorPostion);},_updateAggregateFunction:function(e){this.isDialogOpen=false;this._selectedSpans[0].setAttribute(h.JSON,JSON.stringify(e.getSource().mProperties.jsonData));this._selectedSpans[0].textContent=e.getSource().mProperties.value;this._updateUiModel();this._uiModel=this._convertInputToUiModel(this.relString);this._input.empty();this._uiModelToSpan(this._uiModel);this._setCurrentCursorPosition(this._cursorPostion);},_getNewSpaceSpan:function(){var i={};i.id=this._createUUID();i.text=" ";i.tokenType=h.WS;i.cssClass="sapAstAuxilaryNodeClass";return this._createSpanItem(i);},_createSpaceSpanItem:function(){var e=this._getNewSpaceSpan();var s=this._selectedSpans[0]?this._selectedSpans[0].id:"";var i="#"+s;$(e[0]).insertAfter(i);this._updateUiModel();this._cursorPostion+=e[0].textContent.length;this._selectedSpans=$(e);this._uiModel=this._convertInputToUiModel(this.relString);this._hasTextContent=true;this.nIndexOfToken+=1;},_addSpace:function(){this._createSpaceSpanItem();if(this.bEditInBetween){this._getSuggestionsForEditedInput(false);}else{this._suggestionsList=this._getSuggestionsForTheGivenInput(this.relString);}this._setCaretPosition({spanIndex:this.nIndexOfToken,position:this._selectedSpans[0].textContent.length});this._showAutoSuggestion(this._suggestionsList);},_removeSpans:function(){var e=false;if(this._uiModel.length===0||this._input.children().length===0){return e;}this._prevNodeofRemovedNode=null;for(var i=0;i<this._selectedSpans.length;i++){this._prevNodeofRemovedNode=$("#"+this._selectedSpans[i].id).prev()[0];if(this._selectedSpans[i]instanceof HTMLSpanElement){if(this._selectedSpans[i].textContent){this._cursorPostion-=this._selectedSpans[i].textContent.length;}$(this._selectedSpans[i]).remove();e=true;}if("getAttribute"in this._selectedSpans[i]&&this._selectedSpans[i].getAttribute("class")==="sapAstObjectClass"){this._attributeContext=false;}}if(this.getDomRef("input")&&this.getDomRef("input").textContent&&!this.getDomRef("input").textContent.length>0){this._hasTextContent=false;}return e;},_showAutoSuggestion:function(s,e){var i=q(this._selectedSpans);var x=0;if(this._cursorPostion!==0){if(i&&i[0]instanceof HTMLPreElement){x=12;}else{if("position"in i&&i.position()){x=parseInt(i.position().left,10);}x+=parseInt(i.width(),10);}}var y=3;x+=10;var t=this;if(this._oAutoSuggestionPopUp&&!this._oAutoSuggestionPopUp.isOpen()){this._oAutoSuggestionPopUp.destroyContent();this._oAutoSuggestionPopUp.addContent(new sap.rules.ui.AutoCompleteSuggestionContent({content:s.autoComplete,reference:t._reference,enableAggregateFunctionVocabulary:t._enableAggregateFunctionVocabulary,enableAggregateFunctionWhereClause:t._enableAggregateFunctionWhereClause,dialogOpenedCallbackReference:t._isDialogOpenedCallbackReference,vocabularyInfo:t._oAstExpressionLanguage,expand:e}));this._oAutoSuggestionPopUp.setOffsetX(x);this._oAutoSuggestionPopUp.setOffsetY(y);this._oAutoSuggestionPopUp.openBy(this.getDomRef("input"));}else{this._oAutoSuggestionPopUp.destroyContent();this._oAutoSuggestionPopUp.addContent(new sap.rules.ui.AutoCompleteSuggestionContent({content:s.autoComplete,reference:t._reference,enableAggregateFunctionVocabulary:t._enableAggregateFunctionVocabulary,enableAggregateFunctionWhereClause:t._enableAggregateFunctionWhereClause,dialogOpenedCallbackReference:t._isDialogOpenedCallbackReference,vocabularyInfo:t._oAstExpressionLanguage,expand:e}));this._oAutoSuggestionPopUp.setOffsetX(x);this._oAutoSuggestionPopUp.setOffsetY(y);}if(!this._oAutoSuggestionPopUp.isOpen()){this._oAutoSuggestionPopUp.setOffsetX(x);this._oAutoSuggestionPopUp.setOffsetY(y);this._oAutoSuggestionPopUp.openBy(this.getDomRef("input"));}},_isLastTokenSpaceItem:function(){var i=true;var e=[];if(this.bEditInBetween&&this.tempRelString!=""&&this.nIndexOfToken>=0){e=this._uiModel[this.nIndexOfToken];if(this._attributeContext||(this._selectedSpans[0].textContent!==this.filterText)){return true;}}else if(this._uiModel&&this._uiModel.length>0){e=this._uiModel[this._uiModel.length-1];}if(e&&(e.tokenType===h.WS||e.tokenType===h.UNDEFINED)){return true;}if(e&&e.tokenType!==h.WS&&e.dataObjectType&&e.dataObjectType!=="S"&&e.dataObjectType!=="T"&&e.dataObjectType!=="AO"&&(e.tokenType===h.TERM&&!e.getText().endsWith(h.DOT))){i=false;}else if(e&&e.tokenType!==h.WS&&e.tokenType!==h.TERM&&e.reference===undefined){i=false;}else if(e&&e.tokenType!==h.WS&&this._uiModel[0]&&"getText"in this._uiModel[0]&&(this._uiModel[0].getText().toUpperCase()===h.UPDATE||this._uiModel[0].getText().toUpperCase()===h.APPEND)&&!this._attributeContext){i=false;}else if(e&&(e.tokenType==="D"||e.tokenType==="T")&&this._uiModel[0]&&"getText"in this._uiModel[0]){i=false;}else if(e&&e.tokenType==="ID"&&!e.dataObjectType){var p=e.getReference()?e.getReference().split("/")[1]:"";if(T.getInstance().getTermByTermId(p).isResultDataObjectElement){i=false;}}return i;},_addItemToEmptyInput:function(e,i,s,p){if(p.resultDataObjectId&&p.resultDataObjectId!==""&&p.tokenType===h.TERM){this.ruleContext=true;}i=this._createSpanItem(p);this._uiModel.push(p);this._uiModeltoString();this._uiModel=this._convertInputToUiModel(this.relString);this._cursorPostion=p.text.length;this._uiModelToSpan(this._uiModel);this._selectedSpans=i;if(this.getIsAttributeContext()&&!this.isAssociation&&!p.json&&this._oAutoSuggestionPopUp&&this._oAutoSuggestionPopUp.isOpen){this.isAutoSuggestionRequired=false;this._oAutoSuggestionPopUp.close();}},_addAtBeginningForInBetween:function(e,s,i,p){$(e[0]).insertBefore(s);this._cursorPostion=p.text.length;this._selectedSpans=$(e);$(i[0]).insertBefore(s);p.bAddSpaceAutoMatically=false;if(!p.text.endsWith(h.DOT)){this._cursorPostion+=1;this._selectedSpans=$(i);this.nIndexOfToken+=1;}},_handleUndefinedForInBetween:function(e,i,p,r,s,t){if(e.textContent.startsWith(h.SINGLE_QUOTE)){this._selectedSpans[0].textContent+=i.text;this._cursorPostion+=i.text.length;}else{var u=this._selectedSpans[0].textContent.length;this._selectedSpans[0].textContent=i.text;this._cursorPostion+=i.text.length-u;this._replacePreviousUndefinedTokens();if(p&&p.getAttribute(h.TOKEN_TYPE)===h.TERM&&p.textContent.endsWith(h.DOT)){this.nIndexOfToken-=1;}}if(r&&r.getAttribute(h.TOKEN_TYPE)!==h.WS){$(s[0]).insertAfter(t);i.bAddSpaceAutoMatically=false;}if(i.reference){this._selectedSpans[0].setAttribute(h.REFERENCE,i.reference);}if(i.json){this._selectedSpans[0].setAttribute(h.JSON,JSON.stringify(i.json));}},_addInBetweenTermsForInBetween:function(e,i,s,p,r){if(this.filterText.indexOf(h.DOT)>-1){this._appendItemText(this.filterText,e,p);}else if(this.getOperationsContext()&&this.bEditInBetween&&e.getAttribute("tokentype")==="ID"&&e.textContent.endsWith(h.DOT)){this._appendItemText(e.textContent,e,p);}else{this._selectedSpans[0].textContent=p.text;this._selectedSpans[0].setAttribute("reference",p.reference);}this._cursorPostion=this._cursorPostion-this.filterText.length+this._selectedSpans[0].textContent.length;},_appendItemText:function(e,p,r){var s=e.split(h.DOT);var t=p.getAttribute("reference").split("/");var u="";var v="";for(var i=0;i<s.length-1;i++){v+=s[i]+h.DOT;u+="/"+t[i+1];}if(t[0]===h.DOT){u=h.DOT+u;}r.reference=r.reference.replace(".","");this._selectedSpans[0].textContent=v+r.text;this._selectedSpans[0].setAttribute("reference",u+r.reference);},_addItemInBetween:function(e,i,s,p,r){var t=i.previousSibling;var u=i.nextSibling;e=this._createSpanItem(p);var v=this._getNewSpaceSpan();if(this._cursorPostion===0&&this.nIndexOfToken===0&&!t){this._addAtBeginningForInBetween(e,s,v,p);}else if(i.getAttribute(h.TOKEN_TYPE)===h.UNDEFINED){this._handleUndefinedForInBetween(i,p,t,u,v,s);}else if(p.json){$(e[0]).insertAfter(s);this._selectedSpans=e;this._cursorPostion+=e[0].textContent.length;this.nIndexOfToken+=1;if(u.getAttribute(h.TOKEN_TYPE)!==h.WS){$(v[0]).insertAfter(s);p.bAddSpaceAutoMatically=false;this.nIndexOfToken+=1;}}else if((i.getAttribute(h.TOKEN_TYPE)===h.TERM&&!(i.textContent.endsWith(h.DOT)&&this.filterText===i.textContent))||(i.getAttribute(h.TOKEN_TYPE)===h.FUNCTION&&i.textContent.length===1)){if(this.getOperationsContext()&&this._attributeContext&&e[0].textContent===h.DOT){this._selectedSpans[0].textContent+=p.text;this.isAutoSuggestionRequired=true;this.dotInOperationsContext=true;this._cursorPostion=this._cursorPostion+1;}else{this._addInBetweenTermsForInBetween(i,e,s,p,v);}}else if(i.getAttribute(h.TOKEN_TYPE)===h.TERM&&i.textContent.endsWith(h.DOT)){this._selectedSpans[0].textContent+=p.text;if(p.text===h.DOT&&this._attributeContext){this.isAutoSuggestionRequired=true;this.dotInOperationsContext=true;this._cursorPostion=this._cursorPostion+1;}else{if(p.reference){var w=i.getAttribute(h.REFERENCE)?i.getAttribute(h.REFERENCE)+p.reference:p.reference;this._selectedSpans[0].setAttribute(h.REFERENCE,w);}if(p.json){this._selectedSpans[0].setAttribute(h.JSON,JSON.stringify(p.json));}}this._cursorPostion+=p.text.length;}else if(i.className==="sapAstLiteralClass"){var x=this.filterTextLength;if(this._selectedSpans[0].getAttribute(h.TOKEN_TYPE)==h.DATEBUSINESSDATATYPE||this._selectedSpans[0].getAttribute(h.TOKEN_TYPE)===h.TIMEBUSINESSDATATYPE){this._selectedSpans[0].setAttribute(h.REFERENCE,p.text);}this._selectedSpans[0].textContent=p.text;this._cursorPostion+=p.text.length-x;if(u&&u.getAttribute(h.TOKEN_TYPE)===h.WS){p.bAddSpaceAutoMatically=false;}}else if(r){var x=this._selectedSpans[0].textContent.length;this._selectedSpans[0].textContent=p.text;this._cursorPostion+=p.text.length-x;if(t&&t.getAttribute(h.TOKEN_TYPE)===h.TERM&&t.textContent.endsWith(h.DOT)){this.nIndexOfToken-=1;}if(p.reference){this._selectedSpans[0].setAttribute(h.REFERENCE,p.reference);}}else{$(e[0]).insertAfter(s);if(i.getAttribute(h.TOKEN_TYPE)!==h.WS){$(v[0]).insertAfter(s);this._cursorPostion+=1;this.nIndexOfToken+=1;}this._selectedSpans=$(e);this._cursorPostion+=e[0].textContent.length;if(!this._isLastTokenSpaceItem()){this._addSpace();}else{this.nIndexOfToken+=1;}if(u&&u.getAttribute(h.TOKEN_TYPE)!==h.WS){v=this._getNewSpaceSpan();$(v[0]).insertAfter($("#"+this._selectedSpans[0].id));p.bAddSpaceAutoMatically=false;}}if(p.text.endsWith(" (")){this.nIndexOfToken+=2;}this._updateUiModel();this._uiModel=this._convertInputToUiModel(this.relString);this._uiModelToSpan(this._uiModel);this._getSelectedSpanFromIndex();this._getSuggestionsForEditedInput(false);},_addItemsToTheEnd:function(e,i,s,p,r){if(i.getAttribute(h.TOKEN_TYPE)===h.UNDEFINED){if(i.textContent.startsWith(h.SINGLE_QUOTE)){this._selectedSpans[0].textContent+=p.text;this._cursorPostion+=p.text.length;}else{var t=this._selectedSpans[0].textContent.length;this._selectedSpans[0].textContent=p.text;this._cursorPostion+=p.text.length-t;if(p.tokenType===h.TERM){this._cursorPostion+=1;}this._replacePreviousUndefinedTokens();}if(p.reference){this._selectedSpans[0].setAttribute(h.REFERENCE,p.reference);}if(p.json){this._selectedSpans[0].setAttribute(h.JSON,JSON.stringify(p.json));}}else if(p.json||i.getAttribute(h.TOKEN_TYPE)===h.WS){e=this._createSpanItem(p);$(e[0]).insertAfter(s);this._selectedSpans=e;this._cursorPostion+=e[0].textContent.length;}else if(r){var t=this._selectedSpans[0].textContent.length;this._selectedSpans[0].textContent=p.text;this._cursorPostion+=p.text.length-t;if(p.tokenType===h.TERM){this._cursorPostion+=1;}if(p.reference){this._selectedSpans[0].setAttribute(h.REFERENCE,p.reference);}}else{this._selectedSpans[0].textContent+=p.text;if(p.text===h.DOT&&this._attributeContext){this.isAutoSuggestionRequired=true;this.dotInOperationsContext=true;this._cursorPostion=this._cursorPostion+1;}else{if(p.reference){var u=this._selectedSpans[0].getAttribute(h.REFERENCE)?this._selectedSpans[0].getAttribute(h.REFERENCE)+p.reference:p.reference;this._selectedSpans[0].setAttribute(h.REFERENCE,u);}if(p.json){this._selectedSpans[0].setAttribute(h.JSON,JSON.stringify(p.json));}this._cursorPostion+=p.text.length;}}this._updateUiModel();this._uiModel=this._convertInputToUiModel(this.relString);this._uiModelToSpan(this._uiModel);this._hasTextContent=true;if(this.getIsAttributeContext()&&!this.isAssociation&&!p.json&&this._oAutoSuggestionPopUp&&this._oAutoSuggestionPopUp.isOpen()){this.isAutoSuggestionRequired=false;this._oAutoSuggestionPopUp.close();}},_bReplaceFunctionWithSelectedItem:function(e,i){if(e&&e.className==="sapAstFunctionClass"){var p=i.text.toLowerCase();var r=i.label?i.label.toLowerCase():"";var s=e.textContent.toLowerCase();return(p.startsWith(s)||r.indexOf(s)>-1);}return false;},_resetCursorForRerendering:function(){var e=0;if(this.bEditInBetween){e=this._getFullTextContentLength();if(e!==this._cursorPostion&&this._cursorPostion!==0){this._cursorPostion=e;}}},_getFullTextContentLength:function(){var e=0;for(var i=0;i<=this.nIndexOfToken;i++){e+=this._getSelectedSpanGivenIndex(i)[0].textContent.length;}return e;},_setTextOnCursorPosition:function(e){this.dotInOperationsContext=false;this.bTypingFlow=false;var i;this._resetCursorForRerendering();var p=this._selectedSpans?this._selectedSpans[0]:{};var s="#"+p.id;var r=(p.getAttribute(h.TOKEN_TYPE)===h.WS||this._uiModel.length===0)?"":p.id;var t=this._getItemFromSuggestionModel(e,r);this.ruleContext=false;this.forceFireChange=false;var u=this._bReplaceFunctionWithSelectedItem(p,t);if(!this._selectedSpans[0].textContent.endsWith(".")&&!u&&!this._isLastTokenSpaceItem()&&e.getSource().mProperties&&e.getSource().mProperties.label&&e.getSource().mProperties.label!==h.DOT&&this._cursorPostion>0){this._createSpaceSpanItem();p=this._selectedSpans[0];s="#"+p.id;}if(e&&e.getSource()&&e.getSource().mProperties.forceFireChange){this.forceFireChange=true;}if(this._uiModel.length===0){this._addItemToEmptyInput(e,i,s,t);}else if(p&&this.bEditInBetween){this._addItemInBetween(i,p,s,t,u);}else if(p){this._addItemsToTheEnd(i,p,s,t,u);if(this.isAssociation){this._cursorPostion+=1;}}else{console.error("could not find the user selected span - currentSpan");}if(this._bPopUpFocused){this._input.focus();this._bPopUpFocused=false;}if(!this.bEditInBetween){this.nIndexOfToken=this._input.children().length-1;this._selectedSpans=[];this._selectedSpans.push(this._input.children()[this._input.children().length-1]);}this._setCaretPosition({spanIndex:this.nIndexOfToken,position:this._selectedSpans[0]?this._selectedSpans[0].textContent.length:this._cursorPostion});if(this.isAutoSuggestionRequired){if((t.bAddSpaceAutoMatically&&!this._isLastTokenSpaceItem())&&!(this.bEditInBetween&&this._uiModel[this.nIndexOfToken+1].tokenType===h.WS)){this._addSpace();}else{if(this.bEditInBetween&&!this._isLastTokenSpaceItem()){this._setCaretPosition({spanIndex:this.nIndexOfToken+1,position:1});}else if(!this.bEditInBetween){this._suggestionsList=this._getSuggestionsForTheGivenInput(this.relString);}this._showAutoSuggestion(this._suggestionsList);}}},_replacePreviousUndefinedTokens:function(){var e=this._selectedSpans[0];var p=e.previousSibling;var r;while(p&&p.previousSibling){if((p.getAttribute(h.TOKEN_TYPE)===h.WS&&p.previousSibling.getAttribute(h.TOKEN_TYPE)===h.UNDEFINED)||p.getAttribute(h.TOKEN_TYPE)===h.UNDEFINED){r=p;p=p.previousSibling;r.remove();this.nIndexOfToken-=1;}else{break;}}if(p&&!p.previousSibling&&p.getAttribute(h.TOKEN_TYPE)===h.UNDEFINED){p.remove();this.nIndexOfToken-=1;}},_getItemFromSuggestionModel:function(e,p){this._attributeContext=false;this.isAssociation=false;var i={};var s=e.getSource();i.id=this._createUUID();if(s&&s.getBindingContext()){var B=s.getBindingContext().getObject();i.dataObjectType=B.type;if(B.ResultDataObjectId){i.resultDataObjectId=B.ResultDataObjectId;if(B.displayType&&B.displayType==="Rule"||i.resultDataObjectId){var t=this._oAstExpressionLanguage._astBunldeInstance.TermsProvider.TermsProvider;var r=t.getTermByTermId(B.ResultDataObjectId);if(r&&r.getIsDataObjectElement()){this.ruleWithElementDO=true;i.dataObjectType="ruleWithElementDO";i.cssClass="sapAstObjectClass";i.tokenType=h.TERM;i.text=(B.label!==null&&B.label!=="")?B.label:B.name;i.bAddDotAutomatically=false;i.bAddSpaceAutoMatically=true;i.id=B.id?"/"+B.id:"";i.reference=B.id?"/"+B.id:"";}else{var i=this._createObjectSpanItem(i,p,B);}}}else if(B.type===h.Element){i.tokenType=h.TERM;i.cssClass="sapAstObjectClass";i.id="";i.text=(B.label!==null&&B.label!=="")?B.label:B.name;if(this.getDataObjectInfo()&&this.isDotRequired){i.reference=B.id?"./"+B.id:"";}else{this.isDotRequired=true;i.reference=B.id?"/"+B.id:"";}i.bAddDotAutomatically=false;i.bAddSpaceAutoMatically=true;if(p&&p.indexOf("-")>0){p=p.substring(p.indexOf("-")+1)}i.id=p!==''?p+h.DOT+B.id:B.id;var u=T.getInstance();var v=u.getTermByTermId(i.id);if(v&&v._isDataObjectElement){i._isDataObjectElement=true;}}else if("type"in B){var i=this._createObjectSpanItem(i,p,B);}else{i.text=B.name;if(B&&"noOfMandatoryArgs"in B){if(B.noOfMandatoryArgs==="0"){i.text+=" ( )";}else{i.text+=" (";}}i.bAddDotAutomatically=false;i.bAddSpaceAutoMatically=true;}}else if(e.getParameter("tokens")){var V=e.getParameter("tokens")[0].data("row");;i.text=V.Value;i.bAddDotAutomatically=false;i.bAddSpaceAutoMatically=true;i.cssClass="sapAstLiteralClass";}else if(e.getSource().mProperties.jsonData){i.text=e.getSource().mProperties.value;i.json=e.getSource().mProperties.jsonData;i.bAddDotAutomatically=false;i.bAddSpaceAutoMatically=true;}else{i.text=e.getSource().mProperties.value.trim();i.bAddDotAutomatically=false;i.bAddSpaceAutoMatically=true;}if(this.getDataObjectInfo()&&!this.bEditInBetween){if(i.json){this.dataObjectInfo+=this._constructExpandedRelString(i.json);}else if(this.getIsAttributeContext()){this.dataObjectInfo+=i.reference?i.reference.replace(".",""):i.text;}else{this.dataObjectInfo+=i.reference?i.reference:i.text;}if((i.dataObjectType&&i.dataObjectType!=="AO")||!i.dataObjectType){this.dataObjectInfo+=" ";}}if(e.getSource().mProperties.label===h.DOT){i.bAddDotAutomatically=false;i.bAddSpaceAutoMatically=false;this._attributeContext=true;}return i;},_createObjectSpanItem:function(i,p,B){i.tokenType=h.TERM;i.cssClass="sapAstObjectClass";i.id="";i.text=(B.label!==null&&B.label!=="")?B.label:B.name;if(B.type!==h.ASSOCIATIONDOTYPE){i.reference=B.id?"/"+B.id:"";if(p&&p.indexOf("-")>0){p=p.substring(p.indexOf("-")+1)}i.id=p!==''?p+h.DOT+B.id:B.id;}else{this.isAssociation=true;if(this.getDataObjectInfo()&&this.isDotRequired){i.reference=B.id?"./"+B.id:"";this.isDotRequired=false;}else{i.reference=B.id?"/"+B.id:"";}i.id+=B.id;}if(this.getDataObjectInfo()){this.isDotRequired=false;}this._attributeContext=true;i.bAddDotAutomatically=true;i.bAddSpaceAutoMatically=false;if(this._uiModel&&this._uiModel.length>0&&this._uiModel[0]&&"getText"in this._uiModel[0]&&(this._uiModel[0].getText().toUpperCase()===h.UPDATE||this._uiModel[0].getText().toUpperCase()===h.APPEND)&&this.getOperationsContext()&&!this.getConditionContext()){this._attributeContext=false;i.bAddDotAutomatically=false;i.bAddSpaceAutoMatically=false;this.isDotRequired=false;}return i;},_createPopver:function(){var t=this;if(!this._oAutoSuggestionPopUp){this._oAutoSuggestionPopUp=new R({content:new sap.rules.ui.AutoCompleteSuggestionContent(),showArrow:false,placement:P.Vertical,horizontalScrolling:true,showHeader:false,contentWidth:"400px",initialFocus:t,afterOpen:function(){var p;if(t.bEditInBetween){p=t.filterTextLength;}else{p=t._selectedSpans[0].textContent.length;}var e=t._cursorPostion===0?0:p;t._setCaretPosition({spanIndex:t.nIndexOfToken,position:e});}});}},_getCaretPosition:function(I,s){var r,p,t,u=0;var v=function(N){return(I&&N===I)||(!I&&(N===p.anchorNode||N===p.anchorNode.parentNode));};var w=function(N){var x;if(v(N)){return false;}if(N.nodeType===3){u+=N.textContent.length;}else{for(var i=0;i<N.childNodes.length;i++){x=N.childNodes[i];if(v(x)){return false;}u+=x.textContent.length;}}return true;};try{if(window.getSelection&&window.getSelection().getRangeAt){r=window.getSelection().getRangeAt(0);p=window.getSelection();t=this._input[0].childNodes;for(var i=0;i<t.length;i++){if(!w(t[i])){break;}}return(s||r.startOffset)+u;}}catch(e){return this._cursorPostion;}return 0;},_getSelectedSpans:function(){var s=window.getSelection();var e=new Array();if("getRangeAt"in s){var r=s.getRangeAt(0);if(r.startContainer==r.endContainer){e.push(r.startContainer.parentNode);}else{var i=$(r.startContainer.parentNode);var p=$(r.endContainer.parentNode);e.push(i);$(r.startContainer.parentNode).nextAll().each(function(){var t=$(this).attr('id');if(t!=$(p).attr('id')){e.push($(this));}else{e.push(p);return false;}});}}else{e.push(s.anchorNode.parentNode);}return e;},_createRange:function(e,i,r){if(!r){r=document.createRange();r.selectNode(e);r.setStart(e,0);}if(i.count===0){r.setEnd(e,i.count);}else if(e&&i.count>0){if(e.nodeType===Node.TEXT_NODE){if(e.textContent!=undefined&&e.textContent.length<i.count){i.count-=e.textContent.length;}else{r.setEnd(e,i.count);i.count=0;}}else{for(var p=0;p<e.childNodes.length;p++){r=this._createRange(e.childNodes[p],i,r);if(i.count===0){break;}}}}return r;},_setCurrentCursorPosition:function(e){if(e>=0){var s=window.getSelection();var r=this._createRange($("#"+this.getDomRef("input").id)[0],{count:e});if(r){r.collapse(false);s.removeAllRanges();s.addRange(r);}}},_updateUiModel:function(){var t=this;if(this.getDomRef("input")){var i=this.getDomRef("input").children;t._uiModel=[];for(var p=0;p<i.length;p++){var r=i[p].getAttribute(h.TOKEN_TYPE)!==h.GEOBUSINESSDATATYPE?i[p].getAttribute(h.REFERENCE):undefined;var s=i[p].getAttribute(h.JSON);var u={"id":i[p].id,"cssClass":i[p].className,"reference":r,"tokenType":i[p].getAttribute(h.TOKEN_TYPE),"text":i[p].textContent};if(s){try{u.json=JSON.parse(s);}catch(e){q.sap.log.error("Error in parsing string to JSON: "+e.message);}}this._uiModel.push(u);}t._uiModeltoString();}},_uiModeltoString:function(){var t=this;t.relString="";t._jsonArray=[];this._uiModel.forEach(function(i,e){if(i.reference){t.relString+=i.reference;}else if(i.json){t.relString+=t._constructExpandedRelString(i.json);t._jsonArray.push(i.json);}else{t.relString+=i.text;}});return t.relString;},_calculateStringAndIndexOfNewToken:function(){var t=this;var i="";var p="";if(this.getDomRef("input")){var r=this.getDomRef("input").children;var s=this._selectedSpans?this._selectedSpans[0].id:"";for(var u=0;u<r.length;u++){var v=r[u].getAttribute(h.TOKEN_TYPE)!==h.GEOBUSINESSDATATYPE?r[u].getAttribute(h.REFERENCE):undefined;var w=r[u].getAttribute(h.JSON);if(w){try{w=JSON.parse(w);}catch(e){q.sap.log.error("Error in parsing string to JSON: "+e.message);}}if(r[u].id===s){this.nIndexOfToken=u;var x=p+r[u].textContent;var y=r[u].textContent;var z=x.length-this._cursorPostion;this.filterTextLength=z>=0?y.length-z:y.length;var B=this.filterTextLength<0?y:y.slice(0,this.filterTextLength);this.filterText=B;if(v){i+=this._constructReferenceForFilter(B,v,z);}else if(w){i+=t._constructExpandedRelString(w);}else{i+=B;}break;}p+=r[u].textContent;if(v){i+=v;}else if(w){i+=t._constructExpandedRelString(w);}else{i+=r[u].textContent;}}}return i;},_constructReferenceForFilter:function(e,r,p){var s=e.split(".");var t=r.split("/");var u="";if((p<=0&&s.length===0)||(this._enableAggregateFunctionWhereClause&&r&&p<=0)){return r;}if(s.length>1){if(p<=0){if(this.bTypingFlow){return r+s[s.length-1];}else{return r;}}for(var i=1;i<s.length;i++){u+="/"+t[i];}u+=s[s.length-1];this._attributeContext=true;}else{u=e;this._attributeContext=false;}return u;},_getSelectedSpanFromIndex:function(){if(this.getDomRef("input")){var e=this.getDomRef("input").children;this._selectedSpans=$(e[this.nIndexOfToken]);}},_getSelectedSpanGivenIndex:function(i){if(this.getDomRef("input")){var e=this.getDomRef("input").children;if(e[i]){return $(e[i]);}else{return null;}}},_isChildOf:function(e,p){while(e!==null){if(e.id===p){return true;}e=e.parentNode;}return false;},_getCurrentCursorPosition:function(){var p=this.getDomRef("input").id;var s=window.getSelection(),e=-1,i;if(s.focusNode){if(this._isChildOf(s.focusNode,p)){i=s.focusNode;e=s.focusOffset;while(i){if(i.id===p){break;}if(i.previousSibling){i=i.previousSibling;e+=i.textContent.length;}else{i=i.parentNode;if(i===null){break}}}}}return e;},_hiddenAccessModeSelected:function(e,D,i){if(this._input&&this._input[0].id===i.expId){this._input[0].classList.add("sapAstExpressionInputError");this._input[0].title=this.oBundle.getText("PredefinedResultsValueStateText");this.expId=i.expId}},_validateControl:function(){var v=this.getValueState();var e=this.getValueStateText();if((this.astresponseNodes&&this.astresponseNodes.length===1&&this.astresponseNodes[0].Type==="I")&&this.astresponseNodes[0].Value!==""||(this.astresponseNodes&&v==="Error")){this._input[0].classList.add("sapAstExpressionInputError");if(e){this._input[0].title=e;}else{this._input[0].title=this.oBundle.getText("invalidExpression");}}else if(this.oBundle.getText("PredefinedResultsValueStateText")===e){this._input[0].classList.add("sapAstExpressionInputError");if(e){this._input[0].title=e;}else{this._input[0].title=this.oBundle.getText("invalidExpression");}}else if(this._input[0].classList.contains("sapAstExpressionInputError")&&this._input[0].textContent===""){this._input[0].classList.add("sapAstExpressionInputError");this._input[0].title=this.oBundle.getText("PredefinedResultsValueStateText");this.expId="";}else if(this._input[0].id===this.expId&&this._input[0].textContent!==""){this._input[0].classList.add("sapAstExpressionInputError");this._input[0].title=this.oBundle.getText("PredefinedResultsValueStateText");this.expId="";}else{if(this._input[0].classList.contains("sapAstExpressionInputError")){this._input[0].classList.remove("sapAstExpressionInputError");}}}});return o;},true);
