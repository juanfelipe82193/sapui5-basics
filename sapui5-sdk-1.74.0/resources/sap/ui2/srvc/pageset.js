// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
this.sap=this.sap||{};(function(){"use strict";sap.ui2=sap.ui2||{};sap.ui2.srvc=sap.ui2.srvc||{};var O={assigned:1,userCreated:2,personalized:3,defaultPage:4};jQuery.sap.declare("sap.ui2.srvc.pageset");sap.ui2.srvc.PageSet=function(f,p){var I,a,d,P=[],o,b=true,t=this;function c(){if(b){throw new sap.ui2.srvc.Error(t+": page set is just a stub","sap.ui2.srvc.PageSet");}}sap.ui2.srvc.testPublishAt(t);function g(h){var I=h.getId(),i;c();if(!o.containsKey(I)){throw new sap.ui2.srvc.Error("Unknown page "+I,"sap.ui2.srvc.PageSet");}i=o.get(I);if(i===O.assigned&&h.isPersonalized()){i=O.personalized;}return i;}function e(n){var D=n.DefaultPage.id,r=(n.AssignedPages&&n.AssignedPages.results)||[];a=n;o=new sap.ui2.srvc.Map();r.forEach(function(R){o.put(R.id,O.assigned);});a.Pages.results.forEach(function(R){var h=new sap.ui2.srvc.Page(f,R),s=h.getId();P.push(h);if(D===s){d=h;o.put(s,O.defaultPage);}else if(!o.containsKey(s)){o.put(s,O.userCreated);}});delete a.AssignedPages;delete a.DefaultPage;delete a.Pages;b=false;jQuery.sap.log.debug("Initialized: "+t,null,"sap.ui2.srvc.PageSet");}this.appendPage=function(s,C,S,F){c();if(typeof S!=="function"){throw new sap.ui2.srvc.Error("Missing success handler","sap.ui2.srvc.PageSet");}f.getPageBuildingService().createPageInPageSet(I,s,C,function(n){var N=new sap.ui2.srvc.Page(f,n);P.push(N);o.put(N.getId(),O.userCreated);jQuery.sap.log.debug("Appended new page with ID "+N.getId()+" to pageset "+t,null,"sap.ui2.srvc.PageSet");S(N);},F);};this.isPageRemovable=function(h){return g(h)===O.userCreated;};this.isPageResettable=function(h){return g(h)===O.personalized;};this.removePage=function(h,s,F){if(!this.isPageRemovable(h)){throw new sap.ui2.srvc.Error("Cannot remove page "+h.getId(),"sap.ui2.srvc.PageSet");}h.remove(function(){P.splice(P.indexOf(h),1);o.remove(h.getId());if(s){s();}},F);};this.resetPage=function(h,s,F){if(!this.isPageResettable(h)){throw new sap.ui2.srvc.Error("Cannot reset page "+h.getId(),"sap.ui2.srvc.PageSet");}h.remove(function(){h.load(s,F,true);},F);};this.filter=function(h,C){var i,r=[],j;c();h=h||[];C=C||[];for(i=0;i<P.length;i+=1){j=P[i];if(h.indexOf(j.getId())!==-1){r.push(j);}else if(j.getCatalog()&&C.indexOf(j.getCatalog().getId())!==-1){r.push(j);}}P=r;};this.getConfiguration=function(){c();return a.configuration;};this.setConfiguration=function(C,s,F){c();if(typeof s!=="function"){throw new sap.ui2.srvc.Error("Missing success handler","sap.ui2.srvc.PageSet");}if(a.configuration===C){sap.ui2.srvc.call(s,F,true);return;}a.configuration=C;f.getPageBuildingService().updatePageSet(a,function(n){s();},F);};this.getDefaultPage=function(){c();return d;};this.getId=function(){return I;};this.getPages=function(){c();return P.slice();};this.isStub=function(){return b;};this.load=function(s,F){if(!b){throw new sap.ui2.srvc.Error("Page set is not a stub anymore","sap.ui2.srvc.PageSet");}f.getPageBuildingService().readPageSet(I,function(n){jQuery.sap.log.debug("Loaded: "+t,null,"sap.ui2.srvc.PageSet");e(n);s();},F,true);};this.toString=function(v){var r=['sap.ui2.srvc.PageSet({sId:"',I,'",bIsStub:',b];if(v){r.push(',oAlterEgo:',JSON.stringify(a),',oFactory:',f.toString(v),',aPages:',JSON.stringify(P));}r.push('})');return r.join('');};jQuery.sap.require("sap.ui2.srvc.page");jQuery.sap.require("sap.ui2.srvc.utils");I=p;if(!I){throw new sap.ui2.srvc.Error("Missing page set ID","sap.ui2.srvc.PageSet");}jQuery.sap.log.debug("Created: "+this,null,"sap.ui2.srvc.PageSet");};}());
