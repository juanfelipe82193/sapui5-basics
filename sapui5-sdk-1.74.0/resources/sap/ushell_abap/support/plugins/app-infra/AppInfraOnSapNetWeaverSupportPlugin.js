// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/support/Plugin","sap/ui/core/HTML","sap/ui/layout/VerticalLayout","sap/m/Text","sap/base/i18n/ResourceBundle","sap/base/security/encodeXML","sap/m/Panel","sap/m/Toolbar","sap/m/Image","sap/m/Title"],function(q,P,H,V,T,R,e,a,b,I,c){"use strict";var A=P.extend("sap.ushell_abap.support.plugins.app-infra.AppInfraOnSapNetWeaverSupportPlugin",{constructor:function(s){this.sModulePath=sap.ui.require.toUrl("sap/ushell_abap/support/plugins/app-infra");this.oI18n=R.create({url:this.sModulePath+"/i18n/AppInfraOnSapNetWeaverSupportPlugin.properties"});P.apply(this,["sapUiAppInfraOnSapNetWeaverSupportPlugin",this.oI18n.getText("BACKEND_INFRASTRUCTURE"),s]);}});A.prototype.isToolPlugin=function(){return true;};A.prototype.isAppPlugin=function(){return false;};var g=e("@08@"),y=e("@09@"),r=e("@0A@");A.prototype.getReportLine=function(l,o){var p=(o&&o.putAtBeginningOfEachLine)?o.putAtBeginningOfEachLine:"";l=(l==="")?"&nbsp;":e(l);l="<div>"+p+l.replace(g,"<img src='"+this.sModulePath+"/ABAP_ICON_GREEN_LIGHT.png'/>").replace(y,"<img src='"+this.sModulePath+"/ABAP_ICON_YELLOW_LIGHT.png'/>").replace(r,"<img src='"+this.sModulePath+"/ABAP_ICON_RED_LIGHT.png'/>")+"</div>";return l;};A.prototype.writeReportLine=function(o,l){o.write(this.getReportLine(l));};A.prototype.getReportLines=function(l,o){var t=this;return l.reduce(function(h,L){return h+t.getReportLine(L,o);},"");};A.prototype.writeFormatted=function(f){try{var t=this,i=[],p;this.oInfo=new V("backEndInformation",{content:[new T({text:f.topic}),new T({text:"\n"}),new T({text:this.oI18n.getText("SYSTEM_ID")+" : "+f.sapNetWeaverAsAbap.systemId+" ( "+f.sapNetWeaverAsAbap.systemText+" )"}),new T({text:this.oI18n.getText("CLIENT")+" : "+f.sapNetWeaverAsAbap.client+" ( "+f.sapNetWeaverAsAbap.clientDescription+" )"}),new T({text:this.oI18n.getText("SAP_NETWEAVER_RELEASE")+" : "+f.sapNetWeaverAsAbap.release}),new T({text:"\n"}),new T({text:this.oI18n.getText("SAP_UI_SOFTWARE_COMPONENT")+" : "+f.sapUi.softwareComponent+" ( "+f.sapUi.softwareComponentDescription+" )"}),new T({text:this.oI18n.getText("VERSION")+" : "+f.sapUi.version}),new T({text:this.oI18n.getText("SUPPORT_PACKAGE_LEVEL")+" : "+f.sapUi.supportPackageLevel}),new T({text:"\n"})].map(function(o){return o.addStyleClass("checkInfo");})});i.push(this.oInfo);f.checks.forEach(function(C){function h(C){switch(C.outcome.status){case"S":return t.sModulePath+"/ABAP_ICON_GREEN_LIGHT.png";case"W":return t.sModulePath+"/ABAP_ICON_YELLOW_LIGHT.png";case"E":return t.sModulePath+"/ABAP_ICON_RED_LIGHT.png";default:console.error("SAPUI5 Apps: Check of Infrastructure on SAP NetWeaver Application Server for ABAP - Received invalid status: \""+C.outcome.status+"\" for Check \""+C.title+"\"");return t.sModulePath+"/ABAP_ICON_LIGHT_OUT.png";}}p=new a({expandable:true,expanded:false,width:"auto",headerToolbar:new b({content:[new I({src:h(C)}),new c({level:"H3",text:C.outcome.message})]})});function s(S){switch(S){case"S":return"checkSuccessful";case"W":return"checkEndedWithWarnings";case"E":return"checkEndedWithErrors";default:return"";}}p.addStyleClass(s(C.outcome.status));var o=new H().setContent("<div class=\"checkSummary\">"+t.getReportLines(C.outcome.summary)+"</div><div>&nbsp;</div>&nbsp;<div class=\"sapMText\">"+t.oI18n.getText("DETAILS_BELOW")+"</div><div>&nbsp;</div><div class=\"checkDetails\">"+t.getReportLines(C.outcome.details,{putAtBeginningOfEachLine:"&emsp;&emsp;&emsp;"})+"</div>");p.addContent(o);i.push(p);});return new V({content:i,width:"100%"});}catch(d){return new T({text:this.oI18n.getText("ERROR_RESPONSE_FROM_BACKEND_NOT_PROPERLY_FORMATTED")});}};A.prototype.init=function(){if(this.runsAsToolPlugin()){var t=this,o=sap.ui.getCore().createRenderManager();o.write("<div id=\""+this.getId()+"-Area\" class=\"sapUiSizeCompact\" />").flush(this.$().get(0));this.addStylesheet("sap/ushell_abap/support/plugins/app-infra/AppInfraOnSapNetWeaverSupportPlugin");o.destroy();var d=this.check().done(function(f){t.writeFormatted(f).placeAt(t.getId()+"-Area");}).fail(function(){new T("noBackEndResult",{text:t.oI18n.getText("ERROR_UNABLE_TO_RETRIEVE_INFORMATION_FROM_BACKEND")}).placeAt(t.getId()+"-Area");});return d;}};A.prototype.exit=function(){P.prototype.exit.apply(this,arguments);};A.prototype.destroy=function(){if(this.oInfo){this.oInfo.destroy();}P.prototype.destroy.apply(this,arguments);};A.prototype.check=function(){return q.getJSON("/sap/bc/ui2/check_app_infra",{});};return A;});
